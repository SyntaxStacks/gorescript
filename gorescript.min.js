/*! gorescript / http://gorescript.com */var GS = GS || {};

GS.inherit = function(classObj, members) {
	var base = Object.create(classObj.prototype);

	Object.getOwnPropertyNames(members).forEach(function(prop) {
		var desc = Object.getOwnPropertyDescriptor(members, prop);

		if (desc.get !== undefined) {
			base.__defineGetter__(prop, desc.get);
		} else {
			base[prop] = members[prop];
		}

		if (desc.set !== undefined) {
			base.__defineSetter__(prop, desc.set);
		}
	});

	return base;
};

GS.pushArray = function(dst, src) {
	src.forEach(function(x) {
		this.push(x);
	}, dst);
};

GS.msToFrames = function(ms) {
	return Math.round(ms / 16.66);
};

GS.pad = function(n, width, z) {
	z = z || "0";
	n = n + "";
	return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
};

GS.logOnce = function(id, str) {
	if (GS.logOnce[id.toString()] === true) {
		return;
	}

	GS.logOnce[id.toString()] = true;
	console.log(str);
},

GS.isFirefox = typeof InstallTrigger !== "undefined"; // jshint ignore:line
GS.isIFrame = function() {
    try {
        return window.self !== window.top;
    } catch (e) {
        return true;
    }
}();

GS.Base = function() {
	this.clearColor = 0x000000;
	this.antialias = true;

	this.cameraFov = 90;
	this.cameraNear = 0.1;
	this.cameraFar = 1000;
	this.timeStep = 0.01666;

	this.fpsCounter = {
		updateRate: 0,
		frameRate: 0,
		updates: 0,
		frames: 0,
		currentTime: this.getCurrentTime(),
	};

	this.requestAnimationFrameId = null;
};

GS.Base.prototype = {
	constructor: GS.Base,

	init: function() {
		var that = this;

		this.renderer = new THREE.WebGLRenderer({ antialias: this.antialias });
		this.renderer.setClearColor(this.clearColor, 1);
		this.renderer.setSize(window.innerWidth, window.innerHeight);
		this.renderer.domElement.id = "game-canvas";

		this.camera = new THREE.PerspectiveCamera(this.cameraFov, window.innerWidth / window.innerHeight, this.cameraNear, this.cameraFar);

		this.scene = new THREE.Scene();

		window.addEventListener("resize", function() { that.onResize(); }, false);
		this.onResize();

		document.body.appendChild(this.renderer.domElement);

		this.load();
	},

	load: function() {
		if (this.requestAnimationFrameId !== null) {
			cancelAnimationFrame(this.requestAnimationFrameId);
		}

		this.currentTime = this.getCurrentTime();
		this.accumulator = 0.0;

		this.gameLoop();
	},

	update: function() {
	},

	draw: function() {
		this.renderer.render(this.scene, this.camera);
	},

	// http://gafferongames.com/game-physics/fix-your-timestep/
	gameLoop: function() {
		var that = this;

		var newTime = this.getCurrentTime();
		var frameTime = (newTime - this.currentTime) / 1000;
		if (frameTime > 0.33) {
			frameTime = 0.33;
		}
		this.currentTime = newTime;
		this.accumulator += frameTime;

		while (this.accumulator >= this.timeStep) {
			this.update();
			this.fpsCounter.updates++;

		 	this.accumulator -= this.timeStep;
		}

		this.draw();
		this.fpsCounter.frames++;

		if (newTime - this.fpsCounter.currentTime >= 1000) {
			this.fpsCounter.updateRate = this.fpsCounter.updates;
			this.fpsCounter.frameRate = this.fpsCounter.frames;
			this.fpsCounter.updates = 0;
			this.fpsCounter.frames = 0;
			this.fpsCounter.currentTime = newTime;

			// GS.DebugUI.trackNumericValue("update rate", this.fpsCounter.updateRate);
			GS.DebugUI.trackNumericValue("fps", this.fpsCounter.frameRate);
		}

		this.requestAnimationFrameId = requestAnimationFrame(function() { that.gameLoop(); });
	},

	onResize: function() {
		this.camera.aspect = window.innerWidth / window.innerHeight;
		this.camera.updateProjectionMatrix();

		this.renderer.setSize(window.innerWidth, window.innerHeight);
	},

	getCurrentTime: function() {
		return (self.performance !== undefined && self.performance.now !== undefined) ? self.performance.now() : Date.now();
	},

	set showFPS(value) {
		GS.DebugUI.setStaticLineVisibility("fps", value);
	},

	get showFPS() {
		return GS.DebugUI.getStaticLineVisibility("fps");
	}
};
;GS.Canvas2d = function(hideOnStart) {
	this.canvasId = "canvas2d";
	this.hideOnStart = (hideOnStart !== undefined) ? hideOnStart : false;

	this.minWidth = 1280;
	this.minHeight = 720;

	this.alpha = 1;
	this.redrawOnResize = true;
};

GS.Canvas2d.prototype = {
	constructor: GS.Canvas2d,

	init: function() {
		var that = this;

		var screenCanvas = document.createElement("canvas");
		screenCanvas.width = window.innerWidth;
		screenCanvas.height = window.innerHeight;
		screenCanvas.style.backgroundColor = "rgba(0, 0, 0, " + this.alpha + ")";
		screenCanvas.id = this.canvasId;
		this.screenCanvas = screenCanvas;

		if (this.hideOnStart) {
			this.hide();
		}

		document.body.appendChild(this.screenCanvas);

		var screenCtx = screenCanvas.getContext("2d");
		screenCtx.globalCompositeOperation = "source-over";
		screenCtx.save();
		this.screenCtx = screenCtx;

		var bufferCanvas = document.createElement("canvas");
		bufferCanvas.width = window.innerWidth;
		bufferCanvas.height = window.innerHeight;
		bufferCanvas.style.backgroundColor = "rgba(0, 0, 0, 1)";
		this.bufferCanvas = bufferCanvas;

		var bufferCtx = bufferCanvas.getContext("2d");
		bufferCtx.globalCompositeOperation = "source-over";
		bufferCtx.save();
		this.bufferCtx = bufferCtx;

		$(window).on("resize." + this.canvasId, function() { that.onResize(); });
		this.onResize();
	},

	show: function() {
		this.screenCanvas.style.display = "";
	},

	hide: function() {
		this.screenCanvas.style.display = "none";
	},

	clear: function() {
		this.bufferCtx.clearRect(0, 0, this.bufferCanvas.width, this.bufferCanvas.height);
	},

	flip: function() {
		this.screenCtx.clearRect(0, 0, this.screenCanvas.width, this.screenCanvas.height);
		this.screenCtx.drawImage(this.bufferCanvas, 0, 0);
	},

	line: function(p0, p1, color, lineWidth) {
		color = (color !== undefined) ? color : "#fff";
		lineWidth = lineWidth || 3;

		this.bufferCtx.save();

		this.bufferCtx.strokeStyle = color;
		this.bufferCtx.lineWidth = lineWidth;
		this.bufferCtx.beginPath();
		this.bufferCtx.moveTo(p0.x, p0.y);
		this.bufferCtx.lineTo(p1.x, p1.y);
		this.bufferCtx.closePath();
		this.bufferCtx.stroke();

		this.bufferCtx.restore();
	},

	box: function(p0, p1, color, lineWidth) {
		color = (color !== undefined) ? color : "#fff";
		lineWidth = lineWidth || 3;

		this.bufferCtx.save();

		this.bufferCtx.strokeStyle = color;
		this.bufferCtx.lineWidth = lineWidth;
		this.bufferCtx.beginPath();
		this.bufferCtx.moveTo(p0.x, p0.y);
		this.bufferCtx.lineTo(p1.x, p0.y);
		this.bufferCtx.lineTo(p1.x, p1.y);
		this.bufferCtx.lineTo(p0.x, p1.y);
		this.bufferCtx.closePath();
		this.bufferCtx.stroke();

		this.bufferCtx.restore();
	},

	boxFill: function(p0, p1, color) {
		color = (color !== undefined) ? color : "#fff";

		var x0 = Math.min(p0.x, p1.x);
		var y0 = Math.min(p0.y, p1.y);
		var x1 = Math.max(p0.x, p1.x);
		var y1 = Math.max(p0.y, p1.y);
		var w = x1 - x0;
		var h = y1 - y0;

		this.bufferCtx.save();

		this.bufferCtx.fillStyle = color;
		this.bufferCtx.fillRect(x0, y0, w, h);

		this.bufferCtx.restore();
	},

	_roundedBox: function(p0, p1, radius, filled, color, lineWidth) {
		color = (color !== undefined) ? color : "#fff";
		lineWidth = lineWidth || 3;

		var x0 = Math.min(p0.x, p1.x);
		var y0 = Math.min(p0.y, p1.y);
		var x1 = Math.max(p0.x, p1.x);
		var y1 = Math.max(p0.y, p1.y);

		this.bufferCtx.save();

		if (filled) {
			this.bufferCtx.fillStyle = color;
		} else {
			this.bufferCtx.strokeStyle = color;
			this.bufferCtx.lineWidth = lineWidth;
		}

		this.bufferCtx.beginPath();
		this.bufferCtx.moveTo(x0, y0 + radius);
		this.bufferCtx.lineTo(x0, y1 - radius);
		this.bufferCtx.quadraticCurveTo(x0, y1, x0 + radius, y1);
		this.bufferCtx.lineTo(x1 - radius, y1);
		this.bufferCtx.quadraticCurveTo(x1, y1, x1, y1 - radius);
		this.bufferCtx.lineTo(x1, y0 + radius);
		this.bufferCtx.quadraticCurveTo(x1, y0, x1 - radius, y0);
		this.bufferCtx.lineTo(x0 + radius, y0);
		this.bufferCtx.quadraticCurveTo(x0, y0, x0, y0 + radius);
		this.bufferCtx.closePath();

		if (filled) {
			this.bufferCtx.fill();
		} else {
			this.bufferCtx.stroke();
		}

		this.bufferCtx.restore();
	},

	roundedBox: function(p0, p1, radius, color, lineWidth) {
		this._roundedBox(p0, p1, radius, false, color, lineWidth);
	},

	roundedBoxFill: function(p0, p1, radius, color) {
		this._roundedBox(p0, p1, radius, true, color);
	},

	polygon: function(points, color, lineWidth) {
		color = (color !== undefined) ? color : "#fff";
		lineWidth = lineWidth || 3;

		this.bufferCtx.save();

		this.bufferCtx.strokeStyle = color;
		this.bufferCtx.lineWidth = lineWidth;
		this.bufferCtx.beginPath();
		this.bufferCtx.moveTo(points[0].x, points[0].y);
		for (var i = 1; i < points.length; i++) {
			this.bufferCtx.lineTo(points[i].x, points[i].y);
		}
		this.bufferCtx.closePath();
		this.bufferCtx.stroke();

		this.bufferCtx.restore();
	},

	polygonFill: function(points, color) {
		color = (color !== undefined) ? color : "#fff";

		this.bufferCtx.save();

		this.bufferCtx.fillStyle = color;
		this.bufferCtx.beginPath();
		this.bufferCtx.moveTo(points[0].x, points[0].y);
		for (var i = 1; i < points.length; i++) {
			this.bufferCtx.lineTo(points[i].x, points[i].y);
		}
		this.bufferCtx.closePath();
		this.bufferCtx.fill();

		this.bufferCtx.restore();
	},

	circle: function(pos, radius, color, lineWidth) {
		color = (color !== undefined) ? color : "#fff";
		lineWidth = lineWidth || 3;

		this.bufferCtx.save();

		this.bufferCtx.beginPath();
		this.bufferCtx.arc(pos.x, pos.y, radius, 0, 2 * Math.PI);
		this.bufferCtx.strokeStyle = color;
		this.bufferCtx.lineWidth = lineWidth;
		this.bufferCtx.stroke();

		this.bufferCtx.restore();
	},

	circleFill: function(pos, radius, color) {
		color = (color !== undefined) ? color : "#fff";

		this.bufferCtx.save();

		this.bufferCtx.beginPath();
		this.bufferCtx.arc(pos.x, pos.y, radius, 0, 2 * Math.PI);
		this.bufferCtx.fillStyle = color;
		this.bufferCtx.fill();

		this.bufferCtx.restore();
	},

	text: function(pos, str, color, fontSize, textBaseline, textAlign, fontFamily) {
		color = (color !== undefined) ? color : "#fff";
		fontSize = (fontSize !== undefined) ? fontSize : 16;
		textBaseline = textBaseline || "top";
		textAlign = textAlign || "left";
		fontFamily = fontFamily || "'Lucida Console', Monaco, monospace";

		this.bufferCtx.save();

		var offset = GS.isFirefox ? 4 : 0; // remove once https://bugzilla.mozilla.org/show_bug.cgi?id=737852 is fixed

		this.bufferCtx.textBaseline = textBaseline;
		this.bufferCtx.textAlign = textAlign;
		this.bufferCtx.font = fontSize + "px " + fontFamily;
		this.bufferCtx.fillStyle = color;
		this.bufferCtx.fillText(str, pos.x, pos.y + offset);

		this.bufferCtx.restore();
	},

	drawImage: function(pos, img, size) {
		this.bufferCtx.drawImage(img, pos.x, pos.y, size.x, size.y);
	},

	drawImageFromAtlas: function(pos, img, atlasOffset, atlasSize) {
		this.bufferCtx.drawImage(img, atlasOffset.x, atlasOffset.y, atlasSize.x, atlasSize.y, pos.x, pos.y, atlasSize.x, atlasSize.y);
	},

	getTextWidth: function(str, fontSize, fontFamily) {
		fontSize = (fontSize !== undefined) ? fontSize : 16;
		fontFamily = fontFamily || "'Lucida Console', Monaco, monospace";

		this.bufferCtx.save();

		this.bufferCtx.font = fontSize + "px '" + fontFamily + "'";
		var width = this.bufferCtx.measureText(str).width;

		this.bufferCtx.restore();

		return width;
	},

	onResize: function() {
		var canvas;
		if (this.redrawOnResize) {
			canvas = this.clone();
		}

		this.screenCanvas.width = Math.max(window.innerWidth, this.minWidth);
		this.screenCanvas.height = Math.max(window.innerHeight, this.minHeight);
		this.bufferCanvas.width = Math.max(window.innerWidth, this.minWidth);
		this.bufferCanvas.height = Math.max(window.innerHeight, this.minHeight);

		$(this.screenCanvas).css("width", window.innerWidth + "px").css("height", window.innerHeight + "px");

		if (this.redrawOnResize) {
			this.screenCtx.drawImage(canvas, 0, 0);
		}
	},

	clone: function() {
		var canvas = document.createElement("canvas");
		canvas.width = this.screenCanvas.width;
		canvas.height = this.screenCanvas.height;

		var ctx = canvas.getContext("2d");
		ctx.globalCompositeOperation = "source-over";
		ctx.save();

		ctx.drawImage(this.screenCanvas, 0, 0);

		return canvas;
	},

	dispose: function() {
		$(window).off("resize." + this.canvasId);
		$("#" + this.canvasId).remove();
	},
};
;GS.Cube = {
	getVertices: function() {
		var vertices = [
			// pos x
			new THREE.Vector3(1, 1, -1),
			new THREE.Vector3(1, 1, 1),
			new THREE.Vector3(1, -1, -1),
			new THREE.Vector3(1, 1, 1),
			new THREE.Vector3(1, -1, 1),
			new THREE.Vector3(1, -1, -1),

			// neg x
			new THREE.Vector3(-1, 1, 1),
			new THREE.Vector3(-1, 1, -1),
			new THREE.Vector3(-1, -1, 1),
			new THREE.Vector3(-1, 1, -1),
			new THREE.Vector3(-1, -1, -1),
			new THREE.Vector3(-1, -1, 1),

			// pos y
			new THREE.Vector3(-1, 1, 1),
			new THREE.Vector3(1, 1, 1),
			new THREE.Vector3(-1, 1, -1),
			new THREE.Vector3(1, 1, 1),
			new THREE.Vector3(1, 1, -1),
			new THREE.Vector3(-1, 1, -1),

			// neg y
			new THREE.Vector3(-1, -1, -1),
			new THREE.Vector3(1, -1, -1),
			new THREE.Vector3(-1, -1, 1),
			new THREE.Vector3(1, -1, -1),
			new THREE.Vector3(1, -1, 1),
			new THREE.Vector3(-1, -1, 1),

			// pos z
			new THREE.Vector3(1, 1, 1),
			new THREE.Vector3(-1, 1, 1),
			new THREE.Vector3(1, -1, 1),
			new THREE.Vector3(-1, 1, 1),
			new THREE.Vector3(-1, -1, 1),
			new THREE.Vector3(1, -1, 1),

			// neg z
			new THREE.Vector3(-1, 1, -1),
			new THREE.Vector3(1, 1, -1),
			new THREE.Vector3(-1, -1, -1),
			new THREE.Vector3(1, 1, -1),
			new THREE.Vector3(1, -1, -1),
			new THREE.Vector3(-1, -1, -1),
		];

		return vertices;
	},
};;GS.Detector = {
	run: function(callback) {
		var canvas = document.createElement("canvas");
		if (canvas.getContext === undefined) {
			this.displayErrorMessage("HTML5 canvas");
			return;
		}

		var webGL = (function () {
			try {
				var canvas = document.createElement("canvas");
				return !!window.WebGLRenderingContext && (canvas.getContext("webgl") || canvas.getContext("experimental-webgl"));
			} catch (e) {
				return false;
			}
		})();
		if (!webGL) {
			this.displayErrorMessage("WebGL, or WebGL failed to initialize");
			return;
		}

		var webAudio = (typeof AudioContext !== "undefined") || (typeof webkitAudioContext !== "undefined");
		if (!webAudio) {
			this.displayErrorMessage("the Web Audio API");
			return;
		}

		var pointerLock = "pointerLockElement" in document || "mozPointerLockElement" in document || "webkitPointerLockElement" in document;
		if (!pointerLock) {
			this.displayErrorMessage("the Pointer Lock API");
			return;
		}

		var localStorage;
		try {
			localStorage = "localStorage" in window && window["localStorage"] !== null;
		} catch(e) {
			localStorage = false;
		}
		if (!localStorage) {
			this.displayErrorMessage("HTML5 local storage");
			return;
		}

		callback();
	},

	displayErrorMessage: function(html) {
		var div = document.createElement("div");

		div.style.width = "450px";
		div.style.height = "150px";
		div.style.marginLeft = "-225px";
		div.style.marginTop = "-75px";
		div.style.position = "absolute";
		div.style.top = "50%";
		div.style.left = "50%";
		div.style.backgroundColor = "#000";
		div.style.color = "#fff";
		div.style.fontSize = "20px";
		div.style.fontFamily = "Arial, Helvetica, sans-serif";
		div.style.fontWeight = "normal";
		div.style.textAlign = "center";
		div.style.border = "1px dashed #fff";

		var span = document.createElement("span");
		span.style.display = "block";
		span.style.marginTop = "50px";
		span.innerHTML = "Your browser does not support<br/>" + html + ".";

		div.appendChild(span);
		document.body.appendChild(div);
	}
};;(function() {

	// Vector3

	THREE.Vector3.prototype.toVector2 = function(optionalTarget) {
		var v = optionalTarget || new THREE.Vector2();
		v.x = this.x;
		v.y = this.z;
		return v;
	};

	THREE.Vector3.prototype.toString = function(d) {
		d = d || 0;
		return ["[", this.x.toFixed(d), this.y.toFixed(d), this.z.toFixed(d), "]"].join(" ");
	};

	THREE.Vector3.prototype.equalsEpsilon = function(v, e) {
		e = e || 0.0001;
		return (Math.abs(v.x - this.x) < e &&
				Math.abs(v.y - this.y) < e &&
				Math.abs(v.z - this.z) < e);
	};

	THREE.Vector3.prototype.minCoord = function() {
		return Math.min(Math.min(this.x, this.y), Math.min(this.y, this.z));
	};

	THREE.Vector3.prototype.maxCoord = function() {
		return Math.max(Math.max(this.x, this.y), Math.max(this.y, this.z));
	};
	
	// http://www.gamedev.net/page/resources/_/technical/game-programming/swept-aabb-collision-detection-and-response-r3084
	THREE.Box3.prototype.isIntersectionBoxSwept = function() {
		var aux1 = new THREE.Vector3();
		var aux2 = new THREE.Vector3();
		var auxBox = new THREE.Box3();

		var velocity = new THREE.Vector3();
		var invEntry = new THREE.Vector3();
		var invExit = new THREE.Vector3();
		var entry = new THREE.Vector3();
		var exit = new THREE.Vector3();
		var size1 = new THREE.Vector3();
		var size2 = new THREE.Vector3();

		return function(oldPos, newPos, box, boxPos, point) {
			velocity.copy(newPos).sub(oldPos);
			aux1.copy(this.min).add(velocity);
			aux2.copy(this.max).add(velocity);
			auxBox.setFromPoints([this.min, this.max, aux1, aux2]);

			if (!auxBox.isIntersectionBox(box)) {
				return false;
			}

			if (this.isIntersectionBox(box)) {
				point.copy(oldPos);
				return true;
			}

			auxBox.min.copy(this.min).add(velocity);
			auxBox.max.copy(this.max).add(velocity);

			if (auxBox.isIntersectionBox(box)) {
				point.copy(newPos);
				return true;
			}

			size1.copy(this.max).sub(this.min);
			size2.copy(box.max).sub(box.min);

			if (velocity.x > 0) {
				invEntry.x = box.min.x - (this.min.x + size1.x);
				invExit.x = (box.min.x + size2.x) - this.min.x;
			} else {
				invEntry.x = (box.min.x + size2.x) - this.min.x;
				invExit.x = box.min.x - (this.min.x + size1.x);
			}
			if (velocity.y > 0) {
				invEntry.y = box.min.y - (this.min.y + size1.y);
				invExit.y = (box.min.y + size2.y) - this.min.y;
			} else {
				invEntry.y = (box.min.y + size2.y) - this.min.y;
				invExit.y = box.min.y - (this.min.y + size1.y);
			}
			if (velocity.z > 0) {
				invEntry.z = box.min.z - (this.min.z + size1.z);
				invExit.z = (box.min.z + size2.z) - this.min.z;
			} else {
				invEntry.z = (box.min.z + size2.z) - this.min.z;
				invExit.z = box.min.z - (this.min.z + size1.z);
			}

			if (velocity.x === 0) {
				entry.x = -Infinity;
				exit.x = Infinity;
			} else {
				entry.x = invEntry.x / velocity.x;
				exit.x = invExit.x / velocity.x;
			}
			if (velocity.y === 0) {
				entry.y = -Infinity;
				exit.y = Infinity;
			} else {
				entry.y = invEntry.y / velocity.y;
				exit.y = invExit.y / velocity.y;
			}
			if (velocity.z === 0) {
				entry.z = -Infinity;
				exit.z = Infinity;
			} else {
				entry.z = invEntry.z / velocity.z;
				exit.z = invExit.z / velocity.z;
			}

			var entryTime = entry.maxCoord();
			var exitTime = exit.minCoord();

			if (entryTime > exitTime || entry.x < 0 && entry.y < 0 && entry.z < 0 || entry.x > 1 || entry.y > 1 || entry.z > 1) {
				return false;
			} else {
				velocity.multiplyScalar(entryTime);
				point.copy(oldPos).add(velocity);
				return true;
			}
		}
	}();

	THREE.Ray.prototype.intersectsOrStartsInBox = function(box, optionalTarget) {
		var result = optionalTarget || new THREE.Vector3();

		if (box.containsPoint(this.origin)) {
			result.copy(this.origin);
		} else {
			this.intersectBox(box, result);
		}

		return result;
	};

	// Vector2

	THREE.Vector2.prototype.toString = function(d) {
		d = d || 0;
		return ["[", this.x.toFixed(d), this.y.toFixed(d), "]"].join(" ");
	};

	THREE.Vector2.prototype.equalsEpsilon = function(v, e) {
		e = e || 0.0001;
		return (Math.abs(v.x - this.x) < e &&
				Math.abs(v.y - this.y) < e);
	};

	THREE.Vector2.prototype.minCoord = function() {
		return Math.min(this.x, this.y);
	};

	THREE.Vector2.prototype.maxCoord = function() {
		return Math.max(this.x, this.y);
	};

	// http://www.gamedev.net/page/resources/_/technical/game-programming/swept-aabb-collision-detection-and-response-r3084
	THREE.Box2.prototype.isIntersectionBoxSwept = function() {
		var aux1 = new THREE.Vector2();
		var aux2 = new THREE.Vector2();
		var auxBox = new THREE.Box2();

		var velocity = new THREE.Vector2();
		var invEntry = new THREE.Vector2();
		var invExit = new THREE.Vector2();
		var entry = new THREE.Vector2();
		var exit = new THREE.Vector2();
		var size1 = new THREE.Vector2();
		var size2 = new THREE.Vector2();

		return function(oldPos, newPos, box, boxPos, point) {
			velocity.copy(newPos).sub(oldPos);
			aux1.copy(this.min).add(velocity);
			aux2.copy(this.max).add(velocity);
			auxBox.setFromPoints([this.min, this.max, aux1, aux2]);

			if (!auxBox.isIntersectionBox(box)) {
				return false;
			}

			if (this.isIntersectionBox(box)) {
				point.copy(oldPos);
				return true;
			}

			auxBox.min.copy(this.min).add(velocity);
			auxBox.max.copy(this.max).add(velocity);

			if (auxBox.isIntersectionBox(box)) {
				point.copy(newPos);
				return true;
			}

			size1.copy(this.max).sub(this.min);
			size2.copy(box.max).sub(box.min);

			if (velocity.x > 0) {
				invEntry.x = box.min.x - (this.min.x + size1.x);
				invExit.x = (box.min.x + size2.x) - this.min.x;
			} else {
				invEntry.x = (box.min.x + size2.x) - this.min.x;
				invExit.x = box.min.x - (this.min.x + size1.x);
			}
			if (velocity.y > 0) {
				invEntry.y = box.min.y - (this.min.y + size1.y);
				invExit.y = (box.min.y + size2.y) - this.min.y;
			} else {
				invEntry.y = (box.min.y + size2.y) - this.min.y;
				invExit.y = box.min.y - (this.min.y + size1.y);
			}

			if (velocity.x === 0) {
				entry.x = -Infinity;
				exit.x = Infinity;
			} else {
				entry.x = invEntry.x / velocity.x;
				exit.x = invExit.x / velocity.x;
			}
			if (velocity.y === 0) {
				entry.y = -Infinity;
				exit.y = Infinity;
			} else {
				entry.y = invEntry.y / velocity.y;
				exit.y = invExit.y / velocity.y;
			}

			var entryTime = entry.maxCoord();
			var exitTime = exit.minCoord();

			if (entryTime > exitTime || entry.x < 0 && entry.y < 0 || entry.x > 1 || entry.y > 1) {
				return false;
			} else {
				velocity.multiplyScalar(entryTime);
				point.copy(oldPos).add(velocity);
				return true;
			}
		}
	}();

	// http://gamedev.stackexchange.com/questions/29479/swept-aabb-vs-line-segment-2d
	THREE.Box2.prototype.isIntersectionLineSwept = function() {
		var velocity = new THREE.Vector2();
		var boxExtent = new THREE.Vector2();
		var boxCenter = new THREE.Vector2();
		var lineNormal = new THREE.Vector2();
		var lineDir = new THREE.Vector2();
		var lineMin = new THREE.Vector2();
		var lineMax = new THREE.Vector2();
		var aux = new THREE.Vector2();

		return function(oldPos, newPos, line) {
			var result = {
				foundCollision: false,
				pos: new THREE.Vector2(),
				distance: 0,
				normal: new THREE.Vector2(),
			};

			velocity.copy(newPos).sub(oldPos);

			boxExtent.copy(this.max).sub(this.min).multiplyScalar(0.5);
			boxCenter.copy(this.max).add(this.min).multiplyScalar(0.5);
			GS.MathHelper.vec2Normal(line.start, line.end, lineNormal);

			if (lineNormal.dot(velocity) >= 0) {
				return result;
			}

			lineDir.copy(line.end).sub(line.start);

			if (lineDir.x > 0) {
				lineMin.x = line.start.x;
				lineMax.x = line.end.x;
			}
			else {
				lineMin.x = line.end.x;
				lineMax.x = line.start.x;
			}

			if (lineDir.y > 0) {
				lineMin.y = line.start.y;
				lineMax.y = line.end.y;
			}
			else {
				lineMin.y = line.end.y;
				lineMax.y = line.start.y;
			}

			var hitTime = 0;
			var outTime = 1;

			var r = boxExtent.x * Math.abs(lineNormal.x) + boxExtent.y * Math.abs(lineNormal.y);
			aux.copy(line.start).sub(boxCenter);
			var boxProj = aux.dot(lineNormal);
			var velProj = velocity.dot(lineNormal);

			if (velProj < 0) {
				r *= -1;
			}

			hitTime = Math.max((boxProj - r) / velProj, hitTime);
			outTime = Math.min((boxProj + r) / velProj, outTime);

			if (velocity.x < 0) {
				if (this.max.x < lineMin.x) {
					return result;
				}

				hitTime = Math.max((lineMax.x - this.min.x) / velocity.x, hitTime);
				outTime = Math.min((lineMin.x - this.max.x) / velocity.x, outTime);
			}
			else
			if (velocity.x > 0) {
				if (this.min.x > lineMax.x) { 
					return result;
				}
				hitTime = Math.max((lineMin.x - this.max.x) / velocity.x, hitTime);
				outTime = Math.min((lineMax.x - this.min.x) / velocity.x, outTime);
			}
			else
			if (lineMin.x > this.max.x || lineMax.x < this.min.x) {
				return result;
			}

			if (hitTime > outTime) {
				return result;
			}

			if (velocity.y < 0) {
				if (this.max.y < lineMin.y) { 
					return result;
				}

				hitTime = Math.max((lineMax.y - this.min.y) / velocity.y, hitTime);
				outTime = Math.min((lineMin.y - this.max.y) / velocity.y, outTime);
			}
			else 
			if (velocity.y > 0) {
				if (this.min.y > lineMax.y) { 
					return result;
				}

				hitTime = Math.max((lineMin.y - this.max.y) / velocity.y, hitTime);
				outTime = Math.min((lineMax.y - this.min.y) / velocity.y, outTime);
			}
			else
			if (lineMin.y > this.max.y || lineMax.y < this.min.y) { 
				return result;
			}

			if (hitTime > outTime) { 
				return result;
			}

			result.foundCollision = true;
			result.pos.copy(oldPos).add(velocity.multiplyScalar(hitTime));
			result.distance = velocity.length() * hitTime;
			result.normal.copy(lineNormal);

			return result;
		}
	}();

	// Geometry

	THREE.Geometry.prototype.merge = function ( geometry, matrix, materialIndexOffset ) {

		if ( geometry instanceof THREE.Geometry === false ) {

			console.error( 'THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry );
			return;

		}

		var normalMatrix,
		vertexOffset = this.vertices.length,
		vertices1 = this.vertices,
		vertices2 = geometry.vertices,
		faces1 = this.faces,
		faces2 = geometry.faces,
		uvs1 = this.faceVertexUvs[ 0 ],
		uvs2 = geometry.faceVertexUvs[ 0 ];

		if ( materialIndexOffset === undefined ) materialIndexOffset = 0;

		if ( matrix !== undefined ) {

			normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );

		}

		// vertices

		for ( var i = 0, il = vertices2.length; i < il; i ++ ) {

			var vertex = vertices2[ i ];

			var vertexCopy = vertex.clone();

			if ( matrix !== undefined ) vertexCopy.applyMatrix4( matrix );

			vertices1.push( vertexCopy );

		}

		// faces

		for ( i = 0, il = faces2.length; i < il; i ++ ) {

			var face = faces2[ i ], faceCopy, normal, color,
			faceVertexNormals = face.vertexNormals,
			faceVertexColors = face.vertexColors;

			faceCopy = new THREE.Face3( face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset );
			faceCopy.normal.copy( face.normal );

			if ( normalMatrix !== undefined ) {

				faceCopy.normal.applyMatrix3( normalMatrix ).normalize();

			}

			for ( var j = 0, jl = faceVertexNormals.length; j < jl; j ++ ) {

				normal = faceVertexNormals[ j ].clone();

				if ( normalMatrix !== undefined ) {

					normal.applyMatrix3( normalMatrix ).normalize();

				}

				faceCopy.vertexNormals.push( normal );

			}

			faceCopy.color.copy( face.color );
			faceCopy.emissive = face.emissive.clone();

			for ( var j = 0, jl = faceVertexColors.length; j < jl; j ++ ) {

				color = faceVertexColors[ j ];
				faceCopy.vertexColors.push( color.clone() );

			}

			faceCopy.materialIndex = face.materialIndex + materialIndexOffset;

			faces1.push( faceCopy );

		}

		// uvs

		for ( i = 0, il = uvs2.length; i < il; i ++ ) {

			var uv = uvs2[ i ], uvCopy = [];

			if ( uv === undefined ) {

				continue;

			}

			for ( var j = 0, jl = uv.length; j < jl; j ++ ) {

				uvCopy.push( new THREE.Vector2( uv[ j ].x, uv[ j ].y ) );

			}

			uvs1.push( uvCopy );

		}

	};

	// BufferGeometry
	// jshint ignore:start

	THREE.BufferGeometry.prototype.fromGeometry = function ( geometry, settings ) {		

		settings = settings || { 'vertexColors': THREE.NoColors };

		var vertices = geometry.vertices;
		var faces = geometry.faces;
		var faceVertexUvs = geometry.faceVertexUvs;
		var vertexColors = settings.vertexColors;
		var hasFaceVertexUv = faceVertexUvs[ 0 ].length > 0;
		var hasFaceVertexNormals = faces[ 0 ].vertexNormals.length == 3;

		var positions = new Float32Array( faces.length * 3 * 3 );
		this.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );

		var normals = new Float32Array( faces.length * 3 * 3 );
		this.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ) );

		if ( vertexColors !== THREE.NoColors ) {

			var colors = new Float32Array( faces.length * 3 * 3 );
			this.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ) );

			var emissives = new Float32Array( faces.length * 3 * 3 );
			this.addAttribute( 'emissive', new THREE.BufferAttribute( emissives, 3 ) );

		}

		if ( hasFaceVertexUv === true ) {

			var uvs = new Float32Array( faces.length * 3 * 2 );
			this.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );

		}

		for ( var i = 0, i2 = 0, i3 = 0; i < faces.length; i ++, i2 += 6, i3 += 9 ) {

			var face = faces[ i ];

			var a = vertices[ face.a ];
			var b = vertices[ face.b ];
			var c = vertices[ face.c ];

			positions[ i3     ] = a.x;
			positions[ i3 + 1 ] = a.y;
			positions[ i3 + 2 ] = a.z;

			positions[ i3 + 3 ] = b.x;
			positions[ i3 + 4 ] = b.y;
			positions[ i3 + 5 ] = b.z;

			positions[ i3 + 6 ] = c.x;
			positions[ i3 + 7 ] = c.y;
			positions[ i3 + 8 ] = c.z;

			if ( hasFaceVertexNormals === true ) {

				var na = face.vertexNormals[ 0 ];
				var nb = face.vertexNormals[ 1 ];
				var nc = face.vertexNormals[ 2 ];

				normals[ i3     ] = na.x;
				normals[ i3 + 1 ] = na.y;
				normals[ i3 + 2 ] = na.z;

				normals[ i3 + 3 ] = nb.x;
				normals[ i3 + 4 ] = nb.y;
				normals[ i3 + 5 ] = nb.z;

				normals[ i3 + 6 ] = nc.x;
				normals[ i3 + 7 ] = nc.y;
				normals[ i3 + 8 ] = nc.z;

			} else {

				var n = face.normal;

				normals[ i3     ] = n.x;
				normals[ i3 + 1 ] = n.y;
				normals[ i3 + 2 ] = n.z;

				normals[ i3 + 3 ] = n.x;
				normals[ i3 + 4 ] = n.y;
				normals[ i3 + 5 ] = n.z;

				normals[ i3 + 6 ] = n.x;
				normals[ i3 + 7 ] = n.y;
				normals[ i3 + 8 ] = n.z;

			}

			if ( vertexColors === THREE.FaceColors ) {

				var fc = face.color;

				colors[ i3     ] = fc.r;
				colors[ i3 + 1 ] = fc.g;
				colors[ i3 + 2 ] = fc.b;

				colors[ i3 + 3 ] = fc.r;
				colors[ i3 + 4 ] = fc.g;
				colors[ i3 + 5 ] = fc.b;

				colors[ i3 + 6 ] = fc.r;
				colors[ i3 + 7 ] = fc.g;
				colors[ i3 + 8 ] = fc.b;

				var em = face.emissive;

				emissives[ i3     ] = em.r;
				emissives[ i3 + 1 ] = em.g;
				emissives[ i3 + 2 ] = em.b;

				emissives[ i3 + 3 ] = em.r;
				emissives[ i3 + 4 ] = em.g;
				emissives[ i3 + 5 ] = em.b;

				emissives[ i3 + 6 ] = em.r;
				emissives[ i3 + 7 ] = em.g;
				emissives[ i3 + 8 ] = em.b;

			} else if ( vertexColors === THREE.VertexColors ) {

				var vca = face.vertexColors[ 0 ];
				var vcb = face.vertexColors[ 1 ];
				var vcc = face.vertexColors[ 2 ];

				colors[ i3     ] = vca.r;
				colors[ i3 + 1 ] = vca.g;
				colors[ i3 + 2 ] = vca.b;

				colors[ i3 + 3 ] = vcb.r;
				colors[ i3 + 4 ] = vcb.g;
				colors[ i3 + 5 ] = vcb.b;

				colors[ i3 + 6 ] = vcc.r;
				colors[ i3 + 7 ] = vcc.g;
				colors[ i3 + 8 ] = vcc.b;

			}

			if ( hasFaceVertexUv === true ) {

				var uva = faceVertexUvs[ 0 ][ i ][ 0 ];
				var uvb = faceVertexUvs[ 0 ][ i ][ 1 ];
				var uvc = faceVertexUvs[ 0 ][ i ][ 2 ];

				uvs[ i2     ] = uva.x;
				uvs[ i2 + 1 ] = uva.y;

				uvs[ i2 + 2 ] = uvb.x;
				uvs[ i2 + 3 ] = uvb.y;

				uvs[ i2 + 4 ] = uvc.x;
				uvs[ i2 + 5 ] = uvc.y;

			}

		}

		this.computeBoundingSphere()

		return this;

	};

	// jshint ignore:end

}());
;GS.InputHelper = {
	keyState: [],
	leftMouseDown: false,
	middleMouseDown: false,
	rightMouseDown: false,
	mouseX: 0,
	mouseY: 0,
	screenRatioX: 1,
	screenRatioY: 1,
	mouseWheelEvents: [],
	ctrl: false,
	shift: false,
	alt: false,
	pressedKeys: [],
	keysPressed: false,

	init: function() {
		var that = this;

		$(document).on("contextmenu", function(){
			return false;
		});

		$(document).keydown(function(e){
			that.keyState[e.keyCode] = true;
			that.ctrl = e.ctrlKey;
			that.alt = e.altKey;
			that.shift = e.shiftKey;

			// avoid normal behavior: tab, ctrl+a, ctrl+z, ctrl+g, ctrl-minus, ctrl-plus, ctrl-zero
			if (e.keyCode == 9 || (e.keyCode == 65 && e.ctrlKey) ||
				(e.keyCode == 90 && e.ctrlKey) || (e.keyCode == 71 && e.ctrlKey) ||
				(e.keyCode == 189 && e.ctrlKey) || (e.keyCode == 187 && e.ctrlKey) ||
				(e.keyCode == 48 && e.ctrlKey)) {

				e.stopPropagation();
				e.preventDefault();
				return false;
			}
		});
		$(document).keyup(function(e){
			that.keyState[e.keyCode] = false;
			that.ctrl = e.ctrlKey;
			that.alt = e.altKey;
			that.shift = e.shiftKey;

		});
		$(document).mousedown(function(e){
			if (e.which == 1)
				that.leftMouseDown = true;
			if (e.which == 2)
				that.middleMouseDown = true;
			if (e.which == 3)
				that.rightMouseDown = true;
		});
		$(document).mouseup(function(e){
			if (e.which == 1)
				that.leftMouseDown = false;
			if (e.which == 2)
				that.middleMouseDown = false;
			if (e.which == 3)
				that.rightMouseDown = false;
		});
		$(document).mousemove(function(e){
			that.mouseX = e.pageX * that.screenRatioX;
			that.mouseY = e.pageY * that.screenRatioY;
		});

		document.addEventListener("mousewheel", function(e) {
			that.mouseWheelEvents.push(e.wheelDelta);
		}, false);

		document.addEventListener("DOMMouseScroll", function(e) {
			that.mouseWheelEvents.push(e.detail * -1);
		}, false);
	},

	isKeyUp: function(keyCode) {
		return !this.keyState[keyCode];
	},

	isKeyDown: function(keyCode, dontModifyPressed) {
		if (!dontModifyPressed) {
			if (this.keyState[keyCode]) {
				if (this.pressedKeys.indexOf(keyCode) == -1) {
					this.pressedKeys.push(keyCode);
				}
				this.keysPressed = true;
			}
		}
		return this.keyState[keyCode];
	},

	checkPressedKeys: function() {
		if (this.pressedKeys.length > 0) {
			var n = 0;
			for (var i = 0; i < this.pressedKeys.length; i++) {
				if (this.isKeyUp(this.pressedKeys[i])) {
					n++;
				}
				else {
					return;
				}
			}

			if (n == this.pressedKeys.length) {
				this.keysPressed = false;
			}
		}
	},
};

GS.InputHelper.init();;GS.LineHelper = {
	compare: function(p, q) {
		if (p.x == q.x) {
			return p.y - q.y;
		}
		return p.x - q.x;
	},

	slope: function(s) {
		return (s.end.y - s.start.y) / (s.end.x - s.start.x);
	},

	intersectionLineSegments: function() {
		var p0 = new THREE.Vector2();
		return function(s1, s2, p) {
			p = p || p0;
			return this.intersectionLines(s1, s2, p, true);
		}
	}(),

	intersectionLines: function(s1, s2, p, compareLineSegments) {
		var x1 = s1.start.x, x2 = s1.end.x, x3 = s2.start.x, x4 = s2.end.x;
		var y1 = s1.start.y, y2 = s1.end.y, y3 = s2.start.y, y4 = s2.end.y;

		var denom = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);
		if (denom === 0) {
			return false;
		}

		var ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denom;
		var ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denom;

		if (!compareLineSegments || (ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1)) {
			p.x = x1 + ua * (x2 - x1);
			p.y = y1 + ua * (y2 - y1);
			return true;
		}

		return false;
	},

	intersectionLineSegmentBox: function() {
		var box0 = new THREE.Box2();
		var seg0 = { start: new THREE.Vector2(), end: new THREE.Vector2() };
		var p = new THREE.Vector2();

		return function(seg, box) {
			box0.setFromPoints([seg.start, seg.end]);

			if (!box.isIntersectionBox(box0)) {
				return false;
			}
			if (box.containsPoint(seg.start) && box.containsPoint(seg.end)) {
				return true;
			}

			seg0.start.x = box.min.x; seg0.start.y = box.min.y; seg0.end.x = box.max.x; seg0.end.y = box.min.y;
			if (this.intersectionLineSegments(seg, seg0, p)) {
				return true;
			}

			seg0.start.x = box.max.x; seg0.start.y = box.min.y; seg0.end.x = box.max.x; seg0.end.y = box.max.y;
			if (this.intersectionLineSegments(seg, seg0, p)) {
				return true;
			}

			seg0.start.x = box.max.x; seg0.start.y = box.max.y; seg0.end.x = box.min.x; seg0.end.y = box.max.y;
			if (this.intersectionLineSegments(seg, seg0, p)) {
				return true;
			}

			seg0.start.x = box.min.x; seg0.start.y = box.max.y; seg0.end.x = box.min.x; seg0.end.y = box.min.y;
			if (this.intersectionLineSegments(seg, seg0, p)) {
				return true;
			}

			return false;
		};
	}(),

	lineSegmentsToGraph: function(segments, gridCellSize) {
		var that = this;

		var graph = new GS.PlanarGraph();

		var p = new THREE.Vector2();
		for (var i = 0; i < segments.length; i++) {
			var cuts = [];
			cuts.push(segments[i].start.clone());
			cuts.push(segments[i].end.clone());

			for (var j = 0; j < segments.length; j++) {
				if (i != j) {
					var result = this.intersectionLineSegments(segments[i], segments[j], p);

					if (result) {
						cuts.push(p.clone());
					}
				}
			}
			cuts.sort(sort);

			for (var j = 0; j < cuts.length - 1; j++) {
				graph.addEdge(cuts[j], cuts[j + 1]);
			}
		}

		if (gridCellSize !== undefined) {
			for (var i = 0; i < graph.vertices.length; i++) {
				var v = graph.vertices[i];
				v.x = Math.floor(v.x / gridCellSize) * gridCellSize;
				v.y = Math.floor(v.y / gridCellSize) * gridCellSize;
			}
		}

		function sort(a, b) {
			return that.compare(a, b);
		}

		return graph;
	},

	pointOnLineSegment: function(seg, p) {
		var offset = this.pointOffsetOnLineSegment(seg, p);
		return (offset != -1);
	},

	pointOffsetOnLineSegment: function(seg, p) {
		var epsilon = 0.0001;

		var cross = (p.y - seg.start.y) * (seg.end.x - seg.start.x) - (p.x - seg.start.x) * (seg.end.y - seg.start.y);
		if (Math.abs(cross) > epsilon) {
			return -1;
		}

		var dot = (p.x - seg.start.x) * (seg.end.x - seg.start.x) + (p.y - seg.start.y) * (seg.end.y - seg.start.y);
		if (dot < 0) {
			return -1;
		}

		var lengthSq = (seg.end.x - seg.start.x) * (seg.end.x - seg.start.x) + (seg.end.y - seg.start.y) * (seg.end.y - seg.start.y);
		if (dot > lengthSq) {
			return -1;
		}

		var offset = (lengthSq !== 0) ? (dot / lengthSq) : 1;
		return offset;
	},

	arePointsCollinear: function(p1, p2, p3) {
		return (p1.y - p2.y) * (p1.x - p3.x) == (p1.y - p3.y) * (p1.x - p2.x);
	}
};;GS.MapLayers = {
	Segment: 0,
	Sector: 2,
	Entity: 3,
	Zone: 4,
};

GS.SegmentTypes = {
	User: 0,
	InteriorFloor: 1,
	InteriorCeiling: 2,
	Exterior: 3,
	TVScreen: 4,
	Switch: 5,
};

GS.MapEntities = {
	"M": {
		name: "medkit",
		type: "Item",
	},
	"A": {
		name: "ammo",
		type: "Item",
	},
	"H": {
		name: "hyper_blaster",
		type: "Item",
	},
	"D": {
		name: "double_shotgun",
		type: "Item",
	},
	"N": {
		name: "nom",
		type: "Monster",
		animations: {
			walk: 6,
			death: 4,
		},
	},
	"E": {
		name: "eye",
		type: "Monster",
		animations: {
			walk: 4,
			death: 4,
			attack: 2,
		},
	},
  "S": {
		name: "spawn",
		type: "Spawn",
  },
  "O": {
    name: "online_player",
    type: "OnlinePlayer",
		animations: {
			walk: 6,
			death: 4,
		},
  }

};
;GS.MathHelper = {
	clamp: function(x, min, max) {
		if (x < min) x = min;
		if (x > max) x = max;

		return x;
	},

	// Andrew's monotone chain convex hull algorithm
	// http://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain
	getConvexHullPoints: function(P) {	
		var cross = function(O, A, B) {
			return (A.x - O.x) * (B.y - O.y) - (A.y - O.y) * (B.x - O.x);
		};

		var n = P.length;
		var k = 0;
		var H = [];

		P.sort(function(a, b) {	
			if (a.x == b.x) {
				return a.y - b.y;
			}
			return a.x - b.x; 
		});

		for (var i = 0; i < n; i++) {
			while (k >= 2 && cross(H[k - 2], H[k - 1], P[i]) <= 0) {
				k--;
			}
			H[k++] = P[i];
		}
	 
		var t = k + 1;
		for (var i = n - 2; i >= 0; i--) {
			while (k >= t && cross(H[k - 2], H[k - 1], P[i]) <= 0) {
				k--;
			}
			H[k++] = P[i];
		}
	 
		H.length = k - 1;
		return H;
	},

	pointInTriangle: function(P, A, B, C) {
		var result = this.getTriangleBarycentricCoordinates(P, A, B, C);
		return result.inTriangle;
	},

	// Barycentric Technique
	// http://www.blackpawn.com/texts/pointinpoly/
	getTriangleBarycentricCoordinates: function(P, A, B, C) {
		var v0 = new THREE.Vector2().subVectors(C, A);
		var v1 = new THREE.Vector2().subVectors(B, A);
		var v2 = new THREE.Vector2().subVectors(P, A);

		var dot00 = v0.dot(v0);
		var dot01 = v0.dot(v1);
		var dot02 = v0.dot(v2);
		var dot11 = v1.dot(v1);
		var dot12 = v1.dot(v2);

		var invDenom = 1 / (dot00 * dot11 - dot01 * dot01);
		var u = (dot11 * dot02 - dot01 * dot12) * invDenom;
		var v = (dot00 * dot12 - dot01 * dot02) * invDenom;

		var inTriangle = (u >= 0 && v >= 0 && (u + v < 1));

		return { u: u, v: v, inTriangle: inTriangle };
	},

	vec2Rotate: function(v, angle) {
		var sn = Math.sin(Math.PI / 180 * angle);
		var cs = Math.cos(Math.PI / 180 * angle);

		var x = v.x * cs - v.y * sn;
		var y = v.x * sn + v.y * cs;

		v.x = x;
		v.y = y;
	},

	vec2RotateRadians: function(v, radians) {
		var sn = Math.sin(radians);
		var cs = Math.cos(radians);

		var x = v.x * cs - v.y * sn;
		var y = v.x * sn + v.y * cs;

		v.x = x;
		v.y = y;
	},

	vec2Angle: function(v0, v1) {
		return -Math.atan2(v1.y - v0.y, v1.x - v0.x) * (180 / Math.PI) * 2;
	},

	vec2AngleRadians: function(v0, v1) {
		return -Math.atan2(v1.y - v0.y, v1.x - v0.x) * 2;
	},

	vec2AngleDirected: function(v0, v1) {
		return Math.atan2(v0.y, v0.x) - Math.atan2(v1.y, v1.x);
	},

	vec2Normal: function(v0, v1, optionalTarget) {
		var result = optionalTarget || new THREE.Vector2();

		var dx = v1.x - v0.x;
		var dy = v1.y - v0.y;

		result.set(dy, -dx).normalize();
		return result;
	},

	vec2PointSide: function(a, b, c) {
		return ((b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x)) > 0;
	},
};

GS.SmoothNumber = function(initialValue, speed) {
	this.value = initialValue;
	this.targetValue = initialValue;
	this.speed = speed;
};

GS.SmoothNumber.prototype = {
	setTargetValue: function(targetValue) {
		this.targetValue = targetValue;
	},

	update: function() {
		if (this.value < this.targetValue) {
			this.value += this.speed;
			if (this.value > this.targetValue) {
				this.value = this.targetValue;
			}
		}
		if (this.value > this.targetValue) {
			this.value -= this.speed;
			if (this.value < this.targetValue) {
				this.value = this.targetValue;
			}
		}
	},
};

GS.SmoothVector3 = function(x, y, z, speed) {
	THREE.Vector3.call(this, x, y, z);

	this.targetValue = this.clone();
	this.speed = (speed !== undefined) ? speed : 0.1;
	this.color = new THREE.Color();
};

GS.SmoothVector3.prototype = GS.inherit(THREE.Vector3, {
	setTargetValue: function(targetValue) {
		this.targetValue = targetValue.clone();
	},

	update: function() {
		this.updateProperty("x");
		this.updateProperty("y");
		this.updateProperty("z");

		this.updateColor();
	},

	updateColor: function() {
		this.color.r = this.x;
		this.color.g = this.y;
		this.color.b = this.z;
	},

	updateProperty: function(name) {
		if (this[name] < this.targetValue[name]) {
			this[name] += this.speed;
			if (this[name] > this.targetValue[name]) {
				this[name] = this.targetValue[name];
			}
		}
		if (this[name] > this.targetValue[name]) {
			this[name] -= this.speed;
			if (this[name] < this.targetValue[name]) {
				this[name] = this.targetValue[name];
			}
		}
	},
});;GS.OnlineRoom = function() {
  this.clients = [];
}

GS.OnlineRoom.prototype = {
	init: function() {
	},

  setupRoom: function (room) {
    this.room = room;
    let mapName = "airstrip1online";// room.mapName;
    GAME.loadOnlineLevel(mapName);
  },

  setupClients: function () {
    if (!this.firstRunHack)
      this.room.clients.forEach((e) => this.addClient(e));
    this.firstRunHack = true;
  },

  roomPing: function (room, id) {
    for (i in room.clients) {
      updatedClient = room.clients[i];
      console.log(updatedClient.id + ": " + updatedClient.score)
      if (updatedClient.id === id) {
        continue;
      }
      let client = this.findClient(updatedClient.id);
      if (!client) {
        // this.addClient(updatedClient);
      } else {
        this.updateClient(updatedClient);
      }
    }
  },

  addClient: function (client) {
    if (GAME.onlineManager.socket.id === client.id) {
      return;
    }
    let ntt = {
      id: client.id,
      pos: new THREE.Vector2(client.x || 0, client.y || 0),
      type: "O",
      y: 0,
      isStatic:false,
      rotation: client.direction || 0
    };
    let gridObj = GAME.grid.spawnEntityAtRuntime(ntt, GAME.grid);
    this.clients.push(gridObj);
    GAME.grid.map.layerObjects[GS.MapLayers.Entity].push(gridObj);
  },

  findClient: function (id) {
    if (GAME.onlineManager.socket.id === id) {
      return false;
    }
    return this.clients.filter((e) => e.id === id && e.id !== GAME.onlineManager.socket.id)[0] || false;
  },

  clientDie: function (id) {
    let client = this.findClient(id);
    if (client) {
      client.onDeath();
    }
  },

  clientRespawn: function (id) {
    let client = this.findClient(id);
    if (client) {
      client.onRespawn();
    }
  },

  removeClient: function (id) {
    let client = this.findClient(id);
    if (client) {
      client.onDeath();
      this.clients.splice(this.clients.indexOf(client), 1);
    }
  },

  addProjectile: function (id) {
    let client = this.findClient(id);
    if (client) {
      client.onPlayerShoot();
    }
  },

  removeAllClients: function (id) {
    this.clients = [];
  },

  updateClient: function (updatedClient) {
    let client = this.findClient(updatedClient.id);
    client.onUpdateMove(client);
  }
};


;// Polygon detection from line segments

// retrieves non-overlapping polygons for induced graphs with N <= 100 cycles using the Bron–Kerbosch algorithm
// for graphs with N > 100 cycles uses Horton's algorithm as a fallback

// based on the algorithm described in "Polygon Detection from a Set of Lines":
// http://www.researchgate.net/publication/2933997_Polygon_Detection_from_a_Set_of_Lines/file/79e41507ddec7cc0ae.pdf

GS.PolygonHelper = {
	getPolygonsFromLineSegments: function(segments, gridCellSize) {
		var graph = GS.LineHelper.lineSegmentsToGraph(segments, gridCellSize);
		
		graph.computeShortestPaths();	
		graph.computeMinimumCycleBasis();
		graph.removeNonCycleEdges();

		var vertices = graph.vertices;
		var polygons = [];
		var mcb = graph.minimumCycleBasis;
		for (var i = 0; i < mcb.length; i++) {
			var cycle = graph.cycles[mcb[i]].elements;
			polygons[i] = [];
			for (var j = 0; j < cycle.length; j++) {
				polygons[i].push(vertices[cycle[j].start]);
			}
		}

		return {
			vertices: vertices,
			polygons: polygons,
			graph: graph,
		};
	},

	getTriangulatedPolygonsFromLineSegments: function(segments, gridCellSize) {
		var result = this.getPolygonsFromLineSegments(segments, gridCellSize);
		
		var polygons = [];
		for (var i = 0; i < result.polygons.length; i++) {
			var polygon = result.polygons[i];
			var vertices = this.vector2ToVertexArray(polygon);
			if (this.areVerticesClockwise(vertices)) {
				this.reverseVertices(vertices);
			}
			result.polygons[i] = {
				vertices: this.vertexToVector2Array(vertices),
				indices: PolyK.Triangulate(vertices),
				area: PolyK.GetArea(vertices),
			};
		}

		result.polygons.sort(function(a, b) {
			return b.area - a.area;
		});

		return result;
	},

	vector2ToVertexArray: function(vectors) {
		var vertices = [];
		for (var j = 0; j < vectors.length; j++) {
			vertices.push(vectors[j].x);
			vertices.push(vectors[j].y);
		}
		return vertices;
	},

	vertexToVector2Array: function(vertices) {
		var vectors = [];
		for (var i = 0; i < vertices.length; i += 2) {
			vectors.push(new THREE.Vector2(vertices[i], vertices[i + 1]));
		}
		return vectors;
	},

	reverseVertices: function(vertices) {
		for (var i = 0; i < vertices.length / 2; i += 2) {
			var j = vertices.length - i - 2;
			var x = vertices[i];
			vertices[i] = vertices[j];
			vertices[j] = x;
			var y = vertices[i + 1];
			vertices[i + 1] = vertices[j + 1];
			vertices[j + 1] = y;
		}
	},

	areVerticesClockwise: function(vertices) {
		var sum = 0;
		for (var i = 0; i < vertices.length - 2; i += 2) {
			var x1 = vertices[i];
			var y1 = vertices[i + 1];
			var x2 = vertices[i + 2];
			var y2 = vertices[i + 3];
			sum += (x2 - x1) * (y2 + y1);
		}
		var x1 = vertices[vertices.length - 2];
		var y1 = vertices[vertices.length - 1];
		var x2 = vertices[0];
		var y2 = vertices[1];
		sum += (x2 - x1) * (y2 + y1);
		return sum >= 0;
	},	

	// https://dl.dropboxusercontent.com/u/705999/polyfinder/index.html
	sectorContainsPoint: function(sector, p, useCollisionVertices) {
		var v = useCollisionVertices ? sector.collisionVertices : sector.vertices;
		var n = v.length;
		var c = false;

		var i, j = 0;
		for (i = 0, j = n - 1; i < n; j = i++) {
			var start = v[i];
			var end = v[j];

			if (((start.y > p.y) != (end.y > p.y)) &&
				(p.x < (end.x - start.x) * (p.y - start.y) / (end.y - start.y) + start.x)) {
				c = !c;
			}
		}

		return c;
	},

	intersectionSectorBox: function() {
		var box0 = new THREE.Box2();
		var seg0 = { start: new THREE.Vector2(), end: new THREE.Vector2() };
		var p = new THREE.Vector2();
		var boxPoints = [
			new THREE.Vector2(),
			new THREE.Vector2(),
			new THREE.Vector2(),
			new THREE.Vector2(),
		];

		return function(sector, box) {
			box0.setFromPoints(sector.vertices);

			if (!box.isIntersectionBox(box0)) {
				return false;
			}
			if (box.containsBox(box0)) {
				return true;
			}

			boxPoints[0].x = box.min.x; boxPoints[0].y = box.min.y;
			boxPoints[1].x = box.max.x; boxPoints[1].y = box.min.y;
			boxPoints[2].x = box.max.x; boxPoints[2].y = box.max.y;
			boxPoints[3].x = box.min.x; boxPoints[3].y = box.max.y;

			var v0, v1, v2;
			for (var i = 0; i < sector.indices.length; i += 3) {
				v0 = sector.vertices[sector.indices[i]];
				v1 = sector.vertices[sector.indices[i + 1]];
				v2 = sector.vertices[sector.indices[i + 2]];

				for (var j = 0; j < 4; j++) {
					if (GS.MathHelper.pointInTriangle(boxPoints[j], v0, v1, v2)) {
						return true;
					}
				}
			}

			for (var i = 0; i < sector.vertices.length - 1; i++) {
				seg0.start.copy(sector.vertices[i]);
				seg0.end.copy(sector.vertices[i + 1]);
				if (GS.LineHelper.intersectionLineSegmentBox(seg0, box)) {
					return true;
				}
			}
			seg0.start.copy(sector.vertices[sector.vertices.length - 1]);
			seg0.end.copy(sector.vertices[0]);
			if (GS.LineHelper.intersectionLineSegmentBox(seg0, box)) {
				return true;
			}

			return false;
		};
	}(),

	retriangulateSectors: function(sectors) {
		function sectorEdgeContainsVertex(a, v) {
			var result = { edgeIndex: 0, offset: 0 };
			var i, offset;

			for (i = 0; i < a.vertices.length - 1; i++) {
				if (a.vertices[i].equalsEpsilon(v) || a.vertices[i + 1].equalsEpsilon(v)) {
					return undefined;
				}
				offset = GS.LineHelper.pointOffsetOnLineSegment({ start: a.vertices[i], end: a.vertices[i + 1] }, v);
				if (offset != -1) {
					result.edgeIndex = i;
					result.offset = offset;
					return result;
				}
			}

			if (a.vertices[i].equalsEpsilon(v) || a.vertices[0].equalsEpsilon(v)) {
				return undefined;
			}
			offset = GS.LineHelper.pointOffsetOnLineSegment({ start: a.vertices[i], end: a.vertices[0] }, v);
			if (offset != -1) {
				result.edgeIndex = i;
				result.offset = offset;
				return result;
			}

			return undefined;
		}

		function edgeSetEquals(a, b) {
			return a.vertex.equalsEpsilon(b.vertex);
		}

		function sortCompare(a, b) {
			return b.offset - a.offset;
		}

		function getSectorEdgeIndex(a, start, end) {
			for (var i = 0; i < a.vertices.length - 1; i++) {
				if (a.vertices[i].equalsEpsilon(start) && a.vertices[i + 1].equalsEpsilon(end)) {
					return i;
				}
			}
			if (a.vertices[i].equalsEpsilon(start) && a.vertices[0].equalsEpsilon(end)) {
				return i;
			}
			return -1;
		}

		function addVerticesToSector(a, v) {
			var edgeIndex = getSectorEdgeIndex(a, v.edgeStart, v.edgeEnd);
			if (edgeIndex != -1) {
				for (var i = 0; i < v.vertices.length; i++) {
					a.vertices.splice(edgeIndex + 1, 0, v.vertices[i]);
				}
			}
		}

		var sectorEdges = [];
		for (var i = 0; i < sectors.length; i++) {
			var edges = [];
			for (var j = 0; j < sectors[i].vertices.length; j++) {
				edges.push(new GS.Set([], edgeSetEquals));
			}
			sectorEdges.push(edges);
		}

		function addVertices(aIndex, bIndex) {
			var a = sectors[aIndex];
			var b = sectors[bIndex];

			for (var i = 0; i < b.vertices.length; i++) {
				var result = sectorEdgeContainsVertex(a, b.vertices[i]);
				if (result !== undefined) {
					var edges = sectorEdges[aIndex];
					edges[result.edgeIndex].add({
						vertex: b.vertices[i],
						offset: result.offset,
					});
				}
			}
		}

		for (var i = 0; i < sectors.length - 1; i++) {
			for (var j = i + 1; j < sectors.length; j++) {
				if (i != j) {
					addVertices(i, j);
					addVertices(j, i);
				}
			}
		}		

		for (var i = 0; i < sectors.length; i++) {
			var toAdd = [];
			var n = sectors[i].vertices.length;
			for (var j = 0; j < n; j++) {
				var newPoints = sectorEdges[i][j].elements;
				if (newPoints.length > 0) {
					newPoints.sort(sortCompare);
					var item = { vertices: [], edgeStart: sectors[i].vertices[j], edgeEnd: sectors[i].vertices[(j == n - 1) ? 0 : (j + 1)] };
					for (var k = 0; k < newPoints.length; k++) {
						item.vertices.push(newPoints[k].vertex);
					}
					toAdd.push(item);
				}
			}

			for (var j = 0; j < toAdd.length; j++) {
				addVerticesToSector(sectors[i], toAdd[j]);
			}

			var vertices = this.vector2ToVertexArray(sectors[i].vertices);
			if (this.areVerticesClockwise(vertices)) {
				this.reverseVertices(vertices);
			}
			sectors[i].vertices = this.vertexToVector2Array(vertices);
			sectors[i].indices = PolyK.Triangulate(vertices);
		}
	},

	retriangulateSegments: function(segments) {
		function rightSideCompare(a, b) {
			return b - a;
		}

		function leftSideCompare(a, b) {
			return a - b;
		}

		function addVertices(seg, endPoint, compare) {
			var points = new GS.Set();

			for (var i = 0; i < segments.length; i++) {
				var s = segments[i];
				if (s === seg) {
					continue;
				}
				if (!s.start.equalsEpsilon(endPoint) && !s.end.equalsEpsilon(endPoint)) {
					continue;
				}

				if (s.topY < seg.topY && s.topY > seg.bottomY) {
					points.add(s.topY);
				}
				if (s.bottomY < seg.topY && s.bottomY > seg.bottomY) {
					points.add(s.bottomY);
				}
			}

			if (points.elements.length > 0) {
				points.elements.sort(compare);
				for (var i = 0; i < points.elements.length; i++) {
					seg.vertices.push(new THREE.Vector3(endPoint.x, points.elements[i], endPoint.y));
				}
			}

			return points.elements.length;
		}

		for (var i = 0; i < segments.length; i++) {
			var seg = segments[i];

			if (seg.type === GS.SegmentTypes.TVScreen || seg.type === GS.SegmentTypes.Switch) {
				continue;
			}

			seg.indices = [0, 1, 2];

			seg.vertices = [
				new THREE.Vector3(seg.start.x, seg.topY, seg.start.y),
				new THREE.Vector3(seg.end.x, seg.topY, seg.end.y),
			];

			var n = addVertices(seg, seg.end, rightSideCompare);
			if (n > 0) {
				for (var j = 0; j < n; j++) {
					seg.indices.push(0);
					seg.indices.push(j + 2);
					seg.indices.push(j + 3);
				}
			}

			seg.vertices.push(new THREE.Vector3(seg.end.x, seg.bottomY, seg.end.y));
			seg.vertices.push(new THREE.Vector3(seg.start.x, seg.bottomY, seg.start.y));

			var m = seg.vertices.length - 2;
			n = addVertices(seg, seg.start, leftSideCompare);
			if (n > 0) {
				for (var j = 0; j < n; j++) {
					seg.indices.push(m);
					seg.indices.push(m + j + 1);
					seg.indices.push(m + j + 2);
				}
			}
			seg.indices.push(m);
			seg.indices.push(m + n + 1);
			seg.indices.push(0);

			seg.bottomRightIndex = m;
		}
	},

	// http://www.emanueleferonato.com/2013/10/24/get-simpler-polygons-by-removing-collinear-points/
	detriangulateSectors: function(sectors) {
		for (var i = 0; i < sectors.length; i++) {
			var sector = sectors[i];
			var points = [ sector.vertices[0] ];
			var n = sector.vertices.length;

			for (var j = 1; j < n; j++) {
				if (j < n - 1) {
					if (!GS.LineHelper.arePointsCollinear(sector.vertices[j - 1], sector.vertices[j], sector.vertices[j + 1])) {
						points.push(sector.vertices[j]);
					}
				} else {
					points.push(sector.vertices[j]);
				}
			}

			var vertices = this.vector2ToVertexArray(points);
			if (this.areVerticesClockwise(vertices)) {
				this.reverseVertices(vertices);
			}			
			sector.collisionVertices = this.vertexToVector2Array(vertices);
			sector.collisionIndices = PolyK.Triangulate(vertices);
		}
	},

	// http://stackoverflow.com/a/9939071/3640489
	getSectorCentroid: function(sector) {
		var twicearea = 0, x = 0, y = 0, nPts = sector.vertices.length, p1, p2, f;

		function getPoint(n) {		
			if (n === sector.vertices.length) {
				n = 0;
			}
			return sector.vertices[n];
		}

		for (var i = 0, j = nPts - 1; i < nPts; j = i++) {
			p1 = getPoint(i);
			p2 = getPoint(j);
			f = p1.x * p2.y - p2.x * p1.y;
			twicearea += f;
			x += (p1.x + p2.x) * f;
			y += (p1.y + p2.y) * f;
		}
		f = twicearea * 3;

		return new THREE.Vector2(x/f, y/f);
	},
};

GS.Graph = function(equalsFunc) {
	this.equalsFunc = equalsFunc || function(a, b) { return a == b; };

	this.vertices = [];
	this.edges = [];
};

GS.Graph.prototype = {
	addEdge: function(start, end) {
		if (this.equalsFunc(start, end)) {
			return;
		}

		this.edges.push({
			start: this.addVertex(start),
			end: this.addVertex(end),
		});
	},

	removeEdge: function(start, end) {
		if (this.equalsFunc(start, end)) {
			return;
		}

		var that = this;
		function equals(a, b) {
			return (that.equalsFunc(a.start, b.start) && that.equalsFunc(a.end, b.end) ||
					that.equalsFunc(a.end, b.start) && that.equalsFunc(a.start, b.end));
		}

		var edge = { start: start, end: end };
		for (var i = this.edges.length - 1; i >= 0; i--) {
			if (equals(edge, this.edges[i])) {
				this.edges.splice(i, 1);
			}
		}
	},

	addVertex: function(vertex) {
		var result = this.vertexExists(vertex);
		if (result > -1) {
			return result;
		}
		this.vertices.push(vertex);
		return this.vertices.length - 1;
	},

	vertexExists: function(vertex) {
		for (var i = 0; i < this.vertices.length; i++) {
			if (this.equalsFunc(this.vertices[i], vertex)) {
				return i;
			}
		}
		return -1;
	},

	// Floyd-Warshall: http://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm
	computeShortestPaths: function() {
		var dist = [];
		for (var i = 0; i < this.vertices.length; i++) {
			dist[i] = [];
			for (var j = 0; j < this.vertices.length; j++) {
				dist[i].push(Infinity);
			}
		}
		this.dist = dist;

		var next = [];
		for (var i = 0; i < this.vertices.length; i++) {
			next[i] = [];
			for (var j = 0; j < this.vertices.length; j++) {
				next[i].push(null);
			}
		}
		this.next = next;

		for (var i = 0; i < this.vertices.length; i++) {
			dist[i][i] = 0;
		}
		for (var i = 0; i < this.edges.length; i++) {
			var edge = this.edges[i];
			dist[edge.start][edge.end] = 1;
			dist[edge.end][edge.start] = 1;
		}

		this.initNextArray();

		for (var k = 0; k < this.vertices.length; k++) {
			for (var i = 0; i < this.vertices.length; i++) {
				for (var j = 0; j < this.vertices.length; j++) {
					if (dist[i][k] + dist[k][j] < dist[i][j]) {
						dist[i][j] = dist[i][k] + dist[k][j];
						next[i][j] = next[k][j];
					}
				}
			}
		}
	},

	initNextArray: function() {
		for (var i = 0; i < this.vertices.length; i++) {
			for (var j = 0; j < this.vertices.length; j++) {
				if (i == j || this.dist[i][j] == Infinity) {
					this.next[i][j] = 0;
				} else {
					this.next[i][j] = i;
				}
			}
		}
	},

	getPath: function(i, j) {
		if (i == j) {
			return [];
		}

		var path = this.constructPath(i, j);
		if (path !== undefined) {
			path.unshift(i);
			path.push(j);
		}
		return path;
	},

	constructPath: function(i, j) {
		if (this.dist[i][j] == Infinity) {
			return undefined;
		}

		var intermediate = this.next[i][j];
		if (intermediate == i) {
			return [];
		} else {
			var prev = this.constructPath(i, intermediate);
			var path = [intermediate];
			var next = this.constructPath(intermediate, j);
			if (prev !== undefined) {
				for (var i = prev.length - 1; i >= 0; i--) {
					path.unshift(prev[i]);
				}
			}
			if (next !== undefined) {
				for (var i = 0; i < next.length; i++) {
					path.push(next[i]);
				}
			}
			return path;
		}
	},

	computeVertexNeighborSets: function() {
		var neighborSets = [];

		for (var i = 0; i < this.vertices.length; i++) {
			var v = this.vertices[i];
			var neighbors = new GS.Set();

			for (var j = 0; j < this.edges.length; j++) {
				var edge = this.edges[j];

				if (this.equalsFunc(v, this.vertices[edge.start])) {
					neighbors.add(this.vertices[edge.end]);
				} else
				if (this.equalsFunc(v, this.vertices[edge.end])) {
					neighbors.add(this.vertices[edge.start]);
				}
			}

			neighborSets.push(neighbors);
		}

		this.neighborSets = neighborSets;
	},

	// http://en.wikipedia.org/wiki/Bron%E2%80%93Kerbosch_algorithm
	computeMaximalCliques: function() {
		var that = this;
		this.maximalCliques = [];
		this.computeVertexNeighborSets();

		function bronKerbosch(R, P, X) {
			if (P.elements.length === 0 && X.elements.length === 0) {
				that.maximalCliques.push(R);
			}
			for (var i = 0; i < P.elements.length; i++) {
				var v = P.elements[i];
				var N = that.neighborSets[v];
				bronKerbosch(R.clone().add(v), P.clone().intersection(N), X.clone().intersection(N));
				P.remove(v);
				X.add(v);
			}
		}

		var R = new GS.Set(undefined, this.equalsFunc);
		var P = new GS.Set(this.vertices, this.equalsFunc);
		var X = new GS.Set(undefined, this.equalsFunc);
		bronKerbosch(R, P, X);

		this.maximalCliques.sort(function(a, b) {
			return a.length - b.length;
		});
	},

	getVertexIndex: function(vertex) {
		for (var i = 0; i < this.vertices.length; i++) {
			if (this.equalsFunc(this.vertices[i], vertex)) {
				return i;
			}
		}
		return -1;
	},
};

GS.PlanarGraph = function() {
	GS.Graph.call(this);

	var epsilon = 0.0001;
	this.equalsFunc = function(a, b) {
		return (Math.abs(a.x - b.x) < epsilon &&
				Math.abs(a.y - b.y) < epsilon);
	};
};

GS.PlanarGraph.prototype = GS.inherit(GS.Graph, {
	computeMinimumCycleBasis: function() {
		this.computeAllCycles();

		if (this.cycles.length > 100) {
			console.log("cycle count > 100; using horton");
			this.selectCyclesHorton();
		} else {
			this.selectCyclesNonOverlapping();
		}
	},

	computeAllCycles: function() {
		var that = this;
		var cycles = [];

		function inCycles(cycle) {
			for (var i = 0; i < cycles.length; i++) {
				if (cycles[i].equals(cycle)) {
					return true;
				}
			}
			return false;
		}

		function equals(a, b) {
			return (a.start == b.start && a.end == b.end ||
					a.end == b.start && b.end == a.start);
		}

		function fromPathSet(set) {
			var a = new GS.Set(undefined, equals);
			var e = set.elements;
			var n = e.length;

			for (var i = 0; i < n - 1; i++) {
				a.add({ start: e[i], end: e[i + 1] });
			}
			a.add({ start: e[n - 1], end: e[0] });

			return a;
		}
		
		var path0 = new GS.Set();
		var path1 = new GS.Set();

		for (var i = 0; i < this.vertices.length; i++) {
			for (var j = 0; j < this.edges.length; j++) {
				var edge = this.edges[j];
				path0.elements = this.getPath(edge.start, i) || [];
				path1.elements = this.getPath(i, edge.end) || [];

				var it = path0.intersection(path1);
				if (it.elements.length == 1 && it.elements[0] == i) {
					var cycle = fromPathSet(path0.union(path1));
					cycle.add(edge);
					if (!inCycles(cycle)) {
						cycles.push(cycle);
					}
				}
			}
		}

		cycles.sort(function(a, b) {
			var weightA = that.getCycleWeight(a);
			var weightB = that.getCycleWeight(b);
			return weightA - weightB;
		});

		this.cycles = cycles;
	},

	getCycleWeight: function(cycle) {
		return cycle.elements.length;
	},

	// https://dl.dropboxusercontent.com/u/705999/polyfinder/index.html
	pointInCycle: function(p, cycle) {
		var v = this.vertices;
		var idx = cycle.elements;
		var n = idx.length - 1;
		var c = false;

		var i, j = 0;
		for (i = 0, j = n - 1; i < n; j = i++) {
			var start = v[idx[i].start];
			var end = v[idx[j].start];

			if (((start.y > p.y) != (end.y > p.y)) &&
				(p.x < (end.x - start.x) * (p.y - start.y) / (end.y - start.y) + start.x)) {
				c = !c;
			}
		}

		return c;
	},

	cyclesOverlap: function(a, b) {
		var center = new THREE.Vector2();
		var edgesA = a.difference(b).elements;
		var v = this.vertices;

		for (var i = 0; i < edgesA.length; i++) {
			var edge = edgesA[i];
			center.x = (v[edge.start].x + v[edge.end].x) / 2;
			center.y = (v[edge.start].y + v[edge.end].y) / 2;

			if (this.pointInCycle(center, b)) {
				return true;
			}
		}

		var edgesB = b.difference(a).elements;

		for (var i = 0; i < edgesB.length; i++) {
			var edge = edgesB[i];
			center.x = (v[edge.start].x + v[edge.end].x) / 2;
			center.y = (v[edge.start].y + v[edge.end].y) / 2;

			if (this.pointInCycle(center, a)) {
				return true;
			}
		}

		return false;
	},	

	selectCyclesNonOverlapping: function() {
		var n = this.cycles.length;

		var graph = new GS.Graph();
		for (var i = 0; i < n; i++) {
			graph.addVertex(i);
		}
		for (var i = 0; i < n - 1; i++) {
			for (var j = i + 1; j < n; j++) {
				graph.addEdge(i, j);
			}
		}

		for (var i = 0; i < n - 1; i++) {
			for (var j = i + 1; j < n; j++) {
				if (this.cyclesOverlap(this.cycles[i], this.cycles[j])) {
					graph.removeEdge(i, j);
				}
			}
		}

		graph.computeMaximalCliques();
		if (graph.maximalCliques.length > 0) {
			this.minimumCycleBasis = graph.maximalCliques[0].elements;
		}		
	},

	// http://prolog.hil.unb.ca:8080/xmlui/bitstream/handle/1882/30807/TR84-026.pdf?sequence=1
	selectCyclesHorton: function() {
		var m = this.cycles.length;
		var n = this.edges.length;

		var matrix = new GS.Matrix(m, n);

		for (var i = 0; i < m; i++) {
			for (var j = 0; j < n; j++) {
				if (this.cycles[i].elemExists(this.edges[j])) {
					matrix.matrix[i][j] = 1;
				}
			}
		}

		matrix.binaryGaussianElimination();
		this.minimumCycleBasis = matrix.getNonZeroRowIndices();
	},

	removeNonCycleEdges: function() {
		this.nonCycleVertices = [];
		for (var i = this.vertices.length - 1; i >= 0; i--) {
			var exists = false;
			for (var j = 0; j < this.cycles.length; j++) {
				var cycle = this.cycles[j];
				if (cycle.elemExists(i)) {
					exists = true;
					break;
				}
			}
			if (!exists) {
				this.nonCycleVertices.push(i);
				for (var j = this.edges.length - 1; j >= 0; j--) {
					var edge = this.edges[j];
					if (edge.start == i || edge.end == i) {
						this.edges.splice(j, 1);
					}
				}
			}
		}
	}
});

GS.Set = function(source, equalsFunc) {
	this.equalsFunc = equalsFunc || function(a, b) { return a == b; };
	this.elements = (source !== undefined) ? source : [];
};

GS.Set.prototype = {
	add: function(elem) {
		if (!this.elemExists(elem)) {
			this.elements.push(elem);
		}
		return this;
	},

	remove: function(elem) {
		for (var i = 0; i < this.elements.length; i++) {
			if (this.equalsFunc(this.elements[i], elem)) {
				this.elements.splice(i, 1);
				break;
			}
		}
		return this;
	},

	elemExists: function(elem) {
		for (var i = 0; i < this.elements.length; i++) {
			if (this.equalsFunc(this.elements[i], elem)) {
				return true;
			}
		}
		return false;
	},

	intersection: function(set) {
		var elements = set.elements;
		var it = [];
		for (var i = 0; i < this.elements.length; i++) {
			for (var j = 0; j < elements.length; j++) {
				if (this.equalsFunc(this.elements[i], elements[j])) {
					it.push(this.elements[i]);
				}
			}
		}
		return new GS.Set(it, this.equalsFunc);
	},

	union: function(set) {
		var un = new GS.Set(this.elements.slice(), this.equalsFunc);
		var elements = set.elements;
		for (var i = 0; i < elements.length; i++) {
			un.add(elements[i]);
		}
		return un;
	},

	difference: function(set) {
		var diff = [];
		for (var i = 0; i < this.elements.length; i++) {
			if (!set.elemExists(this.elements[i])) {
				diff.push(this.elements[i]);
			}
		}
		return new GS.Set(diff, this.equalsFunc);
	},

	equals: function(set) {
		var diff1 = this.difference(set);
		var diff2 = set.difference(this);
		return diff1.elements.length === 0 && diff2.elements.length === 0;
	},

	clone: function() {
		return new GS.Set(this.elements.slice(), this.equalsFunc);
	},
};

GS.Matrix = function(m, n) {	
	var matrix = [];
	for (var i = 0; i < m; i++) {
		matrix[i] = [];
		for (var j = 0; j < n; j++) {
			matrix[i].push(0);
		}
	}
	this.matrix = matrix;
	this.rowCount = m;
	this.columnCount = n;
};

GS.Matrix.prototype = {
	// http://www.cs.umd.edu/~gasarch/TOPICS/factoring/fastgauss.pdf
	binaryGaussianElimination: function() {
		var that = this;
		var addRow = function(r0, r1) {
			for (var i = 0; i < that.columnCount; i++) {
				that.matrix[r0][i] = that.matrix[r0][i] ^ that.matrix[r1][i];
			}
		};

		for (var i = 0; i < this.rowCount; i++) {
			var found = false;
			for (var j = 0; j < this.columnCount; j++) {
				if (this.matrix[i][j] == 1) {
					found = true;
					break;
				}
			}			
			if (found) {
				for (var k = 0; k < this.rowCount; k++) {
					if (k != i) {
						if (this.matrix[k][j] == 1) {
							addRow(k, i);
						}
					}
				}
			}
		}
	},

	clear: function(value) {
		value = value || 0;
		for (var i = 0; i < this.rowCount; i++) {
			for (var j = 0; j < this.columnCount; j++) {
				this.matrix[i][j] = value; 
			}
		}
	},

	getNonZeroRowIndices: function() {
		var rowIndices = [];
		for (var i = 0; i < this.rowCount; i++) {
			var nonZero = false;
			for (var j = 0; j < this.columnCount; j++) {
				if (this.matrix[i][j] > 0) {
					nonZero = true;
					break;
				}
			}
			if (nonZero) {
				rowIndices.push(i);
			}
		}
		return rowIndices;
	},

	toString: function() {
		var str = "";
		for (var i = 0; i < this.rowCount; i++) {
			for (var j = 0; j < this.columnCount; j++) {
				str += this.matrix[i][j] + " ";
			}
			str += "\n";
		}
		return str;
	},
};;GS.Rebound = function(keybinds) {
	this.keybinds = keybinds;

	this.modifyingKeybind = false;

	this.onModifyingKeybindStart = function() {};
	this.onModifyingKeybindStop = function() {};
}

GS.Rebound.prototype = {
	init: function() {
		var that = this;

		$(document).on("keydown.keybindUse", function(e) {
			if (that.modifyingKeybind) {
				return;
			}

			var keybind = _.find(that.keybinds, { code: e.keyCode });
			if (keybind) {
				keybind.inUse = true;
				e.preventDefault();
			}
		});

		$(document).on("keyup.keybindUse", function(e) {
			if (that.modifyingKeybind) {
				return;
			}

			var keybind = _.find(that.keybinds, { code: e.keyCode });
			if (keybind) {
				keybind.inUse = false;
				e.preventDefault();
			}
		});

		$(document).on("mousedown.keybindUse", function(e) {
			if (that.modifyingKeybind) {
				return;
			}

			var keybind = _.find(that.keybinds, { mouse: true, button: e.which });
			if (keybind) {
				keybind.inUse = true;
				e.preventDefault();
			}
		});

		$(document).on("mouseup.keybindUse", function(e) {
			if (that.modifyingKeybind) {
				return;
			}

			var keybind = _.find(that.keybinds, { mouse: true, button: e.which });
			if (keybind) {
				keybind.inUse = false;
				e.preventDefault();
			}
		});
	},

	getKeybindByActionName: function(actionName) {
		return _.find(this.keybinds, { actionName: actionName });
	},

	modifyKeybind: function(keybind) {
		var that = this;

		if (this.modifyingKeybind) {
			return;
		}

		this.modifyingKeybind = true;
		this.onModifyingKeybindStart({ keybind: keybind });

		$(document).on("keydown.modifyKeybind", function(e) {
			var code = e.keyCode || e.which;
			$(document).off("keydown.modifyKeybind");
			$(document).off("mousedown.modifyKeybind");

			var ok = that.changeKey(keybind, e);
			that.modifyingKeybind = false;
			that.onModifyingKeybindStop({ keybind: keybind, success: ok });

			e.preventDefault();
		});

		$(document).on("mousedown.modifyKeybind", function(e) {
			var code = e.keyCode || e.which;
			$(document).off("keydown.modifyKeybind");
			$(document).off("mousedown.modifyKeybind");

			var ok = that.changeMouse(keybind, e);
			that.modifyingKeybind = false;
			that.onModifyingKeybindStop({ keybind: keybind, success: ok });

			e.preventDefault();
		});
	},

	changeKey: function(keybind, e) {
		var name = this.isKeyAllowed(e);
		if (!name) {
			return false;
		}

		e.preventDefault();

		var code = e.keyCode;
		var existing = _.find(this.keybinds, { code: code });

		if (existing) {
			existing.code = undefined;
			existing.mouse = undefined;
			existing.button = undefined;
			existing.controlName = "NOT BOUND";
		}

		keybind.code = code;
		keybind.mouse = undefined;
		keybind.button = undefined;
		keybind.controlName = name;

		return true;
	},

	changeMouse: function(keybind, e) {
		var name;

		if (e.which === 1) {
			name = "MOUSE LEFT";
		} else
		if (e.which === 2) {
			name = "MOUSE MIDDLE";
		}
		// else
		// if (e.which === 3) {
		// 	name = "MOUSE RIGHT";
		// }

		if (!name) {
			return false;
		}

		var existing = _.find(this.keybinds, { mouse: true, button: e.which });

		if (existing) {
			existing.code = undefined;
			existing.mouse = undefined;
			existing.button = undefined;
			existing.controlName = "NOT BOUND";
		}

		keybind.code = undefined;
		keybind.mouse = true;
		keybind.button = e.which;
		keybind.controlName = name;

		return true;
	},

	isKeyAllowed: function(e) {
		// A-Z, a-z
		if (e.keyCode >= 65 && e.keyCode <= 90) {
			return String.fromCharCode(e.keyCode);
		}

		// 0-9
		if (e.keyCode >= 48 && e.keyCode <= 57) {
			return String.fromCharCode(e.keyCode);
		}

		// arrows
		if (e.keyCode >= 37 && e.keyCode <= 40) {
			return e.originalEvent.keyIdentifier.toUpperCase();
		}

		// shift, control, alt
		if (e.keyCode >= 16 && e.keyCode <= 18) {
			return e.originalEvent.keyIdentifier.toUpperCase();
		}

		switch (e.keyCode) {
			case 32:
				return "SPACE";
			case 13:
				return "ENTER";
			// case 9:
			// 	return "TAB";
			case 8:
				return "BACKSPACE";
			case 91:
			case 93:
				return "COMMAND";
		}

		return false;
	}
};;GS.TextInput = function(button) {
	this.textButton = button;

	this.modifyingText = false;

	this.onModifyingTextStart = function() {};
	this.onModifyingTextStop = function() {};
}

GS.TextInput.prototype = {
	init: function() {
		var that = this;

		$(document).on("keydown.keybindUse", function(e) {
			if (that.modifyingText) {
				return;
			}

			var keybind = _.find(that.keybinds, { code: e.keyCode });
			if (keybind) {
				keybind.inUse = true;
				e.preventDefault();
			}
		});

		$(document).on("keyup.keybindUse", function(e) {
			if (that.modifyingText) {
				return;
			}

			var keybind = _.find(that.keybinds, { code: e.keyCode });
			if (keybind) {
				keybind.inUse = false;
				e.preventDefault();
			}
		});

		$(document).on("mousedown.keybindUse", function(e) {
			if (that.modifyingText) {
				return;
			}

			var keybind = _.find(that.keybinds, { mouse: true, button: e.which });
			if (keybind) {
				keybind.inUse = true;
				e.preventDefault();
			}
		});

		$(document).on("mouseup.keybindUse", function(e) {
			if (that.modifyingText) {
				return;
			}

			var keybind = _.find(that.keybinds, { mouse: true, button: e.which });
			if (keybind) {
				keybind.inUse = false;
				e.preventDefault();
			}
		});
	},

	getKeybindByActionName: function(actionName) {
		return _.find(this.keybinds, { actionName: actionName });
	},

	modifyText: function(button) {
		var that = this;

		if (this.modifyingText) {
			return;
		}

		this.modifyingText = true;
    button.text = '';
		this.onModifyingTextStart({ button: button });

		$(document).on("keydown.modifyText", function(e) {
			var code = e.keyCode || e.which;

      if (code === 13) {
			  $(document).off("keydown.modifyText");
        that.modifyingText = false;
        that.onModifyingTextStop({ button: button, success: true });
        return
      } else if (code === 8) {
        button.text = (button.text || "").substring(0, button.text.length - 1);
      } else {

          var ok = that.changeText(button, e);

      }

			e.preventDefault();
		});
	},

	changeText: function(button, e) {
		var name = this.isKeyAllowed(e);
		if (!name) {
			return false;
		}

		e.preventDefault();

    button.text += name

		return true;
	},

	isKeyAllowed: function(e) {
		// A-Z, a-z
		if (e.keyCode >= 65 && e.keyCode <= 90) {
			return String.fromCharCode(e.keyCode);
		}

		// 0-9
		if (e.keyCode >= 48 && e.keyCode <= 57) {
			return String.fromCharCode(e.keyCode);
		}

		switch (e.keyCode) {
			case 32:
				return " ";
		}

		return false;
	}
};
;GS.DebugUI = {
	fontSize: 24,
	maxTempLines: 5,
	defaultTimeout: GS.msToFrames(5000),

	overlayMargin: 10,
	overlayPadding: 5,
	overlayWidth: 0,
	overlayHeight: 0,	
	overlayX: 0,
	overlayY: 0,

	visibleStaticLines: 0,

	staticLines: {},
	tempLines: [],
	valueTracking: {},

	hasChanged: false,

	_visible: false,
	set visible(value) {
		this._visible = value;
		if (!value && this.ctx) {
			this.ctx.clearRect(0, 0, this.width, this.height);
		}
	},

	get visible() {
		return this._visible;
	},

	init: function() {
		var that = this;

		this.minWidth = 1280;
		this.minHeight = 720;

		this.width = window.innerWidth;
		this.height = window.innerHeight;

		window.addEventListener("resize", function() { that.onResize(); }, false);		

		var canvas = document.createElement("canvas");
		canvas.id = "debug-ui-canvas";
		canvas.width = this.width;
		canvas.height = this.height;
		canvas.style.backgroundColor = "rgba(0, 0, 0, 0)";
		canvas.style.zIndex = 100;
		this.canvas = canvas;

		var ctx = canvas.getContext("2d");
		ctx.globalCompositeOperation = "source-over";
		ctx.save();
		this.ctx = ctx;
		this.updateFont();
		
		document.body.appendChild(this.canvas);

		this.onResize();
	},

	update: function() {
		var hasChanged = false;
		for (var i = this.tempLines.length - 1; i >= 0; i--) {
			var line = this.tempLines[i];
			line.timeout--;
			if (line.timeout === 0) {
				this.tempLines.splice(i, 1);
				this.hasChanged = true;
			}
		}

		if (this.hasChanged) {
			this.calculateOverlayCoords();
			this.draw();
			this.hasChanged = false;
		}
	},

	draw: function() {
		if (!this._visible) {
			return;
		}

		this.ctx.clearRect(0, 0, this.width, this.height);

		if (this.visibleStaticLines > 0 || this.tempLines.length > 0) {
			this.ctx.save();

			this.ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
			this.ctx.fillRect(this.overlayX, this.overlayY, this.overlayWidth, this.overlayHeight);
			this.ctx.fillStyle = "#fff";

			var y = this.overlayY + this.overlayPadding;
			for (var i in this.staticLines) {
				if (this.staticLines[i].visible) {
					this.ctx.fillText(this.staticLines[i].text, this.overlayX + this.overlayPadding, y);
					y += this.fontSize + this.overlayPadding;
				}
			}

			for (var i = 0; i < this.tempLines.length; i++) {
				this.ctx.fillText(this.tempLines[i].text, this.overlayX + this.overlayPadding, y);
				y += this.fontSize + this.overlayPadding;				
			}

			this.ctx.restore();
		}
	},

	updateFont: function() {
		this.ctx.font = this.fontSize + "px 'Lucida Console', Monaco, monospace";
		this.ctx.textBaseline = "top";
	},

	calculateOverlayCoords: function() {
		this.overlayWidth = 0;
		this.visibleStaticLines = 0;

		for (var i in this.staticLines) {
			if (this.staticLines[i].visible) {
				this.visibleStaticLines++;
			}
		}

		this.overlayHeight = (this.visibleStaticLines + this.tempLines.length) * (this.fontSize + this.overlayPadding) + this.overlayPadding;

		// lower right
		// this.overlayX = this.width - this.overlayWidth - this.overlayMargin;
		// this.overlayY = this.height - this.overlayHeight - this.overlayMargin;

		// upper left
		this.overlayX = this.overlayMargin;
		this.overlayY = this.overlayMargin;

		for (var i in this.staticLines) {
			if (this.staticLines[i].visible) {
				this.overlayWidth = Math.max(this.overlayWidth, this.ctx.measureText(this.staticLines[i].text).width + this.overlayPadding * 2);
			}
		}

		for (var i = 0; i < this.tempLines.length; i++) {
			this.overlayWidth = Math.max(this.overlayWidth, this.ctx.measureText(this.tempLines[i].text).width + this.overlayPadding * 2);
		}
	},

	trackNumericValue: function(id, numericValue) {
		if (this.valueTracking[id] === undefined) {
			this.valueTracking[id] = {};
			this.valueTracking[id].min = Infinity;
			this.valueTracking[id].max = -Infinity;
			this.valueTracking[id].avg = 0;
			this.valueTracking[id].count = 0;
		}

		var v = this.valueTracking[id];
		v.min = Math.min(v.min, numericValue);
		v.max = Math.max(v.max, numericValue);
		v.count++;
		v.avg += (numericValue - v.avg) / v.count;
		this.setStaticLine(id, numericValue + " (min: " + v.min + ", max: " + v.max + ", avg: " + v.avg.toFixed(0) + ")");
	},

	setStaticLine: function(id, text) {
		text = id + ": " + text;
		if (id in this.staticLines) {
			this.staticLines[id].text = text;
		} else {
			this.staticLines[id] = {
				text: text,
				visible: true,
			};
		}
		this.hasChanged = true;
	},

	removeStaticLine: function(id) {
		delete this.staticLines[id];
		this.hasChanged = true;
	},

	setStaticLineVisibility: function(id, value) {
		if (id in this.staticLines) {
			this.staticLines[id].visible = (value === true);
		} else {
			this.staticLines[id] = {
				text: "",
				visible: value,
			}
		}
	},

	getStaticLineVisibility: function(id) {
		if (id in this.staticLines) {
			return this.staticLines[id].visible;
		}
	},

	addTempLine: function(text, timeout) {
		if (this.tempLines.length == this.maxTempLines) {
			this.tempLines.shift();
		}

		timeout = (timeout !== undefined) ? timeout : this.defaultTimeout;
		var line = {
			text: text,
			timeout: timeout,
		};
		this.tempLines.push(line);
		this.hasChanged = true;
	},

	onResize: function() {
		this.width = Math.max(window.innerWidth, this.minWidth);
		this.height = Math.max(window.innerHeight, this.minHeight);

		this.canvas.width = this.width;
		this.canvas.height = this.height;

		$(this.canvas).css("width", window.innerWidth + "px").css("height", window.innerHeight + "px");

		this.ctx.font = this.fontSize + "px 'Lucida Console', Monaco, monospace";
		this.ctx.textBaseline = "top";
		this.draw();
	},
};;GS.LoadingUI = function() {	
	this.redraw = true;
	this.hidden = true;

	this.spinnerOnly = false;

	this.screenInfo = {
		width: null,
		height: null,
		center: new THREE.Vector2(),
	};

	this.loadingBox = {
		width: 0.5,
		height: 0.05,
		contentPadding: 0.005,
		topLeft: new THREE.Vector2(),
		bottomRight: new THREE.Vector2(),
		contentTopLeft: new THREE.Vector2(),
		contentBottomRight: new THREE.Vector2(),
		contentCurrentBottomRight: new THREE.Vector2(),
	};

	this.percentLoaded = 0;
};

GS.LoadingUI.prototype = {
	init: function() {
		this.cvs = new GS.Canvas2d(true);
		this.cvs.canvasId = "loading-canvas";
		this.cvs.init();
		this.cvs.screenCanvas.style.zIndex = 50;

		this.onResize();
	},

	draw: function() {
		if (this.hidden || !this.redraw) {
			return;
		}

		this.redraw = false;

		this.cvs.clear();

		if (this.spinnerOnly) {
			this.cvs.text(this.screenInfo.center, "Imagine it's 1994...", "#fff", 40, "middle", "center", GS.UIFont);
		}
		else {
			this.cvs.box(this.loadingBox.topLeft, this.loadingBox.bottomRight, "#fff", 3);
			this.cvs.boxFill(this.loadingBox.contentTopLeft, this.loadingBox.contentCurrentBottomRight, "#fff");
		}

		this.cvs.flip();
	},

	updateProgress: function(e) {
		this.percentLoaded = e.percentLoaded;
	},

	updateLoadingBoxContent: function() {
		var width = this.loadingBox.contentBottomRight.x - this.loadingBox.contentTopLeft.x;
		this.loadingBox.contentCurrentBottomRight.x = this.loadingBox.contentTopLeft.x + Math.floor(width * this.percentLoaded * 0.01);

		this.redraw = true;
	},

	show: function() {
		this.cvs.show();
		this.hidden = false;
	},

	hide: function() {		
		this.cvs.hide();
		this.hidden = true;
	},

	onResize: function() {
		this.screenInfo.width = this.cvs.bufferCanvas.width;
		this.screenInfo.height = this.cvs.bufferCanvas.height;
		this.screenInfo.center.set(Math.floor(this.screenInfo.width / 2), Math.floor(this.screenInfo.height / 2));

		this.loadingBox.topLeft.copy(this.screenInfo.center);
		this.loadingBox.topLeft.x -= Math.floor(this.loadingBox.width * 0.5 * this.screenInfo.width);
		this.loadingBox.topLeft.y -= Math.floor(this.loadingBox.height * 0.5 * this.screenInfo.height);

		this.loadingBox.bottomRight.copy(this.screenInfo.center);
		this.loadingBox.bottomRight.x += Math.floor(this.loadingBox.width * 0.5 * this.screenInfo.width);
		this.loadingBox.bottomRight.y += Math.floor(this.loadingBox.height * 0.5 * this.screenInfo.height);

		this.loadingBox.contentTopLeft.copy(this.loadingBox.topLeft);
		this.loadingBox.contentTopLeft.x += Math.floor(this.loadingBox.contentPadding * this.screenInfo.width);
		this.loadingBox.contentTopLeft.y += Math.floor(this.loadingBox.contentPadding * this.screenInfo.width);

		this.loadingBox.contentBottomRight.copy(this.loadingBox.bottomRight);
		this.loadingBox.contentBottomRight.x -= Math.floor(this.loadingBox.contentPadding * this.screenInfo.width);
		this.loadingBox.contentBottomRight.y -= Math.floor(this.loadingBox.contentPadding * this.screenInfo.width);

		this.loadingBox.contentCurrentBottomRight.y = this.loadingBox.contentBottomRight.y;

		this.updateLoadingBoxContent();
	},

	set percentLoaded(value) {
		this._percentLoaded = value;
		this.updateLoadingBoxContent();
	},

	get percentLoaded() {
		return this._percentLoaded;
	},
};;GS.UIColors = {
	background: "rgba(0, 0, 0, 0.75)",
	menuBackground: "rgba(0, 0, 0, 0.9)",	
	foreground: "rgba(255, 255, 255, 1)",
	foregroundDisabled: "rgba(64, 64, 64, 1)",
	buttonHover: "rgba(128, 0, 0, 0.5)",
	buttonActive: "rgba(255, 0, 0, 0.5)",
};

GS.UIFont = "hudFont";;GS.UIComponents = GS.UIComponents || {};

GS.UIManager = function() {
	this.reset();
	this.menuOnly = true;
	this.menuActive = false;

	this.menuBackOffset = new THREE.Vector2(0, 0);
	this.menuBackPos = new THREE.Vector2(0, 0);
	this.menuBackSize = new THREE.Vector2(1, 1);

	this.showHUD = GS.Settings.showHUD;
};

GS.UIManager.prototype = {
	constructor: GS.UIManager,

	reset: function() {
		this.grid = undefined;
		this.hidden = true;
	},

	init: function() {
		this.cvs = new GS.Canvas2d(true);

		this.cvs.alpha = 0;
		this.cvs.canvasId = "ui-canvas";
		this.cvs.redrawOnResize = false;

		this.cvs.init();
		this.cvs.screenCanvas.style.zIndex = 30;

		this.vectorCanvas = new GS.VectorCanvas(this.cvs);
		this.vectorCanvas.init();
	},

	initComponents: function(assets, grid) {
		this.grid = grid;
		this.assets = {
			images: assets[GS.AssetTypes.UIWidget],
		};
		this.components = [];

		if (this.grid !== undefined) {
			this.powerBars = new GS.UIComponents.PowerBars(this.vectorCanvas, this.assets, this.grid.player);
			this.powerBars.init();
			this.components.push(this.powerBars);

			this.crosshair = new GS.UIComponents.Crosshair(this.vectorCanvas, this.assets, this.grid.player);
			this.crosshair.init();
			this.components.push(this.crosshair);

			this.notifications = new GS.UIComponents.Notifications(this.vectorCanvas, this.assets, this.grid.player);
			this.notifications.init();
			this.components.push(this.notifications);

			this.winScreen = new GS.UIComponents.WinScreen(this.vectorCanvas, this.assets, this.grid.player);
			this.winScreen.init();
			this.components.push(this.winScreen);

			this.automap = new GS.UIComponents.Automap(this.vectorCanvas, this.assets, this.grid.player);
			this.automap.init();
			this.components.push(this.automap);
		}

		if (this.menu === undefined) {
			this.menu = new GS.UIComponents.Menu(this.vectorCanvas, this.assets);
			this.menu.init();
		}

		this.overrideRedraw = true;
	},

  reinit: function () {
    let player = GAME.grid.player;
    this.player = player;
    this.powerBars.player = player;
    this.crosshair.player = player;
    this.notifications.player = player;
    this.winScreen.player = player;
    this.automap.player = player;
  },

	show: function() {
		this.overrideRedraw = true;
		this.cvs.show();
		this.hidden = false;
	},

	hide: function() {
		this.cvs.hide();
		this.hidden = true;
	},

	update: function() {
		for (var i = 0; i < this.components.length; i++) {
			this.components[i].update();
		}

		if (this.menuActive) {
			this.menu.update();
		}
	},

	draw: function() {
		if (this.menuActive) {
			this.cvs.clear();

			if (this.menuOnly) {
				this.vectorCanvas.drawImage(this.menuBackOffset, this.menuBackPos, this.assets.images.menu_back, this.menuBackSize, false);
			}
			this.menu.draw();

			this.cvs.flip();
		} else
		if (this.winScreen.visible) {
			this.cvs.clear();
			this.winScreen.draw();
			this.cvs.flip();
		} else
		if (this.automap.visible) {
			if (this.overrideRedraw || this.automap.needsRedraw) {
				if (this.overrideRedraw) {
					this.overrideRedraw = false;
				}

				this.cvs.clear();
				this.automap.draw();
				this.automap.needsRedraw = false;
				this.cvs.flip();
			}
		} else {
			if (!this.hidden && this.checkIfRedraw()) {
				this.cvs.clear();

				if (this.showHUD) {
					for (var i = 0; i < this.components.length; i++) {
						if (this.components[i].visible) {
							this.components[i].draw();
							this.components[i].needsRedraw = false;
						}
					}
				}

				this.cvs.flip();
			}
		}
	},

	checkIfRedraw: function() {
		if (this.overrideRedraw) {
			this.overrideRedraw = false;
			return true;
		}

		for (var i = 0; i < this.components.length; i++) {
			if (this.components[i].visible && this.components[i].needsRedraw) {
				return true;
			}
		}

		return false;
	},

	removeNewsBox: function() {
		this.menu.removeNewsBox();
	},

	useIngameMenu: function() {
		this.menuOnly = false;
		this.menu.switchToIngame();
	},

	onResize: function() {
		this.overrideRedraw = true;
		this.vectorCanvas.onResize();

		GS.InputHelper.screenRatioX = this.cvs.bufferCanvas.width / window.innerWidth;
		GS.InputHelper.screenRatioY = this.cvs.bufferCanvas.height / window.innerHeight;
	},

	dispose: function() {
		this.grid = undefined;
		this.powerBars = undefined;
		this.crosshair = undefined;
		this.notifications = undefined;
		this.winScreen = undefined;
		this.components = [];
	},
};
;GS.VectorCanvas = function(canvas2d) {
	this.cvs = canvas2d;

	this.ratio = new THREE.Vector2();
};

GS.VectorCanvas.prototype = {
	constructor: GS.VectorCanvas,

	init: function() {
		this.onResize();
	},

	onResize: function() {
		this.ratio.set(this.cvs.bufferCanvas.width, this.cvs.bufferCanvas.height);
	},

	convertToScreenCoords: function(v0, v, fixedOffset) {
		v.x = Math.floor(v0.x * this.ratio.x);
		v.y = Math.floor(v0.y * this.ratio.y);

		if (fixedOffset !== undefined) {
			v.x += fixedOffset.x;
			v.y += fixedOffset.y;
		}
	},

	fixedLine: function() {
		var v0 = new THREE.Vector2();
		var v1 = new THREE.Vector2();

		return function(pos, p0, p1, color, lineWidth) {
			this.convertToScreenCoords(pos, v0, p0);
			this.convertToScreenCoords(pos, v1, p1);

			this.cvs.line(v0, v1, color, lineWidth);
		}
	}(),

	line: function() {
		var v0 = new THREE.Vector2();
		var v1 = new THREE.Vector2();

		return function(fixedOffset, pos, lineOffset, isFixedLineOffset, color, lineWidth) {
			this.convertToScreenCoords(pos, v0, fixedOffset);

			if (!isFixedLineOffset) {
				this.convertToScreenCoords(lineOffset, v1);
				v1.add(v0);
			} else {
				v1.copy(v0).add(lineOffset);
			}

			this.cvs.line(v0, v1, color, lineWidth);
		}
	}(),

	box: function() {
		var v0 = new THREE.Vector2();
		var v1 = new THREE.Vector2();

		return function(fixedOffset, pos, size, isFixedSize, color, lineWidth) {
			this.convertToScreenCoords(pos, v0, fixedOffset);

			if (!isFixedSize) {
				this.convertToScreenCoords(size, v1);
				v1.add(v0);
			} else {
				v1.copy(v0).add(size);
			}

			this.cvs.box(v0, v1, color, lineWidth);
		}
	}(),

	boxFill: function() {
		var v0 = new THREE.Vector2();
		var v1 = new THREE.Vector2();

		return function(fixedOffset, pos, size, isFixedSize, color) {
			this.convertToScreenCoords(pos, v0, fixedOffset);

			if (!isFixedSize) {
				this.convertToScreenCoords(size, v1);
				v1.add(v0);
			} else {
				v1.copy(v0).add(size);
			}

			this.cvs.boxFill(v0, v1, color);
		}
	}(),

	circle: function() {
		var v = new THREE.Vector2();

		return function(fixedOffset, pos, radius, color, lineWidth) {
			this.convertToScreenCoords(pos, v, fixedOffset);

			this.cvs.circle(v, radius, color, lineWidth);
		}
	}(),

	circleFill: function() {
		var v = new THREE.Vector2();

		return function(fixedOffset, pos, radius, color) {
			this.convertToScreenCoords(pos, v, fixedOffset);

			this.cvs.circleFill(v, radius, color);
		}
	}(),

	text: function() {
		var v = new THREE.Vector2();

		return function(fixedOffset, pos, str, color, fontSize, textBaseline, textAlign, fontFamily) {
			this.convertToScreenCoords(pos, v, fixedOffset);

			this.cvs.text(v, str, color, fontSize, textBaseline, textAlign, fontFamily);
		}
	}(),

	drawImage: function() {
		var v0 = new THREE.Vector2();
		var v1 = new THREE.Vector2();

		return function(fixedOffset, pos, img, size, isFixedSize) {
			this.convertToScreenCoords(pos, v0, fixedOffset);

			if (!isFixedSize) {
				this.convertToScreenCoords(size, v1);
			} else {
				v1.copy(size);
			}

			this.cvs.drawImage(v0, img, v1);
		}
	}(),

	drawImageFromAtlas: function() {
		var v = new THREE.Vector2();

		return function(fixedOffset, pos, img, atlasOffset, atlasSize) {
			this.convertToScreenCoords(pos, v, fixedOffset);

			this.cvs.drawImageFromAtlas(v, img, atlasOffset, atlasSize);
		}
	}(),

	getTextWidth: function(str, fontSize, fontFamily) {
		return this.cvs.getTextWidth(str, fontSize, fontFamily);
	},

	roundedBox: function() {
		var v0 = new THREE.Vector2();
		var v1 = new THREE.Vector2();

		return function(fixedOffset, pos, size, isFixedSize, radius, color, lineWidth) {
			this.convertToScreenCoords(pos, v0, fixedOffset);

			if (!isFixedSize) {
				this.convertToScreenCoords(size, v1);
				v1.add(v0);
			} else {
				v1.copy(v0).add(size);
			}

			this.cvs.roundedBox(v0, v1, radius, color, lineWidth);
		}
	}(),

	roundedBoxFill: function() {
		var v0 = new THREE.Vector2();
		var v1 = new THREE.Vector2();

		return function(fixedOffset, pos, size, isFixedSize, radius, color) {
			this.convertToScreenCoords(pos, v0, fixedOffset);

			if (!isFixedSize) {
				this.convertToScreenCoords(size, v1);
				v1.add(v0);
			} else {
				v1.copy(v0).add(size);
			}

			this.cvs.roundedBoxFill(v0, v1, radius, color);
		}
	}(),
};;GS.UIComponents.Automap = function(vectorCanvas, assets, player) {
	this.cvs = vectorCanvas;
	this.assets = assets;
	this.player = player;
	this.aiManager = player.grid.aiManager;

	this.background = {
		offset: new THREE.Vector2(0, 0),
		pos: new THREE.Vector2(0, 0),
		size: new THREE.Vector2(1, 1),
	};

	this.playerDraw = {
		offset: new THREE.Vector2(0, 0),
		pos: new THREE.Vector2(0.5, 0.5),
	};

	this.mapDraw = {
		offset: new THREE.Vector2(0, 0),
		pos: new THREE.Vector2(0.5, 0.5),
	};

	this.backgroundColor = GS.UIColors.menuBackground;

	this.oldRegionsDiscovered = Object.keys(this.aiManager.regionsDiscovered).length;
	this.oldPlayerPosition = this.player.position.toVector2();
	this.currentPlayerPosition = this.player.position.toVector2();
	this.oldPlayerDirection = this.player.direction.toVector2();
	this.currentPlayerDirection = this.player.direction.toVector2();

	this.zoomSpeed = 0.25;
	this.minZoom = 0.5;
	this.maxZoom = 4;
	this.zoom = 2;

	this.visible = false;
};

GS.UIComponents.Automap.prototype = {
	constructor: GS.UIComponents.Automap,

	init: function() {
	},

	update: function() {
		var regionsDiscovered = Object.keys(this.aiManager.regionsDiscovered).length;
		if (regionsDiscovered > this.oldRegionsDiscovered) {
			this.needsRedraw = true;
			this.oldRegionsDiscovered = regionsDiscovered;
		}

		this.player.position.toVector2(this.currentPlayerPosition);
		if (!this.currentPlayerPosition.equalsEpsilon(this.oldPlayerPosition)) {
			this.needsRedraw = true;
			this.oldPlayerPosition.copy(this.currentPlayerPosition);
		}

		this.player.direction.toVector2(this.currentPlayerDirection);
		if (!this.currentPlayerDirection.equalsEpsilon(this.oldPlayerDirection)) {
			this.needsRedraw = true;
			this.oldPlayerDirection.copy(this.currentPlayerDirection);
		}

		while (GS.InputHelper.mouseWheelEvents.length > 0) {
			var delta = GS.InputHelper.mouseWheelEvents.shift();
			if (delta < 0) {
				this.zoom -= this.zoomSpeed;
			}
			if (delta > 0) {
				this.zoom += this.zoomSpeed;
			}
			this.zoom = GS.MathHelper.clamp(this.zoom, this.minZoom, this.maxZoom);
			this.needsRedraw = true;
		}
	},

	draw: function() {
		this.cvs.boxFill(this.background.offset, this.background.pos, this.background.size, false, this.backgroundColor);

		var regionsDiscovered = this.aiManager.regionsDiscovered;
		for (var i in regionsDiscovered) {
			this.drawRegion(regionsDiscovered[i]);
		}

		this.drawPlayer();
	},

	drawPlayer: function() {
		var p0 = new THREE.Vector2();
		var p1 = new THREE.Vector2();
		var p2 = new THREE.Vector2();
		var aux = new THREE.Vector2();
		var color = "rgba(192, 192, 192, 1)";

		return function() {
			var size = this.player.size.x * this.zoom;
			var xAngle = this.player.xAngle;

			p0.x = size * Math.sin(Math.PI / 180 * (360 + 90 - xAngle));
			p0.y = size * Math.cos(Math.PI / 180 * (360 + 90 - xAngle));
			p1.x = size * Math.sin(Math.PI / 180 * (210 + 90 - xAngle));
			p1.y = size * Math.cos(Math.PI / 180 * (210 + 90 - xAngle));
			p2.x = size * Math.sin(Math.PI / 180 * (150 + 90 - xAngle));
			p2.y = size * Math.cos(Math.PI / 180 * (150 + 90 - xAngle));

			this.cvs.fixedLine(this.mapDraw.pos, p0, p1, color, 3);
			this.cvs.fixedLine(this.mapDraw.pos, p1, p2, color, 3);
			this.cvs.fixedLine(this.mapDraw.pos, p2, p0, color, 3);
		}
	}(),

	drawRegion: function() {
		var p0 = new THREE.Vector2();
		var p1 = new THREE.Vector2();
		var wallColor = "rgba(64, 64, 64, 1)";
		var doorColor = "rgba(128, 0, 0, 1)";

		return function(region) {
			var that = this;

			function drawSectorLine(sector, x0, x1, color, lineWidth) {
				p0.copy(sector.collisionVertices[x0]);
				p1.copy(sector.collisionVertices[x1]);
				p0.sub(that.currentPlayerPosition).multiplyScalar(that.zoom);
				p1.sub(that.currentPlayerPosition).multiplyScalar(that.zoom);
				p1.sub(p0);

				that.cvs.line(p0, that.mapDraw.pos, p1, true, color, lineWidth);
			}

			var sectorDict = this.aiManager.sectorDict;
			for (var i in region.sectorIds) {
				var sector = sectorDict[i].sector;

				if (sector.door) {
					continue;
				}

				for (var j = 0; j < sector.collisionVertices.length - 1; j++) {
					drawSectorLine(sector, j, j + 1, wallColor, 1);
				}
				drawSectorLine(sector, j, 0, wallColor, 1);
			}

			for (var i in region.sectorIds) {
				var sector = sectorDict[i].sector;

				if (!sector.door || !sector.doorOpenedEver) {
					continue;
				}

				for (var j = 0; j < sector.collisionVertices.length - 1; j++) {
					drawSectorLine(sector, j, j + 1, doorColor, 3);
				}
				drawSectorLine(sector, j, 0, doorColor, 3);
			}
		}
	}(),
};;GS.UIComponents.Crosshair = function(vectorCanvas, assets, player) {
	this.cvs = vectorCanvas;
	this.assets = assets;
	this.player = player;

	this.size = 10;
	this.lineWidth = 3;
	this.pos = new THREE.Vector2(0.5, 0.5);
	this.hOffset = new THREE.Vector2(-this.size, 0);
	this.hLineOffset = new THREE.Vector2(this.size * 2, 0);
	this.vOffset = new THREE.Vector2(0, -this.size);
	this.vLineOffset = new THREE.Vector2(0, this.size * 2);

	this.visible = true;
};

GS.UIComponents.Crosshair.prototype = {
	constructor: GS.UIComponents.Crosshair,

	init: function() {
	},

	update: function() {
	},

	draw: function() {
		this.cvs.line(this.hOffset, this.pos, this.hLineOffset, true, GS.UIColors.foreground, this.lineWidth);
		this.cvs.line(this.vOffset, this.pos, this.vLineOffset, true, GS.UIColors.foreground, this.lineWidth);
	},
};;GS.UIComponents.Menu = function(vectorCanvas, assets) {
	this.cvs = vectorCanvas;
	this.assets = assets;

	this.fontSize = 60;
	this.boxCornerRadius = 10;

	this.background = {
		offset: new THREE.Vector2(0, 0),
		pos: new THREE.Vector2(0, 0),
		size: new THREE.Vector2(1, 1),
	};

	this.text = {
		offset: new THREE.Vector2(0, 0),
		pos: new THREE.Vector2(0.5, 0.5),
	};

	this.logo = {
		offset: new THREE.Vector2(-300, -384),
		pos: new THREE.Vector2(0.5, 0.5),
		size: new THREE.Vector2(600, 200),
		image: this.assets.images.logo,
	};

	this.children = [];
	this.activePanel = null;

	this.backgroundColor = GS.UIColors.menuBackground;
	this.ingame = false;

	this.visible = true;
};

GS.UIComponents.Menu.prototype = {
	constructor: GS.UIComponents.Menu,

	init: function() {
		this.initTopPanel();
		this.initOptionsPanel();
		this.initOnlinePanel();
		this.initGraphicsPanel();
		this.initSoundPanel();
		this.initGameplayPanel();
		this.initControlsPanel();
		this.initCreditsPanel();
		this.initCheatsPanel();
		this.initLevelSelectPanel();
		this.initFooter();
		this.initNewsBox();

		this.activePanel = this.topPanel;
	},

	initTopPanel: function() {
		var that = this;

		this.topPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 72, 80);

		this.btnNewGame = this.topPanel.addButton("new game");
		this.btnNewGame.onClick = function() { GAME.newGame(); };

		this.btnMPGame = this.topPanel.addButton("online game");
		this.btnMPGame.onClick = function() {
      that.layoutOnlinePanel();
      that.activePanel = that.onlinePanel;
      let getRoomsCb = (rooms) => {
        that.layoutOnlinePanel(rooms);
        that.activePanel = that.onlinePanel;
      };
      GAME.onlineManager.start(getRoomsCb)
    };

		this.btnSteamPage = this.topPanel.addButton("steam page");
		this.btnSteamPage.onClick = function() {
			var a = document.createElement("a");
			a.href = "https://goo.gl/akICRV";
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
		};

		this.btnLevelSelect = this.topPanel.addButton("level select");
		this.btnLevelSelect.onClick = function() { that.activePanel = that.levelSelectPanel; };


		this.btnOptions = this.topPanel.addButton("options");
		this.btnOptions.onClick = function() { that.activePanel = that.optionsPanel; };

		this.btnCredits = this.topPanel.addButton("credits");
		this.btnCredits.onClick = function() { that.activePanel = that.creditsPanel; };


		this.btnSubscribe = this.topPanel.addButton("subscribe");
		this.btnSubscribe.onClick = function() {
			var a = document.createElement("a");
			a.href = "http://eepurl.com/cEkb3T";
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
		};
	},

	initOptionsPanel: function() {
		var that = this;

		this.optionsPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 60, 65);

		this.btnGraphics = this.optionsPanel.addButton("graphics");
		this.btnGraphics.onClick = function() { that.activePanel = that.graphicsPanel; }

		this.btnSound = this.optionsPanel.addButton("sound");
		this.btnSound.onClick = function() { that.activePanel = that.soundPanel; }

		this.btnGameplay = this.optionsPanel.addButton("gameplay");
		this.btnGameplay.onClick = function() { that.activePanel = that.gameplayPanel; }

		this.btnControls = this.optionsPanel.addButton("controls");
		this.btnControls.onClick = function() { that.activePanel = that.controlsPanel; }

		this.btnCheats = this.optionsPanel.addButton("cheats");
		this.btnCheats.disabled = true;
		this.btnCheats.onClick = function() { that.activePanel = that.cheatsPanel; }

		this.optionsPanel.addEmptyRow();

		this.btnOptionsBack = this.optionsPanel.addButton("back");
		this.btnOptionsBack.onClick = function() { that.activePanel = that.topPanel; };
	},

	layoutOnlinePanel: function(rooms) {
		var that = this;

    let backOnClick = function() {
      that.activePanel = that.topPanel;
      GAME.onlineManager.stop();
    };
		this.onlinePanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 60, 65);
    if (rooms === undefined) {
        this.lblLoading = this.onlinePanel.addDoubleLabel("loading Rooms", "");
        this.btnonlineBack = this.onlinePanel.addButton("back");
        this.btnonlineBack.onClick = backOnClick;
    } else {
      let roomNames = rooms || [];
      if (roomNames.length) {
        this.lblRooms = this.onlinePanel.addDoubleLabel("Rooms", "");
        for (i in roomNames) {
          this['btnGraphics' + i] = this.onlinePanel.addDoubleLabel(roomNames[i], "");
        }
      } else {
        this.lblRooms = this.onlinePanel.addDoubleLabel("No Rooms Found", "");
      }

      this.onlinePanel.addEmptyRow();

      this.btnOnlineRoomName = this.onlinePanel.addTextField("Name", "enter", [""]);

      this.btnOnlineStart = this.onlinePanel.addButton("join");
      this.btnOnlineStart.onClick = () => {
        GAME.onlineManager.joinRoom(that.btnOnlineRoomName.button.text);
        // TODO open level after prompted from server
        // GAME.loadOnlineLevel("airstrip1online")
      };

      this.btnonlineBack = this.onlinePanel.addButton("back");
      this.btnonlineBack.onClick = backOnClick;

      GS.KeybindSettings.textinput.onModifyingTextStart = (e) => {
        let button = this.btnOnlineRoomName.button;
        let joinButton = this.btnOnlineStart;
        button.disabled = false;
        joinButton.disabled = true;
        button.text = "";
        button.states = [""];
        button.currentStateIndex = 0;
      };

      GS.KeybindSettings.textinput.onModifyingTextStop = function(e) {
        let button = that.btnOnlineRoomName.button;
        let joinButton = that.btnOnlineStart;
        button.disabled = false;
        joinButton.disabled = false;
        buttonText = button.text || "";
        button.states = [buttonText];
        button.currentStateIndex = 0;

        GS.Settings.roomName = buttonText;

        if (e.success) {
          button.disabled = false;
          joinButton.disabled = false;

          GS.Settings.saveSettings();
        }
      };
    }
	},

	initOnlinePanel: function() {
    this.layoutOnlinePanel();
	},

	initGraphicsPanel: function() {
		var that = this;

		this.graphicsPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),

			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 40, 43);

		this.btnToggleHalfSize = this.graphicsPanel.addToggleButton("half-size rendering");
		this.btnToggleHalfSize.button.currentStateIndex = (GS.Settings.halfSize === true) ? 0 : 1;
		this.btnToggleHalfSize.button.onClick = function(e) { GS.Settings.halfSize = (e.state === "on"); };

		this.graphicsPanel.addEmptyRow();

		this.btnToggleSSAO = this.graphicsPanel.addToggleButton("SSAO");
		this.btnToggleSSAO.button.currentStateIndex = (GS.Settings.ssao === true) ? 0 : 1;
		this.btnToggleSSAO.button.onClick = function(e) { GS.Settings.ssao = (e.state === "on"); };

		this.btnToggleBloom = this.graphicsPanel.addToggleButton("bloom");
		this.btnToggleBloom.button.currentStateIndex = (GS.Settings.bloom === true) ? 0 : 1;
		this.btnToggleBloom.button.onClick = function(e) { GS.Settings.bloom = (e.state === "on"); };

		this.btnToggleNoise = this.graphicsPanel.addToggleButton("noise filter");
		this.btnToggleNoise.button.currentStateIndex = (GS.Settings.noise === true) ? 0 : 1;
		this.btnToggleNoise.button.onClick = function(e) { GS.Settings.noise = (e.state === "on"); };

		this.btnToggleVignette = this.graphicsPanel.addToggleButton("vignette");
		this.btnToggleVignette.button.currentStateIndex = (GS.Settings.vignette === true) ? 0 : 1;
		this.btnToggleVignette.button.onClick = function(e) { GS.Settings.vignette = (e.state === "on"); };

		this.btnToggleFXAA = this.graphicsPanel.addToggleButton("FXAA");
		this.btnToggleFXAA.button.currentStateIndex = (GS.Settings.fxaa === true) ? 0 : 1;
		this.btnToggleFXAA.button.onClick = function(e) { GS.Settings.fxaa = (e.state === "on"); };

		this.graphicsPanel.addEmptyRow();

		this.numberPickerFOV = this.graphicsPanel.addNumberPicker("field of view", GS.Settings.fov, GS.Settings.fovMin, GS.Settings.fovMax, 5);
		this.numberPickerFOV.numberPicker.onChange = function(e) { GS.Settings.fov = e.value; };

		this.btnToggleShowFPS = this.graphicsPanel.addToggleButton("show FPS");
		this.btnToggleShowFPS.button.currentStateIndex = (GS.Settings.showFPS === true) ? 0 : 1;
		this.btnToggleShowFPS.button.onClick = function(e) { GS.Settings.showFPS = (e.state === "on"); };

		this.graphicsPanel.addEmptyRow();

		this.btnGraphicsBack = this.graphicsPanel.addButton("back");
		this.btnGraphicsBack.onClick = function() { that.activePanel = that.optionsPanel; };
	},

	initSoundPanel: function() {
		var that = this;

		this.soundPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 40, 43);

		this.numberPickerSound = this.soundPanel.addNumberPicker("sound volume", GS.Settings.sound, GS.Settings.soundMin, GS.Settings.soundMax, 1);
		this.numberPickerSound.numberPicker.onChange = function(e) { GS.Settings.sound = e.value; };

		this.numberPickerMusic = this.soundPanel.addNumberPicker("music volume", GS.Settings.music, GS.Settings.musicMin, GS.Settings.musicMax, 1);
		this.numberPickerMusic.numberPicker.onChange = function(e) { GS.Settings.music = e.value; };

		this.soundPanel.addEmptyRow();

		this.btnSoundBack = this.soundPanel.addButton("back");
		this.btnSoundBack.onClick = function() { that.activePanel = that.optionsPanel; };
	},

	initGameplayPanel: function() {
		var that = this;

		this.gameplayPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 40, 43);

		this.btnToggleViewBob = this.gameplayPanel.addToggleButton("view bobbing");
		this.btnToggleViewBob.button.currentStateIndex = (GS.Settings.viewBob === true) ? 0 : 1;
		this.btnToggleViewBob.button.onClick = function(e) { GS.Settings.viewBob = (e.state === "on"); };

		this.btnToggleWeaponBob = this.gameplayPanel.addToggleButton("weapon bobbing");
		this.btnToggleWeaponBob.button.currentStateIndex = (GS.Settings.weaponBob === true) ? 0 : 1;
		this.btnToggleWeaponBob.button.onClick = function(e) { GS.Settings.weaponBob = (e.state === "on"); };

		this.gameplayPanel.addEmptyRow();

		this.btnToggleShowHUD = this.gameplayPanel.addToggleButton("show HUD");
		this.btnToggleShowHUD.button.currentStateIndex = (GS.Settings.showHUD === true) ? 0 : 1;
		this.btnToggleShowHUD.button.onClick = function(e) { GS.Settings.showHUD = (e.state === "on"); };

		this.btnToggleShowWeapon = this.gameplayPanel.addToggleButton("show weapon");
		this.btnToggleShowWeapon.button.currentStateIndex = (GS.Settings.showWeapon === true) ? 0 : 1;
		this.btnToggleShowWeapon.button.onClick = function(e) { GS.Settings.showWeapon = (e.state === "on"); };

		this.gameplayPanel.addEmptyRow();

		this.btnGameplayBack = this.gameplayPanel.addButton("back");
		this.btnGameplayBack.onClick = function() { that.activePanel = that.optionsPanel; };
	},

	initCheatsPanel: function() {
		var that = this;

		this.cheatsPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 40, 43);

		this.btnToggleGod = this.cheatsPanel.addToggleButton("god mode");
		this.btnToggleGod.button.currentStateIndex = 1;
		this.btnToggleGod.button.onClick = function(e) {
			GAME.grid.player.god();
			GS.DebugUI.addTempLine("god mode " + e.state);
		};

		this.btnToggleFly = this.cheatsPanel.addToggleButton("fly mode");
		this.btnToggleFly.button.currentStateIndex = 1;
		this.btnToggleFly.button.onClick = function(e) {
			GAME.grid.player.fly();
			GS.DebugUI.addTempLine("fly mode " + e.state);
		};

		this.btnToggleNoclip = this.cheatsPanel.addToggleButton("noclip mode");
		this.btnToggleNoclip.button.currentStateIndex = 1;
		this.btnToggleNoclip.button.onClick = function(e) {
			GAME.grid.player.noClip();
			GS.DebugUI.addTempLine("noclip mode " + e.state);
		};

		this.cheatsPanel.addEmptyRow();

		this.btnCheatsGiveAll = this.cheatsPanel.addButton("give ammo and all weapons");
		this.btnCheatsGiveAll.onClick = function() {
			GAME.grid.player.giveAll();
			GS.DebugUI.addTempLine("all weapons and max ammo given");
		};

		this.cheatsPanel.addEmptyRow();

		this.btnCheatsBack = this.cheatsPanel.addButton("back");
		this.btnCheatsBack.onClick = function() { that.activePanel = that.optionsPanel; };
	},

	initLevelSelectPanel: function() {
		var that = this;

		this.levelSelectPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 60, 140);

		this.btnLevel1 = this.levelSelectPanel.addImageButton("airstrip one", this.assets.images.thumb_airstrip1);
		this.btnLevel1.onClick = function() { GAME.loadLevel("airstrip1"); }
		this.btnLevel1 = this.levelSelectPanel.addImageButton("drencrom", this.assets.images.thumb_drencrom);
		this.btnLevel1.onClick = function() { GAME.loadLevel("drencrom"); }
		this.btnLevel2 = this.levelSelectPanel.addImageButton("sacrosanct", this.assets.images.thumb_sacrosanct);
		this.btnLevel2.onClick = function() { GAME.loadLevel("sacrosanct"); }

		this.levelSelectPanel.fontSize = 40;
		this.levelSelectPanel.rowHeight = 43;

		this.levelSelectPanel.addEmptyRow();

		this.btnLevelSelectBack = this.levelSelectPanel.addButton("back");
		this.btnLevelSelectBack.onClick = function() { that.activePanel = that.topPanel; };
	},

	initControlsPanel: function() {
		var that = this;

		this.controlsPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 28, 31);

		this.btnToggleMouseInvertY = this.controlsPanel.addToggleButton("invert mouse y axis");
		this.btnToggleMouseInvertY.button.currentStateIndex = (GS.Settings.mouseInvertY === true) ? 0 : 1;
		this.btnToggleMouseInvertY.button.onClick = function(e) { GS.Settings.mouseInvertY = (e.state === "on"); };

		this.numberPickerMouse = this.controlsPanel.addNumberPicker("mouse sensitivity",
			GS.Settings.mouse, GS.Settings.mouseMin, GS.Settings.mouseMax, 1);
		this.numberPickerMouse.numberPicker.onChange = function(e) { GS.Settings.mouse = e.value; };

		this.controlsPanel.addEmptyRow();

		this.btnToggleMoveForward = this.controlsPanel.addToggleButton("move forward", ["W"]);
		this.btnToggleMoveBackward = this.controlsPanel.addToggleButton("move backward", ["S"]);
		this.btnToggleStrafeLeft = this.controlsPanel.addToggleButton("strafe left", ["A"]);
		this.btnToggleStrafeRight = this.controlsPanel.addToggleButton("strafe right", ["D"]);
		this.btnToggleUse = this.controlsPanel.addToggleButton("use", ["E"]);
		this.btnToggleShoot = this.controlsPanel.addToggleButton("shoot", ["mouse left"]);
		this.btnTogglePistol = this.controlsPanel.addToggleButton("pistol", ["2"]);
		this.btnToggleShotgun = this.controlsPanel.addToggleButton("shotgun", ["3"]);
		this.btnToggleHyperBlaster = this.controlsPanel.addToggleButton("hyperblaster", ["4"]);

		this.btnToggleAutomap = this.controlsPanel.addToggleButton("automap", ["TAB"]);
		this.btnToggleAutomap.button.disabled = true;
		this.btnToggleMenu = this.controlsPanel.addToggleButton("menu", ["ESC"]);
		this.btnToggleMenu.button.disabled = true;

		this.controlsPanel.addEmptyRow();

		this.btnControlsBack = this.controlsPanel.addButton("back");
		this.btnControlsBack.onClick = function() { that.activePanel = that.optionsPanel; };

		this.attachReboundEventHandlers();
	},

	attachReboundEventHandlers: function() {
		var keyButtonMap = {
			moveForward: 	this.btnToggleMoveForward,
			moveBackward: 	this.btnToggleMoveBackward,
			strafeLeft: 	this.btnToggleStrafeLeft,
			strafeRight: 	this.btnToggleStrafeRight,
			use: 			this.btnToggleUse,
			shoot: 			this.btnToggleShoot,
			pistol: 		this.btnTogglePistol,
			shotgun: 		this.btnToggleShotgun,
			hyperblaster: 	this.btnToggleHyperBlaster
		};

		for (var i in keyButtonMap) {
			var button = keyButtonMap[i].button;
			button.onClick = getOnClickEventHandler(i);
			button.states = [GS.Keybinds[i].controlName];
			button.currentStateIndex = 0;
		}

		function getOnClickEventHandler(actionName) {
			return function() {
				GS.KeybindSettings.rebound.modifyKeybind(GS.Keybinds[actionName]);
			}
		}

		GS.KeybindSettings.rebound.onModifyingKeybindStart = function(e) {
			var button = keyButtonMap[e.keybind.actionName].button;
			button.states = ["press new key"];
			button.currentStateIndex = 0;
		};

		GS.KeybindSettings.rebound.onModifyingKeybindStop = function(e) {
			for (var i in keyButtonMap) {
				var button = keyButtonMap[i].button;
				button.states = [GS.Keybinds[i].controlName];
				button.currentStateIndex = 0;
			}

			if (e.success) {
				var button2 = keyButtonMap[e.keybind.actionName].button;
				var onClickEventHandler = button2.onClick;
				button2.onClick = function() {};

				setTimeout(function() {
					button2.onClick = onClickEventHandler;
				}, 100);

				GS.Settings.saveSettings();

				var notifications = GAME.uiManager.notifications;
				if (notifications) {
					notifications.useText = "[" + GS.Keybinds.use.controlName + "] to use";
					notifications.calculateSizes();
				}
			}
		};
	},

	initCreditsPanel: function() {
		var that = this;

		this.creditsPanel = new GS.UIComponents.MenuPanel(this.cvs, new THREE.Vector2(-400, -160),
			new THREE.Vector2(0.5, 0.5), new THREE.Vector2(800, 520), 30, 33);

		this.dblLabelCredits1 = this.creditsPanel.addDoubleLabel("code, \"art\"", "sergiu valentin bucur");

		this.creditsPanel.addEmptyRow();

		this.dblLabelCredits23 = this.creditsPanel.addDoubleLabel("music", "DST");
		this.dblLabelCredits24 = this.creditsPanel.addDoubleLabel("", "3uhox");

		this.creditsPanel.addEmptyRow();

		this.dblLabelCredits3 = this.creditsPanel.addDoubleLabel("sound effects", "freesound.org");
		this.dblLabelCredits4 = this.creditsPanel.addDoubleLabel("", "opengameart.org");

		this.creditsPanel.addEmptyRow();

		this.dblLabelCredits5 = this.creditsPanel.addDoubleLabel("skybox texture", "alexcpeterson.com/spacescape");

		this.creditsPanel.addEmptyRow();

		this.dblLabelCredits6 = this.creditsPanel.addDoubleLabel("frameworks", "three.js");
		this.dblLabelCredits7 = this.creditsPanel.addDoubleLabel("", "tween.js");
		this.dblLabelCredits8 = this.creditsPanel.addDoubleLabel("", "jszip");

		this.creditsPanel.addEmptyRow();

		this.btnCreditsBack = this.creditsPanel.addButton("back");
		this.btnCreditsBack.onClick = function() { that.activePanel = that.topPanel; };
	},

	initFooter: function() {
		this.label1 = new GS.UIComponents.MenuLabel(this.cvs, GS.GameVersion,
			new THREE.Vector2(-20, -70), new THREE.Vector2(1, 1));
		this.label1.textAlign = "right";
		this.label1.fontSize = 30;
		this.children.push(this.label1);

		this.label2 = new GS.UIComponents.MenuLabel(this.cvs, GS.ReleaseDate,
			new THREE.Vector2(-20, -35), new THREE.Vector2(1, 1));
		this.label2.textAlign = "right";
		this.label2.fontSize = 30;
		this.children.push(this.label2);
	},

	initNewsBox: function() {
		this.newsBox = $(".news-box");
		this.newsBox.show();
	},

	switchToIngame: function() {
		this.ingame = true;
		this.btnCheats.disabled = false;
		this.btnToggleGod.button.currentStateIndex = 1;
		this.btnToggleFly.button.currentStateIndex = 1;
		this.btnToggleNoclip.button.currentStateIndex = 1;
	},

	update: function() {
		this.activePanel.update();

		for (var i = 0; i < this.children.length; i++) {
			this.children[i].update();
		}
	},

	draw: function() {
		if (this.ingame) {
			this.cvs.boxFill(this.background.offset, this.background.pos, this.background.size, false, this.backgroundColor);
		}

		this.cvs.drawImage(this.logo.offset, this.logo.pos, this.logo.image, this.logo.size, true);

		this.activePanel.draw();
		for (var i = 0; i < this.children.length; i++) {
			this.children[i].draw();
		}
	},

	removeNewsBox: function() {
		this.newsBox.remove();
		this.newsBox = undefined;
	}
};
;GS.UIComponents.MenuButton = function(vectorCanvas, text, offset, pos, size, onClick, states) {
	this.cvs = vectorCanvas;

	this.fontSize = 40;
	this.text = text;
	this.textBaseline = "middle";
	this.textAlign = "center";

	this.offset = offset;
	this.pos = pos;
	this.size = size;
	this.borderRadius = 10;

	this.onClick = onClick || function() {};
	this.states = states;
	this._currentStateIndex = 0;

	this.min = new THREE.Vector2();
	this.max = new THREE.Vector2();

	this.textOffset = this.offset.clone().add(this.size.clone().multiplyScalar(0.5));
	this.hover = false;
	this.active = false;
	this.disabled = false;

	this.backgroundColor = GS.UIColors.buttonHover;
	this.foregroundColor = GS.UIColors.foregroundDisabled;
};

GS.UIComponents.MenuButton.prototype = {
	constructor: GS.UIComponents.MenuButton,

	init: function() {
	},

	update: function() {
		var mx = GS.InputHelper.mouseX;
		var my = GS.InputHelper.mouseY;

		this.cvs.convertToScreenCoords(this.pos, this.min, this.offset);
		this.max.copy(this.min).add(this.size);

		if (!this.disabled) {
			this.foregroundColor = GS.UIColors.foreground;

			if (mx >= this.min.x && my >= this.min.y && mx < this.max.x && my < this.max.y) {
				this.hover = true;
				this.backgroundColor = GS.UIColors.buttonHover;
			} else {
				this.hover = false;
			}

			if (this.hover) {
				if (GS.InputHelper.leftMouseDown) {
					this.active = true;
					this.backgroundColor = GS.UIColors.buttonActive;
				} else {
					if (this.active) {
						if (this.states !== undefined) {
							this._currentStateIndex++;
							if (this._currentStateIndex >= this.states.length) {
								this._currentStateIndex = 0;
							}

							this.text = this.states[this._currentStateIndex];
							this.onClick({ state: this.text, stateIndex: this._currentStateIndex });
						} else {
							this.onClick();
						}

						this.active = false;
						this.backgroundColor = GS.UIColors.buttonHover;
					}
				}
			}
		} else {
			this.foregroundColor = GS.UIColors.foregroundDisabled;
		}
	},

	draw: function() {
		if (!this.disabled && this.hover) {
			this.cvs.roundedBoxFill(this.offset, this.pos, this.size, true, this.borderRadius, this.backgroundColor);
		}

		this.cvs.text(this.textOffset, this.pos, this.text, this.foregroundColor, this.fontSize, this.textBaseline, this.textAlign, GS.UIFont);
	},

	set currentStateIndex(value) {
		if (this.states !== undefined) {
			if (value >= 0 && value < this.states.length) {
				this._currentStateIndex = value;
				this.text = this.states[this._currentStateIndex];
			}
		}
	},

	get currentStateIndex() {
		return this._currentStateIndex;
	},
};
;GS.UIComponents.MenuImageButton = function(vectorCanvas, offset, pos, size, fontSize, text, image, onClick) {
	this.cvs = vectorCanvas;

	this.fontSize = fontSize || 40;

	this.offset = offset;
	this.pos = pos;
	this.size = size;
	this.text = text;
	this.image = image;
	this.onClick = onClick || function() {};

	this.init();
};

GS.UIComponents.MenuImageButton.prototype = {
	constructor: GS.UIComponents.MenuImageButton,

	init: function() {
		var that = this;

		var buttonOffset = this.offset.clone();
		var buttonSize = new THREE.Vector2(this.size.x, this.size.y);

		var button = new GS.UIComponents.MenuButton(this.cvs, this.text, buttonOffset, this.pos, buttonSize, function() {
			that.onClick();
		});
		button.textOffset.x -= this.size.x * 0.1;
		button.textAlign = "left";
		button.fontSize = this.fontSize;

		this.button = button;

		this.imageSize = new THREE.Vector2(231, 130);
		this.imageOffset = this.offset.clone();
		this.imageOffset.x += this.size.x * 0.2 - this.imageSize.x / 2;
		this.imageOffset.y += this.size.y * 0.5 - this.imageSize.y / 2;
	},

	update: function() {
		this.button.update();
	},

	draw: function() {
		this.button.draw();
		this.cvs.drawImage(this.imageOffset, this.pos, this.image, this.imageSize, true);
	},
};;GS.UIComponents.MenuLabel = function(vectorCanvas, text, offset, pos) {
	this.cvs = vectorCanvas;

	this.fontSize = 40;
	this.text = text;
	this.textBaseline = "middle";
	this.textAlign = "center";

	this.offset = offset;
	this.pos = pos;

	this.foregroundColor = GS.UIColors.foreground;
};

GS.UIComponents.MenuLabel.prototype = {
	constructor: GS.UIComponents.MenuLabel,

	init: function() {
	},

	update: function() {
	},

	draw: function() {
		this.cvs.text(this.offset, this.pos, this.text, this.foregroundColor, this.fontSize, this.textBaseline, this.textAlign, GS.UIFont);
	},
};;GS.UIComponents.MenuNumberPicker = function(vectorCanvas, offset, pos, size, fontSize, value, min, max, step, onChange) {
	this.cvs = vectorCanvas;

	this.fontSize = fontSize || 40;

	this.offset = offset;
	this.pos = pos;
	this.size = size;

	this.value = (value !== undefined) ? value : 5;
	this.min = (min !== undefined) ? min : 1;
	this.max = (max !== undefined) ? max : 10;
	this.step = (step !== undefined) ? step : 1;

	this.onChange = onChange || function() {};

	this.init();
};

GS.UIComponents.MenuNumberPicker.prototype = {
	constructor: GS.UIComponents.MenuNumberPicker,

	init: function() {
		var that = this;
		var size = new THREE.Vector2(this.size.x * 0.2, this.size.y);

		var leftOffset = this.offset.clone();
		this.leftButton = new GS.UIComponents.MenuButton(this.cvs, "<", leftOffset, this.pos, size);
		this.leftButton.fontSize = this.fontSize;
		this.leftButton.onClick = function() {
			that.value -= that.step;
			that.value = Math.max(that.min, that.value);
			that.label.text = that.value;
			that.onChange({ value: that.value });
		};

		var rightOffset = this.offset.clone();
		rightOffset.x += this.size.x * 0.8;
		this.rightButton = new GS.UIComponents.MenuButton(this.cvs, ">", rightOffset, this.pos, size);
		this.rightButton.fontSize = this.fontSize;
		this.rightButton.onClick = function() {
			that.value += that.step;
			that.value = Math.min(that.max, that.value);
			that.label.text = that.value;
			that.onChange({ value: that.value });
		};

		var labelOffset = this.offset.clone();
		labelOffset.x += this.size.x * 0.5;
		labelOffset.y += this.size.y * 0.5;
		this.label = new GS.UIComponents.MenuLabel(this.cvs, this.value, labelOffset, this.pos);
		this.label.fontSize = this.fontSize;
	},

	update: function() {
		this.leftButton.update();
		this.rightButton.update();
	},

	draw: function() {
		this.leftButton.draw();
		this.rightButton.draw();
		this.label.draw();
	},
};;GS.UIComponents.MenuPanel = function(vectorCanvas, offset, pos, size, fontSize, rowHeight) {
	this.cvs = vectorCanvas;

	this.children = [];
	this.fontSize = fontSize || 40;

	this.offset = offset;
	this.pos = pos;
	this.size = size;
	this.rowHeight = rowHeight || 40;
	this.rowOffset = 0;
};

GS.UIComponents.MenuPanel.prototype = {
	constructor: GS.UIComponents.MenuPanel,

	init: function() {
	},

	addButton: function(text, onClick) {
		var offset = this.getRowOffset();
		var size = new THREE.Vector2(this.size.x, this.rowHeight);

		var button = new GS.UIComponents.MenuButton(this.cvs, text, offset, this.pos, size, onClick);
		button.fontSize = this.fontSize;

		this.children.push(button);

		this.rowOffset += this.rowHeight;

		return button;
	},

	addTextField: function(label, text, states, buttonSize) {
		buttonSize = buttonSize || 0.2;

		var offset = this.getRowOffset();
		var labelOffset = offset.clone();
		labelOffset.x += this.size.x * 0.5 - 10;
		labelOffset.y += this.rowHeight * 0.5;

		var label = new GS.UIComponents.MenuLabel(this.cvs, label, labelOffset, this.pos);
		label.fontSize = this.fontSize;
		label.textAlign = "right";

		this.children.push(label);

		var buttonOffset = offset.clone();
		var buttonSize = new THREE.Vector2(this.size.x * buttonSize, this.rowHeight);
		buttonOffset.x += this.size.x * 0.5 + 10;

		states = states || ["on", "off"];
		var button = new GS.UIComponents.MenuButton(this.cvs, ['enter'], buttonOffset, this.pos, buttonSize, () => {}, states);
    button.onClick = () => {
        GS.KeybindSettings.textinput.modifyText(button);
    };
		button.fontSize = this.fontSize;

		this.children.push(button);

		this.rowOffset += this.rowHeight;

		return {
			label: label,
			button: button,
		};
	},
	addToggleButton: function(text, states, buttonSize, onClick) {
		buttonSize = buttonSize || 0.2;

		var offset = this.getRowOffset();
		var labelOffset = offset.clone();
		labelOffset.x += this.size.x * 0.5 - 10;
		labelOffset.y += this.rowHeight * 0.5;

		var label = new GS.UIComponents.MenuLabel(this.cvs, text, labelOffset, this.pos);
		label.fontSize = this.fontSize;
		label.textAlign = "right";

		this.children.push(label);

		var buttonOffset = offset.clone();
		var buttonSize = new THREE.Vector2(this.size.x * buttonSize, this.rowHeight);
		buttonOffset.x += this.size.x * 0.5 + 10;

		states = states || ["on", "off"];
		var button = new GS.UIComponents.MenuButton(this.cvs, states[0], buttonOffset, this.pos, buttonSize, onClick, states);
		button.fontSize = this.fontSize;

		this.children.push(button);

		this.rowOffset += this.rowHeight;

		return {
			label: label,
			button: button,
		};
	},

	addDoubleLabel: function(text1, text2) {
		var offset = this.getRowOffset();

		var label1Offset = offset.clone();
		label1Offset.x += this.size.x * 0.5 - 30;
		label1Offset.y += this.rowHeight * 0.5;

		var label1 = new GS.UIComponents.MenuLabel(this.cvs, text1, label1Offset, this.pos);
		label1.fontSize = this.fontSize;
		label1.textAlign = "right";

		this.children.push(label1);

		var label2Offset = offset.clone();
		label2Offset.x += this.size.x * 0.5 + 30;
		label2Offset.y += this.rowHeight * 0.5;

		var label2 = new GS.UIComponents.MenuLabel(this.cvs, text2, label2Offset, this.pos);
		label2.fontSize = this.fontSize;
		label2.textAlign = "left";

		this.children.push(label2);

		this.rowOffset += this.rowHeight;

		return {
			label1: label1,
			label2: label2,
		};
	},
	addNumberPicker: function(text, value, min, max, step, onChange) {
		var offset = this.getRowOffset();
		var labelOffset = offset.clone();
		labelOffset.x += this.size.x * 0.5 - 10;
		labelOffset.y += this.rowHeight * 0.5;

		var label = new GS.UIComponents.MenuLabel(this.cvs, text, labelOffset, this.pos);
		label.fontSize = this.fontSize;
		label.textAlign = "right";

		this.children.push(label);

		var numberPickerOffset = offset.clone();
		var numberPickerSize = new THREE.Vector2(this.size.x * 0.2, this.rowHeight);
		numberPickerOffset.x += this.size.x * 0.5 + 10;
		var numberPicker = new GS.UIComponents.MenuNumberPicker(this.cvs, numberPickerOffset, this.pos, numberPickerSize,
			this.fontSize, value, min, max, step, onChange);

		this.children.push(numberPicker);

		this.rowOffset += this.rowHeight;

		return {
			label: label,
			numberPicker: numberPicker,
		};
	},

	addImageButton: function(text, image, onClick) {
		var offset = this.getRowOffset();
		var imageButtonOffset = offset.clone();
		var imageButtonSize = new THREE.Vector2(this.size.x, this.rowHeight);
		var imageButton = new GS.UIComponents.MenuImageButton(this.cvs, imageButtonOffset, this.pos,
			imageButtonSize, this.fontSize, text, image, onClick);

		this.children.push(imageButton);
		this.rowOffset += this.rowHeight;

		return imageButton;
	},

	addEmptyRow: function() {
		this.rowOffset += this.rowHeight;
	},

	getRowOffset: function() {
		var offset = this.offset.clone();
		offset.y += this.rowOffset;

		if (Math.abs(offset.y - this.offset.y) > this.size.y) {
			GAME.handleFatalError("menu panel exceeds height");
			return;
		}

		return offset;
	},

	update: function() {
		for (var i = 0; i < this.children.length; i++) {
			this.children[i].update();
		}
	},

	draw: function() {
		// this.cvs.boxFill(this.offset, this.pos, this.size, true, "rgba(255, 0, 0, 1)");

		for (var i = 0; i < this.children.length; i++) {
			this.children[i].draw();
		}
	},

	add: function(menuComponent) {
		this.children.push(menuComponent);
	},
};
;GS.UIComponents.Notifications = function(vectorCanvas, assets, player) {
	this.cvs = vectorCanvas;
	this.assets = assets;
	this.player = player;

	this.fontSize = 40;
	this.boxCornerRadius = 10;

	this.useText = "[" + GS.Keybinds.use.controlName + "] to use";
	this.pointerLockText = "right-click to enable pointer lock";
	this.restartText = "[ENTER] to restart level";

	this.usePopup = {
		originalOffset: new THREE.Vector2(0, 100),
		offset: new THREE.Vector2(),
		pos: new THREE.Vector2(0.5, 0.5),
		size: new THREE.Vector2(0, 60),
		textOffset: new THREE.Vector2(0, 0),
	};

	this.pointerLockPopup = {
		originalOffset: new THREE.Vector2(0, 100),
		offset: new THREE.Vector2(),
		pos: new THREE.Vector2(0.5, 0.5),
		size: new THREE.Vector2(0, 60),
		textOffset: new THREE.Vector2(0, 0),
	};

	this.restartPopup = {
		originalOffset: new THREE.Vector2(0, 100),
		offset: new THREE.Vector2(),
		pos: new THREE.Vector2(0.5, 0.5),
		size: new THREE.Vector2(0, 60),
		textOffset: new THREE.Vector2(0, 0),
	};

	this.calculateSizes();

	this.visible = true;

	this.oldShowUsePopup = false;
	this.showUsePopup = false;

	this.oldShowPointerLockPopup = false;
	this.showPointerLockPopup = false;

	this.oldShowRestartPopup = false;
	this.showRestartPopup = false;
};

GS.UIComponents.Notifications.prototype = {
	constructor: GS.UIComponents.Notifications,

	init: function() {
	},

	update: function() {
		this.showUsePopup = this.player.canUse;
		if (this.showUsePopup != this.oldShowUsePopup) {
			this.needsRedraw = true;
			this.oldShowUsePopup = this.showUsePopup;
		}

		this.showPointerLockPopup = !this.player.controls.pointerLockEnabled;
		if (this.showPointerLockPopup != this.oldShowPointerLockPopup) {
			this.needsRedraw = true;
			this.oldShowPointerLockPopup = this.showPointerLockPopup;
		}

		this.showRestartPopup = this.player.dead;
		if (this.showRestartPopup != this.oldShowRestartPopup) {
			this.needsRedraw = true;
			this.oldShowRestartPopup = this.showRestartPopup;
		}
	},

	draw: function() {
		if (this.showRestartPopup) {
			this.drawPopup(this.restartText, this.restartPopup);
		} else
		if (this.showPointerLockPopup) {
			this.drawPopup(this.pointerLockText, this.pointerLockPopup);
		} else
		if (this.showUsePopup) {
			this.drawPopup(this.useText, this.usePopup);
		}
	},

	drawPopup: function(text, popup) {
		this.cvs.roundedBoxFill(popup.offset, popup.pos, popup.size, true,
			this.boxCornerRadius, GS.UIColors.background);
		this.cvs.text(popup.textOffset, popup.pos, text,
			GS.UIColors.foreground, this.fontSize, "middle", "center", GS.UIFont);
	},

	calculateSizes: function() {
		this.calculatePopupSize(this.useText, this.usePopup);
		this.calculatePopupSize(this.pointerLockText, this.pointerLockPopup);
		this.calculatePopupSize(this.restartText, this.restartPopup);
	},

	calculatePopupSize: function(text, popup, textWidth) {
		if (textWidth === undefined) {
			textWidth = this.cvs.getTextWidth(text, this.fontSize, GS.UIFont);
		}

		var padding = 15;
		var width = textWidth + padding * 2;

		popup.size.x = width;
		popup.offset.x = -width / 2;
		popup.offset.y = popup.originalOffset.y - popup.size.y;
		popup.textOffset.copy(popup.offset).add(popup.size.clone().multiplyScalar(0.5));
	},
};;GS.UIComponents.PowerBars = function(vectorCanvas, assets, player) {
	this.cvs = vectorCanvas;
	this.assets = assets;
	this.player = player;

	this.fontSize = 60;
	this.boxCornerRadius = 10;

	this.healthBar = {
		offset: new THREE.Vector2(20, -20),
		pos: new THREE.Vector2(0, 1),
		size: new THREE.Vector2(220, 90),
		textOffset: new THREE.Vector2(95, 4),
		imageOffset: new THREE.Vector2(20, 20),
		imageAtlasOffset: new THREE.Vector2(0, 0),
		imageAtlasSize: new THREE.Vector2(64, 64),
	};

	this.healthBar.offset.y -= this.healthBar.size.y;
	this.healthBar.imageOffset.add(this.healthBar.offset);
	this.healthBar.textOffset.add(this.healthBar.offset).add(this.healthBar.size.clone().multiplyScalar(0.5));	

	this.ammoBar = {
		offset: new THREE.Vector2(-20, -20),
		pos: new THREE.Vector2(1, 1),
		size: new THREE.Vector2(220, 90),
		textOffset: new THREE.Vector2(95, 4),
		imageOffset: new THREE.Vector2(20, 20),
		imageAtlasOffset: new THREE.Vector2(64, 0),
		imageAtlasSize: new THREE.Vector2(64, 64),
	};

	this.ammoBar.offset.sub(this.ammoBar.size);
	this.ammoBar.imageOffset.add(this.ammoBar.offset);
	this.ammoBar.textOffset.add(this.ammoBar.offset).add(this.ammoBar.size.clone().multiplyScalar(0.5));

	this.tex = this.assets.images.hud;

	this.visible = true;

	this.ammo = undefined;
	this.health = "";
	this.oldHealth = -1;
	this.oldAmmo = -1;
};

GS.UIComponents.PowerBars.prototype = {
	constructor: GS.UIComponents.PowerBars,

	init: function() {
	},

	update: function() {
		this.health = Math.floor(this.player.health);
		if (this.player.weapon !== undefined && !this.player.weapon.infiniteAmmo) {
			this.ammo = this.player.weapon.ammo;
		} else {
			this.ammo = undefined;
		}

		if (this.health != this.oldHealth || this.ammo != this.oldAmmo) {
			this.needsRedraw = true;
			this.oldHealth = this.health;
			this.oldAmmo = this.ammo;
		}
	},

	draw: function() {
		this.cvs.roundedBoxFill(this.healthBar.offset, this.healthBar.pos, this.healthBar.size, true, 
				this.boxCornerRadius, GS.UIColors.background);
		this.cvs.text(this.healthBar.textOffset, this.healthBar.pos, this.health, 
			GS.UIColors.foreground, this.fontSize, "middle", "right", GS.UIFont);

		this.cvs.drawImageFromAtlas(this.healthBar.imageOffset, this.healthBar.pos, this.tex,
			this.healthBar.imageAtlasOffset, this.healthBar.imageAtlasSize);

		if (this.ammo !== undefined) {
			this.cvs.roundedBoxFill(this.ammoBar.offset, this.ammoBar.pos, this.ammoBar.size, true, 
					this.boxCornerRadius, GS.UIColors.background);
			this.cvs.text(this.ammoBar.textOffset, this.ammoBar.pos, this.ammo, GS.UIColors.foreground, 
				this.fontSize, "middle", "right", GS.UIFont);
			this.cvs.drawImageFromAtlas(this.ammoBar.imageOffset, this.ammoBar.pos, this.tex,
				this.ammoBar.imageAtlasOffset, this.ammoBar.imageAtlasSize);
		}
	},
};;GS.UIComponents.WinScreen = function(vectorCanvas, assets, player) {
	this.cvs = vectorCanvas;
	this.assets = assets;
	this.player = player;

	this.fontSize = 40;
	this.rowHeight = 45;
	this.boxCornerRadius = 10;

	this.aiManager = player.grid.aiManager;

	this.mapName = "map name";
	this.hasNextMap = false;

	this.monstersKilled = 0;
	this.maxMonsters = 0;
	this.itemsPickedUp = 0;
	this.maxItems = 0;
	this.secretsFound = 0;
	this.maxSecrets = 0;
	this.minutes = "00";
	this.seconds = "00";

	this.popup = {
		offset: new THREE.Vector2(-480, -315),
		pos: new THREE.Vector2(0.5, 0.5),
		size: new THREE.Vector2(960, 630),
	};

	this.textOffsetLeft = new THREE.Vector2(-30, -247);
	this.textOffsetRight = new THREE.Vector2(30, -247);
	this.textOffsetCenter = new THREE.Vector2(0, -247);

	this.visible = false;
};

GS.UIComponents.WinScreen.prototype = {
	constructor: GS.UIComponents.WinScreen,

	init: function() {
	},

	update: function() {
		if (!this.visible && this.aiManager.script !== undefined && this.aiManager.script.mapWon) {
			this.collectData();
			this.visible = true;
		}
	},

	collectData: function() {
		var script = this.aiManager.script;

		this.mapName = script.mapName;
		this.hasNextMap = script.nextMap !== undefined;
		this.monstersKilled = this.aiManager.monstersKilled;
		this.maxMonsters = this.aiManager.maxMonsters;
		this.itemsPickedUp = this.aiManager.itemsPickedUp;
		this.maxItems = this.aiManager.maxItems;
		this.secretsFound = script.secretsFound;
		this.maxSecrets = script.maxSecrets;

		this.minutes = GS.pad(this.aiManager.minutes, 2);
		this.seconds = GS.pad(this.aiManager.seconds, 2);
	},

	draw: function() {
		this.cvs.roundedBoxFill(this.popup.offset, this.popup.pos, this.popup.size, true, 
			this.boxCornerRadius, GS.UIColors.menuBackground);

		this.drawMessage("\"" + this.mapName + "\" complete", 0);

		this.drawField("monsters killed", this.monstersKilled + " / " + this.maxMonsters, 2);
		this.drawField("items picked up", this.itemsPickedUp + " / " + this.maxItems, 3);
		this.drawField("secrets found", this.secretsFound + " / " + this.maxSecrets, 4);

		this.drawField("time spent", this.minutes + ":" + this.seconds, 6);

		if (this.hasNextMap) {
			this.drawMessage("[ENTER] to continue to the next level", 11);
		} else {
			this.drawMessage("congrats!", 10);
			this.drawMessage("this concludes the current release", 11);
		}
	},

	drawField: function() {
		var left = new THREE.Vector2();
		var right = new THREE.Vector2();

		return function(name, value, row) {
			left.copy(this.textOffsetLeft);
			left.y += row * this.rowHeight;
			right.copy(this.textOffsetRight);
			right.y += row * this.rowHeight;

			this.cvs.text(left, this.popup.pos, name, 
				GS.UIColors.foreground, this.fontSize, "middle", "right", GS.UIFont);
			this.cvs.text(right, this.popup.pos, value, 
				GS.UIColors.foreground, this.fontSize, "middle", "left", GS.UIFont);
		}
	}(),

	drawMessage: function() {
		var center = new THREE.Vector2();

		return function(message, row) {
			center.copy(this.textOffsetCenter);
			center.y += row * this.rowHeight;

			this.cvs.text(center, this.popup.pos, message, 
				GS.UIColors.foreground, this.fontSize, "middle", "center", GS.UIFont);
		}
	}(),
};;// Sliding Camera Collision Detection
// http://www.braynzarsoft.net/index.php?p=D3D11SlidingCamera

GS.CollisionHelper = {
	gravity: new THREE.Vector3(0, -1.5, 0),
	unitsPerMeter: 100,

	handleCollisionsSliding: function(oldPos, newPos, gravityFactor, ellipsoid, triangleIterator) {
		return this.handleCollisions(oldPos, newPos, gravityFactor, ellipsoid, triangleIterator, false, false);
	},

	handleCollisionsFirstHit: function(oldPos, newPos, gravityFactor, ellipsoid, triangleIterator) {
		return this.handleCollisions(oldPos, newPos, gravityFactor, ellipsoid, triangleIterator, true, false);
	},

	handleCollisions: function() {
		var p = {
			ellipsoidSpace: new THREE.Vector3(),
			worldPosition: new THREE.Vector3(),
			worldVelocity: new THREE.Vector3(),

			lspPosition: new THREE.Vector3(),
			lspVelocity: new THREE.Vector3(),
			lspNormalizedVelocity: new THREE.Vector3(),
			normal: new THREE.Vector3(),

			foundCollision: false,
			nearestDistance: 0,
			intersectionPoint: new THREE.Vector3(),
			collisionRecursionDepth: 0,
			stopOnFirstHit: false,

			gravityFactor: 0,
		};

		return function(oldPos, newPos, gravityFactor, ellipsoid, triangleIterator, stopOnFirstHit, horizontalOnly) {
			p.ellipsoidSpace.copy(ellipsoid);
			p.worldPosition.copy(oldPos);
			p.worldVelocity.subVectors(newPos, oldPos);

			p.foundCollision = false;
			p.nearestDistance = 0;
			p.collisionRecursionDepth = 0;
			p.stopOnFirstHit = stopOnFirstHit;
			p.gravityFactor = gravityFactor;

			var result = this.collisionSlide(p, triangleIterator);
			newPos.copy(result.pos);

			return result;
		}
	}(),

	collisionSlide: function(p, triangleIterator) {
		p.lspVelocity.copy(p.worldVelocity).divide(p.ellipsoidSpace);
		p.lspPosition.copy(p.worldPosition).divide(p.ellipsoidSpace);
		var oldY = p.lspPosition.y;

		p.collisionRecursionDepth = 0;
		var finalPosition = this.collideWithWorld(p, triangleIterator);
		var climbing = (oldY < finalPosition.y);

		if (p.gravityFactor !== 0 && !climbing && !p.horizontalOnly) {
			p.lspVelocity.copy(this.gravity);
			p.lspVelocity.y *= p.gravityFactor;
			p.lspVelocity.divide(p.ellipsoidSpace);
			p.lspPosition.copy(finalPosition);
			p.collisionRecursionDepth = 0;
			finalPosition = this.collideWithWorld(p, triangleIterator);
		}

		finalPosition.multiply(p.ellipsoidSpace);

		if (p.horizontalOnly) {
			finalPosition.y = p.originalHeight;
		}

		var result = { 
			pos: finalPosition,
			climbing: climbing,
			foundCollision: p.foundCollision,
			gridObject: p.gridObject,
			normal: p.normal,
		};

		return result;
	},

	collideWithWorld: function() {
		var normal = new THREE.Vector3();
		var aux = new THREE.Vector3();
		var result = new THREE.Vector3();
		var destinationPoint = new THREE.Vector3();
		var newPosition = new THREE.Vector3();
		var slidePlaneOrigin = new THREE.Vector3();
		var slidePlaneNormal = new THREE.Vector3();
		var newDestinationPoint = new THREE.Vector3();
		var newVelocityVector = new THREE.Vector3();
		var v0 = new THREE.Vector3();
		var v1 = new THREE.Vector3();
		var v2 = new THREE.Vector3();

		return function(p, triangleIterator) {
			var that = this;

			var unitScale = this.unitsPerMeter / 100;
			var veryCloseDistance = 0.005 * unitScale;

			if (p.collisionRecursionDepth > 5) {
				return p.lspPosition;
			}

			p.lspNormalizedVelocity.copy(p.lspVelocity).normalize();

			p.foundCollision = false;
			p.nearestDistance = 0;

			triangleIterator(function(gridObject, t0, t1, t2, triangleOffset) {
				GAME.grid.totalSphereTriangleChecks++;
				
				v0.copy(t0).divide(p.ellipsoidSpace);
				v1.copy(t1).divide(p.ellipsoidSpace);
				v2.copy(t2).divide(p.ellipsoidSpace);

				aux.subVectors(v2, v0);
				normal.copy(v1).sub(v0).cross(aux).normalize();

				that.sphereCollidingWithTriangle(gridObject, p, v0, v1, v2, normal);
			});

			if (!p.foundCollision) {
				result.copy(p.lspPosition).add(p.lspVelocity);
				return result;
			}

			destinationPoint.copy(p.lspPosition).add(p.lspVelocity);
			newPosition.copy(p.lspPosition);

			if (p.nearestDistance >= veryCloseDistance) {
				aux.copy(p.lspVelocity).normalize();
				aux.multiplyScalar(p.nearestDistance - veryCloseDistance);
				newPosition.copy(p.lspPosition).add(aux);

				aux.normalize().multiplyScalar(veryCloseDistance);
				p.intersectionPoint.sub(aux);
			}

			if (!p.stopOnFirstHit) {
				slidePlaneOrigin.copy(p.intersectionPoint);
				slidePlaneNormal.copy(newPosition).sub(p.intersectionPoint).normalize();

				var x = slidePlaneOrigin.x;
				var y = slidePlaneOrigin.y;
				var z = slidePlaneOrigin.z;

				var A = slidePlaneNormal.x;
				var B = slidePlaneNormal.y;
				var C = slidePlaneNormal.z;
				var D = -((A * x) + (B * y) + (C * z));

				var planeConstant = D;

				var signedDistFromDestPointToSlidingPlane = slidePlaneNormal.dot(destinationPoint) + planeConstant;

				aux.copy(slidePlaneNormal).multiplyScalar(signedDistFromDestPointToSlidingPlane);
				newDestinationPoint.copy(destinationPoint).sub(aux);
				newVelocityVector.copy(newDestinationPoint).sub(p.intersectionPoint);

				if (newVelocityVector.length() < veryCloseDistance) {
					return newPosition;
				}

				p.collisionRecursionDepth++;
				p.lspPosition.copy(newPosition);
				p.lspVelocity.copy(newVelocityVector);

				return this.collideWithWorld(p, triangleIterator);
			} else {
				p.lspPosition.copy(newPosition);
				return p.lspPosition;
			}
		}
	}(),

	sphereCollidingWithTriangle: function() {
		var velocity = new THREE.Vector3();
		var position = new THREE.Vector3();
		var aux = new THREE.Vector3();
		var planeIntersectionPoint = new THREE.Vector3();
		var collisionPoint = new THREE.Vector3();
		var edge = new THREE.Vector3();
		var spherePositionToVertex = new THREE.Vector3();

		return function(gridObject, p, v0, v1, v2, normal) {
			var facing = normal.dot(p.lspNormalizedVelocity);			
			if (facing <= 0) {
				velocity.copy(p.lspVelocity);
				position.copy(p.lspPosition);

				var t0, t1;
				var sphereInPlane = false;

				var A = normal.x;
				var B = normal.y;
				var C = normal.z;
				var D = -((A * v0.x) + (B * v0.y) + (C * v0.z));

				var planeConstant = D;

				var signedDistFromPositionToTriPlane = position.dot(normal) + planeConstant;
				var planeNormalDotVelocity = normal.dot(velocity);

				if (planeNormalDotVelocity === 0) {
					if (Math.abs(signedDistFromPositionToTriPlane) >= 1) {
						return false;
					} else {
						sphereInPlane = true;
					}
				} else {
					t0 = (1 - signedDistFromPositionToTriPlane) / planeNormalDotVelocity;
					t1 = (-1 - signedDistFromPositionToTriPlane) / planeNormalDotVelocity;

					if (t0 > t1) {
						var temp = t0;
						t0 = t1;
						t1 = temp;
					}

					if (t0 > 1 || t1 < 0) {
						return false;
					}

					if (t0 < 0) {
						t0 = 0;
					}
					if (t1 > 1) {
						t1 = 1;
					}
				}

				var collidingWithTri = false;
				var t = 1;

				if (!sphereInPlane) {
					aux.copy(velocity).multiplyScalar(t0);
					planeIntersectionPoint.copy(position).add(aux).sub(normal);

					if (this.checkPointInTriangle(planeIntersectionPoint, v0, v1, v2)) {
						collidingWithTri = true;
						t = t0;
						collisionPoint.copy(planeIntersectionPoint);
					}
				}

				if (!collidingWithTri) {
					var a, b, c;
					var velocityLengthSquared = velocity.lengthSq();
					a = velocityLengthSquared;
					var result = {};

					aux.copy(position).sub(v0);
					b = 2 * velocity.dot(aux);
					aux.copy(v0).sub(position);
					c = aux.length();
					c = c * c - 1;
					if (this.getLowestRoot(a, b, c, t, result)) {
						t = result.root;
						collidingWithTri = true;
						collisionPoint.copy(v0);
					}

					aux.copy(position).sub(v1);
					b = 2 * velocity.dot(aux);
					aux.copy(v1).sub(position);
					c = aux.length();
					c = c * c - 1;
					if (this.getLowestRoot(a, b, c, t, result)) {
						t = result.root;
						collidingWithTri = true;
						collisionPoint.copy(v1);
					}

					aux.copy(position).sub(v2);
					b = 2 * velocity.dot(aux);
					aux.copy(v2).sub(position);
					c = aux.length();
					c = c * c - 1;
					if (this.getLowestRoot(a, b, c, t, result)) {
						t = result.root;
						collidingWithTri = true;
						collisionPoint.copy(v2);
					}

					edge.copy(v1).sub(v0);
					spherePositionToVertex.copy(v0).sub(position);
					var edgeLengthSquared = edge.lengthSq();
					var edgeDotVelocity = edge.dot(velocity);
					var edgeDotSpherePositionToVertex = edge.dot(spherePositionToVertex);
					var spherePositionToVertexLengthSquared = spherePositionToVertex.lengthSq();

					a = edgeLengthSquared * -velocityLengthSquared + (edgeDotVelocity * edgeDotVelocity);
					b = edgeLengthSquared * 2 * velocity.dot(spherePositionToVertex) - 2 * edgeDotVelocity * edgeDotSpherePositionToVertex;
					c = edgeLengthSquared * (1 - spherePositionToVertexLengthSquared) + 
						(edgeDotSpherePositionToVertex * edgeDotSpherePositionToVertex);

					if (this.getLowestRoot(a, b, c, t, result)) {
						var f = (edgeDotVelocity * result.root - edgeDotSpherePositionToVertex) / edgeLengthSquared;
						if (f >= 0 && f <= 1) {
							t = result.root;
							collidingWithTri = true;
							edge.multiplyScalar(f);
							collisionPoint.copy(v0).add(edge);
						}
					}

					edge.copy(v2).sub(v1);
					spherePositionToVertex.copy(v1).sub(position);
					edgeLengthSquared = edge.lengthSq();
					edgeDotVelocity = edge.dot(velocity);
					edgeDotSpherePositionToVertex = edge.dot(spherePositionToVertex);
					spherePositionToVertexLengthSquared = spherePositionToVertex.lengthSq();

					a = edgeLengthSquared * -velocityLengthSquared + (edgeDotVelocity * edgeDotVelocity);
					b = edgeLengthSquared * 2 * velocity.dot(spherePositionToVertex) - 2 * edgeDotVelocity * edgeDotSpherePositionToVertex;
					c = edgeLengthSquared * (1 - spherePositionToVertexLengthSquared) + 
						(edgeDotSpherePositionToVertex * edgeDotSpherePositionToVertex);

					if (this.getLowestRoot(a, b, c, t, result)) {
						var f = (edgeDotVelocity * result.root - edgeDotSpherePositionToVertex) / edgeLengthSquared;
						if (f >= 0 && f <= 1) {
							t = result.root;
							collidingWithTri = true;
							edge.multiplyScalar(f);
							collisionPoint.copy(v1).add(edge);
						}
					}

					edge.copy(v0).sub(v2);
					spherePositionToVertex.copy(v2).sub(position);
					edgeLengthSquared = edge.lengthSq();
					edgeDotVelocity = edge.dot(velocity);
					edgeDotSpherePositionToVertex = edge.dot(spherePositionToVertex);
					spherePositionToVertexLengthSquared = spherePositionToVertex.lengthSq();

					a = edgeLengthSquared * -velocityLengthSquared + (edgeDotVelocity * edgeDotVelocity);
					b = edgeLengthSquared * 2 * velocity.dot(spherePositionToVertex) - 2 * edgeDotVelocity * edgeDotSpherePositionToVertex;
					c = edgeLengthSquared * (1 - spherePositionToVertexLengthSquared) + 
						(edgeDotSpherePositionToVertex * edgeDotSpherePositionToVertex);

					if (this.getLowestRoot(a, b, c, t, result)) {
						var f = (edgeDotVelocity * result.root - edgeDotSpherePositionToVertex) / edgeLengthSquared;
						if (f >= 0 && f <= 1) {
							t = result.root;
							collidingWithTri = true;
							edge.multiplyScalar(f);
							collisionPoint.copy(v2).add(edge);
						}
					}
				}

				if (collidingWithTri) {
					var distToCollision = t * velocity.length();
					if (!p.foundCollision || distToCollision < p.nearestDistance) {
						p.nearestDistance = distToCollision;
						p.intersectionPoint.copy(collisionPoint);
						p.foundCollision = true;
						p.normal.copy(normal);
						p.gridObject = gridObject;

						return true;
					}
				}
			}

			return false;
		}
	}(),

	checkPointInTriangle: function() {
		var cp1 = new THREE.Vector3();
		var cp2 = new THREE.Vector3();
		var aux = new THREE.Vector3();
		var aux2 = new THREE.Vector3();

		return function(point, v1, v2, v3) {
			aux.copy(v3).sub(v2);
			aux2.copy(point).sub(v2);
			cp1.crossVectors(aux, aux2);

			aux.copy(v3).sub(v2);
			aux2.copy(v1).sub(v2);
			cp2.crossVectors(aux, aux2);

			if (cp1.dot(cp2) >= 0) {
				aux.copy(v3).sub(v1);
				aux2.copy(point).sub(v1);
				cp1.crossVectors(aux, aux2);

				aux.copy(v3).sub(v1);
				aux2.copy(v2).sub(v1);
				cp2.crossVectors(aux, aux2);

				if (cp1.dot(cp2) >= 0) {
					aux.copy(v2).sub(v1);
					aux2.copy(point).sub(v1);
					cp1.crossVectors(aux, aux2);

					aux.copy(v2).sub(v1);
					aux2.copy(v3).sub(v1);
					cp2.crossVectors(aux, aux2);

					if (cp1.dot(cp2) >= 0) {
						return true;
					}
				}
			}
		}
	}(),

	getLowestRoot: function(a, b, c, maxR, result) {
		var determinant = b * b - 4 * a * c;
		if (determinant < 0) {
			return false;
		}

		var sqrtD = Math.sqrt(determinant);
		var r1 = (-b - sqrtD) / (2 * a);
		var r2 = (-b + sqrtD) / (2 * a);

		if (r1 > r2) {
			var temp = r2;
			r2 = r1;
			r1 = temp;
		}

		if (r1 > 0 && r1 < maxR) {
			result.root = r1;
			return true;
		}

		if (r2 > 0 && r2 < maxR) {
			result.root = r2;
			return true;
		}

		return false;
	},
};;GS.HitscanHelper = {
	unitLength: 64,
	steps: 5,

	spread: function(weapon, xAngle, yAngle, callback) {
		var angleForX = weapon.spread.angleOffset + 20 * (Math.abs(yAngle - 90) / 90) * (Math.abs(yAngle - 90) / 90);
		var angleForY = weapon.spread.angleOffset;
		
		for (var i = 0; i < weapon.spread.shots; i++) {
			var xAngleOffset = xAngle + Math.random() * angleForX * 2 - angleForX;
			var yAngleOffset = yAngle + Math.random() * angleForY * 2 - angleForY;

			var x = Math.sin(Math.PI / 180 * yAngleOffset) * Math.cos(Math.PI / 180 * xAngleOffset);
			var y = Math.cos(Math.PI / 180 * yAngleOffset);
			var z = Math.sin(Math.PI / 180 * yAngleOffset) * Math.sin(Math.PI / 180 * xAngleOffset);

			var dir = new THREE.Vector3(x, y, z);
			dir.normalize();

			callback(dir);
		}
	},

	getIntersection: function() {
		var newPos = new THREE.Vector3();
		var step = new THREE.Vector3();
		var endPoint = new THREE.Vector3();
		var points = [ new THREE.Vector2(), new THREE.Vector2() ];
		var ray = new THREE.Ray();
		var point = new THREE.Vector3();

		return function(pos, dir, grid, typesEnvironment, typesEntity, steps, except) {
			steps = steps || this.steps;
			newPos.copy(pos);
			step.copy(dir).multiplyScalar(this.unitLength);

			var result = {
				type: GS.CollisionTypes.None,
				pos: new THREE.Vector3(),
				gridObject: null,
				distance: Infinity,
				normal: new THREE.Vector3(),
			};

			ray.set(pos, dir);

			for (var i = 0; i < steps; i++) {
				endPoint.copy(newPos).add(step);
				
				newPos.toVector2(points[0]);
				endPoint.toVector2(points[1]);

				var gridLocation = grid.getGridLocationFromPoints(points);
				if (gridLocation === undefined) {
					break;
				}

				this.checkEnvironmentIntersection(ray, grid, gridLocation, typesEnvironment, result, except);
				this.checkEntityIntersection(ray, grid, gridLocation, typesEntity, result, except);

				if (result.type !== GS.CollisionTypes.None) {
					break;
				} else {
					newPos.add(step);
				}
			}

			return result;
		}
	}(),

	checkEnvironmentIntersection: function() {
		var aux = new THREE.Vector3();
		var point = new THREE.Vector3();

		return function(ray, grid, gridLocation, types, result, except) {
			var triangleIterator = grid.getTriangleIterator(gridLocation, types);

			triangleIterator(function(gridObject, v0, v1, v2) {
				if (gridObject === except) {
					return;
				}

				if (ray.intersectTriangle(v0, v1, v2, true, point) !== null) {
					var dist = point.distanceToSquared(ray.origin);

					if (dist < result.distance) {
						result.type = GS.CollisionTypes.Environment;

						aux.subVectors(v2, v0);
						result.normal.copy(v1).sub(v0).cross(aux).normalize();

						result.pos.copy(point).add(result.normal);
						result.distance = dist;
						result.gridObject = gridObject;
					}
				}
			});
		}
	}(),

	checkEntityIntersection: function() {
		var point = new THREE.Vector3();

		return function(ray, grid, gridLocation, types, result, except) {
			var cells = grid.getCellsFromGridLocation(gridLocation);
		
			grid.forEachUniqueGridObjectInCells(cells, types, function(gridObject) {
				if (gridObject.dead || gridObject === except) {
					return;
				}

				if (ray.intersectBox(gridObject.view.collisionData.boundingBox, point) !== null) {
					var dist = point.distanceToSquared(ray.origin);

					if (dist < result.distance) {
						result.type = GS.CollisionTypes.Entity;

						result.pos.copy(point);
						result.distance = dist;
						result.gridObject = gridObject;
					}
				}
			});
		}
	}(),
};;GS.RegionHelper = function() {
	this.material = new GS.MeshVertexColorMaterial();
};

GS.RegionHelper.prototype = {
	constructor: GS.RegionHelper,

	getRegions: function(sectors, sectorLinks) {
		var result = this.getSectorGraph(sectors, sectorLinks);
		result.regions = this.constructRegions(result.sectorDict, result.sectorGraph);
		return result;
	},

	getSectorGraph: function(sectors, sectorLinks) {
		var sectorGraph = new GS.Graph(function(a, b) { return a.id == b.id });
		var sectorDict = {};

		for (var i = 0; i < sectorLinks.length; i += 2) {
			var s1 = this.getSectorById(sectors, sectorLinks[i]);
			var s2 = this.getSectorById(sectors, sectorLinks[i + 1]);

			sectorDict[s1.id] = { index: -1, sector: s1, center: GS.PolygonHelper.getSectorCentroid(s1) };
			sectorDict[s2.id] = { index: -1, sector: s2, center: GS.PolygonHelper.getSectorCentroid(s2) };

			sectorGraph.addEdge(s1, s2);
		}

		var keys = Object.keys(sectorDict);
		for (var i = 0; i < keys.length; i++) {
			var obj = sectorDict[keys[i]];
			obj.index = sectorGraph.getVertexIndex(obj.sector);
		}

		sectorGraph.computeVertexNeighborSets();

		return {
			sectorGraph: sectorGraph,
			sectorDict: sectorDict,
		};
	},

	constructRegions: function(sectorDict, sectorGraph) {
		this.regionIdCount = 0;

		var toVisit = [];
		var doorCount = 0;
		var seeds = {};

		for (var i in sectorDict) {
			if (sectorDict[i].sector.door) {
				var neighbors = sectorGraph.neighborSets[sectorDict[i].index].elements;
				for (var j = 0; j < neighbors.length; j++) {
					var id = neighbors[j].id;
					toVisit.push({ id: id, seed: id });
					seeds[id] = { doorIds: {}, sectorIds: {} };
				}
				doorCount++;
			}
		}

		var regions = [];
		if (doorCount > 0) {
			var visited = {};

			while (toVisit.length > 0) {
				var current = toVisit.pop();
				var id = current.id;
				var seedId = current.seed;

				if (sectorDict[id].sector.door) {
					seeds[seedId].doorIds[id] = true;
				}
				if (visited[id]) {
					continue;
				}

				visited[id] = true;
				seeds[seedId].sectorIds[id] = true;

				if (sectorDict[id].sector.door) {
					continue;
				}

				var neighbors = sectorGraph.neighborSets[sectorDict[id].index].elements;
				for (var i = 0; i < neighbors.length; i++) {
					var info = sectorDict[neighbors[i].id];
					var id = info.sector.id;
					toVisit.push({ id: id, seed: seedId });
				}
			}

			for (var i in seeds) {
				var sectorIds = seeds[i].sectorIds;
				if (Object.keys(sectorIds).length > 0) {
					regions.push(this.getNewRegion(seeds[i].doorIds, sectorIds));
				}
			}

			for (var i = 0; i < regions.length; i++) {
				var region = regions[i];
				region.linkedRegions = [];

				for (var j in region.doorIds) {
					for (var k = 0; k < regions.length; k++) {
						if (k !== i) {
							var region2 = regions[k];
							for (var e in region2.doorIds) {
								if (e === j) {
									region.linkedRegions.push({ doorId: e, region: region2 });
									break;
								}
							}
						}
					}
				}
			}
		} else {
			var region = this.getNewRegion();
			for (var i in this.sectorDict) {
				region.sectorIds[i] = true;
			}
			regions.push(region);
		}

		return regions;
	},

	getNewRegion: function(doorIds, sectorIds) {
		var region = {
			id: this.regionIdCount,
			doorIds: doorIds || {},
			sectorIds: sectorIds || {},
			monsters: []
		};

		var mesh = new THREE.Mesh(new THREE.Geometry(), this.material);
		mesh.matrixAutoUpdate = false;
		region.mesh = mesh;

		this.regionIdCount++;
		return region;
	},

	getSectorById: function(sectors, id) {
		for (var i = 0; i < sectors.length; i++) {
			if (sectors[i].id == id) {
				return sectors[i];
			}
		}

		GAME.handleFatalError("sector " + id + " not found");
		return;
	},
};;GS.BrightnessFilterShader = {
	uniforms: {
		"tDiffuse": { type: "t", value: null },
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D(tDiffuse, vUv);",

			"float lum = dot(texel, vec4(0.299, 0.587, 0.114, 0.0));",
			"lum = step(0.9999, lum);",

			"gl_FragColor = vec4(texel.xyz * lum, 1.0);",

		"}"

	].join("\n")
};
;// https://github.com/mrdoob/three.js/blob/master/examples/js/shaders/ColorifyShader.js

GS.ColorShader = {
	uniforms: {
		"tDiffuse": { type: "t", value: null },
		"color":    { type: "c", value: new THREE.Color(0xffffff) }
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform vec3 color;",
		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D(tDiffuse, vUv);",

			"gl_FragColor = vec4(texel.xyz + color.xyz * 0.75, 1.0);",

		"}"

	].join("\n")
};
;GS.GlowShader = {
	uniforms: {
		"tDiffuse": { type: "t", value: null },
		"tGlow": { type: "t", value: null },
		"intensity":  { type: "f", value: 1.0 }
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform float intensity;",
		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tGlow;",
		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D(tDiffuse, vUv);",
			"vec4 glow = texture2D(tGlow, vUv);",

			"gl_FragColor = vec4(texel.xyz + glow.xyz * intensity, 1.0);",

		"}"

	].join("\n")
};
;GS.MeshPhongGlowMaterial = function(map, glow, normal, emissive, glowIntensity) {
	this.shader = GS.PhongGlowShader;

	this.uniforms = THREE.UniformsUtils.clone(this.shader.uniforms);

	this.uniforms["map"].value = map;
	this.uniforms["glowMap"].value = glow;
	this.uniforms["normalMap"].value = normal;
	this.uniforms["emissive"].value = new THREE.Color(emissive || 0);
	this.uniforms["glowIntensity"].value = (glowIntensity !== undefined) ? glowIntensity : 1;

	THREE.ShaderMaterial.call(this, {
		uniforms: this.uniforms,
		fragmentShader: this.shader.fragmentShader,
		vertexShader: this.shader.vertexShader,
		lights: true,
	});

	this.map = true;
	this.normalMap = (normal !== undefined && normal !== null);
};

GS.MeshPhongGlowMaterial.prototype = GS.inherit(THREE.ShaderMaterial, {
	constructor: GS.MeshPhongGlowMaterial,

	clone: function() {
		var material = new GS.MeshPhongGlowMaterial(
			this.uniforms["map"].value,
			this.uniforms["glowMap"].value,
			this.uniforms["normalMap"].value,			
			this.uniforms["emissive"].value,
			this.uniforms["glowIntensity"].value
		);

		return material;
	},

	get emissive() {
		return this.uniforms["emissive"].value;
	},

	set glowIntensity(value) {
		this.uniforms["glowIntensity"].value = value;
	},

	get glowIntensity() {
		return this.uniforms["glowIntensity"].value
	},
});;GS.MeshVertexColorMaterial = function() {
	this.shader = GS.VertexColorShader;

	this.uniforms = THREE.UniformsUtils.clone(this.shader.uniforms);

	THREE.ShaderMaterial.call(this, {
		uniforms: this.uniforms,
		attributes: {
			emissive: { type: "c", value: [] }
		},
		fragmentShader: this.shader.fragmentShader,
		vertexShader: this.shader.vertexShader,
		vertexColors: THREE.FaceColors,
		lights: true,
	});
};

GS.MeshVertexColorMaterial.prototype = GS.inherit(THREE.ShaderMaterial, {
	constructor: GS.MeshVertexColorMaterial,

	clone: function() {
		var material = new GS.MeshVertexColorMaterial();

		return material;
	},
});;GS.NoiseShader = {
	uniforms: {
		"tDiffuse": { type: "t", value: null },
		"tNoise": { type: "t", value: null },
		"ratio": { type: "v2", value: new THREE.Vector2(1, 1) },
		"intensity" : { type: "f", value: 0.05 },
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tNoise;",
		"uniform vec2 ratio;",
		"uniform float intensity;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 cDiffuse = texture2D(tDiffuse, vUv);",
			"vec4 cNoise = texture2D(tNoise, vUv * ratio);",

			"gl_FragColor = vec4(cDiffuse.xyz + cNoise.xyz * intensity - intensity * 0.5, 1.0);",

		"}"

	].join("\n")
};
;GS.PhongGlowShader = {

	uniforms: THREE.UniformsUtils.merge( [

		THREE.UniformsLib[ "common" ],
		THREE.UniformsLib[ "normalmap" ],
		THREE.UniformsLib[ "fog" ],
		THREE.UniformsLib[ "lights" ],

		{
			"ambient"  : { type: "c", value: new THREE.Color( 0xffffff ) },
			"emissive" : { type: "c", value: new THREE.Color( 0x000000 ) },
			"specular" : { type: "c", value: new THREE.Color( 0x111111 ) },
			"shininess": { type: "f", value: 30 },
			"wrapRGB"  : { type: "v3", value: new THREE.Vector3( 1, 1, 1 ) },

			"glowMap"  	   : { type: "t", value: null },
			"glowIntensity": { type: "f", value: 1 },
		}

	] ),

	vertexShader: [

		"#define PHONG",

		"varying vec3 vViewPosition;",
		"varying vec3 vNormal;",

		THREE.ShaderChunk[ "map_pars_vertex" ],
		THREE.ShaderChunk[ "lightmap_pars_vertex" ],
		THREE.ShaderChunk[ "envmap_pars_vertex" ],
		THREE.ShaderChunk[ "lights_phong_pars_vertex" ],
		THREE.ShaderChunk[ "color_pars_vertex" ],
		THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

		"void main() {",

			THREE.ShaderChunk[ "map_vertex" ],
			THREE.ShaderChunk[ "lightmap_vertex" ],
			THREE.ShaderChunk[ "color_vertex" ],

			THREE.ShaderChunk[ "defaultnormal_vertex" ],

		"	vNormal = normalize( transformedNormal );",
			
			THREE.ShaderChunk[ "default_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_vertex" ],

		"	vViewPosition = -mvPosition.xyz;",

			THREE.ShaderChunk[ "worldpos_vertex" ],
			THREE.ShaderChunk[ "envmap_vertex" ],
			THREE.ShaderChunk[ "lights_phong_vertex" ],

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform vec3 diffuse;",
		"uniform float opacity;",

		"uniform vec3 ambient;",
		"uniform vec3 emissive;",
		"uniform vec3 specular;",
		"uniform float shininess;",

		"uniform sampler2D glowMap;",
		"uniform float glowIntensity;",

		THREE.ShaderChunk[ "color_pars_fragment" ],
		THREE.ShaderChunk[ "map_pars_fragment" ],
		THREE.ShaderChunk[ "lightmap_pars_fragment" ],
		THREE.ShaderChunk[ "envmap_pars_fragment" ],
		THREE.ShaderChunk[ "fog_pars_fragment" ],
		THREE.ShaderChunk[ "lights_phong_pars_fragment" ],
		THREE.ShaderChunk[ "normalmap_pars_fragment" ],
		THREE.ShaderChunk[ "specularmap_pars_fragment" ],
		THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

		"void main() {",

		"	gl_FragColor = vec4( vec3( 1.0 ), opacity );",

			THREE.ShaderChunk[ "logdepthbuf_fragment" ],
			THREE.ShaderChunk[ "map_fragment" ],
			THREE.ShaderChunk[ "alphatest_fragment" ],
			THREE.ShaderChunk[ "specularmap_fragment" ],

			THREE.ShaderChunk[ "lights_phong_fragment" ],

		"	float glow = texture2D(glowMap, vUv).x * glowIntensity * 2.0;",
		"	gl_FragColor.xyz = texelColor.xyz * clamp(emissive + totalDiffuse + ambientLightColor * ambient + glow, 0.0, 2.0) + totalSpecular;",

			THREE.ShaderChunk[ "lightmap_fragment" ],
			THREE.ShaderChunk[ "color_fragment" ],
			THREE.ShaderChunk[ "envmap_fragment" ],

			THREE.ShaderChunk[ "linear_to_gamma_fragment" ],

			THREE.ShaderChunk[ "fog_fragment" ],

		"}"

	].join("\n")

};;GS.RandomNoiseShader = {
	uniforms: {
		"tDiffuse": { type: "t", value: null },
		"intensity" : { type: "f", value: 0.05 },
		"seed": { type: "v2", value: new THREE.Vector2(Math.random(), Math.random()) },
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float intensity;",
		"uniform vec2 seed;",

		"varying vec2 vUv;",

		// http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/

		"highp float rand(vec2 co)",
		"{",
			"highp float a = 12.9898;",
			"highp float b = 78.233;",
			"highp float c = 43758.5453;",
			"highp float dt = dot(co.xy, vec2(a,b));",
			"highp float sn = mod(dt, 3.14);",
			"return fract(sin(sn) * c);",
		"}",

		"void main() {",

			"vec4 cDiffuse = texture2D(tDiffuse, vUv);",
			"gl_FragColor = vec4(cDiffuse.xyz - rand(vUv + seed) * intensity, 1.0);",

		"}"

	].join("\n")
};
;GS.VertexColorShader = {

	uniforms: THREE.UniformsUtils.merge( [

		THREE.UniformsLib[ "common" ],
		THREE.UniformsLib[ "normalmap" ],
		THREE.UniformsLib[ "fog" ],
		THREE.UniformsLib[ "lights" ],

		{
			"ambient"  : { type: "c", value: new THREE.Color( 0xffffff ) },
			"specular" : { type: "c", value: new THREE.Color( 0x111111 ) },
			"shininess": { type: "f", value: 30 },
			"wrapRGB"  : { type: "v3", value: new THREE.Vector3( 1, 1, 1 ) }
		}

	] ),

	vertexShader: [

		"#define PHONG",

		"varying vec3 vViewPosition;",
		"varying vec3 vNormal;",

		THREE.ShaderChunk[ "lights_phong_pars_vertex" ],

		"#ifdef USE_COLOR",
			"attribute vec3 emissive;",

			"varying vec3 vColor;",
			"varying vec3 vEmissive;",
		"#endif",

		"void main() {",

			"#ifdef USE_COLOR",
				"#ifdef GAMMA_INPUT",
					"vColor = color * color;",
				"#else",
					"vColor = color;",
				"#endif",

				"vEmissive = emissive;",
			"#endif",

			THREE.ShaderChunk[ "defaultnormal_vertex" ],

			"vNormal = normalize( transformedNormal );",

			THREE.ShaderChunk[ "default_vertex" ],

			"vViewPosition = -mvPosition.xyz;",

			THREE.ShaderChunk[ "worldpos_vertex" ],
			THREE.ShaderChunk[ "lights_phong_vertex" ],

		"}"

	].join("\n"),

	fragmentShader: [

		"#define PHONG",

		"uniform vec3 diffuse;",
		"uniform float opacity;",

		"uniform vec3 ambient;",
		"uniform vec3 specular;",
		"uniform float shininess;",

		"#ifdef USE_COLOR",
			"varying vec3 vColor;",
			"varying vec3 vEmissive;",
		"#endif",

		THREE.ShaderChunk[ "fog_pars_fragment" ],
		THREE.ShaderChunk[ "lights_phong_pars_fragment" ],
		THREE.ShaderChunk[ "normalmap_pars_fragment" ],
		THREE.ShaderChunk[ "specularmap_pars_fragment" ],

		"void main() {",

			"gl_FragColor = vec4( vec3( 1.0 ), opacity );",

			THREE.ShaderChunk[ "specularmap_fragment" ],

			"vec3 emissive = vEmissive;",

			THREE.ShaderChunk[ "lights_phong_fragment" ],
			THREE.ShaderChunk[ "color_fragment" ],

			THREE.ShaderChunk[ "linear_to_gamma_fragment" ],
			THREE.ShaderChunk[ "fog_fragment" ],

		"}"

	].join("\n")

};;GS.AssetTypes = {
	Texture: 0,
	Mesh: 1,
	Sound: 2,
	CubeTexture: 3,
	UIWidget: 4,
	Map: 5,
	Script: 6,
	MusicTrack: 7,
};

GS.TextureTypes = {
	Map: 0,
	TVScreen: 1,
	Entity: 2,
}

GS.CubeTextureExtension = ".jpg";
GS.CubeTextureNames = [ "left", "right", "top", "bottom", "front", "back" ];
GS.CustomFontFile = "capsuula.woff";

GS.Assets = {};

GS.Assets[GS.AssetTypes.Texture] = {
	"cyan_wall":			{ filename: "cyan_wall.png",				type: GS.TextureTypes.Map },
	"red_wall": 			{ filename: "red_wall.png", 				type: GS.TextureTypes.Map },
	"blue_metal": 			{ filename: "blue_metal.png", 				type: GS.TextureTypes.Map },
	"white": 				{ filename: "white.png",	 				type: GS.TextureTypes.Map },
	"wall": 				{ filename: "wall.png", 					type: GS.TextureTypes.Map },
	"metal": 				{ filename: "metal.png", 					type: GS.TextureTypes.Map },
	"light": 				{ filename: "light.png", 					type: GS.TextureTypes.Map },
	"red": 					{ filename: "red.png", 						type: GS.TextureTypes.Map },
	"blue": 				{ filename: "blue.png", 					type: GS.TextureTypes.Map },
	"cyan": 				{ filename: "cyan.png", 					type: GS.TextureTypes.Map },
	"brown": 				{ filename: "brown.png", 					type: GS.TextureTypes.Map },

	"exit": 				{ filename: "exit.png",						type: GS.TextureTypes.TVScreen, showInMapEditor: true },
	"switch_off": 			{ filename: "switch_off.png",				type: GS.TextureTypes.TVScreen },
	"switch_on": 			{ filename: "switch_on.png",				type: GS.TextureTypes.TVScreen },

	"ammo": 				{ filename: "ammo.png", 					type: GS.TextureTypes.Entity },
	"ammo_glow": 			{ filename: "ammo_glow.png", 				type: GS.TextureTypes.Entity },
	"medkit": 				{ filename: "medkit.png", 					type: GS.TextureTypes.Entity },
	"medkit_glow": 			{ filename: "medkit_glow.png", 				type: GS.TextureTypes.Entity },
	"pistol": 				{ filename: "pistol.png", 					type: GS.TextureTypes.Entity },
	"pistol_glow": 			{ filename: "pistol_glow.png", 				type: GS.TextureTypes.Entity },
	"double_shotgun": 		{ filename: "double_shotgun.png", 			type: GS.TextureTypes.Entity },
	"double_shotgun_glow": 	{ filename: "double_shotgun_glow.png", 		type: GS.TextureTypes.Entity },
	"hyper_blaster": 		{ filename: "hyper_blaster.png", 			type: GS.TextureTypes.Entity },
	"hyper_blaster_glow": 	{ filename: "hyper_blaster_glow.png", 		type: GS.TextureTypes.Entity },
	"nom": 					{ filename: "nom.png", 						type: GS.TextureTypes.Entity },
	"nom_glow": 			{ filename: "nom_glow.png", 				type: GS.TextureTypes.Entity },
	"eye": 					{ filename: "eye.png", 						type: GS.TextureTypes.Entity },
	"eye_glow": 			{ filename: "eye_glow.png", 				type: GS.TextureTypes.Entity },
	"online_player": 					{ filename: "nom.png", 						type: GS.TextureTypes.Entity },
	"online_player_glow": 			{ filename: "nom_glow.png", 				type: GS.TextureTypes.Entity },
};

GS.Assets[GS.AssetTypes.CubeTexture] = {
	"skybox1": 				{ filename: "skybox1" },
};

GS.Assets[GS.AssetTypes.UIWidget] = {
	"hud": 					{ filename: "hud.png" },
	"logo": 				{ filename: "logo.png" },
	"menu_back":			{ filename: "menu_back.png" },
	"thumb_airstrip1":		{ filename: "thumb_airstrip1.png" },
	"thumb_drencrom":		{ filename: "thumb_drencrom.png" },
	"thumb_sacrosanct":		{ filename: "thumb_sacrosanct.png" },
};

GS.Assets[GS.AssetTypes.Mesh] = {
	"ammo": 				{ filename: "ammo.js" },
	"medkit": 				{ filename: "medkit.js" },

	"pistol": 				{ filename: "pistol.js" },
	"double_shotgun": 		{ filename: "double_shotgun.js" },
	"hyper_blaster": 		{ filename: "hyper_blaster.js" },

	"nom_walk0": 			{ filename: "nom_walk0.js" },
	"nom_walk1": 			{ filename: "nom_walk1.js" },
	"nom_walk2": 			{ filename: "nom_walk2.js" },
	"nom_walk3": 			{ filename: "nom_walk3.js" },
	"nom_walk4": 			{ filename: "nom_walk4.js" },
	"nom_walk5": 			{ filename: "nom_walk5.js" },
	"nom_death0": 			{ filename: "nom_death0.js" },
	"nom_death1": 			{ filename: "nom_death1.js" },
	"nom_death2": 			{ filename: "nom_death2.js" },
	"nom_death3": 			{ filename: "nom_death3.js" },

	"online_player_walk0": 			{ filename: "nom_walk0.js" },
	"online_player_walk1": 			{ filename: "nom_walk1.js" },
	"online_player_walk2": 			{ filename: "nom_walk2.js" },
	"online_player_walk3": 			{ filename: "nom_walk3.js" },
	"online_player_walk4": 			{ filename: "nom_walk4.js" },
	"online_player_walk5": 			{ filename: "nom_walk5.js" },
	"online_player_death0": 			{ filename: "nom_death0.js" },
	"online_player_death1": 			{ filename: "nom_death1.js" },
	"online_player_death2": 			{ filename: "nom_death2.js" },
	"online_player_death3": 			{ filename: "nom_death3.js" },

	"eye_walk0": 			{ filename: "eye_walk0.js" },
	"eye_walk1": 			{ filename: "eye_walk1.js" },
	"eye_walk2": 			{ filename: "eye_walk2.js" },
	"eye_walk3": 			{ filename: "eye_walk3.js" },
	"eye_death0": 			{ filename: "eye_death0.js" },
	"eye_death1": 			{ filename: "eye_death1.js" },
	"eye_death2": 			{ filename: "eye_death2.js" },
	"eye_death3": 			{ filename: "eye_death3.js" },
	"eye_attack0": 			{ filename: "eye_attack0.js" },
	"eye_attack1": 			{ filename: "eye_attack1.js" },
};

GS.Assets[GS.AssetTypes.Sound] = {
	"door_close": 			{ filename: "door_close.ogg",				allowMultipleAtOnce: true },
	"door_open": 			{ filename: "door_open.ogg",				allowMultipleAtOnce: true },
	"elevator_move": 		{ filename: "elevator_move.ogg",			allowMultipleAtOnce: true },
	"elevator_stop": 		{ filename: "elevator_stop.ogg",			allowMultipleAtOnce: true },
	"hyper_blaster_fire": 	{ filename: "hyper_blaster_fire.ogg",		allowMultipleAtOnce: true },
	"hyper_blaster_hit": 	{ filename: "hyper_blaster_hit.ogg",		allowMultipleAtOnce: true },
	"monster_pain": 		{ filename: "monster_pain.ogg",				allowMultipleAtOnce: false },
	"monster_roar": 		{ filename: "monster_roar.ogg",				allowMultipleAtOnce: true },
	"monster_bite": 		{ filename: "monster_bite.ogg",				allowMultipleAtOnce: true },
	"monster_death": 		{ filename: "monster_death.ogg",			allowMultipleAtOnce: true },
	"eye_charging": 		{ filename: "eye_charging.ogg",				allowMultipleAtOnce: true },
	"pickup_ammo": 			{ filename: "pickup_ammo.ogg",				allowMultipleAtOnce: true },
	"pickup_item": 			{ filename: "pickup_item.ogg",				allowMultipleAtOnce: true },
	"pickup_weapon": 		{ filename: "pickup_weapon.ogg",			allowMultipleAtOnce: true },
	"shotgun_fire": 		{ filename: "shotgun_fire.ogg",				allowMultipleAtOnce: true },
	"player_death": 		{ filename: "player_death.ogg",				allowMultipleAtOnce: true },
	"switch_on": 			{ filename: "switch_on.ogg",				allowMultipleAtOnce: true },
	"none": 				{ filename: "none.ogg",						allowMultipleAtOnce: true },
};

GS.Assets[GS.AssetTypes.MusicTrack] = {
	"simple_action_beat": 	{ filename: "simple_action_beat.ogg" },
	"tower_defense_theme": 	{ filename: "tower_defense_theme.ogg" },
	"angry_robot_3": 		{ filename: "angry_robot_3.ogg" },
};

GS.Assets[GS.AssetTypes.Map] = {
	"testMap": 				{ filename: "" },
	"airstrip1": 			{ filename: "airstrip1.js" },
	"airstrip1online": 			{ filename: "airstrip1online.js" },
	"drencrom":				{ filename: "drencrom.js" },
	"sacrosanct":			{ filename: "sacrosanct.js" },
};

GS.Assets[GS.AssetTypes.Script] = {
	"airstrip1": 			{ filename: "airstrip1online.js" },
	"airstrip1": 			{ filename: "airstrip1.js" },
	"drencrom":				{ filename: "drencrom.js" },
	"sacrosanct":			{ filename: "sacrosanct.js" },
};
;GS.MonsterAttackTypes = {
	Melee: 0,
	Ranged: 1,
};

GS.Monsters = {
	nom: {
		size: new THREE.Vector3(16 * 0.45, 16 * 0.5,  16 * 0.45),
		scale: new THREE.Vector3(0.9, 0.9, 0.9),
		offset: new THREE.Vector3(16 * 0.45 * 0.5, 16 * 0.5 + 0.03, 16 * 0.45 * 0.5),
		speed: 0.75,
		rotationOffset: Math.PI,

		painChance: 0.25,
		attackType: GS.MonsterAttackTypes.Melee,
		maxHealth: 160,
		meleeDamage: 10,
		meleeAttackMaxCooldown: GS.msToFrames(500),
		meleeRange: 15,
		walkDelay: 5,
		bloodColor: new THREE.Color().setRGB(1, 0, 0).getHex(),

		roarSound: "monster_roar",
		meleeAttackSound: "monster_bite",
		painSound: "monster_pain",
		deathSound: "monster_death",
	},
	eye: {
		size: new THREE.Vector3(16 * 0.35, 16 * 0.5,  16 * 0.35),
		scale: new THREE.Vector3(0.5, 0.5, 0.5),
		offset: new THREE.Vector3(16 * 0.35 * 0.5, 16 * 0.5 + 0.03, 16 * 0.35 * 0.5),
		speed: 0.25,
		rotationOffset: Math.PI,

		painChance: 0.75,
		attackType: GS.MonsterAttackTypes.Ranged,
		maxHealth: 50,
		meleeRange: 15,
		rangedAttackMaxCooldown: GS.msToFrames(1500),
		rangedAttackCooldownRandomModifier: GS.msToFrames(1000),
		rangedAttackRange: 200,
		rangedAttackProjectile: "eye_bolt",
		rangedAttackChargeMaxCooldown: GS.msToFrames(500),
		preferredMaxDistance: 100,
		walkDelay: 15,
		bloodColor: new THREE.Color().setRGB(0, 1, 1).getHex(),

		roarSound: "monster_roar",
		rangedAttackChargeUpSound: "eye_charging",
		painSound: "monster_pain",
		deathSound: "monster_death",
	},
};;GS.Projectiles = {
	pistol_bolt: {
		hitSound: "hyper_blaster_hit",
		size: new THREE.Vector3(1, 1, 1),
		visualSize: new THREE.Vector3(1, 1, 3),
		rotating: false,
		speed: 5,
		maxDistance: 500,
		color: new THREE.Color().setRGB(1, 1, 1).getHex(),
		damage: 10,
	},
	hyper_blaster_bolt: {
		hitSound: "hyper_blaster_hit",
		size: new THREE.Vector3(1, 1, 1),
		visualSize: new THREE.Vector3(1, 1, 3),
		rotating: false,
		speed: 5,
		maxDistance: 500,
		color: new THREE.Color().setRGB(1, 1, 1).getHex(),
		damage: 10,
	},
	eye_bolt: {
		hitSound: "hyper_blaster_hit",
		size: new THREE.Vector3(2, 2, 2),
		visualSize: new THREE.Vector3(3, 3, 3),
		rotating: true,
		speed: 2,
		maxDistance: 500,
		color: new THREE.Color().setRGB(1, 1, 1).getHex(),
		damage: 20,
	},
};;GS.Weapons = {
	pistol: {
		name: "pistol",
		powerLevel: 2,
		ammo: 0,
		infiniteAmmo: true,
		cooldown: 400,
		hitscan: false,
	},
	double_shotgun: {
		name: "shotgun",
		powerLevel: 3,
		ammo: 0,
		ammoMax: 50,
		ammoClip: 8,
		bulletsPerShot: 2,
		cooldown: 1000,
		hitscan: true,
		spread: {
			shots: 8,
			angleOffset: 5,
		},
		damage: 10,
		impactParticleColor: new THREE.Color().setRGB(1, 1, 1).getHex(),
		impactParticleCount: 1,
	},
	hyper_blaster: {
		name: "hyperblaster",
		powerLevel: 4,
		ammo: 0,
		ammoMax: 200,
		ammoClip: 20,
		bulletsPerShot: 1,
		cooldown: 80,
		hitscan: false,
	},
};;GS.GridObject = function(grid, layer, sourceObj) {
	this.id = GS.gridObjectIdCount;
	this.grid = grid;
	this.type = layer;
	this.sourceObj = sourceObj;
	this.linkedGridCells = [];
	this.view = null;

	this.removed = false;
	this.usable = false;

	this.lightLevelFactor = 0.1;
	this.minLightLevel = 0.1;
	this.maxLightLevel = 0.75;

	GS.gridObjectIdCount++;
};

GS.GridObject.prototype = {
	constructor: GS.GridObject,

	init: function() {
	},

	update: function() {
	},

	updateCollisionData: function(newPos) {
	},

	updateBoundingBox: function() {
		var min = new THREE.Vector3();
		var max = new THREE.Vector3();
		var points = [ new THREE.Vector2(), new THREE.Vector2() ];
		var aux = new THREE.Vector2();

		return function() {
			var data = this.view.collisionData;
			min.copy(this.position).sub(this.size);
			max.copy(this.position).add(this.size);
			data.boundingBox.set(min, max);

			var debugMesh = this.view.debugMesh;
			if (debugMesh !== undefined) {
				if (debugMesh.userData.isTriangleMesh !== true) {
					debugMesh.scale.subVectors(max, min);
					debugMesh.position.copy(this.position);
				} else {
					debugMesh.geometry.vertices.length = 0;
					GS.pushArray(debugMesh.geometry.vertices, data.triangles);
					debugMesh.geometry.verticesNeedUpdate = true;
				}
			}

			if (data.boundingSquare !== undefined) {
				this.size.toVector2(aux);
				this.position.toVector2(points[0]);
				points[0].sub(aux);
				this.size.toVector2(aux);
				this.position.toVector2(points[1]);
				points[1].add(aux);

				data.boundingSquare.setFromPoints(points);
			}
		}
	}(),

	updateTriangles: function(velocity) {
		var triangles = this.view.collisionData.triangles;
		for (var i = 0; i < triangles.length; i++) {
			triangles[i].add(velocity);
		}
	},

	updateSegments: function(yVelocity) {
		var segs = this.view.collisionData.segments;
		for (var i = 0; i < segs.length; i++) {
			segs[i].bottomY += yVelocity;
			segs[i].topY += yVelocity;
		}
	},

	assignToCells: function(gridLocation) {
		if (gridLocation !== undefined) {
			if (this.gridLocation !== undefined) {
				if (!gridLocation.gridMin.equals(this.gridLocation.gridMin) ||
					!gridLocation.gridMax.equals(this.gridLocation.gridMax)) {

					this.unlinkFromCells();
					this.linkToCells(gridLocation);
				}
			} else {
				this.linkToCells(gridLocation);
			}
		} else {
			this.unlinkFromCells();
		}
	},

	linkToCells: function(gridLocation) {
		var min = gridLocation.gridMin;
		var max = gridLocation.gridMax;

		for (var i = min.y; i <= max.y; i++) {
			for (var j = min.x; j <= max.x; j++) {
				this.grid.cells[i][j].children.push(this);
				this.linkedGridCells.push(this.grid.cells[i][j]);
			}
		}

		this.gridLocation = gridLocation;
	},

	unlinkFromCells: function() {
		for (var i = 0; i < this.linkedGridCells.length; i++) {
			var cell = this.linkedGridCells[i];
			var idx = cell.children.indexOf(this);
			if (idx != -1) {
				cell.children.splice(idx, 1);
			}
		}
		this.linkedGridCells.length = 0;
		this.gridLocation = undefined;
	},

	getLightColorFromSector: function(optionalTarget, optionalSector) {
		var sector = optionalSector || this.getSector();
		if (sector !== undefined) {
			var color = optionalTarget || new THREE.Color();
			var x = (sector.lightLevel * this.lightLevelFactor);
			x *= x;
			x = GS.MathHelper.clamp(x, this.minLightLevel, this.maxLightLevel);
			color.setHex(0xffffff).multiplyScalar(x);
		}
	},

	computeYFromSector: function() {
		var sector = this.getSector();
		if (sector !== undefined) {
			this.position.y = sector.floorTopY + this.size.y + 0.03;
		}
	},

	getSector: function() {
		var position2d = new THREE.Vector2();

		return function() {
			var that = this;

			var sector;
			var currentSector;
			this.position.toVector2(position2d);

			this.grid.forEachUniqueGridObjectInCells(this.linkedGridCells, [GS.Concrete, GS.Elevator], function(gridObject) {
				if (sector === undefined) {
					if (gridObject instanceof GS.Concrete) {
						if (gridObject.type === GS.MapLayers.Sector) {
							currentSector = gridObject.sourceObj;
						} else {
							return;
						}
					} else {
						currentSector = gridObject.sector;
					}

					if (GS.PolygonHelper.sectorContainsPoint(currentSector, position2d, true)) {
						sector = currentSector;
					}
				}
			});

			return sector;
		}
	}(),

	onHit: function() {
	},

	remove: function() {
		this.removed = true;
		this.unlinkFromCells();
	},
};

GS.gridObjectIdCount = 0;;GS.Concrete = function(grid, layer, sourceObj) {
	GS.GridObject.apply(this, arguments);

	if (layer === GS.MapLayers.Sector) {
		this.sector = this.sourceObj;
	}

	this.view = {
		collisionData: {
			triangles: null,
		},
	};
};

GS.Concrete.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Concrete,
});;GS.DoorStates = {
	Open: 0,
	Closed: 1,
	Opening: 2,
	Closing: 3,
};

GS.Door = function(grid, sector) {
	GS.GridObject.call(this, grid);

	this.sector = sector;
	this.sector.doorGridObject = this;
	this.lightColor = new THREE.Color();

	this.speed = 0.5;
	this.state = GS.DoorStates.Closed;
	this.automatic = true;

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
			triangles: null,
			segments: null,
		},
	};

	this.maxCooldown = GS.msToFrames(5000);
	this.cooldown = this.maxCooldown;
};

GS.Door.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Door,

	init: function() {
		this.closedY = this.position.y;
		this.openY = this.closedY + this.sector.doorMaxHeight;
		this.usable = true;

		this.updateBoundingBox();
	},

	update: function() {
		var velocity = new THREE.Vector3();

		switch (this.state) {
			case GS.DoorStates.Open:
				if (this.automatic) {
					this.cooldown--;
					if (this.cooldown <= 0) {
						this.cooldown = this.maxCooldown;
						this.state = GS.DoorStates.Closing;
						this.grid.soundManager.playSound("door_close");
					}
				} else {
					this.cooldown = this.maxCooldown;
				}
				break;

			case GS.DoorStates.Closed:
				break;

			case GS.DoorStates.Opening:
				this.position.y += this.speed;
				velocity.y = this.speed;
				if (this.position.y >= this.openY) {
					this.position.y = this.openY;
					this.state = GS.DoorStates.Open;
				}
				break;

			case GS.DoorStates.Closing:
				if (!this.grid.collisionManager.isEntityNearDoor(this)) {
					this.position.y -= this.speed;
					velocity.y = -this.speed;
					if (this.position.y <= this.closedY) {
						this.position.y = this.closedY;
						this.state = GS.DoorStates.Closed;
					}
				} else {
					this.sector.doorOpenedEver = true;
					this.state = GS.DoorStates.Opening;
				}
				break;
		}

		this.usable = (this.state === GS.DoorStates.Closed && this._automatic === true);

		if (velocity.y !== 0) {
			this.updateBoundingBox();
			this.updateTriangles(velocity);
			this.updateSegments(velocity.y);
			this.updateMesh();
		}

		if (!this.sector.useVertexColors) {
			this.getLightColorFromSector(this.lightColor, this.sector);
			for (var i = 0; i < this.view.mesh.children.length; i++) {
				var material = this.view.mesh.children[i].material;
				if (material.emissive !== undefined) {
					material.emissive.copy(this.lightColor);
				}
			}
		}
	},

	updateMesh: function() {
		for (var i = 0; i < this.view.mesh.children.length; i++) {
			this.view.mesh.children[i].position.copy(this.position);
		}
	},

	onUse: function() {
		if (this.state == GS.DoorStates.Closed) {
			this.sector.doorOpenedEver = true;
			this.state = GS.DoorStates.Opening;
			this.grid.soundManager.playSound("door_open");
			this.grid.aiManager.onPlayerOpenDoor(this);
		}
	},

	open: function() {
		this.sector.doorOpenedEver = true;
		this.state = GS.DoorStates.Opening;
		this.grid.soundManager.playSound("door_open");

		return this;
	},

	openSilent: function() {
		this.sector.doorOpenedEver = true;
		this.state = GS.DoorStates.Opening;

		return this;
	},

	close: function() {
		this.state = GS.DoorStates.Closing;
		this.grid.soundManager.playSound("door_close");

		return this;
	},

	set automatic(value) {
		this._automatic = value;
		this.usable = (this._automatic === true);
	},

	get automatic() {
		return this._automatic;
	},
});
;GS.ElevatorStates = {
	Down: 0,
	Up: 1,
	GoindDown: 2,
	GoingUp: 3,
};

GS.Elevator = function(grid, sector) {
	GS.GridObject.call(this, grid);

	this.sector = sector;
	this.speed = 0.25;
	this.state = GS.ElevatorStates.Down;
	this.automatic = true;
	this.lightColor = new THREE.Color();

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
			triangles: null,
			segments: null,
		},
	};

	this.maxCooldown = GS.msToFrames(0);
	this.cooldown = this.maxCooldown;

	this.velocity = new THREE.Vector3();
};

GS.Elevator.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Elevator,

	init: function() {
		this.downY = this.position.y;
		this.upY = this.downY + this.sector.elevatorMaxHeight;

		this.updateBoundingBox();
	},

	update: function() {
		this.velocity.set(0, 0, 0);
		var oldY = 0;

		switch (this.state) {
			case GS.ElevatorStates.Down:
				if (this.automatic) {
					this.cooldown--;
					if (this.cooldown <= 0) {
						this.cooldown = this.maxCooldown;
						this.state = GS.ElevatorStates.GoingUp;
					}
				}
				break;

			case GS.ElevatorStates.Up:
				if (this.automatic) {
					this.cooldown--;
					if (this.cooldown <= 0) {
						this.cooldown = this.maxCooldown;
						this.state = GS.ElevatorStates.GoingDown;
					}
				}
				break;

			case GS.ElevatorStates.GoingDown:
				oldY = this.position.y;
				this.position.y -= this.speed;
				if (this.position.y <= this.downY) {
					this.position.y = this.downY;
					this.velocity.y = this.downY - oldY;
					this.state = GS.ElevatorStates.Down;
					this.grid.soundManager.playSound("elevator_stop");
				} else {
					this.velocity.y = -this.speed;
				}
				break;

			case GS.ElevatorStates.GoingUp:
				oldY = this.position.y;
				this.position.y += this.speed;
				if (this.position.y >= this.upY) {
					this.position.y = this.upY;
					this.velocity.y = this.upY - oldY;
					this.state = GS.ElevatorStates.Up;
					this.grid.soundManager.playSound("elevator_stop");
				} else {
					this.velocity.y = this.speed;
				}
				break;
		}

		this.updateChange();
	},

	updateChange: function() {
		if (this.velocity.y !== 0) {
			this.updateBoundingBox();
			this.updateTriangles(this.velocity);
			this.updateSegments(this.velocity.y);
			this.updateSector(this.velocity.y);
			this.updateMesh();

			this.grid.collisionManager.elevatorMove(this, this.velocity.y);
		}

		if (!this.sector.useVertexColors) {
			this.getLightColorFromSector(this.lightColor, this.sector);
			for (var i = 0; i < this.view.mesh.children.length; i++) {
				var material = this.view.mesh.children[i].material;
				if (material.emissive !== undefined) {
					material.emissive.copy(this.lightColor);
				}
			}
		}
	},

	updateSector: function(yVelocity) {
		this.sector.floorTopY += yVelocity;
		this.sector.ceilBottomY += yVelocity;
	},

	setPositionUp: function() {
		this.velocity.y = this.upY - this.position.y;
		this.position.y = this.upY;
		this.state = GS.ElevatorStates.Up;

		this.updateChange();

		return this;
	},

	setPositionDown: function() {
		this.velocity.y = this.downY - this.position.y;
		this.position.y = this.downY;
		this.state = GS.ElevatorStates.Down;

		this.updateChange();

		return this;
	},

	goDown: function(emit = true) {
		this.state = GS.ElevatorStates.GoingDown;
		this.grid.soundManager.playSound("elevator_move");

		return this;
	},

	goUp: function(emit = true) {
		this.state = GS.ElevatorStates.GoingUp;
		this.grid.soundManager.playSound("elevator_move");

		return this;
	},

	updateMesh: function() {
		for (var i = 0; i < this.view.mesh.children.length; i++) {
			this.view.mesh.children[i].position.copy(this.position);
		}
	},

	onUse: function() {
		if (this.state == GS.ElevatorStates.Closed) {
			this.state = GS.ElevatorStates.Opening;
		}
	},
});
;GS.Item = function(grid, layer, sourceObj) {
	GS.GridObject.apply(this, arguments);

	this.size = new THREE.Vector3(5, 5, 5);
	this.scale = new THREE.Vector3(0.4, 0.4, 0.4);
	this.offset = new THREE.Vector3(4, 3, 4);

	this.animation = {
		rotationSpeed: 0.01,
		floatYDelta: 0.25,
		floatAngle: 0,
		floatSpeed: 2,
	};

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
		}
	};
};

GS.Item.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Item,

	init: function() {
		this.updateBoundingBox();
		this.sector = this.getSector();
		this.getLightColorFromSector(this.view.mesh.material.emissive, this.sector);
	},

	update: function() {
		this.updateLightLevel();

		this.view.mesh.rotation.y += this.animation.rotationSpeed;		
		this.animation.floatAngle += this.animation.floatSpeed;

		var pos = this.view.mesh.position;
		pos.y = this.position.y + this.animation.floatYDelta * Math.sin(Math.PI / 180 * this.animation.floatAngle);
	},

	updateLightLevel: function() {
		this.getLightColorFromSector(this.view.mesh.material.emissive, this.sector);
	},

	updateCollisionData: function(newPos) {
		this.position.copy(newPos);
		this.view.mesh.position.copy(this.position);
		this.updateBoundingBox();
	},

	remove: function() {
		this.grid.removeEntityMesh(this.view.mesh);
		GS.GridObject.prototype.remove.call(this);
	},
});;GS.MonsterStates = {
	Scripted: 0,
	Inactive: 1,
	Awake: 2,
	Active: 3,
};

GS.Monster = function(grid, layer, sourceObj) {
	GS.GridObject.apply(this, arguments);

	this.monsterType = GS.MapEntities[sourceObj.type].name;
	$.extend(true, this, GS.Monsters[this.monsterType]);

	this.xAngle = THREE.Math.degToRad(360 - sourceObj.rotation);
	this.direction = new THREE.Vector3();

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
			boundingSquare: new THREE.Box2(),
			ellipsoid: this.size,
			triangles: null,
		}
	};

	this.dead = false;
	this.health = this.maxHealth;
	this.scatterCooldown = 0;
	this.state = GS.MonsterStates.Inactive;
	this.moving = false;
	this.inPain = false;

	this.changeTargetMaxCooldown = GS.msToFrames(500);
	this.changeTargetCooldown = 1;
	this.meleeAttackCooldown = 0;
	this.rangedAttackCooldown = Math.floor(Math.random() * this.rangedAttackCooldownRandomModifier);
	this.rangedAttackChargeCooldown = 0;
	this.chargingUpRangedAttack = false;
};

GS.Monster.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Monster,

	init: function() {
		this.animationView = new GS.AnimationView(this);
		this.animationView.init();
		this.animationView.setLoop("inactive");

		this.updateBoundingBox();
		this.updateMesh();

		this.sector = this.getSector();
	},

	update: function() {
		this.animationView.update();

		if (!this.dead) {
			if (this.state === GS.MonsterStates.Awake) {
				this.updateScan();
			} else
			if (this.state === GS.MonsterStates.Active) {
				this.updateMove();

				if (this.attackType === GS.MonsterAttackTypes.Melee) {
					this.updateAttackMelee();
				} else
				if (this.attackType === GS.MonsterAttackTypes.Ranged) {
					this.updateAttackRanged();
				}
			}
		}

		this.updateLightLevel();
	},

	updateLightLevel: function() {
		this.getLightColorFromSector(this.animationView.currentMesh.material.emissive, this.sector);
	},

	updateMesh: function() {
		this.view.mesh.position.copy(this.position);
		this.view.mesh.position.y += this.animationView.positionYOffset;
		this.view.mesh.rotation.y = this.xAngle + this.rotationOffset + this.animationView.rotationYOffset;
	},

	updateScan: function() {
		var target = this.grid.player;

		if (this.inMeleeRange(target.position)) {
			this.activate();
			return;
		}

		if (this.isFacing(target.position)) {
			this.activate();
			return;
		}

		this.updateMesh();
	},

	updateMove: function() {
		var target = this.grid.player;

		if (!this.chargingUpRangedAttack) {
			if (this.scatterCooldown > 0) {
				this.scatterCooldown--;
			} else {
				if (target.dead) {
					this.scatter();
				} else
				if (this.attackType === GS.MonsterAttackTypes.Melee) {
					this.updateMoveMelee();
				} else
				if (this.attackType === GS.MonsterAttackTypes.Ranged) {
					this.updateMoveRanged();
				}
			}

			if (!this.inPain) {
				this.move();
			} else {
				this.updateMesh();
			}
		} else {
			this.calculateDirection(target.position);
			this.calculateRotation();
			this.updateMesh();
		}
	},

	updateMoveMelee: function() {
		var aux = new THREE.Vector3();
		var targetPos = new THREE.Vector3();

		return function() {
			var target = this.grid.player;

			if (this.changeTargetCooldown > 0) {
				this.changeTargetCooldown--;

				if (this.changeTargetCooldown === 0) {
					this.changeTargetCooldown = this.changeTargetMaxCooldown;
					targetPos.copy(target.position);

					var distanceToTarget = this.position.distanceTo(targetPos);
					if (distanceToTarget > 20) {
						aux.set(Math.random() - 0.5, 0, Math.random() - 0.5).normalize().multiplyScalar(20);
						targetPos.add(aux);
					}

					this.calculateDirection(targetPos);
					this.calculateRotation();
				}
			}
		}
	}(),

	updateMoveRanged: function() {
		var aux = new THREE.Vector3();
		var targetPos = new THREE.Vector3();

		return function() {
			var target = this.grid.player;

			if (this.changeTargetCooldown > 0) {
				this.changeTargetCooldown--;

				if (this.changeTargetCooldown === 0) {
					this.changeTargetCooldown = this.changeTargetMaxCooldown;

					targetPos.copy(target.position);
					var distanceToTarget = this.position.distanceTo(targetPos);
					if (distanceToTarget > 30 && distanceToTarget < this.preferredMaxDistance) {
						targetPos.copy(this.position);
						aux.set(Math.random() - 0.5, 0, Math.random() - 0.5).normalize().multiplyScalar(20);
						targetPos.add(aux);
					}

					this.calculateDirection(targetPos);
					this.calculateRotation();
				}
			}
		}
	}(),

	move: function() {
		var newPos = new THREE.Vector3();

		return function() {
			this.moving = true;
			newPos.copy(this.direction).multiplyScalar(this.speed).add(this.position);
			this.grid.collisionManager.collideMonster(this, this.position, newPos);
		}
	}(),

	updateAttackMelee: function() {
		var target = this.grid.player;

		if (this.meleeAttackCooldown > 0) {
			this.meleeAttackCooldown--;
		} else {
			if (!target.dead && !this.inPain) {
				if (this.inMeleeRange(target.position) && this.isFacing(target.position) &&
					this.grid.collisionManager.checkMonsterLineOfSight(this, target, this.meleeRange)) {

					this.meleeAttack();
				}
			}
		}
	},

	meleeAttack: function() {
		var target = this.grid.player;

		this.grid.soundManager.playSound("monster_bite");
		this.meleeAttackCooldown = this.meleeAttackMaxCooldown;
		target.onHit({ damage: this.meleeDamage });
		this.grid.addEntityImpactParticles(target.position, target.bloodColor);
	},

	updateAttackRanged: function() {
		var target = this.grid.player;

		if (this.rangedAttackCooldown > 0) {
			this.rangedAttackCooldown--;
		} else {
			if (!target.dead && !this.inPain) {
				if (this.rangedAttackChargeCooldown > 0) {
					this.rangedAttackChargeCooldown--;

					if (this.rangedAttackChargeCooldown === 0) {
						this.rangedAttack();
					}
				} else
				if (this.isFacing(target.position) &&
					this.grid.collisionManager.checkMonsterLineOfSight(this, target, this.rangedAttackRange)) {

					this.chargeUpRangedAttack();
				}
			}
		}
	},

	chargeUpRangedAttack: function() {
		this.grid.soundManager.playSound(this.rangedAttackChargeUpSound);
		this.moving = false;
		this.chargingUpRangedAttack = true;
		this.rangedAttackChargeCooldown = this.rangedAttackChargeMaxCooldown;
		this.animationView.setLoop("attack");
	},

	cancelRangedAttack: function() {
		this.chargingUpRangedAttack = false;
		this.rangedAttackChargeCooldown = 0;
		this.animationView.setLoop("walk");
	},

	rangedAttack: function() {
		var direction = new THREE.Vector3();

		return function() {
			this.moving = false;
			var target = this.grid.player;

			this.chargingUpRangedAttack = false;
			this.animationView.setLoop("walk");

			this.rangedAttackCooldown = this.rangedAttackMaxCooldown +
				Math.floor(Math.random() * this.rangedAttackCooldownRandomModifier);

			direction.copy(target.position).sub(this.position).normalize();
			this.grid.addProjectile(this, this.rangedAttackProjectile, this.position.clone(), direction.clone());
		}
	}(),

	inMeleeRange: function(pos) {
		return this.position.distanceTo(pos) < this.meleeRange;
	},

	inRangedAttackRange: function(pos) {
		return this.position.distanceTo(pos) < this.rangedAttackRange;
	},

	isFacing: function() {
		var p = new THREE.Vector2();
		var t = new THREE.Vector2();
		var a = new THREE.Vector2();
		var b = new THREE.Vector2();

		return function(pos) {
			this.position.toVector2(p);
			pos.toVector2(t);
			var x = this.xAngle + this.rotationOffset;
			a.set(Math.sin(x - Math.PI / 2), Math.cos(x - Math.PI / 2)).add(p);
			b.set(Math.sin(x + Math.PI / 2), Math.cos(x + Math.PI / 2)).add(p);

			return GS.MathHelper.vec2PointSide(a, b, t);
		}
	}(),

	scatter: function() {
		var target = this.grid.player;

		if (this.scatterCooldown > 20) {
			return;
		}

		var distance = target.position.distanceTo(this.position);
		if (target.dead || distance > 10 * (1 + this.scale.x)) {
			this.direction = new THREE.Vector3(Math.random() * 2 - 1, 0, Math.random() * 2 - 1);
			this.direction.normalize();
			this.calculateRotation();

			this.scatterCooldown = 30;
		}
	},

	calculateDirection: function(targetPos) {
		this.direction.copy(targetPos).sub(this.position);
		this.direction.y = 0;
		this.direction.normalize();
	},

	calculateRotation: function() {
		this.xAngle = Math.atan2(this.direction.x, this.direction.z) + Math.PI;
	},

	updateCollisionData: function() {
		var velocity = new THREE.Vector3();

		return function(newPos) {
			velocity.copy(newPos).sub(this.position);
			var currentSpeed = newPos.distanceTo(this.position);

			this.position.copy(newPos);
			this.updateTriangles(velocity);
			this.updateBoundingBox();
			this.updateMesh();

			if (currentSpeed / this.speed < 0.1) {
				this.scatter();
			}

			this.sector = this.getSector();
		}
	}(),

	wakeUp: function(script) {
		if (this.state === GS.MonsterStates.Awake) {
			return;
		}

		if (script !== true && this.state === GS.MonsterStates.Scripted) {
			return;
		}

		this.state = GS.MonsterStates.Awake;
		this.animationView.setLoop("inactive");
	},

	activate: function(script) {
		if (this.state === GS.MonsterStates.Active) {
			return;
		}

		if (script !== true && this.state === GS.MonsterStates.Scripted) {
			return;
		}

		this.state = GS.MonsterStates.Active;
		this.animationView.setLoop("walk");
		this.grid.soundManager.playSound(this.roarSound);
	},

	onHit: function(projectile) {
		if (this.state !== GS.MonsterStates.Active) {
			this.activate(true);
		}

		if (Math.random() <= this.painChance) {
			this.inPain = true;
			this.moving = false;

			if (this.attackType === GS.MonsterAttackTypes.Ranged) {
				this.cancelRangedAttack();
			}

			this.animationView.pain();
			this.grid.soundManager.playSound(this.painSound);
		}

		this.health -= projectile.damage;
		if (this.health < 0) {
			this.health = 0;
			this.onDeath();
		}
	},

	onDeath: function() {
		this.moving = false;

		var target = this.grid.player;
		this.calculateDirection(target.position);
		this.calculateRotation();

		this.dead = true;
		this.grid.soundManager.playSound(this.deathSound);
		this.grid.aiManager.onMonsterDeath();
		this.animationView.setLoop("death");
		this.updateMesh();
	},
});
;GS.OnlinePlayerStates = {
	Scripted: 0,
	Inactive: 1,
	Awake: 2,
	Active: 3,
};

GS.OnlinePlayer = function(grid, layer, sourceObj) {
	GS.GridObject.apply(this, arguments);

	this.monsterType = "nom";
	$.extend(true, this, GS.Monsters[this.monsterType]);

  this.id = sourceObj.id;
	this.xAngle = THREE.Math.degToRad(360 - sourceObj.rotation);
	this.direction = new THREE.Vector3();

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
			boundingSquare: new THREE.Box2(),
			ellipsoid: this.size,
			triangles: null,
		}
	};

	this.dead = false;
	this.health = this.maxHealth;
	this.scatterCooldown = 0;
	this.state = GS.OnlinePlayerStates.Active;
	this.moving = false;
	this.inPain = false;

	this.changeTargetMaxCooldown = GS.msToFrames(500);
	this.changeTargetCooldown = 1;
	this.meleeAttackCooldown = 0;
	this.rangedAttackCooldown = Math.floor(Math.random() * this.rangedAttackCooldownRandomModifier);
	this.rangedAttackChargeCooldown = 0;
	this.chargingUpRangedAttack = false;
};

GS.OnlinePlayer.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.OnlinePlayer,

	init: function() {
		this.animationView = new GS.AnimationView(this);
		this.animationView.init();
		this.animationView.setLoop("walk");

		this.updateBoundingBox();
		this.updateMesh();

		this.sector = this.getSector();

	},

	update: function() {
		this.animationView.update();

		if (!this.dead) {
      this.updateMove();
    }

			// if (this.state === GS.OnlinePlayerStates.Awake) {
				// this.updateScan();
			// } else if (this.state === GS.OnlinePlayerStates.Active) {
		// 		if (this.attackType === GS.OnlinePlayerAttackTypes.Melee) {
		// 			this.updateAttackMelee();
		// 		} else
		// 		if (this.attackType === GS.OnlinePlayerAttackTypes.Ranged) {
		// 			this.updateAttackRanged();
		// 		}
			// }
		// }

		this.updateLightLevel();
	},

	updateLightLevel: function() {
		this.getLightColorFromSector(this.animationView.currentMesh.material.emissive, this.sector);
	},

	updateMesh: function() {
		this.view.mesh.position.copy(this.position);
		this.view.mesh.position.y += this.animationView.positionYOffset;
		this.view.mesh.rotation.y = this.xAngle + this.rotationOffset + this.animationView.rotationYOffset;
	},

	// updateScan: function() {
	// 	var target = this.grid.player;

	// 	if (this.inMeleeRange(target.position)) {
	// 		this.activate();
	// 		return;
	// 	}

	// 	if (this.isFacing(target.position)) {
	// 		this.activate();
	// 		return;
	// 	}

	// 	this.updateMesh();
	// },

  updateMove: function () {
			if (this.inPain) {
				this.updateMesh();
			}
      // this.move();
			// this.calculateDirection(target.position);
			this.calculateRotation();
  },
	onUpdateMove: function(updateClient) {
    if (!this.dead) {
      let oldPos = this.position.clone();
      this.position.set(updatedClient.x, updatedClient.y, updatedClient.z);
      let newPos = this.position.clone();
      GAME.onlineManager.checkZones(this, oldPos, newPos);
      let direction = updatedClient.direction;
      this.direction.set(direction.x, direction.y, direction.z);
      this.move();
    }
    // this.calculateDirection(target.position);
    // this.calculateRotation();
    // this.updateMesh();
	},

	onPlayerShoot: function() {
		var direction = new THREE.Vector3();

		return function() {
			// this.moving = false;
			// var target = this.grid.player;

			// this.chargingUpRangedAttack = false;
			// this.animationView.setLoop("walk");

			// this.rangedAttackCooldown = this.rangedAttackMaxCooldown +
				// Math.floor(Math.random() * this.rangedAttackCooldownRandomModifier);

			// direction.copy(this.position).sub(this.position).normalize();
			this.grid.addProjectile(this, "pistol_bolt", this.position.clone(), this.direction.clone());
		}
	}(),

	move: function() {
		var newPos = new THREE.Vector3();

		return function() {
			this.moving = true;
			newPos.copy(this.direction).multiplyScalar(this.speed).add(this.position);
			this.grid.collisionManager.collideOnlinePlayer(this, this.position, newPos);
		}
	}(),

	chargeUpRangedAttack: function() {
		this.grid.soundManager.playSound(this.rangedAttackChargeUpSound);
		this.moving = false;
		this.chargingUpRangedAttack = true;
		this.rangedAttackChargeCooldown = this.rangedAttackChargeMaxCooldown;
		this.animationView.setLoop("attack");
	},

	cancelRangedAttack: function() {
		this.chargingUpRangedAttack = false;
		this.rangedAttackChargeCooldown = 0;
		this.animationView.setLoop("walk");
	},

	inMeleeRange: function(pos) {
		return this.position.distanceTo(pos) < this.meleeRange;
	},

	inRangedAttackRange: function(pos) {
		return this.position.distanceTo(pos) < this.rangedAttackRange;
	},

	isFacing: function() {
		var p = new THREE.Vector2();
		var t = new THREE.Vector2();
		var a = new THREE.Vector2();
		var b = new THREE.Vector2();

		return function(pos) {
			this.position.toVector2(p);
			pos.toVector2(t);
			var x = this.xAngle + this.rotationOffset;
			a.set(Math.sin(x - Math.PI / 2), Math.cos(x - Math.PI / 2)).add(p);
			b.set(Math.sin(x + Math.PI / 2), Math.cos(x + Math.PI / 2)).add(p);

			return GS.MathHelper.vec2PointSide(a, b, t);
		}
	}(),

	calculateDirection: function(targetPos) {
		this.direction.copy(targetPos).sub(this.position);
		this.direction.y = 0;
		this.direction.normalize();
	},

	calculateRotation: function() {
		this.xAngle = Math.atan2(this.direction.x, this.direction.z) + Math.PI;
	},

	updateCollisionData: function() {
		var velocity = new THREE.Vector3();

		return function(newPos) {
			velocity.copy(newPos).sub(this.position);
			var currentSpeed = newPos.distanceTo(this.position);

			this.position.copy(newPos);
			this.updateTriangles(velocity);
			this.updateBoundingBox();
			this.updateMesh();

			if (currentSpeed / this.speed < 0.1) {
				// this.scatter();
			}

			this.sector = this.getSector();
		}
	}(),

	activate: function(script) {
		if (this.state === GS.OnlinePlayerStates.Active) {
			return;
		}

		if (script !== true && this.state === GS.OnlinePlayerStates.Scripted) {
			return;
		}

		this.state = GS.OnlinePlayerStates.Active;
		this.animationView.setLoop("walk");
		this.grid.soundManager.playSound(this.roarSound);
	},

	onHit: function(projectile) {
		if (this.state !== GS.OnlinePlayerStates.Active) {
			this.activate(true);
		}

		if (Math.random() <= this.painChance) {
			this.inPain = true;
			this.moving = false;

			if (this.attackType === GS.OnlinePlayerAttackTypes.Ranged) {
				this.cancelRangedAttack();
			}

			this.animationView.pain();
			this.grid.soundManager.playSound(this.painSound);
		}

		this.health -= projectile.damage;
		if (this.health < 0) {
			this.health = 0;
			this.onDeath();
		}
	},

	onRespawn: function() {
    if (!this.dead) {
      return;
    }
		this.moving = true;

		// var target = this.grid.player;
		// this.calculateDirection(target.position);
		this.calculateRotation();

		this.dead = false;
    // TODO respawn sound
		// this.grid.soundManager.playSound(this.deathSound);
		this.animationView.setLoop("walk");
		this.updateMesh();
	},

	onDeath: function() {
    if (this.dead) {
      return;
    }
		this.moving = false;

		// var target = this.grid.player;
		// this.calculateDirection(target.position);
		this.calculateRotation();

		this.dead = true;
		this.grid.soundManager.playSound(this.deathSound);
		GAME.onlineManager.onOnlinePlayerDeath(this.playerInfo);
		this.animationView.setLoop("death");
		this.updateMesh();
	},

  playerInfo: function () {
    return {
      id: this.id,
      x: this.position.x,
      y: this.position.y,
      z: this.position.z,
      direction: this.direction,
    };
  },

  setPosition: function (x, y, z, direction) {
    this.position.x = x,
    this.position.y = y
    this.position.z = z
    this.direction = direction
  }
});
;GS.Player = function(grid, camera, playerView) {
	GS.GridObject.call(this, grid);

	this.camera = camera;
	this.playerView = playerView;
	this.playerView.player = this;

	this.moveSpeed = 1.5;
	this.godEnabled = false;
	this.flyEnabled = false;
	this.noClipEnabled = false;
	this.inMenu = false;

	this.health = 100;
	this.dead = false;

	this.size = new THREE.Vector3(3, 7, 3);
	this.useRange = this.size.x + 15;
	this.bloodColor = new THREE.Color().setRGB(1, 0, 0).getHex();
	this.direction = new THREE.Vector3();

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
			boundingSquare: new THREE.Box2(),
			ellipsoid: this.size,
			triangles: null,
		},
	};

	this.moving = false;
	this.shooting = false;
	this.canUse = true;

	this.ySmoothingMaxCooldown = GS.msToFrames(500);
	this.ySmoothingCooldown = 0;

	this.swapWeaponsOnPickup = true;
};

GS.Player.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Player,

	init: function() {
		var that = this;

		this.availableWeapons = $.extend(true, {}, GS.Weapons);
		Object.keys(this.availableWeapons).forEach(function(key) {
			that.availableWeapons[key].pickedUp = false;
			that.availableWeapons[key].cooldownRemaining = 0;
		});

		this.computeYFromSector();
		this.initTriangles();
		this.updateBoundingBox();

		this.controls = new GS.FPSControls(this.camera);


		this.controls.eye.copy(this.position);
		this.controls.followingEye.copy(this.position);
		this.controls.moveSpeed = this.moveSpeed;
		this.controls.init();

		this.controls.onHandleCollisions = function(oldPos, newPos) {
			if (!that.noClipEnabled) {
				that.grid.collisionManager.collidePlayer(that, oldPos, newPos);
			} else {
				that.updateCollisionData(newPos);
			}
		};

		that.availableWeapons.pistol.pickedUp = true;
		that.availableWeapons.pistol.cooldownRemaining = 0;

		this.weapon = this.availableWeapons.pistol;
		this.weaponName = "pistol";
		this.playerView.changeToWeaponInstant("pistol");
	},

	getPersistencePackage: function() {
		var pkg = {
			health: this.health,
			weapons: {},
			currentWeapon: this.weaponName,
		};

		for (var i in this.availableWeapons) {
			pkg.weapons[i] = {};
			pkg.weapons[i].pickedUp = this.availableWeapons[i].pickedUp;
			pkg.weapons[i].ammo = this.availableWeapons[i].ammo;
		}

		return pkg;
	},

	applyPersistencePackage: function(pkg) {
		this.health = pkg.health;

		for (var i in this.availableWeapons) {
			this.availableWeapons[i].pickedUp = pkg.weapons[i].pickedUp;
			this.availableWeapons[i].ammo = pkg.weapons[i].ammo;
		}

		this.weapon = this.availableWeapons[pkg.currentWeapon];
		this.weaponName = pkg.currentWeapon;
		this.playerView.changeToWeaponInstant(pkg.currentWeapon);
	},

	giveAll: function() {
		var that = this;
		Object.keys(this.availableWeapons).forEach(function(key) {
			var weapon = that.availableWeapons[key];

			weapon.pickedUp = true;
			weapon.cooldownRemaining = 0;

			if (!weapon.infiniteAmmo) {
				weapon.ammo = weapon.ammoMax;
			}
		});
	},

	fly: function(value) {
		if (value === undefined) {
			this.flyEnabled = !this.flyEnabled;
		} else {
			this.flyEnabled = value;
		}

		this.controls.fly = this.flyEnabled;
		if (this.flyEnabled) {
			this.playerView.viewBob.enabled = false;
			this.playerView.weaponBob.enabled = false;
		} else {
			this.playerView.viewBob.enabled = true;
			this.playerView.weaponBob.enabled = true;
		}
	},

	noClip: function(value) {
		if (value === undefined) {
			this.noClipEnabled = !this.noClipEnabled;
		} else {
			this.noClipEnabled = value;
		}
	},

	god: function(value) {
		if (value === undefined) {
			this.godEnabled = !this.godEnabled;
		} else {
			this.godEnabled = value;
		}
	},

	initTriangles: function() {
		var triangles = GS.Cube.getVertices();
		for (var i = 0; i < triangles.length; i++) {
			triangles[i].multiply(this.size).add(this.position);
		}
		this.view.collisionData.triangles = triangles;
	},

	update: function() {
		if (!this.dead) {
			this.updateControls();
			this.updateUse();
			this.updateShoot();
			this.updateChangeWeapon();
		}
	},

	afterCollision: function(result) {
		if (result.climbing && !(result.gridObject instanceof GS.Elevator)) {
			this.ySmoothingCooldown = this.ySmoothingMaxCooldown;
		}
	},

	onHit: function(projectile) {
		if (!this.godEnabled) {
			this.health -= projectile.damage;
			if (this.health <= 0) {
				this.health = 0;
				this.onDeath({ killId: projectile.sourceGridObject.id });
			}
			this.playerView.onDamage();
		}
	},

	onDeath: function(data) {
		this.dead = true;
		this.grid.soundManager.playSound("player_death");

		if (this.weapon !== undefined) {
			this.playerView.onDeath();
		}

    if (GAME.onlinePlay) {
      GAME.onlineManager.playerDie(data);
    }
	},

	onItemCollision: function(item) {
		var name = GS.MapEntities[item.sourceObj.type].name;

		if (this.pickupWeapon(name) || this.pickupAmmo(name) || this.pickupMedkit(name)) {
			this.grid.aiManager.onPlayerItemPickup(this, item);
      if (GAME.onlinePlay) {
        GAME.onlineManager.playerPickup(item);
      }
			item.remove();
			this.playerView.onItemPickup();
		}
	},

	pickupWeapon: function(name) {
		if (this.availableWeapons[name] !== undefined) {
			var weapon = this.availableWeapons[name];

			if (!weapon.pickedUp) {
				weapon.pickedUp = true;

				GS.DebugUI.addTempLine("picked up " + weapon.name);

				if (this.weapon === undefined ||
					this.swapWeaponsOnPickup && weapon.powerLevel > this.weapon.powerLevel) {
					this.weapon = weapon;
					this.weaponName = name;
					this.playerView.changeToWeapon(name);
				}
			}

			weapon.ammo += weapon.ammoClip;
			this.grid.soundManager.playSound("pickup_weapon");
			if (weapon.ammo > weapon.ammoMax) {
				weapon.ammo = weapon.ammoMax;
			}

			GS.DebugUI.addTempLine("picked up " + weapon.ammoClip + " " + weapon.name + " ammo");

			return true;
		}
		return false;
	},

	pickupAmmo: function(name) {
		var that = this;
		var once = false;

		if (name == "ammo") {
			Object.keys(this.availableWeapons).forEach(function(key) {
				var weapon = that.availableWeapons[key];

				if (!weapon.infiniteAmmo && weapon.ammo < weapon.ammoMax) {
					weapon.ammo += weapon.ammoClip;
					if (weapon.ammo > weapon.ammoMax) {
						weapon.ammo = weapon.ammoMax;
					}

					GS.DebugUI.addTempLine("picked up " + weapon.ammoClip + " " + weapon.name + " ammo");
					once = true;
				}
			});

			if (once) {
				this.grid.soundManager.playSound("pickup_ammo");
				return true;
			}
		}

		return false;
	},

	pickupMedkit: function(name) {
		var that = this;
		if (name == "medkit" && this.health < 100) {
			GS.DebugUI.addTempLine("picked up medkit");

			this.health += 25;
			if (this.health > 100) {
				this.health = 100;
			}

			this.grid.soundManager.playSound("pickup_item");
			return true;
		}
		return false;
	},

	updateUse: function() {
		if (this.canUse && GS.Keybinds.use.inUse) {
      GAME.onlineManager.useTarget(this.useTarget);
			this.useTarget.onUse();
		}
	},

	updateShoot: function() {
		var that = this;
		if (this.weapon !== undefined) {
			if (this.weapon.cooldownRemaining > 0) {
				this.weapon.cooldownRemaining -= 1;
				return;
			}

			var oldShooting = this.shooting;
			if (GS.Keybinds.shoot.inUse && this.playerView.weaponReady) {
				if (this.weapon.infiniteAmmo || this.weapon.ammo > 0) {
					this.shooting = true;
					if (this.shooting && !oldShooting) {
						this.shootStart();
					}

					if (!this.weapon.infiniteAmmo) {
						this.weapon.ammo -= this.weapon.bulletsPerShot;
					}

					this.playerView.shoot();
					this.playShootSound();
					this.weapon.cooldownRemaining = GS.msToFrames(this.weapon.cooldown);

					var projectileStart = this.getProjectileStart();
					if (this.weapon.hitscan) {
						this.grid.collisionManager.hitscan(this, projectileStart, this.weapon, this.xAngle, this.yAngle);
					} else
					if (this.weaponName == "hyper_blaster") {
						this.grid.addProjectile(this, "hyper_blaster_bolt", projectileStart, this.direction.clone());
					} else
					if (this.weaponName == "pistol") {
						this.grid.addProjectile(this, "pistol_bolt", projectileStart, this.direction.clone());
					}
          // HACK I don't like this here
          if (GAME.onlinePlay) {
            GAME.onlineManager.playerShoot();
          }
				}

				if (!this.weapon.infiniteAmmo && this.weapon.ammo === 0) {
					this.trySwapToWeaponWithAmmo();
				}
			} else {
				this.shooting = false;
				if (!this.shooting && oldShooting) {
					this.shootEnd();
				}
			}
		}
	},

	playShootSound: function() {
		var name;
		if (this.weaponName == "double_shotgun") {
			name = "shotgun_fire";
		} else
		if (this.weaponName == "hyper_blaster") {
			name = "hyper_blaster_fire";
		} else
		if (this.weaponName == "pistol") {
			name = "hyper_blaster_fire";
		}

		this.grid.soundManager.playSound(name);
	},

	shootStart: function() {
		this.grid.aiManager.onPlayerShoot(this);
	},

	shootEnd: function() {
	},

	trySwapToWeaponWithAmmo: function() {
		var keys = Object.keys(this.availableWeapons);
		for (var i = keys.length - 1; i >= 0; i--) {
			var name = keys[i];
			var weapon = this.availableWeapons[name];
			if (weapon.pickedUp && (weapon.infiniteAmmo || weapon.ammo > 0)) {
				this.changeToWeapon(name);
				break;
			}
		}
	},

	getProjectileStart: function() {
		var projectileStart = this.position.clone();
		projectileStart.y += this.controls.eyeOffsetY;
		return projectileStart;
	},

	updateChangeWeapon: function() {
		var that = this;
		Object.keys(this.availableWeapons).forEach(function(key) {
			var weapon = that.availableWeapons[key];
			if (weapon.pickedUp && weapon !== that.weapon && that.weapon !== undefined && that.playerView.weaponReady) {
				if (GS.Keybinds[weapon.name].inUse) {
					that.changeToWeapon(key);
				}
			}
		});
	},

	changeToWeapon: function(name) {
		this.weapon = this.availableWeapons[name];
		this.weaponName = name;
		this.playerView.changeToWeapon(name);
	},

	updateControls: function(e) {
		if (this.ySmoothingCooldown > 0) {
			this.ySmoothingCooldown--;
			this.controls.ySmoothing = true;
		} else {
			this.controls.ySmoothing = false;
		}

		this.controls.update();

		this.direction.copy(this.controls.lookNoOffset).sub(this.controls.followingEye).normalize();
		this.xAngle = this.controls.xAngle;
		this.yAngle = this.controls.yAngle;

		// GS.DebugUI.setStaticLine("direction", this.direction.toString(2));

		this.playerView.update();
	},

	moveStart: function() {
	},

	moveEnd: function() {
	},

	updateCollisionData: function(newPos) {
		this.playerView.updateThrottle(this.position, newPos);
		var velocity = newPos.clone().sub(this.position);
		this.updateTriangles(velocity);

		var oldMoving = this.moving;
		this.moving = !this.position.equals(newPos);
		this.position.copy(newPos);
		this.controls.eye.copy(newPos);

		// GS.DebugUI.setStaticLine("position", newPos.toString());

		if (this.moving && !oldMoving) {
			this.moveStart();
		} else
		if (!this.moving && oldMoving) {
			this.moveEnd();
		}

		this.updateBoundingBox();
	},
});
;GS.Projectile = function(grid, sourceGridObject, type, position, direction) {
	GS.GridObject.call(this, grid);

	$.extend(true, this, GS.Projectiles[type]);

	this.sourceGridObject = sourceGridObject;
	this.type = type;
	this.position = position;
	this.direction = direction;

	this.steps = 0;
	this.maxSteps = Math.floor(this.maxDistance / this.speed);

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
			ellipsoid: this.size,
		},
	};
};

GS.Projectile.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Projectile,

	init: function() {
		var that = this;

		this.updateBoundingBox();

		this.particle = this.grid.particleView.addParticle(this.visualSize.x, this.visualSize.y, this.visualSize.z, this.color);

		this.view.mesh = this.particle.mesh;
		this.view.mesh.lookAt(this.direction);
		this.view.mesh.visible = false;
		//this.view.mesh.rotation.z = Math.random() * Math.PI;

		var points = [
			new THREE.Vector2(this.position.x - this.size.x, this.position.z - this.size.z),
			new THREE.Vector2(this.position.x + this.size.x, this.position.z + this.size.z),
		];
		var gridLocation = this.grid.getGridLocationFromPoints(points);
		this.assignToCells(gridLocation);
	},

	update: function() {
		this.steps++;

		var newPos = this.position.clone().add(this.direction.clone().multiplyScalar(this.speed));
		this.grid.collisionManager.collideProjectile(this, this.position, newPos);

		this.view.mesh.position.copy(this.position);

		if (this.rotating) {
			this.view.mesh.rotation.x += 0.1;
			this.view.mesh.rotation.y += 0.1;
		}

		if (this.steps > this.maxSteps || this.linkedGridCells.length === 0) {
			this.remove();
		}
	},

	updateCollisionData: function(newPos) {
		this.distanceTravelled += newPos.distanceTo(this.position);

		if (this.steps > 1) {
			this.view.mesh.visible = true;
		}

		this.position.copy(newPos);
		this.updateBoundingBox();
	},

	onHit: function() {
		this.grid.soundManager.playSound(this.hitSound);
		this.remove();
	},

	remove: function() {
		this.particle.toBeRemoved = true;
		GS.GridObject.prototype.remove.call(this);
	},
});;GS.Spawn = function(grid, layer, sourceObj) {
	GS.GridObject.apply(this, arguments);

	this.size = new THREE.Vector3(5, 5, 5);
	this.scale = new THREE.Vector3(0.4, 0.4, 0.4);
	this.offset = new THREE.Vector3(4, 3, 4);

	this.animation = {
		rotationSpeed: 0.01,
		floatYDelta: 0.25,
		floatAngle: 0,
		floatSpeed: 2,
	};

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
		}
	};
};

GS.Spawn.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Spawn,

	init: function() {
		this.updateBoundingBox();
		this.sector = this.getSector();
		// this.getLightColorFromSector(this.view.mesh.material.emissive, this.sector);
	},

	update: function() {
		// this.updateLightLevel();

		// this.view.mesh.rotation.y += this.animation.rotationSpeed;
		// this.animation.floatAngle += this.animation.floatSpeed;

		var pos = this.view.mesh.position;
		pos.y = this.position.y + this.animation.floatYDelta * Math.sin(Math.PI / 180 * this.animation.floatAngle);
	},

	updateLightLevel: function() {
		this.getLightColorFromSector(this.view.mesh.material.emissive, this.sector);
	},

	updateCollisionData: function(newPos) {
		this.position.copy(newPos);
		this.view.mesh.position.copy(this.position);
		this.updateBoundingBox();
	},

	remove: function() {
		this.grid.removeEntityMesh(this.view.mesh);
		GS.GridObject.prototype.remove.call(this);
	},
});
;GS.Switch = function(grid, seg) {
	GS.GridObject.call(this, grid);

	this.segment = seg;
	this.on = false;
	this.usable = true;

	this.view = {
		collisionData: {
			boundingBox: new THREE.Box3(),
		},
	};
};

GS.Switch.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.Switch,

	init: function() {
	},

	onUse: function() {
		this.on = true;
		this.view.mesh.material.map = this.view.textureOn;
		this.usable = false;
		this.grid.aiManager.onSwitchStateChange(this);
    GAME.onlineManager.switchStateChange(this);
		this.grid.soundManager.playSound("switch_on");
	},

	block: function() {
		this.on = true;
		this.view.mesh.material.map = this.view.textureOn;
		this.usable = false;
	},
});
;GS.TVScreen = function(grid, seg) {
	GS.GridObject.call(this, grid);

	this.segment = seg;

	this.view = {
	};
};

GS.TVScreen.prototype = GS.inherit(GS.GridObject, {
	constructor: GS.TVScreen,

	init: function() {
	},
});;GS.FontLoader = function() {
	this.fontPath = "";
};

GS.FontLoader.prototype = {
	constructor: GS.FontLoader,

	load: function(name, filename, callback) {
		var that = this;
		var path = this.fontPath + filename;

		$("head").prepend([
				"<style type='text/css'>",
					"@font-face {",
						"font-family: '" + name + "';",
						"src: url('" + path + "') format('woff');",
						"font-weight: normal;",
						"font-style: normal;",
					"}",
				"</style>",
			].join("\n"));

		// http://stackoverflow.com/a/11689060/3640489
		var node = document.createElement("span");
		node.innerHTML = "giItT1WQy@!-/#";
		node.style.position = "absolute";
		node.style.left = "-10000px";
		node.style.top = "-10000px";
		node.style.fontSize = "300px";
		node.style.fontFamily = "sans-serif";
		node.style.fontVariant = "normal";
		node.style.fontStyle = "normal";
		node.style.fontWeight = "normal";
		node.style.letterSpacing = "0";
		document.body.appendChild(node);

		var width = node.offsetWidth;
		node.style.fontFamily = name;

		var intervalId = setInterval(function() {
			if (node.offsetWidth != width) {
				node.parentNode.removeChild(node);
				clearInterval(intervalId);
				callback();
			}
		}, 50);
	},
};;GS.MapScripts = {};

GS.MapLoader = function() {
	this.mapPath = "assets/maps/";
};

GS.MapLoader.prototype = {
	constructor: GS.MapLoader,

	loadTestMap: function() {
		var testMap = window.localStorage.testMap;

		if (!testMap) {
			alert("testMap not found in localStorage");
		}

		return testMap;
	},

	load: function(name, filename, callback) {
		var that = this;
		var path = this.mapPath + filename;

		$.ajax({
			url: path,
			dataType: "text",
			success: function(jsonStr) {
				callback(jsonStr);
			},
			error: function(jqXHR, textStatus, errorThrown) {
				throw errorThrown;
			}
		});
	},

	parse: function(text) {
		var map;

		try {
			map = JSON.parse(text, function(k, v) {
				if (v instanceof Object) {
					if (v.x !== undefined && v.y !== undefined && v.z !== undefined) {
						return new THREE.Vector3(v.x, v.y, v.z);
					} else
					if (v.x !== undefined && v.y !== undefined) {
						return new THREE.Vector2(v.x, v.y);
					}
				}
				return v;
			});
		}
		catch (ex) {
			GAME.handleFatalError("invalid map - parse error");
		}

		map.bounds = this.getMapBounds(map);

		return map;
	},

	getMapBounds: function(map) {
		var points = [];

		if (!map.layerObjects) {
			GAME.handleFatalError("invalid map - no layer objects");
		}

		var segs = map.layerObjects[GS.MapLayers.Segment];
		for (var i = 0; i < segs.length; i++) {
			var seg = segs[i];
			points.push(new THREE.Vector2().copy(seg.start));
			points.push(new THREE.Vector2().copy(seg.end));
		}

		var sectors = map.layerObjects[GS.MapLayers.Sector];
		for (var i = 0; i < sectors.length; i++) {
			var sector = sectors[i];

			for (var j = 0; j < sector.vertices.length; j++) {
				var vertex = sector.vertices[j];
				points.push(new THREE.Vector2().copy(vertex));
			}
		}

		var bounds = new THREE.Box2();
		bounds.setFromPoints(points);
		return bounds;
	},
};;GS.ZipAssetLoader = function(audioContext) {
	this.audioContext = audioContext;
	this.objLoader = new THREE.OBJLoader();
	this.mapLoader = new GS.MapLoader();

	this.fontLoader = new GS.FontLoader();
	this.fontLoader.fontPath = "";

	this.zipPath = "assets.zip";

	this.path = {};
	this.path[GS.AssetTypes.Texture] = "textures/";
	this.path[GS.AssetTypes.CubeTexture] = "textures/";
	this.path[GS.AssetTypes.UIWidget] = "textures/widgets/";
	this.path[GS.AssetTypes.Mesh] = "meshes/";
	this.path[GS.AssetTypes.Sound] = "sounds/";
	this.path[GS.AssetTypes.Map] = "maps/";
	this.path[GS.AssetTypes.Script] = "scripts/";
	this.path[GS.AssetTypes.MusicTrack] = "music/";

	this.reset();
};

GS.ZipAssetLoader.prototype = {
	reset: function() {
		this.loaded = false;
		this.assetsToLoad = 0;
		this.queue = [];

		this.assets = {};
		this.assets[GS.AssetTypes.Texture] = {};
		this.assets[GS.AssetTypes.CubeTexture] = {};
		this.assets[GS.AssetTypes.UIWidget] = {};
		this.assets[GS.AssetTypes.Mesh] = {};
		this.assets[GS.AssetTypes.Sound] = {};
		this.assets[GS.AssetTypes.Map] = {};
		this.assets[GS.AssetTypes.Script] = {};
		this.assets[GS.AssetTypes.MusicTrack] = {};
	},

	init: function() {
		for (var j in GS.AssetTypes) {
			var assetDict = GS.Assets[GS.AssetTypes[j]];
			for (var i in assetDict) {
				this.add(i, assetDict[i].filename, GS.AssetTypes[j]);
			}
		}
	},

	add: function(name, filename, type) {
		this.queue.push({
			name: name,
			filename: filename,
			type: type,
		});
		this.assetsToLoad++;
	},

	loadZip: function() {
		var that = this;

		var xhr = new XMLHttpRequest();
		xhr.open("GET", this.zipPath, true);
		xhr.responseType = "arraybuffer";

		xhr.onreadystatechange = function(e) {
			if (this.readyState == 4 && this.status == 200) {
				that.zip = new JSZip(this.response);
				setTimeout(function() { that._load() }, 0);
			}
		};

		xhr.onprogress = function(e) { that.zipOnProgress(e); };

		xhr.send();
	},

	_load: function() {
		var that = this;

		this.totalAssets = this.queue.length + 1;
		this.assetsToLoad++;
		this.fontLoader.load("hudFont", GS.CustomFontFile, function() {
			that.checkIfFullyLoaded();
		});

		var asset;
		while (this.queue.length > 0) {
			asset = this.queue.pop();

			if (asset.name in this.assets[asset.type]) {
				this.assetsToLoad--;
				continue;
			}

			this.loadAsset(asset);
		}
	},

	load: function() {
		this.loadZip();
	},

	loadAsset: function(asset) {
		switch (asset.type) {
			case GS.AssetTypes.Texture:
				this.loadTexture(asset.name, asset.filename);
				break;
			case GS.AssetTypes.CubeTexture:
				this.loadCubeTexture(asset.name, asset.filename);
				break;
			case GS.AssetTypes.UIWidget:
				this.loadUIWidget(asset.name, asset.filename);
				break;
			case GS.AssetTypes.Mesh:
				this.loadMesh(asset.name, asset.filename);
				break;
			case GS.AssetTypes.Sound:
				this.loadSound(asset.name, asset.filename, GS.AssetTypes.Sound);
				break;
			case GS.AssetTypes.Map:
				this.loadMap(asset.name, asset.filename);
				break;
			case GS.AssetTypes.Script:
				this.loadScript(asset.name, asset.filename);
				break;
			case GS.AssetTypes.MusicTrack:
				this.loadSound(asset.name, asset.filename, GS.AssetTypes.MusicTrack);
				break;
		}
	},

	getImageFromZip: function(path) {
		var buffer = this.zip.file(path).asArrayBuffer();
		var blob = new Blob([buffer], { type: "image/png" });
		var urlCreator = window.URL || window.webkitURL;
		var imageUrl = urlCreator.createObjectURL(blob);

		var img = new Image();
		img.src = imageUrl;

		return img;
	},

	getTextureFromZip: function(path) {
		var img = this.getImageFromZip(path);
		var tex = new THREE.Texture(img);
		tex.needsUpdate = true;

		return tex;
	},

	loadTexture: function(name, filename) {
		var path = this.path[GS.AssetTypes.Texture] + filename;

		this.assets[GS.AssetTypes.Texture][name] = this.getTextureFromZip(path);
		this.checkIfFullyLoaded();
	},

	loadCubeTexture: function(name, folder) {
		var path = this.path[GS.AssetTypes.CubeTexture] + folder + "/";

		var tex = new THREE.Texture();
		tex.image = [];
		tex.flipY = false;

		for (var i = 0; i < GS.CubeTextureNames.length; i++) {
			tex.image[i] = this.getImageFromZip(path + GS.CubeTextureNames[i] + GS.CubeTextureExtension);
		}

		tex.needsUpdate = true;

		this.assets[GS.AssetTypes.CubeTexture][name] = tex;
		this.checkIfFullyLoaded();
	},

	loadUIWidget: function(name, filename) {
		var path = this.path[GS.AssetTypes.UIWidget] + filename;

		this.assets[GS.AssetTypes.UIWidget][name] = this.getImageFromZip(path);
		this.checkIfFullyLoaded();
	},

	loadMesh: function(name, filename) {
		var path = this.path[GS.AssetTypes.Mesh] + filename;
		var text = this.zip.file(path).asText();

		this.assets[GS.AssetTypes.Mesh][name] = this.objLoader.parse(text).children[0];
		this.checkIfFullyLoaded();
	},

	loadSound: function(name, filename, assetType) {
		var that = this;
		var path = this.path[assetType] + filename;
		var encodedBuffer = this.zip.file(path).asArrayBuffer();

		this.audioContext.decodeAudioData(encodedBuffer, function(buffer) {
			that.assets[assetType][name] = buffer;
			that.checkIfFullyLoaded();
		});
	},

	loadMap: function(name, filename) {
		var path = this.path[GS.AssetTypes.Map] + filename;

		if (name !== "testMap") {
			this.assets[GS.AssetTypes.Map][name] = this.zip.file(path).asText();
		} else {
			if (GAME.isTestMap()) {
				this.assets[GS.AssetTypes.Map][name] = this.mapLoader.loadTestMap();
			}
		}

		this.checkIfFullyLoaded();
	},

	loadScript: function(name, filename) {
		var path = this.path[GS.AssetTypes.Script] + filename;

		var scriptTag = document.createElement("script");
		scriptTag.text = this.zip.file(path).asText();
		document.body.appendChild(scriptTag);

		this.checkIfFullyLoaded();
	},

	zipOnProgress: function(e) {
		var percentLoaded = (e.loaded / e.total) * 50;
		this.dispatchEvent({ type: "progress", percentLoaded: percentLoaded.toFixed(0) });
	},

	checkIfFullyLoaded: function() {
		this.assetsToLoad--;

		var percentLoaded = (0.5 + ((this.totalAssets - this.assetsToLoad) / this.totalAssets) * 0.5) * 100;
		this.dispatchEvent({ type: "progress", percentLoaded: percentLoaded.toFixed(0) });

		if (this.assetsToLoad === 0) {
			this.loaded = true;
			this.dispatchEvent({ type: "load", percentLoaded: 100, assets: this.assets });
		}
	},
};

THREE.EventDispatcher.prototype.apply(GS.ZipAssetLoader.prototype);;GS.GridFactory = function(viewFactory, soundManager, renderer, scene, camera) {
	this.viewFactory = viewFactory;
	this.soundManager = soundManager;
	this.renderer = renderer;
	this.scene = scene;
	this.camera = camera;

	this.gridCellSize = 8;
};

GS.GridFactory.prototype = {
	constructor: GS.GridFactory,

	getGrid: function(map) {
		var that = this;

		var hCells = Math.ceil((map.bounds.max.x - map.bounds.min.x) / this.gridCellSize);
		var vCells = Math.ceil((map.bounds.max.y - map.bounds.min.y) / this.gridCellSize);

		var cells = [];
		for (var i = 0; i < vCells; i++) {
			cells[i] = [];
			for (var j = 0; j < hCells; j++) {
				var min = new THREE.Vector2(j * this.gridCellSize, i * this.gridCellSize).add(map.bounds.min);
				var max = new THREE.Vector2((j + 1) * this.gridCellSize, (i + 1) * this.gridCellSize).add(map.bounds.min);
				var box2 = new THREE.Box2(min, max);
				cells[i][j] = { box2: box2, children: [], x: j, y: i };
			}
		}

		var grid = new GS.Grid(this.renderer, this.scene);
    // HACK viewFactory
    grid.viewFactory = this.viewFactory;
		grid.clearScene();
		grid.cellSize = this.gridCellSize;
		grid.cells = cells;
		grid.width = hCells;
		grid.height = vCells;
		grid.map = map;
		grid.regionInfo = this.getRegions(map);
		grid.soundManager = this.soundManager;

		this.assignMapEntitiesToGrid(grid);
		this.addPlayerToGrid(grid);
    grid.respawn = () => {
      let position = new THREE.Vector3();
      this.assignPositionToRandomSpawn(position, grid);
      grid.player.position = position;
      grid.player.health = 100;
      grid.player.playerView.showWeapon("pistol");
      let gridLoc = {};
      gridLoc.x = position.x;
      gridLoc.y = position.y;
      var gridLocation = grid.getGridLocationFromPoints([gridLoc]);
      grid.player.assignToCells(gridLocation);
      grid.player.dead = false;
      // this.addPlayerToGrid(grid);
      // grid.player.init();
      // grid.player.playerView.lightingView = grid.lightingView;
      // GAME.uiManager.reinit();
      GAME.onlineManager.playerRespawn();
    };

		grid.initSkybox(this.viewFactory.getSkyboxMesh());
		grid.init();

		return grid;
	},

	getRegions: function(map) {
		var sectors = map.layerObjects[GS.MapLayers.Sector];
		var sectorLinks = map.sectorLinks;
		if (sectorLinks === undefined) {
			GAME.handleFatalError("invalid map - sector links not found");
			return;
		}

		var regionHelper = new GS.RegionHelper();
		return regionHelper.getRegions(sectors, sectorLinks);
	},

  getRandomSpawnPoint: function (grid) {
    let entities = grid.map.layerObjects[GS.MapLayers.Entity].filter((e) => { return e.type === "S"})
    let randomSpawn = entities[Math.floor(Math.random() * entities.length)];
    return randomSpawn;
  },

  assignPositionToRandomSpawn(position, grid) {
    let randomSpawn = this.getRandomSpawnPoint(grid);
    position.x = randomSpawn.pos.x;
    // position.y = 0;
    position.y = randomSpawn.y + 3.5;
    position.z = randomSpawn.pos.y - 0.0001;
  },

	addPlayerToGrid: function(grid) {
		var playerView = this.viewFactory.getPlayerView();
		grid.player = new GS.Player(grid, this.camera, playerView);

		var position = new THREE.Vector3();
    let gridLoc = {};
    if (GAME.onlinePlay) {
      this.assignPositionToRandomSpawn(position, grid);
      gridLoc.x = position.x;
      gridLoc.y = position.y;
    } else {
      gridLoc = grid.map.playerStartPosition;
      position.x = gridLoc.x;
      position.y = 0;
      position.z = gridLoc.y - 0.0001; // fix for visual bug
    }

		grid.player.position = position;
		var gridLocation = grid.getGridLocationFromPoints([gridLoc]);
		grid.player.assignToCells(gridLocation);

		grid.player.view.debugMesh = this.viewFactory.getDebugMesh(position, grid.player.size);
	},

	assignMapEntitiesToGrid: function(grid) {
		var sectorDict = {};

		var sectors = grid.map.layerObjects[GS.MapLayers.Sector];
		for (var i = 0; i < sectors.length; i++) {
			var sector = sectors[i];
			sectorDict[sector.id] = sector;

			var hasFloor = (sector.elevator !== true);
			var hasCeiling = (sector.ceiling === true && sector.door !== true);
			var gridLocation = grid.getGridLocationFromPoints(sector.collisionVertices);

			if (hasFloor || hasCeiling) {
				if (hasFloor) {
					var floor = new GS.Concrete(grid, GS.MapLayers.Sector, sector);
					floor.region = this.getRegionBySectorId(grid, sector.id);
					this.viewFactory.applySectorView(floor, false);
					floor.assignToCells(gridLocation);
				}

				if (hasCeiling) {
					var ceiling = new GS.Concrete(grid, GS.MapLayers.Sector, sector);
					ceiling.region = this.getRegionBySectorId(grid, sector.id);
					this.viewFactory.applySectorView(ceiling, true);
					ceiling.assignToCells(gridLocation);
				}
			}

			if (sector.door === true) {
				this.addDoor(grid, gridLocation, sector);
			} else
			if (sector.elevator === true) {
				this.addElevator(grid, gridLocation, sector);
			}
		}

		var segs = grid.map.layerObjects[GS.MapLayers.Segment];
		for (var i = 0; i < segs.length; i++) {
			var seg = segs[i];

			var points = [];
			points.push(new THREE.Vector2().copy(seg.start));
			points.push(new THREE.Vector2().copy(seg.end));
			var gridLocation = grid.getGridLocationFromPoints(points);

			if (seg.type !== GS.SegmentTypes.TVScreen && seg.type !== GS.SegmentTypes.Switch) {
				var gridObject = new GS.Concrete(grid, GS.MapLayers.Segment, seg);
				gridObject.sector = sectorDict[seg.sectorId];
				gridObject.region = this.getRegionBySectorId(grid, seg.sectorId);
				this.viewFactory.applySegmentView(gridObject);
				gridObject.assignToCells(gridLocation);
			} else
			if (seg.type === GS.SegmentTypes.TVScreen) {
				this.addTVScreen(grid, gridLocation, seg);
			} else
			if (seg.type === GS.SegmentTypes.Switch) {
				this.addSwitch(grid, gridLocation, seg);
			}
		}

		var entities = grid.map.layerObjects[GS.MapLayers.Entity];
		for (var i = 0; i < entities.length; i++) {
			var ntt = entities[i];
      grid.spawnEntity(ntt, grid);
		}
	},

	addDoor: function(grid, gridLocation, sector) {
		var door = new GS.Door(grid, sector);
		this.viewFactory.applyDoorView(door);
		door.assignToCells(gridLocation);
		sector.doorOpenedEver = false;
	},

	addElevator: function(grid, gridLocation, sector) {
		var elevator = new GS.Elevator(grid, sector);
		this.viewFactory.applyElevatorView(elevator);
		elevator.assignToCells(gridLocation);
	},

	addTVScreen: function(grid, gridLocation, seg) {
		var tvScreen = new GS.TVScreen(grid, seg);
		this.viewFactory.applyTVScreenView(tvScreen);
		tvScreen.assignToCells(gridLocation);
	},

	addSwitch: function(grid, gridLocation, seg) {
		var switchObj = new GS.Switch(grid, seg);
		this.viewFactory.applySwitchView(switchObj);
		switchObj.assignToCells(gridLocation);
	},

	getRegionBySectorId: function(grid, sectorId) {
		var regions = grid.regionInfo.regions;

		for (var i = 0; i < regions.length; i++) {
			if (sectorId in regions[i].sectorIds) {
				return regions[i];
			}
		}

		GAME.handleFatalError("sector has no corresponding region");
		return;
	},
};
;GS.ViewFactory = function(renderer, map, assets) {
	this.renderer = renderer;
	this.map = map;

	this.textures = assets[GS.AssetTypes.Texture];
	this.cubeTextures = assets[GS.AssetTypes.CubeTexture];
	this.meshes = assets[GS.AssetTypes.Mesh];

	this.anisotropy = renderer.getMaxAnisotropy();
	this.debugBoundingBoxMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true });
	this.debugTriangleMaterial = new THREE.MeshBasicMaterial({ color: 0x00c0ff, wireframe: true });

	this.texScale = 16;
	this.triangleCount = 0;
};

GS.ViewFactory.prototype = {
	constructor: GS.ViewFactory,

	init: function() {
		var that = this;
		Object.keys(this.textures).forEach(function(key) {
			that.textures[key].anisotropy = that.anisotropy;
		});

		this.materials = {};

		var textureAssets = GS.Assets[GS.AssetTypes.Texture];
		for (var i in textureAssets) {
			var tex = textureAssets[i];
			if (tex.type === GS.TextureTypes.Map) {
				this.wrap(this.textures[i]);
				this.materials[i] = new THREE.MeshPhongMaterial({ map: this.textures[i] });
			} else
			if (tex.type === GS.TextureTypes.TVScreen) {
				this.textures[i].flipY = false;
			}
		}

		var entities = this.map.layerObjects[GS.MapLayers.Entity];
    // HACK: force online_player into entities
    // TODO: check to see if is online map and add material if true
    let onlineNtt = {
      id: 24,
      pos: new THREE.Vector2(-100, -100),
      type: "O",
      y:-100,
      isStatic: false,
      rotation:0
    };
    entities.push(onlineNtt);
		var entityMaterials = {};
		for (var i = 0; i < entities.length; i++) {
			var ntt = entities[i];

			var desc = GS.MapEntities[ntt.type];
			var name = desc.name;
			if (entityMaterials[name] === undefined) {
				entityMaterials[name] = true;

				this.materials[name] = new GS.MeshPhongGlowMaterial(this.textures[name], this.textures[name + "_glow"]);
			}
		}

		this.vertexColorMaterial = new GS.MeshVertexColorMaterial();

		for (var i in GS.Weapons) {
			this.wrap(this.textures[i]);
			this.materials[i] = new GS.MeshPhongGlowMaterial(this.textures[i], this.textures[i + "_glow"]);
		}
	},

	getSkyboxMesh: function() {
		var name = "skybox1";

		var tex = this.cubeTextures[name];
		tex.format = THREE.RGBFormat;

		var shader = THREE.ShaderLib["cube"];
		var uniforms = THREE.UniformsUtils.clone(shader.uniforms);
		uniforms["tCube"].value = tex;

		var material = new THREE.ShaderMaterial({
			fragmentShader: shader.fragmentShader,
			vertexShader: shader.vertexShader,
			uniforms: uniforms,
			depthWrite: false,
			side: THREE.BackSide,
		});

		var geometry = new THREE.BoxGeometry(1000, 1000, 1000);
		var mesh = new THREE.Mesh(geometry, material);

		return mesh;
	},

	wrap: function(tex) {
		tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
	},

	applySegmentView: function(gridObject) {
		var seg = gridObject.sourceObj;

		var geometry = new THREE.Geometry();
		var triangles = this.getSegmentDefinedTriangles(seg);
		GS.pushArray(geometry.vertices, triangles);

		var distance = seg.start.distanceTo(seg.end);
		var length;
		if (distance > this.texScale) {
			length = Math.round((distance / (this.texScale * this.texScale)) * this.texScale);
		} else {
			length = distance / this.texScale;
		}

		var color = new THREE.Color(seg.lightColor);
		var emissive = this.getEmissiveColor(gridObject.sector.lightLevel);

		for (var i = 0; i < triangles.length; i += 3) {
			var face = new THREE.Face3(i, i + 1, i + 2, null, color);
			face.emissive = emissive;

			geometry.faces.push(face);
		}

		geometry.computeFaceNormals();
		geometry.computeVertexNormals();

		gridObject.region.mesh.geometry.merge(geometry);

		gridObject.view.collisionData.triangles = this.getSegmentTriangles(seg);
		this.applyConcreteBoundingBox(gridObject, triangles);

		this.triangleCount += gridObject.view.collisionData.triangles.length / 3;
	},

	getEmissiveColor: function(lightLevel) {
		var lightLevelFactor = 0.1;
		var minLightLevel = 0.1;
		var maxLightLevel = 0.75;

		var x = lightLevel * lightLevelFactor;
		x *= x;
		x = GS.MathHelper.clamp(x, minLightLevel, maxLightLevel);

		return new THREE.Color(0xffffff).multiplyScalar(x);
	},

	applySectorView: function(gridObject, ceiling) {
		var sector = gridObject.sourceObj;

		var triangles = [];

		var geometry;

		if (!ceiling) {
			if (sector.elevator !== true) {
				geometry = this.getSectorGeometry(sector, triangles, false);
				gridObject.region.mesh.geometry.merge(geometry);
			}
		} else {
			var hasCeiling = (sector.ceiling !== undefined) ? sector.ceiling : true;
			if (hasCeiling) {
				geometry = this.getSectorGeometry(sector, triangles, true);
				gridObject.region.mesh.geometry.merge(geometry);
			}
		}

		gridObject.view.collisionData.triangles = triangles;
		this.applyConcreteBoundingBox(gridObject, triangles);

		this.triangleCount += triangles.length / 3;
	},

	applyConcreteBoundingBox: function(gridObject, triangles) {
		var boundingBox = new THREE.Box3().setFromPoints(triangles);
		var center = boundingBox.min.clone().add(boundingBox.max).divideScalar(2);
		var debugMesh = this.getDebugMesh(center);
		debugMesh.scale.copy(boundingBox.max).sub(boundingBox.min).addScalar(0.01);
		gridObject.view.collisionData.boundingBox = boundingBox;
		gridObject.view.debugMesh = debugMesh;
	},

	getSectorGeometry: function(sector, sectorTriangles, ceiling) {
		var geometry = new THREE.Geometry();
		var triangles = this.getSectorTriangles(sector, ceiling);
		GS.pushArray(geometry.vertices, triangles);
		GS.pushArray(sectorTriangles, this.getSectorTriangles(sector, ceiling, true));

		var emissive = this.getEmissiveColor(sector.lightLevel);
		var color = new THREE.Color(ceiling ? sector.ceilingCatColor : sector.lightColor);

		for (var j = 0; j < triangles.length; j += 3) {
			var face = new THREE.Face3(j, j + 1, j + 2, null, color);
			face.emissive = emissive;

			geometry.faces.push(face);
		}

		geometry.computeFaceNormals();
		geometry.computeVertexNormals();

		return geometry;
	},

	getSegmentDefinedTriangles: function(seg) {
		var triangles = [];

		var bottomRightIndex = 0;
		for (var i = 0; i < seg.indices.length; i += 3) {
			triangles.push(seg.vertices[seg.indices[i]]);
			triangles.push(seg.vertices[seg.indices[i + 1]]);
			triangles.push(seg.vertices[seg.indices[i + 2]]);

			if (seg.indices[i + 2] == seg.bottomRightIndex) {
				bottomRightIndex = i + 3;
			}
		}
		seg.bottomRightIndex = bottomRightIndex;

		return triangles;
	},

	getSegmentTriangles: function(seg) {
		var triangles = [];

		triangles.push(new THREE.Vector3(seg.start.x, seg.topY, seg.start.y));
		triangles.push(new THREE.Vector3(seg.end.x, seg.topY, seg.end.y));
		triangles.push(new THREE.Vector3(seg.start.x, seg.bottomY, seg.start.y));
		triangles.push(new THREE.Vector3(seg.end.x, seg.topY, seg.end.y));
		triangles.push(new THREE.Vector3(seg.end.x, seg.bottomY, seg.end.y));
		triangles.push(new THREE.Vector3(seg.start.x, seg.bottomY, seg.start.y));

		return triangles;
	},

	getSectorTriangles: function(sector, ceiling, getCollisionTriangles) {
		var triangles = [];

		var v = sector.vertices;
		var idx = sector.indices;

		if (getCollisionTriangles) {
			v = sector.collisionVertices;
			idx = sector.collisionIndices;
		}

		if (!ceiling) {
			for (var i = 0; i < idx.length; i += 3) {
				triangles.push(new THREE.Vector3(v[idx[i + 2]].x, sector.floorTopY, v[idx[i + 2]].y));
				triangles.push(new THREE.Vector3(v[idx[i + 1]].x, sector.floorTopY, v[idx[i + 1]].y));
				triangles.push(new THREE.Vector3(v[idx[i]].x, sector.floorTopY, v[idx[i]].y));
			}
		} else {
			for (var i = 0; i < idx.length; i += 3) {
				triangles.push(new THREE.Vector3(v[idx[i]].x, sector.ceilBottomY, v[idx[i]].y));
				triangles.push(new THREE.Vector3(v[idx[i + 1]].x, sector.ceilBottomY, v[idx[i + 1]].y));
				triangles.push(new THREE.Vector3(v[idx[i + 2]].x, sector.ceilBottomY, v[idx[i + 2]].y));
			}
		}

		return triangles;
	},

	applyEntityView: function(gridObject) {
		var vertices = GS.Cube.getVertices();

		return function(gridObject) {
			var that = this;

			var ntt = gridObject.sourceObj;
			var desc = GS.MapEntities[ntt.type];
			var name = GS.MapEntities[ntt.type].name;

			var offset = gridObject.offset;
			var scale = gridObject.scale;
			var size = gridObject.size;

			var material = this.materials[name].clone();

			var mesh;
			if (name === "spawn") {
				mesh = new THREE.Object3D();
        mesh.position.copy(offset);
        mesh.position.copy(gridObject.position);
        mesh.scale.copy(scale);

        gridObject.view.mesh = mesh;
        gridObject.view.debugMesh = this.getDebugMesh(gridObject.position);
          return; // No Draw
      }
			if (desc.animations === undefined) {
				mesh = this.meshes[name].clone();
				mesh.material = material;
			} else {
				mesh = new THREE.Object3D();
				var data = mesh.userData;
				data.animations = {};
				Object.keys(desc.animations).forEach(function(key) {
					var count = desc.animations[key];
					data.animations[key] = [];

					for (var i = 0; i < count; i++) {
						var animationName = name + "_" + key + i;
						var animMesh = that.meshes[animationName].clone();
						animMesh.visible = false;
						animMesh.material = material;
						data.animations[key].push(animMesh);
						mesh.add(animMesh);
					}
				});
			}

			mesh.position.copy(offset);
			mesh.position.copy(gridObject.position);
			mesh.scale.copy(scale);

			gridObject.view.mesh = mesh;
			gridObject.view.debugMesh = this.getDebugMesh(gridObject.position);

			if (gridObject instanceof GS.Monster ||
          gridObject instanceof GS.OnlinePlayer) {
				gridObject.view.collisionData.triangles = [];
				for (var i = 0; i < vertices.length; i++) {
					var v = vertices[i].clone();
					v.multiply(size).add(gridObject.view.mesh.position);
					gridObject.view.collisionData.triangles.push(v);
				}

				gridObject.view.collisionData.boundingSquare.setFromPoints([
					gridObject.position.toVector2().sub(gridObject.size.toVector2()),
					gridObject.position.toVector2().add(gridObject.size.toVector2()),
				]);
			}
		}
	}(),

	getSegmentsForMovingSector: function(gridObject, elevator) {
		var sector = gridObject.sector;
		var segs = [];

		for (var i = 0; i < sector.collisionVertices.length - 1; i++) {
			segs.push({
				start: sector.collisionVertices[i].clone(),
				end: sector.collisionVertices[i + 1].clone(),
			});
		}
		segs.push({
			start: sector.collisionVertices[i].clone(),
			end: sector.collisionVertices[0].clone(),
		});

		if (elevator !== true) {
			for (var i = 0; i < segs.length; i++) {
				segs[i].bottomY = sector.floorTopY;
				segs[i].topY = sector.ceilBottomY;
			}
		} else {
			for (var i = 0; i < segs.length; i++) {
				segs[i].bottomY = sector.floorTopY - sector.elevatorMaxHeight;
				segs[i].topY = sector.floorTopY;
			}
		}

		return segs;
	},

	applyDoorView: function(door) {
		var triangles = [];

		door.position = this.getMovingSectorPosition(door);
		door.view.collisionData.segments = this.getSegmentsForMovingSector(door, false);

		var centerMaterial = this.vertexColorMaterial;
		var sideMaterial = this.vertexColorMaterial;
		if (!door.sector.useVertexColors) {
			centerMaterial = this.materials[door.sector.ceilTexId].clone();
			sideMaterial = this.materials[door.sector.sideTexId].clone();
		}

		var mesh = new THREE.Object3D();
		mesh.children.push(this.getMovingSectorCenterMesh(door, triangles, centerMaterial));
		mesh.children.push(this.getMovingSectorSideMesh(door, triangles, sideMaterial));

		mesh.children[0].position.copy(door.position);
		mesh.children[1].position.copy(door.position);

		door.view.mesh = mesh;
		door.view.collisionData.triangles = triangles;
		door.view.debugMesh = this.getDebugMesh(door.position);
		// door.view.debugMesh = this.getDebugTriangleMesh(triangles);

		var box = door.view.collisionData.boundingBox;
		box.setFromPoints(triangles);
		door.size = box.max.clone().sub(box.min).divideScalar(2);

		this.triangleCount += triangles.length / 3;
	},

	applyElevatorView: function(elevator) {
		var triangles = [];

		elevator.position = this.getMovingSectorPosition(elevator, true);
		elevator.view.collisionData.segments = this.getSegmentsForMovingSector(elevator, true);

		var centerMaterial = this.vertexColorMaterial;
		var sideMaterial = this.vertexColorMaterial;
		if (!elevator.sector.useVertexColors) {
			centerMaterial = this.materials[elevator.sector.floorTexId].clone();
			sideMaterial = this.materials[elevator.sector.sideTexId].clone();
		}

		var mesh = new THREE.Object3D();
		mesh.children.push(this.getMovingSectorCenterMesh(elevator, triangles,
			centerMaterial, true));
		mesh.children.push(this.getMovingSectorSideMesh(elevator, triangles,
			sideMaterial, true));

		mesh.children[0].position.copy(elevator.position);
		mesh.children[1].position.copy(elevator.position);

		elevator.view.mesh = mesh;
		elevator.view.collisionData.triangles = triangles;
		elevator.view.debugMesh = this.getDebugMesh(elevator.position);
		//elevator.view.debugMesh = this.getDebugTriangleMesh(triangles);

		var box = elevator.view.collisionData.boundingBox;
		box.setFromPoints(triangles);
		elevator.size = box.max.clone().sub(box.min).divideScalar(2);

		this.triangleCount += triangles.length / 3;
	},

	getMovingSectorPosition: function(movingSector, elevator) {
		var box = new THREE.Box2().setFromPoints(movingSector.sector.vertices);
		var center = box.min.clone().add(box.max).divideScalar(2);

		var pos = new THREE.Vector3(center.x, 0, center.y);

		if (elevator !== true) {
			pos.y = (movingSector.sector.floorTopY + movingSector.sector.ceilBottomY) / 2;
		} else {
			pos.y = movingSector.sector.floorTopY - movingSector.sector.elevatorMaxHeight / 2;
		}

		return pos;
	},

	getMovingSectorSideMesh: function(movingSector, movingSectorTriangles, material, elevator) {
		var bottomY, topY;
		if (elevator !== true) {
			bottomY = movingSector.sector.floorTopY;
			topY = movingSector.sector.ceilBottomY;
		} else {
			bottomY = movingSector.sector.floorTopY - movingSector.sector.elevatorMaxHeight;
			topY = movingSector.sector.floorTopY;
		}

		var geometry = new THREE.Geometry();
		var color = new THREE.Color(movingSector.sector.lightColor);
		var emissive = this.getEmissiveColor(movingSector.sector.lightLevel);
		var triangles = [];

		var k = 0;
		for (var i = 0; i < movingSector.sector.vertices.length; i++) {
			var next = (i < movingSector.sector.vertices.length - 1) ? (i + 1) : 0;

			var start = movingSector.sector.vertices[i];
			var end = movingSector.sector.vertices[next];

			var distance = start.distanceTo(end);
			var length;
			if (distance > this.texScale) {
				length = Math.round((distance / (this.texScale * this.texScale)) * this.texScale);
			} else {
				length = distance / this.texScale;
			}

			var vertices = [
				new THREE.Vector3(start.x, topY, start.y),
				new THREE.Vector3(end.x, topY, end.y),
				new THREE.Vector3(start.x, bottomY, start.y),
				new THREE.Vector3(end.x, topY, end.y),
				new THREE.Vector3(end.x, bottomY, end.y),
				new THREE.Vector3(start.x, bottomY, start.y),
			];

			for (var j = 0; j < vertices.length; j++) {
				triangles.push(vertices[j].clone());
			}

			for (var j = 0; j < vertices.length; j++) {
				vertices[j].sub(movingSector.position);
			}

			GS.pushArray(geometry.vertices, vertices);

			if (!movingSector.sector.useVertexColors) {
				geometry.faces.push(new THREE.Face3(k, k + 1, k + 2));
				geometry.faces.push(new THREE.Face3(k + 3, k + 4, k + 5));

				geometry.faceVertexUvs[0].push([
					new THREE.Vector2(0, topY / this.texScale),
					new THREE.Vector2(length, topY / this.texScale),
					new THREE.Vector2(0, bottomY / this.texScale),
				]);
				geometry.faceVertexUvs[0].push([
					new THREE.Vector2(length, topY / this.texScale),
					new THREE.Vector2(length, bottomY / this.texScale),
					new THREE.Vector2(0, bottomY / this.texScale),
				]);
			} else {
				var face1 = new THREE.Face3(k, k + 1, k + 2,
					null, color);
				face1.emissive = emissive;

				geometry.faces.push(face1);

				var face2 = new THREE.Face3(k + 3, k + 4, k + 5,
					null, color);
				face2.emissive = emissive;

				geometry.faces.push(face2);
			}

			k += 6;
		}

		GS.pushArray(movingSectorTriangles, triangles);

		geometry.computeFaceNormals();
		geometry.computeVertexNormals();

		if (movingSector.sector.useVertexColors) {
			var bufferGeo = new THREE.BufferGeometry()
				.fromGeometry(geometry, {
					vertexColors: THREE.FaceColors
				});

			return new THREE.Mesh(bufferGeo, material);
		} else {
			return new THREE.Mesh(geometry, material);
		}
	},

	getMovingSectorCenterMesh: function(movingSector, movingSectorTriangles, material, elevator) {
		var minHeight = movingSector.sector.floorTopY;

		var geometry = new THREE.Geometry();
		var color = new THREE.Color(movingSector.sector.lightColor);
		var emissive = this.getEmissiveColor(movingSector.sector.lightLevel);

		var v = movingSector.sector.vertices;
		var idx = movingSector.sector.indices;
		var v0, v1, v2;
		for (var i = 0; i < idx.length; i += 3) {
			if (elevator === true) {
				v0 = new THREE.Vector3(v[idx[i + 2]].x, minHeight, v[idx[i + 2]].y);
				v1 = new THREE.Vector3(v[idx[i + 1]].x, minHeight, v[idx[i + 1]].y);
				v2 = new THREE.Vector3(v[idx[i]].x, minHeight, v[idx[i]].y);
			} else {
				v0 = new THREE.Vector3(v[idx[i]].x, minHeight, v[idx[i]].y);
				v1 = new THREE.Vector3(v[idx[i + 1]].x, minHeight, v[idx[i + 1]].y);
				v2 = new THREE.Vector3(v[idx[i + 2]].x, minHeight, v[idx[i + 2]].y);
			}

			if (!movingSector.sector.useVertexColors) {
				geometry.faces.push(new THREE.Face3(i, i + 1, i + 2));
				geometry.faceVertexUvs[0].push([
					new THREE.Vector2(v0.x / this.texScale, v0.z / this.texScale),
					new THREE.Vector2(v1.x / this.texScale, v1.z / this.texScale),
					new THREE.Vector2(v2.x / this.texScale, v2.z / this.texScale),
				]);
			} else {
				var face = new THREE.Face3(i, i + 1, i + 2,
					null, color);
				face.emissive = emissive;

				geometry.faces.push(face);
			}

			v0.sub(movingSector.position);
			v1.sub(movingSector.position);
			v2.sub(movingSector.position);

			geometry.vertices.push(v0);
			geometry.vertices.push(v1);
			geometry.vertices.push(v2);
		}

		v = movingSector.sector.collisionVertices;
		idx = movingSector.sector.collisionIndices;
		for (var i = 0; i < idx.length; i += 3) {
			if (elevator === true) {
				v0 = new THREE.Vector3(v[idx[i + 2]].x, minHeight, v[idx[i + 2]].y);
				v1 = new THREE.Vector3(v[idx[i + 1]].x, minHeight, v[idx[i + 1]].y);
				v2 = new THREE.Vector3(v[idx[i]].x, minHeight, v[idx[i]].y);
			} else {
				v0 = new THREE.Vector3(v[idx[i]].x, minHeight, v[idx[i]].y);
				v1 = new THREE.Vector3(v[idx[i + 1]].x, minHeight, v[idx[i + 1]].y);
				v2 = new THREE.Vector3(v[idx[i + 2]].x, minHeight, v[idx[i + 2]].y);
			}

			movingSectorTriangles.push(v0);
			movingSectorTriangles.push(v1);
			movingSectorTriangles.push(v2);
		}

		geometry.computeFaceNormals();
		geometry.computeVertexNormals();

		if (movingSector.sector.useVertexColors) {
			var bufferGeo = new THREE.BufferGeometry()
				.fromGeometry(geometry, {
					vertexColors: THREE.FaceColors
				});

			return new THREE.Mesh(bufferGeo, material);
		} else {
			return new THREE.Mesh(geometry, material);
		}
	},

	applyTVScreenView: function(tvScreen) {
		tvScreen.view.mesh = this.getTVScreenMesh(tvScreen);

		tvScreen.view.mesh.material = new THREE.MeshBasicMaterial({
			map: this.textures[tvScreen.segment.texId],
			depthWrite: false,
			polygonOffset: true,
			polygonOffsetFactor: -4,
			transparent: true,
		});
	},

	applySwitchView: function(switchObj) {
		switchObj.segment.bottomY += 8;
		switchObj.segment.topY = switchObj.segment.bottomY + 8;
		switchObj.view.mesh = this.getTVScreenMesh(switchObj);

		switchObj.view.collisionData.boundingBox.setFromPoints([
			new THREE.Vector3(switchObj.segment.start.x, switchObj.segment.bottomY, switchObj.segment.start.y),
			new THREE.Vector3(switchObj.segment.end.x, switchObj.segment.topY, switchObj.segment.end.y),
		]);

		switchObj.view.textureOn = this.textures.switch_on;
		switchObj.view.textureOff = this.textures.switch_off;

		switchObj.view.mesh.material = new THREE.MeshBasicMaterial({
			map: switchObj.view.textureOff,
			depthWrite: false,
			polygonOffset: true,
			polygonOffsetFactor: -4,
			transparent: true,
		});
	},

	getTVScreenMesh: function(tvScreen) {
		var seg = tvScreen.segment;

		var geometry = new THREE.Geometry();
		var triangles = this.getSegmentTriangles(seg);
		GS.pushArray(geometry.vertices, triangles);

		geometry.faces.push(new THREE.Face3(0, 1, 2));
		geometry.faces.push(new THREE.Face3(3, 4, 5));

		geometry.faceVertexUvs[0].push([
			new THREE.Vector2(1, 0),
			new THREE.Vector2(0, 0),
			new THREE.Vector2(1, 1),
		]);
		geometry.faceVertexUvs[0].push([
			new THREE.Vector2(0, 0),
			new THREE.Vector2(0, 1),
			new THREE.Vector2(1, 1),
		]);

		geometry.computeFaceNormals();
		geometry.computeVertexNormals();

		var mesh = new THREE.Mesh(geometry, undefined);
		mesh.matrixAutoUpdate = false;
		mesh.renderDepth = 1000;
		return mesh;
	},

	getPlayerView: function() {
		var playerView = new GS.PlayerView();
		var weapons = Object.keys(GS.Weapons);
		for (var i = 0; i < weapons.length; i++) {
			var name = weapons[i];
			if (this.meshes[name] !== undefined) {
				var material = this.materials[name].clone();
				var mesh = this.meshes[name].clone();
				mesh.material = material;
				playerView.addWeaponMesh(name, mesh);
			}
		}
		playerView.init();

		return playerView;
	},

	getDebugMesh: function(position) {
		var debugGeometry = new THREE.BoxGeometry(1, 1, 1);
		var debugMesh = new THREE.Mesh(debugGeometry, this.debugBoundingBoxMaterial);
		debugMesh.position.copy(position);
		return debugMesh;
	},

	getDebugTriangleMesh: function(triangles) {
		var debugGeometry = new THREE.Geometry();
		GS.pushArray(debugGeometry.vertices, triangles);

		for (var i = 0; i < triangles.length; i += 3) {
			debugGeometry.faces.push(new THREE.Face3(i, i + 1, i + 2));
		}

		var debugMesh = new THREE.Mesh(debugGeometry, this.debugTriangleMaterial);
		debugMesh.userData.isTriangleMesh = true;
		debugMesh.matrixAutoUpdate = false;
		return debugMesh;
	},
};

THREE.EventDispatcher.prototype.apply(GS.ViewFactory.prototype);
;GS.AIManager = function(grid) {
	this.grid = grid;
	this.map = grid.map;
	this.mapWon = false;

	this.monstersKilled = 0;
	this.maxMonsters = 0;
	this.itemsPickedUp = 0;
	this.maxItems = 0;

	this.lastFrameTime = performance.now();
	this.timeSpent = 0;
	this.minutes = 0;
	this.seconds = 0;

	this.regionsDiscovered = {};
};

GS.AIManager.prototype = {
	init: function() {
		this.initZones();

		this.sectorDict = this.grid.regionInfo.sectorDict;
		this.regions = this.grid.regionInfo.regions;

		for (var i = 0; i < this.regions.length; i++) {
			this.regions[i].mesh.visible = false;
		}

		this.assignMonstersToRegions();
		this.initGridObjectLibrary();
		this.initScripts();
	},

	initZones: function() {
		this.zones = this.map.layerObjects[GS.MapLayers.Zone];
		for (var i = 0; i < this.zones.length; i++) {
			var zone = this.zones[i];
			zone.boundingSquare = new THREE.Box2().setFromPoints([zone.start, zone.end]);
		}
	},

	assignMonstersToRegions: function() {
		var that = this;
		this.grid.forEachUniqueGridObject([GS.Monster], function(monster) {
			if (monster.startingSector !== undefined) {
				var region = that.getRegionBySectorId(monster.startingSector.id);
				if (region === undefined) {
					GAME.handleFatalError("sector not in region");
					return;
				}
				region.monsters.push(monster);
			} else {
				GAME.handleFatalError("monster " + monster.id + " has no starting sector");
				return;
			}
		});
	},

	initGridObjectLibrary: function() {
		var that = this;

		var library = {
			items: {},
			doors: {},
			elevators: {},
			monsters: {},
			sectors: {},
			switches: {},
		};

		this.grid.forEachUniqueGridObject([GS.Item, GS.Door, GS.Elevator, GS.Monster, GS.Concrete, GS.Switch], function(gridObject) {
			if (gridObject instanceof GS.Item) {
				library.items[gridObject.sourceObj.id] = gridObject;
			} else
			if (gridObject instanceof GS.Door) {
				library.doors[gridObject.sector.id] = gridObject;
			} else
			if (gridObject instanceof GS.Elevator) {
				library.elevators[gridObject.sector.id] = gridObject;
			} else
			if (gridObject instanceof GS.Monster) {
				library.monsters[gridObject.sourceObj.id] = gridObject;
			} else
			if (gridObject instanceof GS.Concrete && gridObject.type == GS.MapLayers.Sector) {
				library.sectors[gridObject.sourceObj.id] = gridObject;
			} else
			if (gridObject instanceof GS.Switch) {
				library.switches[gridObject.segment.id] = gridObject;
			}
		});

		this.gridObjectLibrary = library;
	},

	initScripts: function() {
		if (this.map.hasScript === true) {
			this.script = new GS.MapScripts[this.map.name](this.gridObjectLibrary);
			this.script.init();

			var entities = this.grid.map.layerObjects[GS.MapLayers.Entity];
			for (var i = 0; i < entities.length; i++) {
				var entity = entities[i];
				var type = GS.MapEntities[entity.type].type;
				if (type === "Monster") {
					this.maxMonsters++;
				} else
				if (type === "Item") {
					this.maxItems++;
				}
			}
		}
	},

	update: function() {
		if (this.script !== undefined) {
			this.script.update();

			if (this.script.mapWon && !this.mapWon) {
				this.mapWon = true;
			}
		}

		if (!this.mapWon) {
			this.updateTime();
		}
	},

	updateTime: function() {
		if (!this.grid.player.inMenu && !this.onlinePlay) {
			this.timeSpent += performance.now() - this.lastFrameTime;
			this.minutes = Math.floor(Math.floor(this.timeSpent) / 60000);
			this.seconds = Math.floor(Math.floor(this.timeSpent) / 1000 - this.minutes * 60);
		}
		this.lastFrameTime = performance.now();

		// GS.DebugUI.setStaticLine("time spent", GS.pad(this.minutes, 2) + ":" + GS.pad(this.seconds, 2));
	},

	resume: function() {
		this.lastFrameTime = performance.now();
	},

	onMonsterDeath: function() {
		this.monstersKilled++;
	},

	onPlayerMove: function(player, oldPos, newPos) {
		if (this.script !== undefined) {
			this.checkZones(player, oldPos, newPos);
		}

		this.wakeUpNearbyMonsters(player);
		this.applyRegionVisibility(player);
	},

	onPlayerShoot: function(player) {
		this.activateNearbyMonsters(player);
	},

	onPlayerOpenDoor: function(door) {
		if (this.script !== undefined) {
			this.script.onPlayerOpenDoor(door);
		}
	},

	onPlayerItemPickup: function(player, item) {
		this.itemsPickedUp++;

		if (this.script !== undefined) {
			this.script.onItemPickup(item);
		}
	},

	onSwitchStateChange: function(switchObj) {
		if (this.script !== undefined) {
			this.script.onSwitchStateChange(switchObj);
		}
	},

	applyRegionVisibility: function(player) {
		var that = this;

		for (var i = 0; i < this.regions.length; i++) {
			this.regions[i].reachedThisFrame = false;
		}

		var visibleRegions = 0;
		this.propagateRegions(player, function(region) {
			region.reachedThisFrame = true;
			region.mesh.visible = true;
			visibleRegions++;
		});

		for (var i = 0; i < this.regions.length; i++) {
			var region = this.regions[i];
			if (region.mesh.visible && !region.reachedThisFrame) {
				region.mesh.visible = false;
			}
		}

		// GS.DebugUI.setStaticLine("total regions", this.regions.length);
		// GS.DebugUI.trackNumericValue("visible regions", visibleRegions);
	},

	checkZones: function() {
		var oldPos2d = new THREE.Vector2();
		var newPos2d = new THREE.Vector2();

		return function(player, oldPos, newPos) {
			oldPos.toVector2(oldPos2d);
			newPos.toVector2(newPos2d);

			for (var i = 0; i < this.zones.length; i++) {
				var zone = this.zones[i];
				var c1 = zone.boundingSquare.containsPoint(oldPos2d);
				var c2 = zone.boundingSquare.containsPoint(newPos2d);

				if (c1 && !c2) {
					this.script.onZoneLeave(zone);
				} else
				if (!c1 && c2) {
					this.script.onZoneEnter(zone);
				}
			}
		}
	}(),

	wakeUpNearbyMonsters: function(player) {
		var that = this;
		this.propagateRegions(player, function(region) { that.wakeUpMonsters(region); });
	},

	activateNearbyMonsters: function(player) {
		var that = this;
		this.propagateRegions(player, function(region) { that.activateMonsters(region); });
	},

	propagateRegions: function(player, callback) {
		var sector = player.getSector();

		if (sector !== undefined) {
			var toVisit = [ this.getRegionBySectorId(sector.id) ];
			var visited = {};

			while (toVisit.length > 0) {
				var region = toVisit.pop();

				if (region.id in visited) {
					continue;
				}
				visited[region.id] = true;
				this.regionsDiscovered[region.id] = region;

				callback(region);
				if (region.linkedRegions !== undefined) {
					for (var i = 0; i < region.linkedRegions.length; i++) {
						var linked = region.linkedRegions[i];
						var sector = this.sectorDict[linked.doorId].sector;

						if (sector.doorGridObject.state !== GS.DoorStates.Closed) {
							toVisit.push(linked.region);
						}
					}
				}
			}
		}
	},

	wakeUpMonsters: function(region) {
		if (region.awake) {
			return;
		}

		for (var i = 0; i < region.monsters.length; i++) {
			region.monsters[i].wakeUp();
		}
		region.awake = true;
	},

	activateMonsters: function(region) {
		if (region.active) {
			return;
		}

		for (var i = 0; i < region.monsters.length; i++) {
			region.monsters[i].activate();
		}
		region.active = true;
	},

	getRegionBySectorId: function(sectorId) {
		for (var i = 0; i < this.regions.length; i++) {
			var region = this.regions[i];
			if (sectorId in region.sectorIds) {
				return region;
			}
		}

		GAME.handleFatalError("sector has no corresponding region");
	},
};
;GS.ChromeAppFPSControls = function(camera) {
	this.camera = camera;

	this.eye = new THREE.Vector3();
	this.followingEye = new THREE.Vector3();
	this.look = new THREE.Vector3(0, 0, -10).add(this.eye);
	this.lookNoOffset = this.look.clone();

	this.moveSpeed = 1;
	this.lookSpeed = 0.066 * (GS.Settings.mouse / 5);
	this.mouseInvertY = GS.Settings.mouseInvertY;

	this.forwardLookVector = new THREE.Vector3(0, 0, -1);
	this.forwardMoveVector = new THREE.Vector3(0, 0, -1);
	this.rightLookVector = new THREE.Vector3(1, 0, 0);
	this.rightMoveVector = new THREE.Vector3(1, 0, 0);

	this.xAngle = 270;
	this.yAngle = 90;
	this.viewOffsetY = 0;
	this.eyeOffsetY = 3.5;

	this.pointerLockEnabled = false;

	this.onHandleCollisions = function(oldPos, newPos) {};

	this.enabled = true;
	this.fly = false;
	this.ySmoothing = false;
	this.ySmoothingFactor = 0.1;
};

GS.ChromeAppFPSControls.prototype = {
	constructor: GS.ChromeAppFPSControls,

	init: function() {
		var that = this;
		var pointerLock = "pointerLockElement" in document;
		if (!pointerLock) {
			GAME.handleFatalError("Pointer Lock API not supported");
			return;
		}

		this.canvas = $("#game-canvas")[0];
		this.debugCanvas = $("#debug-ui-canvas")[0];

		this.setViewAngles(this.xAngle, this.yAngle);
	},

	enable: function() {
		var that = this;
		this.canvas.requestPointerLock();
		$(document).off("mousemove.fpsControls");
		$(document).on("mousemove.fpsControls", function(e) { that.onMouseMove(e.originalEvent); });
	},

	disable: function() {
		document.exitPointerLock();
		$(document).off("mousemove.fpsControls");
	},


	onMouseMove: function(e) {
		if (!this.enabled) {
			return;
		}

		var mx = e.movementX || e.mozMovementX || e.webkitMovementX || 0;
		var my = e.movementY || e.mozMovementY || e.webkitMovementY || 0;

		var invertY = this.mouseInvertY ? -1 : 1;

		this.setViewAngles(this.xAngle + mx * this.lookSpeed, this.yAngle + invertY * my * this.lookSpeed);
	},

	setViewOffsetY: function(y) {
		this.viewOffsetY = y;
	},

	update: function() {
		if (!this.enabled) {
			return;
		}

		var x = 0;
		var z = 0;

		if (GS.Keybinds.moveForward.inUse) {
			z++;
		}
		if (GS.Keybinds.moveBackward.inUse) {
			z--;
		}
		if (GS.Keybinds.strafeLeft.inUse) {
			x--;
		}
		if (GS.Keybinds.strafeRight.inUse) {
			x++;
		}

		this.move(x, z);
		this.dispatchEvent({ type: "update", pos: this.eye, xAngle: this.xAngle, yAngle: this.yAngle, look: this.lookNoOffset });
	},

	moveTo: function(pos) {
		this.eye.copy(pos);
		this.updateCamera();
	},

	move: function() {
		var newPos = new THREE.Vector3();
		var aux = new THREE.Vector3();

		return function(x, z) {
			newPos.copy(this.eye);

			if (x !== 0 || z !== 0) {
				aux.copy(this.rightMoveVector).multiplyScalar(this.moveSpeed * x);
				newPos.add(aux);
				aux.copy(this.forwardMoveVector).multiplyScalar(this.moveSpeed * z);
				newPos.add(aux);
			}

			this.onHandleCollisions(this.eye, newPos);

			this.eye.copy(newPos);
			this.updateCamera();
		}
	}(),

	updateCamera: function() {
		this.followingEye.x = this.eye.x;
		this.followingEye.z = this.eye.z;
		if (this.ySmoothing) {
			if (this.followingEye.y != this.eye.y) {
				this.followingEye.y = this.followingEye.y + this.ySmoothingFactor * (this.eye.y - this.followingEye.y);
			}
		} else {
			this.followingEye.y = this.eye.y;
		}

		this.camera.position.copy(this.followingEye);
		this.camera.position.y += this.viewOffsetY + this.eyeOffsetY;
		this.lookNoOffset.addVectors(this.followingEye, this.forwardLookVector);
		this.look.addVectors(this.camera.position, this.forwardLookVector);
		this.camera.lookAt(this.look);
	},

	setViewAngles: function() {
		var right = new THREE.Vector3();
		var forward = new THREE.Vector3();

		return function(x, y) {
			this.xAngle = x;
			this.yAngle = GS.MathHelper.clamp(y, 10, 170);

			var x = Math.sin(Math.PI / 180 * this.yAngle) * Math.cos(Math.PI / 180 * this.xAngle);
			var y = Math.cos(Math.PI / 180 * this.yAngle);
			var z = Math.sin(Math.PI / 180 * this.yAngle) * Math.sin(Math.PI / 180 * this.xAngle);

			forward.set(x, y, z);

			x = Math.sin(Math.PI / 180 * this.yAngle) * Math.cos(Math.PI / 180 * (this.xAngle + 90));
			z = Math.sin(Math.PI / 180 * this.yAngle) * Math.sin(Math.PI / 180 * (this.xAngle + 90));

			right.set(x, 0, z);

			this.forwardLookVector.copy(forward);
			if (!this.fly) {
				this.forwardMoveVector.set(forward.x, 0, forward.z).normalize();
			}
			else {
				this.forwardMoveVector.copy(forward).normalize();
			}
			this.rightLookVector.copy(right).normalize();
			this.rightMoveVector.copy(right).normalize();

			this.updateCamera();
		}
	}(),

	dispose: function(callback) {
		this.onHandleCollisions = undefined;
		this.disable();
	},
};

THREE.EventDispatcher.prototype.apply(GS.ChromeAppFPSControls.prototype);;GS.CollisionTypes = {
	None: 0,
	Environment: 1,
	Entity: 2,
};

GS.CollisionManager = function(grid) {
	this.grid = grid;
	this.gravity = 1.33;
};

GS.CollisionManager.prototype = {
	init: function() {
	},

	collideOnlinePlayer: function(monster, oldPos, newPos) {
    return this.collideMonster(monster, oldPos, newPos);
  },

	collidePlayer: function() {
		var oldPosBeforeMove = new THREE.Vector3();

		return function(player, oldPos, newPos) {
			oldPosBeforeMove.copy(oldPos);

			this.collidePlayerEnvironment(player, oldPos, newPos);
			this.updateGridLocationEllipsoid(player, newPos);
			this.collidePlayerItems(player);
			this.updatePlayerUseTarget(player);

			this.grid.aiManager.onPlayerMove(player, oldPosBeforeMove, newPos);
		}
	}(),

	collidePlayerEnvironment: function() {
		var points = [ new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() ];
		var points3d = [ new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3() ];
		var velocityBoundingBox = new THREE.Box3();
		var types = [GS.Monster, GS.Concrete, GS.Door, GS.Elevator];

		return function(player, oldPos, newPos) {
			var lsp = player.view.collisionData.ellipsoid;

			points[0].set(oldPos.x + lsp.x, oldPos.z + lsp.z);
			points[1].set(oldPos.x - lsp.x, oldPos.z - lsp.z);
			points[2].set(newPos.x + lsp.x, newPos.z + lsp.z);
			points[3].set(newPos.x - lsp.x, newPos.z - lsp.z);

			var gridLocation = this.grid.getGridLocationFromPoints(points);

			points3d[0].copy(oldPos).sub(player.size);
			points3d[1].copy(oldPos).add(player.size);
			points3d[2].copy(newPos).sub(player.size);
			points3d[3].copy(newPos).add(player.size);

			velocityBoundingBox.setFromPoints(points3d);
			velocityBoundingBox.expandByScalar(this.gravity * 2);

			if (gridLocation === undefined) {
				return;
			}

			var triangleIterator = this.grid.getTriangleIterator(gridLocation, types, function(gridObject) {
				if (gridObject instanceof GS.Monster && gridObject.dead) {
					return false;
				}
				return gridObject.view.collisionData.boundingBox.isIntersectionBox(velocityBoundingBox);
			});

			var gravity = player.flyEnabled ? 0 : this.gravity;
			var result = GS.CollisionHelper.handleCollisionsSliding(oldPos, newPos, gravity, lsp, triangleIterator);
			player.afterCollision(result);
		}
	}(),

	slidingBoxLineCollision: function() {
		var newPos0 = new THREE.Vector2();
		var aux = new THREE.Vector2();
		var slideVelocity = new THREE.Vector2();
		var epsilon = 0.005;

		return function(oldPos, newPos, box, lineSegmentIterator) {
			newPos0.copy(newPos);

			var k = 0;
			var foundCollision;

			while (k < 5) {
				foundCollision = false;

				lineSegmentIterator(iterator);

				if (!foundCollision) {
					break;
				}

				k++;
			}

			newPos.copy(newPos0);

			function iterator(seg) {
				GAME.grid.totalBoxSegmentChecks++;
				var result = box.isIntersectionLineSwept(oldPos, newPos0, seg);

				if (result.foundCollision) {
					foundCollision = true;

					aux.copy(newPos0).sub(result.pos);
					var m = -aux.dot(result.normal);

					slideVelocity.copy(aux);
					aux.copy(result.normal).multiplyScalar(m);
					slideVelocity.add(aux);

					aux.copy(result.pos).sub(newPos0).normalize().multiplyScalar(epsilon);
					result.pos.add(aux);

					newPos0.copy(result.pos).add(slideVelocity);
				}
			}
		}
	}(),

	collidePlayerItems: function(player) {
		var that = this;
		this.grid.forEachUniqueGridObjectInCells(player.linkedGridCells, [GS.Item], function(item) {
			if (player.view.collisionData.boundingBox.isIntersectionBox(item.view.collisionData.boundingBox)) {
				player.onItemCollision(item);
			}
		});
	},

	updatePlayerUseTarget: function(player) {
		var ray = new THREE.Ray();
		var position = new THREE.Vector3();
		var endPoint = new THREE.Vector3();
		var aux = new THREE.Vector3();
		var points = [ new THREE.Vector2(), new THREE.Vector2() ];
		var usableTypes = [GS.Door, GS.Switch];

		return function(player) {
			player.useTarget = null;

			position.copy(player.position);
			position.y += player.controls.eyeOffsetY;

			ray.set(position, player.direction);
			aux.copy(player.direction).multiplyScalar(player.useRange);
			endPoint.copy(position).add(aux);

			position.toVector2(points[0]);
			endPoint.toVector2(points[1]);

			var gridLocation = this.grid.getGridLocationFromPoints(points);
			if (gridLocation === undefined) {
				return;
			}

			var cells = this.grid.getCellsFromGridLocation(gridLocation);
			var minDist = Infinity;
			var minObject = null;
			this.grid.forEachUniqueGridObjectInCells(cells, usableTypes, function(gridObject) {
				if (ray.intersectsOrStartsInBox(gridObject.view.collisionData.boundingBox, aux) !== null) {
					var dist = aux.distanceTo(position);
					if (dist <= player.useRange && dist < minDist) {
						minDist = dist;
						minObject = gridObject;
					}
				}
			});

			player.useTarget = minObject;
			player.canUse = (minObject !== null && minObject.usable);
		}
	}(),

	checkMonsterLineOfSight: function() {
		var direction = new THREE.Vector3();
		var position = new THREE.Vector3();
		var typesEnvironment = [GS.Elevator, GS.Door, GS.Concrete];
		var typesEntity = [GS.Player];

		return function(monster, target, range) {
			position.copy(monster.position);
			direction.copy(target.position).sub(monster.position).normalize();

			var steps = Math.ceil(range / GS.HitscanHelper.unitLength);
			var result = GS.HitscanHelper.getIntersection(position, direction, this.grid, typesEnvironment, typesEntity, steps, monster);
			return (result.type === GS.CollisionTypes.Entity && result.gridObject === target);
		}
	}(),

	collideMonster: function(monster, oldPos, newPos) {
		this.collideMonsterPlayerEnvironment(monster, oldPos, newPos);
		this.updateGridLocationEllipsoid(monster, newPos);
	},

	collideMonsterPlayerEnvironment: function() {
		var points = [ new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() ];
		var types = [GS.Player, GS.Monster, GS.OnlinePlayer];
		var aux = new THREE.Vector3();
		var velocity = new THREE.Vector2();
		var velocityBox = new THREE.Box2();

		return function(monster, oldPos, newPos) {
			var lsp = monster.view.collisionData.ellipsoid;

			points[0].set(oldPos.x + lsp.x, oldPos.z + lsp.z);
			points[1].set(oldPos.x - lsp.x, oldPos.z - lsp.z);
			points[2].set(newPos.x + lsp.x, newPos.z + lsp.z);
			points[3].set(newPos.x - lsp.x, newPos.z - lsp.z);

			var gridLocation = this.grid.getGridLocationFromPoints(points);

			if (gridLocation === undefined) {
				return;
			}

			this.handleConcreteCollisions(gridLocation, oldPos, newPos, monster.size);

			points[0].set(oldPos.x + lsp.x, oldPos.z + lsp.z);
			points[1].set(oldPos.x - lsp.x, oldPos.z - lsp.z);
			points[2].set(newPos.x + lsp.x, newPos.z + lsp.z);
			points[3].set(newPos.x - lsp.x, newPos.z - lsp.z);

			gridLocation = this.grid.getGridLocationFromPoints(points);

			if (gridLocation !== undefined) {
				var cells = this.grid.getCellsFromGridLocation(gridLocation);
				aux.subVectors(newPos, oldPos).toVector2(velocity);
				velocityBox.copy(monster.view.collisionData.boundingSquare);
				velocityBox.min.add(velocity);
				velocityBox.max.add(velocity);

				var foundCollision = false;
				var collisionGridObject = null;
				this.grid.forEachUniqueGridObjectInCells(cells, types, function(gridObject) {
					if (foundCollision || gridObject === monster || (gridObject instanceof GS.Monster || gridObject instanceof GS.OnlinePlayer && gridObject.dead)) {
						return;
					}

					if (velocityBox.isIntersectionBox(gridObject.view.collisionData.boundingSquare)) {
						foundCollision = true;
						collisionGridObject = gridObject;
					}
				});

				if (!foundCollision) {
				} else {
					var y = newPos.y;
					newPos.copy(oldPos);
					newPos.y = y;
					if (collisionGridObject instanceof GS.Monster) {
						monster.scatter();
					}
				}
			}
		}
	}(),

	handleConcreteCollisions: function() {
		var oldPos2d = new THREE.Vector2();
		var newPos2d = new THREE.Vector2();
		var size2d = new THREE.Vector2();

		var box = new THREE.Box2();
		var boxNew = new THREE.Box2();

		return function(gridLocation, oldPos, newPos, size) {
			oldPos.toVector2(oldPos2d);
			newPos.toVector2(newPos2d);
			size.toVector2(size2d);

			box.min.copy(oldPos2d).sub(size2d);
			box.max.copy(oldPos2d).add(size2d);
			boxNew.min.copy(newPos2d).sub(size2d);
			boxNew.max.copy(newPos2d).add(size2d);

			var cells = this.grid.getCellsFromGridLocation(gridLocation);
			var newSector = this.getSectorHeights(cells, boxNew);

			var condition = function() { return true; };
			if (newSector !== undefined) {
				var currentHeight = newPos.y - size.y;
				var newHeight = newSector.floorHeight;

				if (Math.abs(newSector.ceilHeight - newSector.floorHeight) >= size.y * 2) {
					newPos.y = newHeight + size.y;
					var minHeight = newPos.y - size.y + 0.03;
					var maxHeight = newPos.y + size.y + 0.03;

					condition = function(seg) {
						return (seg.bottomY >= minHeight && seg.bottomY <= maxHeight ||
							seg.topY >= minHeight && seg.topY <= maxHeight ||
							seg.bottomY < minHeight && seg.topY > maxHeight);
					};
				}

				var segmentIterator = this.grid.getSegmentIterator(gridLocation, condition);
				this.slidingBoxLineCollision(oldPos2d, newPos2d, box, segmentIterator);

				newPos.x = newPos2d.x;
				newPos.z = newPos2d.y;
			} else {
				newPos.copy(oldPos);
			}
		}
	}(),

	getSectorHeights: function(cells, box) {
		var heights = [];

		var result = {
			floorHeight: -Infinity,
			ceilHeight: Infinity,
		};

		var sector;
		this.grid.forEachUniqueGridObjectInCells(cells, [GS.Concrete, GS.Elevator], function(gridObject) {
			if (gridObject instanceof GS.Concrete) {
				if (gridObject.type === GS.MapLayers.Sector) {
					sector = gridObject.sourceObj;
				} else {
					return;
				}
			} else {
				sector = gridObject.sector;
			}

			GAME.grid.totalBoxSectorChecks++;
			if (GS.PolygonHelper.intersectionSectorBox(sector, box)) {
				var floorHeight = sector.floorTopY;
				if (floorHeight > result.floorHeight) {
					result.floorHeight = floorHeight;
					result.ceilHeight = (sector.ceiling === true) ? sector.ceilBottomY : Infinity;
				}
				heights.push(floorHeight);
			}
		});

		if (heights.length > 0) {
			heights.sort();

			var maxDistance = 0;
			var distance;
			for (var i = 0; i < heights.length - 1; i++) {
				distance = Math.abs(heights[i + 1] - heights[i]);
				if (distance > maxDistance) {
					maxDistance = distance;
				}
			}

			if (maxDistance <= 6) {
				return result;
			}
		}

		return undefined;
	},

	isEntityNearDoor: function(door, types) {
		types = types || [GS.Monster, GS.Player];

		var that = this;
		var collided = false;
		var doorBoundingBox = door.view.collisionData.boundingBox;

		this.grid.forEachUniqueGridObjectInCells(door.linkedGridCells, types, function(gridObject) {
			if (!collided) {
				if (!gridObject.dead && doorBoundingBox.isIntersectionBox(gridObject.view.collisionData.boundingBox)) {
					collided = true;
				}
			}
		});

		return collided;
	},

	elevatorMove: function() {
		var newPos = new THREE.Vector3();
		var pos2d = new THREE.Vector2();

		return function(elevator, velocity) {
			var types = [GS.Item];
			if (velocity > 0) {
				types.push(GS.Monster);
				types.push(GS.Player);
			}

			var that = this;
			var elevatorBoundingBox = elevator.view.collisionData.boundingBox;

			var boundingBox;
			this.grid.forEachUniqueGridObjectInCells(elevator.linkedGridCells, types, function(gridObject) {
				if (gridObject instanceof GS.Item) {
					if (gridObject.isStatic === true) {
						return;
					}
				}

				boundingBox = gridObject.view.collisionData.boundingBox;
				if (boundingBox.isIntersectionBox(elevatorBoundingBox)) {
					if (gridObject instanceof GS.Item) {
						if (gridObject.elevatorId !== undefined) {
							if (gridObject.elevatorId != elevator.id) {
								return;
							}
						} else {
							gridObject.position.toVector2(pos2d);
							if (GS.PolygonHelper.sectorContainsPoint(elevator.sector, pos2d, true)) {
								gridObject.elevatorId = elevator.id;
							} else {
								return;
							}
						}
					}

					newPos.copy(gridObject.position);
					newPos.y += velocity;
					gridObject.updateCollisionData(newPos);
				}
			});
		}
	}(),

	collideProjectile: function() {
		var points = [ new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() ];
		var normal = new THREE.Vector3();

		return function(projectile, oldPos, newPos) {
			var lsp = projectile.view.collisionData.ellipsoid;

			points[0].set(oldPos.x + lsp.x, oldPos.z + lsp.z);
			points[1].set(oldPos.x - lsp.x, oldPos.z - lsp.z);
			points[2].set(newPos.x + lsp.x, newPos.z + lsp.z);
			points[3].set(newPos.x - lsp.x, newPos.z - lsp.z);

			var gridLocation = this.grid.getGridLocationFromPoints(points);
			if (gridLocation === undefined) {
				return;
			}

			var result = {
				type: GS.CollisionTypes.None,
				pos: new THREE.Vector3(),
				gridObject: null,
				distance: Infinity,
				normal: new THREE.Vector3(),
			};

			this.collideProjectileEnvironment(projectile, gridLocation, oldPos, newPos, result);
			this.collideProjectileEntities(projectile, gridLocation, oldPos, newPos, result);

			if (result.type !== GS.CollisionTypes.None) {
				if (result.type === GS.CollisionTypes.Environment) {
					this.grid.addEnvironmentImpactParticles(result.pos, result.normal, projectile.color);
					result.gridObject.onHit(projectile);
				} else
				if (result.type === GS.CollisionTypes.Entity) {
					if (result.gridObject.constructor === projectile.sourceGridObject.constructor) {
						normal.copy(result.pos).sub(projectile.position).normalize();
						this.grid.addEnvironmentImpactParticles(result.pos, normal, projectile.color);
					} else {
						this.grid.addEntityImpactParticles(result.pos, result.gridObject.bloodColor);
						result.gridObject.onHit(projectile);
					}
				}

				projectile.updateCollisionData(result.pos);
				projectile.onHit();
			} else {
				projectile.updateCollisionData(newPos);
			}

			if (!projectile.removed) {
				this.updateGridLocationEllipsoid(projectile, newPos);
			}
		}
	}(),

	collideProjectileEnvironment: function() {
		var points3d = [ new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3() ];
		var velocityBoundingBox = new THREE.Box3();
		var types = [GS.Concrete, GS.Door, GS.Elevator];

		return function(projectile, gridLocation, oldPos, newPos, result) {
			var that = this;

			var lsp = projectile.view.collisionData.ellipsoid;

			points3d[0].copy(oldPos).sub(projectile.size);
			points3d[1].copy(oldPos).add(projectile.size);
			points3d[2].copy(newPos).sub(projectile.size);
			points3d[3].copy(newPos).add(projectile.size);

			velocityBoundingBox.setFromPoints(points3d);

			var triangleIterator = this.grid.getTriangleIterator(gridLocation, types, function(gridObject) {
				return gridObject.view.collisionData.boundingBox.isIntersectionBox(velocityBoundingBox);
			});

			var triangleResult = GS.CollisionHelper.handleCollisionsFirstHit(oldPos, newPos, 0, lsp, triangleIterator);
			if (triangleResult.foundCollision) {
				var dist = oldPos.distanceToSquared(triangleResult.pos);

				if (dist < result.distance) {
					result.type = GS.CollisionTypes.Environment;
					result.pos.copy(triangleResult.pos);
					result.normal.copy(triangleResult.normal);
					result.distance = dist;
					result.gridObject = triangleResult.gridObject;
				}
			}
		}
	}(),

	collideProjectileEntities: function() {
		var minPos = new THREE.Vector3();
		var collisionPoint = new THREE.Vector3();
		var types = [GS.Monster, GS.Player];

		return function(projectile, gridLocation, oldPos, newPos, result) {
			var that = this;
			var projectileBox = projectile.view.collisionData.boundingBox;
			var gridObjectBox;
			var cells = this.grid.getCellsFromGridLocation(gridLocation);

			this.grid.forEachUniqueGridObjectInCells(cells, types, function(gridObject) {
				if (gridObject.dead || projectile.sourceGridObject === gridObject) {
					return;
				}

				gridObjectBox = gridObject.view.collisionData.boundingBox;

				if (projectileBox.isIntersectionBoxSwept(oldPos, newPos, gridObjectBox, gridObject.position, collisionPoint)) {
					var dist = oldPos.distanceToSquared(collisionPoint);

					if (dist < result.distance) {
						result.type = GS.CollisionTypes.Entity;
						result.pos.copy(collisionPoint);
						result.distance = dist;
						result.gridObject = gridObject;
					}
				}
			});
		}
	}(),

	updateGridLocationEllipsoid: function() {
		var points = [ new THREE.Vector2(), new THREE.Vector2() ];

		return function(gridObject, newPos) {
			var lsp = gridObject.view.collisionData.ellipsoid;

			points[0].set(newPos.x + lsp.x, newPos.z + lsp.z);
			points[1].set(newPos.x - lsp.x, newPos.z - lsp.z);

			var gridLocation = this.grid.getGridLocationFromPoints(points);
			gridObject.assignToCells(gridLocation);
			gridObject.updateCollisionData(newPos);
		}
	}(),

	hitscan: function(sourceGridObject, projectileStart, weapon, xAngle, yAngle) {
		var that = this;
		var typesEnvironment = [GS.Concrete, GS.Door, GS.Elevator];
		var typesEntity = [];

		if (sourceGridObject instanceof GS.Player) {
			typesEntity.push(GS.Monster);
		}

		GS.HitscanHelper.spread(weapon, xAngle, yAngle, function(dir) {
			var result = GS.HitscanHelper.getIntersection(projectileStart, dir, that.grid, typesEnvironment, typesEntity);

			if (result.type === GS.CollisionTypes.Environment) {
				that.grid.addEnvironmentImpactParticles(result.pos, result.normal,
					weapon.impactParticleColor, weapon.impactParticleCount);
				result.gridObject.onHit();
			} else
			if (result.type === GS.CollisionTypes.Entity) {
				that.grid.addEntityImpactParticles(result.pos, result.gridObject.bloodColor);
				result.gridObject.onHit({ damage: weapon.damage });
			}
		});
	},
};
;GS.FPSControls = function(camera) {
	this.camera = camera;

	this.eye = new THREE.Vector3();
	this.followingEye = new THREE.Vector3();
	this.look = new THREE.Vector3(0, 0, -10).add(this.eye);
	this.lookNoOffset = this.look.clone();

	this.moveSpeed = 1;
	this.lookSpeed = 0.066 * (GS.Settings.mouse / 5);
	this.mouseInvertY = GS.Settings.mouseInvertY;

	this.forwardLookVector = new THREE.Vector3(0, 0, -1);
	this.forwardMoveVector = new THREE.Vector3(0, 0, -1);
	this.rightLookVector = new THREE.Vector3(1, 0, 0);
	this.rightMoveVector = new THREE.Vector3(1, 0, 0);

	this.xAngle = 270;
	this.yAngle = 90;
	this.viewOffsetY = 0;
	this.eyeOffsetY = 3.5;

	this.pointerLockEnabled = false;

	this.onHandleCollisions = function(oldPos, newPos) {};

	this.enabled = true;
	this.fly = false;
	this.ySmoothing = false;
	this.ySmoothingFactor = 0.1;	
};

GS.FPSControls.prototype = {
	constructor: GS.FPSControls,

	init: function() {
		var that = this;
		var pointerLock = "pointerLockElement" in document || "mozPointerLockElement" in document || "webkitPointerLockElement" in document;
		if (!pointerLock) {
			throw "Pointer Lock API not supported";
		}

		this.attachEvents();

		this.setViewAngles(this.xAngle, this.yAngle);
	},

	attachEvents: function() {
		var that = this;

		$(document).on("pointerlockchange.fpsControls", function(e) { that.onPointerLockChange(e); });
		$(document).on("mozpointerlockchange.fpsControls", function(e) { that.onPointerLockChange(e); });
		$(document).on("webkitpointerlockchange.fpsControls", function(e) { that.onPointerLockChange(e); });

		$(document).on("pointerlockerror.fpsControls", function(e) { that.onPointerLockError(e); });
		$(document).on("mozpointerlockerror.fpsControls", function(e) { that.onPointerLockError(e); });
		$(document).on("webkitpointerlockerror.fpsControls", function(e) { that.onPointerLockError(e); });

		this.canvas = $("#game-canvas")[0];
		this.debugCanvas = $("#debug-ui-canvas")[0];

		var rightMouseDown = false;
		$(this.debugCanvas).on("mousedown.fpsControls", function(e) { 
			if (e.which == 3) { 
				rightMouseDown = true; 
			} 
		});
		$(this.debugCanvas).on("mouseup.fpsControls", function(e) { 
			if (e.which == 3 && rightMouseDown) { 
				rightMouseDown = false; 
				that.enable(); 
			}
		});
	},
	
	detachEvents: function() {
		$(this.debugCanvas).off("mousedown.fpsControls");
		$(this.debugCanvas).off("mouseup.fpsControls");

		$(document).off("pointerlockchange.fpsControls");
		$(document).off("mozpointerlockchange.fpsControls");
		$(document).off("webkitpointerlockchange.fpsControls");

		$(document).off("pointerlockerror.fpsControls");
		$(document).off("mozpointerlockerror.fpsControls");
		$(document).off("webkitpointerlockerror.fpsControls");
	},

	enable: function() {
		if (!this.pointerLockEnabled) {
			this.canvas.requestPointerLock = this.canvas.requestPointerLock || 
				this.canvas.mozRequestPointerLock || this.canvas.webkitRequestPointerLock;
			this.canvas.requestPointerLock();
		}
	},

	disable: function() {
		if (this.pointerLockEnabled) {
			document.exitPointerLock = document.exitPointerLock || document.mozExitPointerLock || document.webkitExitPointerLock;
			document.exitPointerLock();			
		}
	},

	onPointerLockChange: function(e) {
		var that = this;

		var isCanvas = document.pointerLockElement === this.canvas || document.mozPointerLockElement === this.canvas ||
			document.webkitPointerLockElement === this.canvas;

		if (isCanvas) {
			this.pointerLockEnabled = true;
			$(document).on("mousemove.fpsControls", function(e) { that.onMouseMove(e.originalEvent); });
			this.dispatchEvent({ type: "pointerLockEnabled" });
		} else {
			this.pointerLockEnabled = false;
			$(document).off("mousemove.fpsControls");

			if (this.disposeCallback !== undefined) {
				this.detachEvents();
				this.disposeCallback();
			} else {
				this.dispatchEvent({ type: "pointerLockDisabled" });
			}
		}
	},

	onPointerLockError: function() {
	},

	onMouseMove: function(e) {
		if (!this.enabled) {
			return
		}

		var mx = e.movementX || e.mozMovementX || e.webkitMovementX || 0;
		var my = e.movementY || e.mozMovementY || e.webkitMovementY || 0;

		var invertY = this.mouseInvertY ? -1 : 1;

		this.setViewAngles(this.xAngle + mx * this.lookSpeed, this.yAngle + invertY * my * this.lookSpeed);
	},

	setViewOffsetY: function(y) {
		this.viewOffsetY = y;
	},

	update: function() {
		if (!this.enabled) {
			return;
		}

		var x = 0;
		var z = 0;

		if (GS.Keybinds.moveForward.inUse) {
			z++;
		}
		if (GS.Keybinds.moveBackward.inUse) {
			z--;
		}
		if (GS.Keybinds.strafeLeft.inUse) {
			x--;
		}
		if (GS.Keybinds.strafeRight.inUse) {
			x++;
		}

		this.move(x, z);
		this.dispatchEvent({ type: "update", pos: this.eye, xAngle: this.xAngle, yAngle: this.yAngle, look: this.lookNoOffset });
	},

	moveTo: function(pos) {
		this.eye.copy(pos);
		this.updateCamera();
	},

	move: function() {
		var newPos = new THREE.Vector3();
		var aux = new THREE.Vector3();

		return function(x, z) {
			newPos.copy(this.eye);

			if (x !== 0 || z !== 0) {
				aux.copy(this.rightMoveVector).multiplyScalar(this.moveSpeed * x);
				newPos.add(aux);
				aux.copy(this.forwardMoveVector).multiplyScalar(this.moveSpeed * z);
				newPos.add(aux);
			}

			this.onHandleCollisions(this.eye, newPos);

			this.eye.copy(newPos);
			this.updateCamera();
		}
	}(),

	updateCamera: function() {
		this.followingEye.x = this.eye.x;
		this.followingEye.z = this.eye.z;
		if (this.ySmoothing) {
			if (this.followingEye.y != this.eye.y) {
				this.followingEye.y = this.followingEye.y + this.ySmoothingFactor * (this.eye.y - this.followingEye.y);
			}
		} else {
			this.followingEye.y = this.eye.y;
		}

		this.camera.position.copy(this.followingEye);
		this.camera.position.y += this.viewOffsetY + this.eyeOffsetY;
		this.lookNoOffset.addVectors(this.followingEye, this.forwardLookVector);
		this.look.addVectors(this.camera.position, this.forwardLookVector);
		this.camera.lookAt(this.look);
	},
	
	setViewAngles: function() {
		var right = new THREE.Vector3();
		var forward = new THREE.Vector3();

		return function(x, y) {
			this.xAngle = x;
			this.yAngle = GS.MathHelper.clamp(y, 10, 170);

			var x = Math.sin(Math.PI / 180 * this.yAngle) * Math.cos(Math.PI / 180 * this.xAngle);
			var y = Math.cos(Math.PI / 180 * this.yAngle);
			var z = Math.sin(Math.PI / 180 * this.yAngle) * Math.sin(Math.PI / 180 * this.xAngle);

			forward.set(x, y, z);

			x = Math.sin(Math.PI / 180 * this.yAngle) * Math.cos(Math.PI / 180 * (this.xAngle + 90));
			z = Math.sin(Math.PI / 180 * this.yAngle) * Math.sin(Math.PI / 180 * (this.xAngle + 90));

			right.set(x, 0, z);

			this.forwardLookVector.copy(forward);
			if (!this.fly) {
				this.forwardMoveVector.set(forward.x, 0, forward.z).normalize();
			}
			else {
				this.forwardMoveVector.copy(forward).normalize();
			}
			this.rightLookVector.copy(right).normalize();
			this.rightMoveVector.copy(right).normalize();

			this.updateCamera();
		}
	}(),

	dispose: function(callback) {
		if (this.pointerLockEnabled) {
			this.disposeCallback = callback;
		}

		this.onHandleCollisions = undefined;
		this.disable();

		if (!this.pointerLockEnabled) {
			this.detachEvents();
			callback();
		}
	},
};

THREE.EventDispatcher.prototype.apply(GS.FPSControls.prototype);;GS.GraphicsManager = function(renderer, camera) {
	this.renderer = renderer;
	this.camera = camera;

	this.noPostProcessing = false;
	this.noiseTextureSize = 256;

	this.showWeapon = GS.Settings.showWeapon;
};

GS.GraphicsManager.prototype = {
	init: function() {
		this.initEffectComposer();

		this.bloomEnabled = GS.Settings.bloom;
		this.fxaaEnabled = GS.Settings.fxaa;
		this.ssaoEnabled = GS.Settings.ssao;
		this.noiseEnabled = GS.Settings.noise;
		this.vignetteEnabled = GS.Settings.vignette;		
		this.halfSizeEnabled = GS.Settings.halfSize;

		this.monochromeEnabled = false;
	},

	setGrid: function(grid) {
		var that = this;

		this.grid = grid;
		this.scene = grid.scene;

		that.effectColor.uniforms["color"].value.setRGB(0, 0, 0);
		grid.player.playerView.addEventListener("screenOverlayColorChange", function(e) {
			that.effectColor.uniforms["color"].value.copy(e.color);
		});
	},

	initEffectComposer: function() {
		this.composer = new THREE.EffectComposer(this.renderer);

		var depthShader = THREE.ShaderLib["depthRGBA"];
		var depthUniforms = THREE.UniformsUtils.clone(depthShader.uniforms);

		this.depthMaterial = new THREE.ShaderMaterial({ 
			fragmentShader: depthShader.fragmentShader, 
			vertexShader: depthShader.vertexShader, 
			uniforms: depthUniforms 
		});
		this.depthMaterial.blending = THREE.NoBlending;

		this.depthTarget = new THREE.WebGLRenderTarget(window.innerWidth, window.innerHeight, { 
			minFilter: THREE.NearestFilter, 
			magFilter: THREE.NearestFilter, 
			format: THREE.RGBAFormat 
		});

		this.effectSSAO = new THREE.ShaderPass(THREE.SSAOShader);
		this.effectSSAO.uniforms["tDepth"].value = this.depthTarget;
		this.effectSSAO.uniforms["size"].value.set(window.innerWidth, window.innerHeight);
		this.effectSSAO.uniforms["cameraNear"].value = this.camera.near;
		this.effectSSAO.uniforms["cameraFar"].value = this.camera.far;

		this.effectFilter = new THREE.ShaderPass(GS.BrightnessFilterShader);
		this.effectBloom = new THREE.BloomPass(1, 25, 4, 512);
		this.effectBloom.needsSwap = true;

		this.effectGlow = new THREE.ShaderPass(GS.GlowShader);
		this.effectGlow.uniforms["tGlow"].value = this.effectBloom.renderTargetY;
		this.effectGlow.uniforms["intensity"].value = 1;

		this.effectColor = new THREE.ShaderPass(GS.ColorShader);
		this.effectColor.uniforms["color"].value = new THREE.Color(0x000000);

		this.effectFXAA = new THREE.ShaderPass(THREE.FXAAShader);
		this.effectFXAA.uniforms["resolution"].value.set(1 / window.innerWidth, 1 / window.innerHeight);

		this.effectVignette = new THREE.ShaderPass(THREE.VignetteShader);
		this.effectNoise = new THREE.ShaderPass(GS.NoiseShader);
		this.effectNoise.uniforms["tNoise"].value = this.getNoiseTexture(this.noiseTextureSize);
		this.effectNoise.uniforms["ratio"].value.set(window.innerWidth / this.noiseTextureSize, window.innerHeight / this.noiseTextureSize);

		this.effectMonochrome = new THREE.ShaderPass(THREE.LuminosityShader);

		var effectCopy = new THREE.ShaderPass(THREE.CopyShader);
		effectCopy.renderToScreen = true;

		this.composer.addPass(this.effectFilter);
		this.composer.addPass(this.effectBloom);
		this.composer.addPass(this.effectNoise);
		this.composer.addPass(this.effectGlow);
		this.composer.addPass(this.effectSSAO);
		this.composer.addPass(this.effectColor);
		this.composer.addPass(this.effectFXAA);
		this.composer.addPass(this.effectVignette);		
		this.composer.addPass(this.effectMonochrome);
		this.composer.addPass(effectCopy);
	},

	renderToScreen: function() {
		this.renderer.autoClear = false;

		this.renderer.clear(true, true, false);

		this.renderer.render(this.grid.skybox.scene, this.grid.skybox.camera);
		this.renderer.render(this.scene, this.camera);

		this.renderer.clear(false, true, false);

		var playerView = this.grid.player.playerView;
		this.renderer.render(playerView.scene, playerView.camera);
	},

	render: function() {
		var renderTarget = this.composer.renderTarget2;
		this.renderer.autoClear = false;

		this.renderer.clearTarget(renderTarget, true, true, false);

		this.renderer.render(this.grid.skybox.scene, this.grid.skybox.camera, renderTarget);
		this.renderer.render(this.scene, this.camera, renderTarget);

		this.renderer.clearTarget(renderTarget, false, true, false);

		if (this.showWeapon) {
			var playerView = this.grid.player.playerView;
			this.renderer.render(playerView.scene, playerView.camera, renderTarget);
		}
	},

	renderDepthTarget: function() {
		var renderTarget = this.depthTarget;
		this.renderer.autoClear = false;

		this.renderer.clearTarget(renderTarget, true, true, false);

		this.scene.overrideMaterial = this.depthMaterial;
		this.renderer.render(this.scene, this.camera, renderTarget);
		this.scene.overrideMaterial = null;

		this.renderer.clearTarget(renderTarget, false, true, false);

		if (this.showWeapon) {
			var playerView = this.grid.player.playerView;
			playerView.scene.overrideMaterial = this.depthMaterial;
			this.renderer.render(playerView.scene, playerView.camera, renderTarget);
			playerView.scene.overrideMaterial = null;
		}
	},

	draw: function() {
		if (this.noPostProcessing) {
			this.renderToScreen();
		} else {			
			this.render();

			if (this.ssaoEnabled) {
				this.renderDepthTarget();
			}

			this.composer.render();
		}
	},

	onResize: function() {
		var width = window.innerWidth;
		var height = window.innerHeight;

		if (this._halfSizeEnabled) {
			width *= 0.5;
			height *= 0.5;
		}

		var depthTarget = this.depthTarget.clone();
		depthTarget.width = width;
		depthTarget.height = height;
		this.depthTarget = depthTarget;
		this.effectSSAO.uniforms["tDepth"].value = this.depthTarget;

		this.effectSSAO.uniforms["size"].value.set(width, height);
		this.effectFXAA.uniforms["resolution"].value.set(1 / width, 1 / height);
		this.effectNoise.uniforms["ratio"].value.set(width / this.noiseTextureSize, height / this.noiseTextureSize);
		this.composer.setSize(width, height);

		$(this.renderer.domElement).css("width", window.innerWidth + "px").css("height", window.innerHeight + "px");
	},

	getNoiseTexture: function(size) {
		size = size || 256;

		var canvas = document.createElement("canvas");
		canvas.width = size;
		canvas.height = size;
		canvas.style.backgroundColor = "rgba(255, 255, 255, 1)";

		var ctx = canvas.getContext("2d");
		ctx.globalCompositeOperation = "source-over";
		ctx.save();

		var imageData = ctx.getImageData(0, 0, size, size);
		for (var i = 0, n = size * size * 4; i < n; i += 4) {
			var x = Math.floor(Math.random() * 255);
			imageData.data[i] = x;
			imageData.data[i + 1] = x;
			imageData.data[i + 2] = x;
			imageData.data[i + 3] = 255;
		}

		ctx.putImageData(imageData, 0, 0);

		var tex = new THREE.Texture(canvas);
		tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
		tex.needsUpdate = true;
		return tex;
	},

	reset: function() {
		this.grid = undefined;
		this.scene = undefined;
	},

	set ssaoEnabled(value) {
		if (this.effectSSAO !== undefined) {
			this.effectSSAO.enabled = value;
		}
	},

	get ssaoEnabled() {
		return this.effectSSAO.enabled;
	},

	set bloomEnabled(value) {
		if (this.effectBloom !== undefined) {
			this.effectFilter.enabled = value;
			this.effectBloom.enabled = value;
			this.effectGlow.enabled = value;
		}
	},

	get bloomEnabled() {
		return this.effectBloom.enabled;
	},

	set fxaaEnabled(value) {
		if (this.effectFXAA !== undefined) {
			this.effectFXAA.enabled = value;
		}
	},

	get fxaaEnabled() {
		return this.effectFXAA.enabled;
	},

	set vignetteEnabled(value) {
		if (this.effectVignette !== undefined) {
			this.effectVignette.enabled = value;
		}
	},

	get vignetteEnabled() {
		return this.effectVignette.enabled;
	},

	set monochromeEnabled(value) {
		if (this.effectMonochrome !== undefined) {
			this.effectMonochrome.enabled = value;
		}
	},

	get monochromeEnabled() {
		return this.effectMonochrome.enabled;
	},

	set noiseEnabled(value) {
		if (this.effectNoise !== undefined) {
			this.effectNoise.enabled = value;
		}
	},

	get noiseEnabled() {
		return this.effectNoise.enabled;
	},

	set halfSizeEnabled(value) {		
		this._halfSizeEnabled = value;
		this.onResize();
	},

	get halfSizeEnabled() {
		return this._halfSizeEnabled;
	},
};;GS.Grid = function(renderer, scene) {
	this.renderer = renderer;
	this.scene = scene;

	this.concreteMeshes = new THREE.Object3D();
	this.entityMeshes = new THREE.Object3D();

	this.stopMonsters = false;

	this.debugEntityMeshes = false;
	this.debugConcreteMeshes = false;
	this.debugCellLines = false;
};

GS.Grid.prototype = {
	constructor: GS.Grid,

	init: function() {
		this.particleView = new GS.ParticleView(this);
		this.particleView.init();

		this.collisionManager = new GS.CollisionManager(this);
		this.collisionManager.init();

		this.lightingView = new GS.LightingView(this);
		this.lightingView.init();

		this.forEachUniqueGridObject(undefined, function(gridObject) {
			gridObject.init();
		});

		this.aiManager = new GS.AIManager(this);
		this.aiManager.init();

		this.addConcreteMeshesToScene();
		this.addEntityMeshesToScene();

		if (this.debugCellLines) {
			this.addDebugCellLines();
		}
	},

	initSkybox: function(skyboxMesh) {
		this.skybox = {
			mesh: skyboxMesh,
			scene: new THREE.Scene(),
			camera: new THREE.PerspectiveCamera(GS.Settings.fov, window.innerWidth / window.innerHeight, 1, 2000),
		}
		this.skybox.scene.add(skyboxMesh);
	},

	update: function() {
		var that = this;

		this.particleView.update();
		this.lightingView.update();
		this.aiManager.update();

		this.totalSphereTriangleChecks = 0;
		this.totalBoxSectorChecks = 0;
		this.totalBoxSegmentChecks = 0;

		var projectileCount = 0;
		var itemCount = 0;
		var activeMonsterCount = 0;

		this.forEachUniqueGridObject(undefined, function(gridObject) {
			if (gridObject instanceof GS.Monster) {
				if (!that.stopMonsters) {
					gridObject.update();
				}
			} else {
				gridObject.update();
			}
		});

		if (this.player.linkedGridCells.length === 0) {
			this.player.update();
		}

		var rotationMatrix = new THREE.Matrix4().extractRotation(this.player.camera.matrixWorld);
		this.skybox.camera.rotation.setFromRotationMatrix(rotationMatrix, this.skybox.camera.rotation.order);

		// GS.DebugUI.trackNumericValue("total box sector checks", this.totalBoxSectorChecks);
		// GS.DebugUI.trackNumericValue("total box segment checks", this.totalBoxSegmentChecks);
		// GS.DebugUI.trackNumericValue("total sphere triangle checks", this.totalSphereTriangleChecks);
	},

	addConcreteMeshesToScene: function() {
		var that = this;
		this.forEachUniqueGridObject([GS.Concrete], function(gridObject) {
			if (that.debugConcreteMeshes) {
				that.concreteMeshes.children.push(gridObject.view.debugMesh);
			}
		});

		var regions = this.regionInfo.regions;
		for (var i = 0; i < regions.length; i++) {
			var mesh = regions[i].mesh;

			var bufferGeo = new THREE.BufferGeometry();
			bufferGeo.fromGeometry(mesh.geometry, {
				vertexColors: THREE.FaceColors
			});
			mesh.geometry = bufferGeo;

			this.concreteMeshes.children.push(mesh);
		}

		this.scene.add(this.concreteMeshes);
	},

	addEntityMeshesToScene: function() {
		var that = this;
		this.forEachUniqueGridObject([GS.Item, GS.Monster, GS.Door, GS.Elevator, GS.TVScreen, GS.Switch], function(gridObject) {
			if (that.debugEntityMeshes && gridObject.view.debugMesh !== undefined) {
				gridObject.view.mesh.children.push(gridObject.view.debugMesh);
			}

			that.entityMeshes.children.push(gridObject.view.mesh);
		});

		this.scene.add(this.entityMeshes);

		// if (this.debugEntityMeshes) {
		// 	this.scene.add(this.player.view.debugMesh);
		// }
	},

  addEntityMeshToScene: function (gridObject) {
    this.scene.children.push(gridObject.view.mesh);
  },

	addDebugLine: function(pos0, pos1, color) {
		color = (color !== undefined) ? color: 0xffffff;

		var geometry = new THREE.Geometry();
		geometry.vertices.push(pos0);
		geometry.vertices.push(pos1);
		var material = new THREE.LineBasicMaterial({ color: color });
		var line = new THREE.Line(geometry, material);
		this.scene.add(line);
	},

	addDebugCellLines: function() {
		var height = 2;
		var color = new THREE.Color().setRGB(0, 0, 0.5).getHex();

		var geometry = new THREE.PlaneGeometry(this.width * this.cellSize, this.height * this.cellSize, this.width, this.height);
		var material = new THREE.MeshBasicMaterial({ color: color, wireframe: true });
		var mesh = new THREE.Mesh(geometry, material);
		mesh.rotation.x = -Math.PI / 2;

		var v = this.map.bounds.min.clone().multiplyScalar(-1);
		v.sub(this.map.bounds.max.clone().sub(this.map.bounds.min).divideScalar(2));
		mesh.position.x = -v.x;
		mesh.position.y = height;
		mesh.position.z = -v.y;

		this.scene.add(mesh);
	},

	addProjectile: function(sourceGridObject, type, position, direction) {
		var projectile = new GS.Projectile(this, sourceGridObject, type, position, direction);
		projectile.init();

		if (this.debugEntityMeshes) {
			projectile.view.debugMesh = new THREE.Mesh(
				new THREE.BoxGeometry(1, 1, 1),
				new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true })
			);

			this.scene.add(projectile.view.debugMesh);
		}

		this.lightingView.addProjectileLight(projectile);
	},

	addEnvironmentImpactParticles: function(position, normal, color, n) {
		n = n || 5;
		for (var i = 0; i < n; i++) {
			var particle = this.particleView.addParticle(1, 1, 1, color, GS.ParticleMovementTypes.Falling, position);
			this.particleView.alignParticleTrajectoryToNormal(particle, normal);
			particle.mesh.position.copy(position);
		}
	},

	addEntityImpactParticles: function(position, color, n) {
		n = n || 3;
		for (var i = 0; i < n; i++) {
			var particle = this.particleView.addParticle(1, 1, 1, color, GS.ParticleMovementTypes.Gushing, position);
			particle.mesh.position.copy(position);
		}
	},

	getMeshFromBox2: function(box2, material) {
		var geometry = new THREE.Geometry();

		geometry.vertices.push(new THREE.Vector3(box2.min.x, 0, box2.min.y));
		geometry.vertices.push(new THREE.Vector3(box2.max.x, 0, box2.min.y));
		geometry.vertices.push(new THREE.Vector3(box2.min.x, 0, box2.max.y));
		geometry.vertices.push(new THREE.Vector3(box2.max.x, 0, box2.max.y));

		geometry.faces.push(new THREE.Face3(0, 1, 2));
		geometry.faces.push(new THREE.Face3(1, 3, 2));

		var mesh = new THREE.Mesh(geometry, material);
		return mesh;
	},

	addDebugGridLocation: function(gridLocation) {
		var material = new THREE.MeshBasicMaterial({ color: 0xff00ff, wireframe: true });
		var mesh = this.getMeshFromBox2(gridLocation.box2, material);
		this.scene.add(mesh);
	},

	forEachUniqueGridObjectInCells: function(cells, types, callback) {
		var gridObjects = {};

		if (types !== undefined && types.length > 0) {
			for (var i = 0; i < cells.length; i++) {
				var cell = cells[i];

				for (var k = 0; k < cell.children.length; k++) {
					var gridObject = cell.children[k];
					for (var e = 0; e < types.length; e++) {
						if (gridObject instanceof types[e]) {
							gridObjects[gridObject.id] = gridObject;
						}
					}
				}
			}
		} else {
			for (var i = 0; i < cells.length; i++) {
				var cell = cells[i];

				for (var k = 0; k < cell.children.length; k++) {
					var gridObject = cell.children[k];
					gridObjects[gridObject.id] = gridObject;
				}
			}
		}

		Object.keys(gridObjects).forEach(function(key) {
			callback(gridObjects[key]);
		});
	},

	forEachUniqueGridObject: function(types, callback) {
		var gridObjects = {};

		if (types !== undefined && types.length > 0) {
			for (var i = 0; i < this.height; i++) {
				for (var j = 0; j < this.width; j++) {
					var cell = this.cells[i][j];

					for (var k = 0; k < cell.children.length; k++) {
						var gridObject = cell.children[k];
						for (var e = 0; e < types.length; e++) {
							if (gridObject instanceof types[e]) {
								gridObjects[gridObject.id] = gridObject;
							}
						}
					}
				}
			}
		} else {
			for (var i = 0; i < this.height; i++) {
				for (var j = 0; j < this.width; j++) {
					var cell = this.cells[i][j];

					for (var k = 0; k < cell.children.length; k++) {
						var gridObject = cell.children[k];
						gridObjects[gridObject.id] = gridObject;
					}
				}
			}
		}

		Object.keys(gridObjects).forEach(function(key) {
			callback(gridObjects[key]);
		});
	},

	removeEntityMesh: function(mesh) {
		this.entityMeshes.remove(mesh);
	},

	isPointInMapBounds: function(point) {
		return this.map.bounds.containsPoint(point);
	},

	getGridLocationFromPoints: function(points) {
		var box2 = new THREE.Box2().setFromPoints(points);

		if (this.map.bounds.isIntersectionBox(box2)) {
			var gridMin = this.getGridCoords(box2.min);
			var gridMax = this.getGridCoords(box2.max);

			gridMin.x = GS.MathHelper.clamp(gridMin.x, 0, this.width - 1);
			gridMin.y = GS.MathHelper.clamp(gridMin.y, 0, this.height - 1);
			gridMax.x = GS.MathHelper.clamp(gridMax.x, 0, this.width - 1);
			gridMax.y = GS.MathHelper.clamp(gridMax.y, 0, this.height - 1);

			return {
				box2: box2,
				gridMin: gridMin,
				gridMax: gridMax,
			}
		} else {
			return undefined;
		}
	},

	getGridCoords: function(point) {
		var p = point.clone().sub(this.map.bounds.min);
		p.x = Math.floor(p.x / this.cellSize);
		p.y = Math.floor(p.y / this.cellSize);
		return p;
	},

	getCellsFromGridLocation: function(gridLocation) {
		var cells = [];

		var min = gridLocation.gridMin;
		var max = gridLocation.gridMax;

		for (var i = min.y; i <= max.y; i++) {
			for (var j = min.x; j <= max.x; j++) {
				cells.push(this.cells[i][j]);
			}
		}

		return cells;
	},

	getTriangleIterator: function(gridLocation, types, condition) {
		var that = this;
		var cells = that.getCellsFromGridLocation(gridLocation);

		if (condition === undefined) {
			return function(callback) {
				that.forEachUniqueGridObjectInCells(cells, types, function(gridObject) {
					var triangles = gridObject.view.collisionData.triangles;

					for (var i = 0; i < triangles.length; i += 3) {
						callback(gridObject, triangles[i], triangles[i + 1], triangles[i + 2], i);
					}
				});
			}
		}

		return function(callback) {
			that.forEachUniqueGridObjectInCells(cells, types, function(gridObject) {
				if (condition(gridObject)) {
					var triangles = gridObject.view.collisionData.triangles;

					for (var i = 0; i < triangles.length; i += 3) {
						callback(gridObject, triangles[i], triangles[i + 1], triangles[i + 2], i);
					}
				}
			});
		}
	},

	getSegmentIterator: function(gridLocation, condition) {
		var that = this;
		var cells = that.getCellsFromGridLocation(gridLocation);

		if (condition === undefined) {
			return function(callback) {
				that.forEachUniqueGridObjectInCells(cells, [GS.Concrete, GS.Elevator, GS.Door], function(gridObject) {
					if (gridObject instanceof GS.Concrete && gridObject.type === GS.MapLayers.Segment) {
						callback(gridObject.sourceObj);
					} else
					if (gridObject instanceof GS.Elevator || gridObject instanceof GS.Door) {
						var segs = gridObject.view.collisionData.segments;
						for (var i = 0; i < segs.length; i++) {
							callback(segs[i]);
						}
					}
				});
			}
		}

		return function(callback) {
			that.forEachUniqueGridObjectInCells(cells, [GS.Concrete, GS.Elevator, GS.Door], function(gridObject) {
				if (gridObject instanceof GS.Concrete && gridObject.type === GS.MapLayers.Segment) {
					if (condition(gridObject.sourceObj)) {
						callback(gridObject.sourceObj);
					}
				} else
				if (gridObject instanceof GS.Elevator || gridObject instanceof GS.Door) {
					var segs = gridObject.view.collisionData.segments;
					for (var i = 0; i < segs.length; i++) {
						if (condition(segs[i])) {
							callback(segs[i]);
						}
					}
				}
			});
		}
	},

	clearScene: function() {
		for (var i = this.scene.children.length - 1; i >= 0; i--) {
			var obj = this.scene.children[i];
			this.scene.remove(obj);
		}
	},

	onResize: function() {
		this.skybox.camera.aspect = window.innerWidth / window.innerHeight;
		this.skybox.camera.updateProjectionMatrix();
	},

	updateFov: function() {
		this.skybox.camera.fov = GS.Settings.fov;
		this.skybox.camera.updateProjectionMatrix();
	},

  spawnEntity: function (ntt) {
    var type = GS.MapEntities[ntt.type].type;

    var gridObject = new GS[type](this, GS.MapLayers.Entity, ntt);
    var offset = gridObject.offset;
    var size = gridObject.size;
    gridObject.position = offset.clone();
    gridObject.position.x += ntt.pos.x;
    gridObject.position.y += ntt.y || 0;
    gridObject.position.z += ntt.pos.y;

    gridObject.isStatic = ntt.isStatic;

    var points = [
      ntt.pos.clone().add(new THREE.Vector2(offset.x, offset.z)).sub(new THREE.Vector2(size.x, size.z)),
      ntt.pos.clone().add(new THREE.Vector2(offset.x, offset.z)).add(new THREE.Vector2(size.x, size.z)),
    ];
    var gridLocation = this.getGridLocationFromPoints(points);
    this.viewFactory.applyEntityView(gridObject);
    gridObject.assignToCells(gridLocation);
    gridObject.startingSector = gridObject.getSector();
    return gridObject;
  },

  spawnEntityAtRuntime: function (ntt) {
    let gridObj = this.spawnEntity(ntt);
    gridObj.init();
    this.addEntityMeshToScene(gridObj);
    return gridObj;
  },

};
;GS.MapScript = function(gridObjectLibrary) {
	this.lib = gridObjectLibrary;
	
	this.mapName = "map name";
	this.mapWon = false;
	this.nextMap = undefined;
	
	this.secretsFound = 0;
	this.maxSecrets = 0;
	this.musicTrack = "simple_action_beat";
};

GS.MapScript.prototype = {
	constructor: GS.MapScript,

	init: function() {
	},

	update: function() {
	},

	onZoneEnter: function(zone) {
	},

	onZoneLeave: function(zone) {
	},

	onItemPickup: function(item) {
	},

	onPlayerOpenDoor: function(door) {
	},

	onSwitchStateChange: function(switchObj) {
	},

	foundSecret: function() {
		this.secretsFound++;
		GS.DebugUI.addTempLine("secret found");
	},

	getGridObjectsById: function(type, idArray) {
		var list = [];
		var source = this.lib[type];
		for (var i in source) {			
			if (idArray.indexOf(parseInt(i, 10)) != -1) {				
				list.push(source[i]);
			}
		}
		return list;
	},
};;GS.MusicManager = function() {
	this.volume = GS.Settings.music / 10;
};

GS.MusicManager.prototype = {
	init: function() {
		var ctx;

		if (typeof AudioContext !== "undefined") {
			ctx = new AudioContext();
		} else
		if (typeof webkitAudioContext !== "undefined") {
			ctx = new webkitAudioContext();
		} else {
			GAME.handleFatalError("No AudioContext support");
			return;
		}

		this.ctx = ctx;

		if (!this.ctx.createGain) {
			this.ctx.createGain = ctx.createGainNode;
		}

		this.gainNode = this.ctx.createGain();
		this.gainNode.gain.value = this._volume;
		this.gainNode.connect(this.ctx.destination);

		this.initTracks();
	},

	playTrack: function(name) {
		var that = this;
		this.currentTrack = this.tracks[name];

		if (this.source !== undefined) {
			this.source.stop(0);
		}

		this.source = this.ctx.createBufferSource();
		this.source.buffer = this.currentTrack.buffer;
		this.source.loop = true;
		this.source.connect(this.gainNode);
		if (!this.source.start) {
			this.source.start = source.noteOn;
		}
		this.source.start(0);
	},

	initTracks: function(soundBuffers) {
		this.tracks = {};
		for (var i in soundBuffers) {
			this.tracks[i] = {
				buffer: soundBuffers[i],
				duration: Math.ceil(soundBuffers[i].length / this.ctx.sampleRate * 1000),
			};
		}
	},

	set volume(value) {
		this._volume = value;
		if (this.gainNode !== undefined) {
			this.gainNode.gain.value = this._volume;
		}
	},

	get volume() {
		return this._volume;
	},
};;GS.OnlineManager = function(grid) {
	this.mapWon = false;

	this.onlinePlayersKilled = 0;
  this.onlineRoom = new GS.OnlineRoom();
};

GS.OnlineManager.prototype = {
	init: function() {
		// this.initGridObjectLibrary();
		// this.initScripts();
    this.callbacks = {};
    this.socket = { emit: () => {}}
    this.onlineRoom.init();
	},

  isCurrentClient(client) {
    client.id === this.socket.id;
  },

  setGrid: function (grig) {
    this.grid = grid;
    this.map = grid.map;
  },

  setupClients: function () {
    this.onlineRoom.setupClients();
  },

  socketListeners: function (socket) {
    // socket.usePeerConnection = true;

    // this event will be triggered over the socket transport
    // until `usePeerConnection` is set to `true`
    socket.on('peer-msg', (data) => {
      console.log(data);
    });

    socket.on('get-rooms', (data) => {
      (this.callbacks.getRooms || ((e) => {}))(data.rooms);
    });

    // socket.on('dead-monster', this.onMonsterDeath.bind(this));
    socket.on('setup-room', this.onSetupRoom.bind(this));
    socket.on('player-die', this.onOnlinePlayerDeath.bind(this));
    socket.on('player-respawn', this.onOnlinePlayerRespawn.bind(this));
    socket.on('player-join', this.onOnlinePlayerJoin.bind(this));
    // socket.on('player-move', this.onOnlinePlayerMove.bind(this));
    socket.on('player-shoot', this.onOnlinePlayerShoot.bind(this));
    socket.on('player-pickup', this.onOnlinePlayerItemPickup.bind(this));
    socket.on('door-open', this.onOnlinePlayerOpenDoor.bind(this));
    socket.on('switch-change', this.onSwitchStateChange.bind(this));
    socket.on('room-ping', this.onRoomPing.bind(this));
    socket.on('use-elevator', this.onUseElevator.bind(this));
    // socket.on('up-elevator', this.onUpElevator.bind(this));
    // socket.on('down-elevator', this.onDownElevator.bind(this));
    socket.on('enter-sector', this.onEnterSector.bind(this));
    socket.on('zone-enter', this.onZoneEnter.bind(this));
    socket.on('zone-leave', this.onZoneLeave.bind(this));
    socket.on('map-won', this.onMapWon.bind(this));
  },

  start: function (cb) {
    this.callbacks.getRooms = cb;
    GS.Socket.init();

    this.socket = GS.Socket.io;
    this.socketListeners(this.socket);
    this.getRooms();

  },

  stop: function () {
    GS.Socket.close();
  },

  startGame: function () {
    this.pingInterval = setInterval(() => this.roomPing(), 100);
  },

  stopGame: function () {
    clearInterval(this.pingInterval);
  },

	// initGridObjectLibrary: function() {
	// 	var that = this;

	// 	var library = {
	// 		items: {},
	// 		doors: {},
	// 		elevators: {},
	// 		monsters: {},
	// 		sectors: {},
	// 		switches: {},
	// 	};

	// 	this.grid.forEachUniqueGridObject([GS.Item, GS.Door, GS.Elevator, GS.Monster, GS.Concrete, GS.Switch], function(gridObject) {
	// 		if (gridObject instanceof GS.Item) {
	// 			library.items[gridObject.sourceObj.id] = gridObject;
	// 		} else
	// 		if (gridObject instanceof GS.Door) {
	// 			library.doors[gridObject.sector.id] = gridObject;
	// 		} else
	// 		if (gridObject instanceof GS.Elevator) {
	// 			library.elevators[gridObject.sector.id] = gridObject;
	// 		} else
	// 		if (gridObject instanceof GS.Monster) {
	// 			library.monsters[gridObject.sourceObj.id] = gridObject;
	// 		} else
	// 		if (gridObject instanceof GS.Concrete && gridObject.type == GS.MapLayers.Sector) {
	// 			library.sectors[gridObject.sourceObj.id] = gridObject;
	// 		} else
	// 		if (gridObject instanceof GS.Switch) {
	// 			library.switches[gridObject.segment.id] = gridObject;
	// 		}
	// 	});

	// 	this.gridObjectLibrary = library;
	// },

	// initScripts: function() {
	// 	if (this.map.hasScript === true) {
	// 		this.script = new GS.MapScripts[this.map.name](this.gridObjectLibrary);
	// 		this.script.init();

	// 		var entities = this.grid.map.layerObjects[GS.MapLayers.Entity];
	// 		for (var i = 0; i < entities.length; i++) {
	// 			var entity = entities[i];
	// 			var type = GS.MapEntities[entity.type].type;
	// 			if (type === "Monster") {
	// 				this.maxMonsters++;
	// 			} else
	// 			if (type === "Item") {
	// 				this.maxItems++;
	// 			}
	// 		}
	// 	}
	// },

	update: function() {
		// if (this.script !== undefined) {
		// 	this.script.update();

		// 	if (this.script.mapWon && !this.mapWon) {
		// 		this.mapWon = true;
		// 	}
		// }

		// if (!this.mapWon) {
    //   this.updateTime();
		// }
	},
  // Listeners
	onMonsterDeath: function() {
		// this.monstersKilled++;
	},

	onOnlinePlayerRespawn: function(data) {
    this.onlineRoom.clientRespawn(data.id);
	},

	onOnlinePlayerDeath: function(data) {
		// this.onlinePlayersKilled++;
    this.onlineRoom.clientDie(data.id);
	},

	onOnlinePlayerJoin: function(data) {
    console.log('player joined');
    console.dir(data);
		// this.onlinePlayersKilled++;
    this.onlineRoom.addClient(data);
	},

	onOnlinePlayerMove: function(player, oldPos, newPos) {
		if (this.script !== undefined) {
			this.checkZones(player, oldPos, newPos);
		}

		this.wakeUpNearbyMonsters(player);
		this.applyRegionVisibility(player);
	},

	checkZones: function() {
		var oldPos2d = new THREE.Vector2();
		var newPos2d = new THREE.Vector2();

		return function(player, oldPos, newPos) {
			oldPos.toVector2(oldPos2d);
			newPos.toVector2(newPos2d);

      let aiManager = GAME.grid.aiManager;
			for (let i = 0; i < aiManager.zones.length; i++) {
				var zone = aiManager.zones[i];
				var c1 = zone.boundingSquare.containsPoint(oldPos2d);
				var c2 = zone.boundingSquare.containsPoint(newPos2d);

				if (c1 && !c2) {
					this.zoneLeave(i);
				} else
				if (!c1 && c2) {
					this.zoneEnter(i);
				}
			}
		}
	}(),

	onOnlinePlayerShoot: function(player) {
		// this.activateNearbyMonsters(player);
    this.onlineRoom.addProjectile(player.id);
	},

	onOnlinePlayerOpenDoor: function(data) {
    let id = data.doorInfo.id;
    let aiManager = GAME.grid.aiManager;
    let doorObj = aiManager.gridObjectLibrary.doors[id];
    doorObj.onUse();
	},

	onOnlinePlayerItemPickup: function(player, old_item) {
		// this.itemsPickedUp++;
		GAME.grid.forEachUniqueGridObjectInCells(GAME.grid.player.linkedGridCells, [GS.Item], function(item) {
      if (item.id === old_item.id) {
        item.remove();
        GAME.grid.aiManager.onItemPickup(item);
      }
		});
	},

	onZoneLeave: function(data) {
    let aiManager = GAME.grid.aiManager;
    let z = aiManager.zones[data.zone.id];
    aiManager.script.onZoneLeave(z);
	},

	onZoneEnter: function(data) {
    let aiManager = GAME.grid.aiManager;
    let z = aiManager.zones[data.zone.id];
    aiManager.script.onZoneEnter(z);
	},

	onEnterSector: function(sector) {
    let aiManager = GAME.grid.aiManager;
    let sectorObj = aiManager.gridObjectLibrary.sectors[sector.id];
    // aiManager.onSwitchStateChange(sectorObj);
	},

	onUpElevator: function(data) {
    let id = data.elevatorInfo.id;
    let aiManager = GAME.grid.aiManager;
    let elevatorObj = aiManager.gridObjectLibrary.elevators[id];
    elevatorObj.onUp(false);
	},

	onDownElevator: function(data) {
    let id = data.elevatorInfo.id;
    let aiManager = GAME.grid.aiManager;
    let elevatorObj = aiManager.gridObjectLibrary.elevators[id];
    elevatorObj.onDown(false);
	},

	onUseElevator: function(data) {
    let id = data.elevatorInfo.id;
    let aiManager = GAME.grid.aiManager;
    let elevatorObj = aiManager.gridObjectLibrary.elevators[id];
    elevatorObj.onUse();
	},

	onSwitchStateChange: function(data) {
    let id = data.switchInfo.id
    let aiManager = GAME.grid.aiManager;
    let switchObj = aiManager.gridObjectLibrary.switches[id];
    aiManager.onSwitchStateChange(switchObj);
	},

  onSetupRoom: function (room) {
    this.onlineRoom.setupRoom(room);
    this.startGame();
  },

  onRoomPing: function(room) {
    let id = this.socket.id;
    this.onlineRoom.roomPing(room, id);
    let player = {
      id,
      x: GAME.grid.player.position.x,
      y: GAME.grid.player.position.y,
      z: GAME.grid.player.position.z,
      direction: GAME.grid.player.direction,
    };
    this.socket.emit('player-move', player)
  },

  onMapWon: function () {
    GAME.grid.aiManager.mapWon = true;
  },

  // Events
  joinRoom: function(room) {
    GS.Game.onlinePlay = true;
    this.socket.emit('join-room', { roomName: GS.Settings.roomName })
  },

  roomPing: function() {
    this.socket.emit('room-ping', { roomName: GS.Settings.roomName })
  },

  getRooms: function(room) {
    this.socket.emit('get-rooms', {});
  },
  playerShoot: function() {
    this.socket.emit('player-shoot', {});
  },
  playerDie: function(data) {
    this.socket.emit('player-die', { killer: data.killId });
  },
  playerRespawn: function() {
    this.socket.emit('player-respawn', {});
  },
  playerPickup: function(item) {
    this.socket.emit('player-pickup', { id: item.sourceObj.id });
  },
  openDoor: function(door) {
    this.socket.emit('door-open', { id: door.sector.id });
  },
  useElevator: function(elevator) {
    this.socket.emit('use-elevator', { id: elevator.sector.id });
  },
  // upElevator: function(elevator) {
  //   this.socket.emit('up-elevator', { id: elevator.sector.id });
  // },
  // downElevator: function(elevator) {
  //   this.socket.emit('down-elevator', { id: elevator.sector.id });
  // },
  enterSector: function(sector) {
    this.socket.emit('enter-sector', { id: sector.sourceObj.id });
  },
  switchStateChange: function(switchObj) {
    this.socket.emit('switch-change', { id: switchObj.segment.id });
  },

  zoneEnter: function(zone) {
    this.socket.emit('zone-enter', { id: zone });
  },

  zoneLeave: function(zone) {
    this.socket.emit('zone-leave', { id: zone });
  },

  useTarget: function (obj) {
    let library = GAME.grid.aiManager.gridObjectLibrary;
    if (obj instanceof GS.Door) {
      this.openDoor(obj);
    } else
    if (obj instanceof GS.Elevator) {
      this.useElevator(obj);
    } else
    if (obj instanceof GS.Switch) {
      this.switchStateChange(obj);
    }
  }
};
;GS.SoundManager = function() {
	this.volume = GS.Settings.sound / 10;
};

GS.SoundManager.prototype = {
	init: function() {
		var ctx;

		if (typeof AudioContext !== "undefined") {
			ctx = new AudioContext();
		} else
		if (typeof webkitAudioContext !== "undefined") {
			ctx = new webkitAudioContext();
		} else {
			GAME.handleFatalError("No AudioContext support");
			return;
		}

		this.ctx = ctx;

		if (!this.ctx.createGain) {
			this.ctx.createGain = ctx.createGainNode;
		}

		this.gainNode = this.ctx.createGain();
		this.gainNode.gain.value = this._volume;

		this.compressor = this.ctx.createDynamicsCompressor();
		this.gainNode.connect(this.compressor);
		this.compressor.connect(this.ctx.destination);

		this.initSounds();
	},

	playSound: function(name) {
		var that = this;
		var sound = this.sounds[name];

		if (sound.isPlaying && !sound.allowMultipleAtOnce) {
			return;
		}

		var source = this.ctx.createBufferSource();
		source.buffer = this.sounds[name].buffer;
		source.connect(this.gainNode);
		if (!source.start) {
			source.start = source.noteOn;
		}
		source.start(0);

		setTimeout(function() { sound.isPlaying = false }, sound.duration);

		sound.isPlaying = true;
	},

	initSounds: function(soundBuffers) {
		this.sounds = {};
		for (var i in soundBuffers) {
			this.sounds[i] = {
				buffer: soundBuffers[i],
				duration: Math.ceil(soundBuffers[i].length / this.ctx.sampleRate * 1000),
				isPlaying: false,
				allowMultipleAtOnce: GS.Assets[GS.AssetTypes.Sound][i].allowMultipleAtOnce,
			};
		}
	},

	set volume(value) {
		this._volume = value;
		if (this.gainNode !== undefined) {
			this.gainNode.gain.value = this._volume;
		}
	},

	get volume() {
		return this._volume;
	},
};;GS.AnimationView = function(gridObject) {
	this.gridObject = gridObject;

	this.loops = {
		attack: {
			delay: 10,
		},
		inactive: {
			delay: 30,
		},
		walk: {
			delay: gridObject.walkDelay,
		},
		death: {
			delay: 30,
			runOnce: true,
		},
	};

	this.floatYDelta = 0.5;
	this.floatAngle = 0;
	this.floatSpeed = 0.175;
	this.inactiveFloatSpeed = 0.0875;
	this.painMaxAngle = Math.PI / 2;
	this.painAngle = 0;
	this.painSpeed = 0.05;
	this.painSgn = 1;

	this.rotationYOffset = 0;
	this.positionYOffset = 0;

	this.currentMesh = new THREE.Object3D();
};

GS.AnimationView.prototype = {
	init: function() {
		var that = this;

		$.extend(true, this, this.gridObject.view.mesh.userData);

		Object.keys(this.animations).forEach(function(key) {
			var loop = that.loops[key];
			if (that.loops[key] === undefined) {
				GAME.handleFatalError("animation loop not found");
				return;
			}

			loop.index = 0;
			loop.frames = that.animations[key];
			loop.max = loop.frames.length;
			loop.cooldown = Math.floor(Math.random() * (loop.delay - 1)) + 1;
		});

		this.initInactiveLoop();
	},

	update: function() {
		var loop = this.currentLoop;

		if (!(loop.runOnce && loop.index === loop.max - 1)) {
			if (loop.cooldown > 0) {
				loop.cooldown--;
				if (loop.cooldown === 0) {
					loop.cooldown = loop.delay;

					loop.index++;
					if (loop.index === loop.max) {
						loop.index = 0;
					}

					this.switchMesh();
				}
			}
		}

		if (!this.gridObject.dead) {
			if (this.gridObject.moving) {
				this.floatAngle += this.floatSpeed;
			} else
			if (loop === this.loops.inactive) {
				this.floatAngle += this.inactiveFloatSpeed;
			}

			this.positionYOffset = this.floatYDelta * Math.sin(this.floatAngle);

			if (Math.abs(this.painAngle) > 0) {
				this.painAngle -= this.painSgn * this.painSpeed;
				if (this.painSgn == 1 && this.painAngle < 0) {
					this.gridObject.inPain = false;
					this.painAngle = 0;
				} else
				if (this.painSgn == -1 && this.painAngle > 0) {
					this.gridObject.inPain = false;
					this.painAngle = 0;
				}
			}

			this.rotationYOffset = this.painAngle;
		}
	},

	initInactiveLoop: function() {
		var walk = this.loops.walk;

		var loop = this.loops.inactive;
		loop.index = 0;
		loop.frames = [];
		loop.cooldown = loop.delay;

		loop.frames.push(walk.frames[0]);
		loop.frames.push(walk.frames[2]);

		loop.max = loop.frames.length;
	},

	pain: function() {
		if (Math.floor(Math.random() * 2) === 0) {
			this.painAngle = this.painMaxAngle;
			this.painSgn = 1;
		} else {
			this.painAngle = -this.painMaxAngle;
			this.painSgn = -1;
		}
	},

	death: function() {
		this.setLoop("death");
		this.rotationYOffset = 0;
		this.positionYOffset = 0;
	},

	setLoop: function(name) {
		this.currentLoop = this.loops[name];
		this.switchMesh();
	},

	switchMesh: function() {
		var loop = this.currentLoop;

		this.currentMesh.visible = false;
		this.currentMesh = loop.frames[loop.index];
		this.currentMesh.visible = true;
	},
};;GS.LightingView = function(grid) {
	this.grid = grid;
	this.player = grid.player;

	this.worldScene = grid.scene;
	this.playerScene = grid.player.playerView.scene;

	this.ambientColor = new THREE.Color().setRGB(0, 0, 0);

	this.directionalColor = new THREE.Color().setRGB(1, 1, 1).getHex();
	this.directionalPosition = new THREE.Vector3(1, 1, 1);
	this.directionalIntensity = 0;

	this.muzzleFlashPosition = new THREE.Vector3(0, -3, -12);
	this.muzzleFlashDistance = 256;
	this.muzzleFlashMaxIntensity = 1;
	this.muzzleFlashIntensity = new GS.SmoothNumber(0, 0.1);

	this.projectileIntensity = 1;
	this.projectileDistance = 32;
	this.maxProjectilePointLights = 10;

	this.playerTorchDistance = 256;
	this.playerTorchIntensity = 0.5;
	this.playerTorchColor = new THREE.Color().setRGB(1, 1, 1);

	this.worldLights = {};
	this.playerLights = {};
	this.projectileLights = [];
};

GS.LightingView.prototype = {
	init: function() {
		this.initWorldLights();
		this.initPlayerLights();
	},

	initWorldLights: function() {
		var ambientLight = new THREE.AmbientLight(this.ambientColor);
		this.worldScene.add(ambientLight);
		this.worldLights.ambient = ambientLight;

		var pointLight = new THREE.PointLight();
		pointLight.intensity = this.muzzleFlashIntensity.value;
		pointLight.distance = this.muzzleFlashDistance;
		this.worldScene.add(pointLight);
		this.worldLights.muzzleFlash = pointLight;		

		var dirLight = new THREE.DirectionalLight(this.directionalColor, this.directionalIntensity);
		dirLight.position.copy(this.directionalPosition);
		this.worldScene.add(dirLight);
		this.worldLights.directional = dirLight;

		for (var i = 0; i < this.maxProjectilePointLights; i++) {
			var pointLight = new THREE.PointLight();
			pointLight.intensity = 0;
			pointLight.distance = this.projectileDistance;

			var light = {
				active: false,
				pointLight: pointLight,
				intensity: new GS.SmoothNumber(this.projectileIntensity, 0.1),
			};

			this.worldScene.add(pointLight);
			this.projectileLights.push(light);
		}

		var playerTorch = new THREE.PointLight();
		playerTorch.color.copy(this.playerTorchColor);
		playerTorch.intensity = this.playerTorchIntensity;
		playerTorch.distance = this.playerTorchDistance;
		this.worldScene.add(playerTorch);
		this.worldLights.playerTorch = playerTorch;

		var playerSceneTorch = new THREE.PointLight();
		playerSceneTorch.color.copy(this.playerTorchColor);
		playerSceneTorch.intensity = this.playerTorchIntensity;
		playerSceneTorch.distance = this.playerTorchDistance;
		this.playerScene.add(playerSceneTorch);
		this.playerLights.playerTorch = playerSceneTorch;
	},

	initPlayerLights: function() {
		var ambientLight = new THREE.AmbientLight(this.ambientColor);
		this.playerScene.add(ambientLight);
		this.playerLights.ambient = ambientLight;

		var pointLight = new THREE.PointLight();
		pointLight.position.copy(this.muzzleFlashPosition);
		pointLight.intensity = this.muzzleFlashIntensity.value;
		pointLight.distance = this.muzzleFlashDistance;
		this.playerScene.add(pointLight);
		this.playerLights.muzzleFlash = pointLight;
		
		var dirLight = new THREE.DirectionalLight(this.directionalColor, this.directionalIntensity);
		dirLight.position.copy(this.directionalPosition);
		this.playerScene.add(dirLight);
		this.playerLights.directional = dirLight;

		this.player.playerView.lightingView = this;
	},

	updatePlayerLights: function() {
		var xAngle = Math.PI / 180 * (this.player.yAngle - 90);
		var yAngle = Math.PI / 180 * (this.player.xAngle + 90);
		var matrix = new THREE.Matrix4().makeRotationX(xAngle).multiply(new THREE.Matrix4().makeRotationY(yAngle));
		var dirPos = this.worldLights.directional.position;
		this.playerLights.directional.position.copy(dirPos).applyMatrix4(matrix);

		this.muzzleFlashIntensity.update();
		this.worldLights.muzzleFlash.position.copy(this.player.position);
		this.worldLights.muzzleFlash.position.y += this.player.size.y * 0.5;
		this.worldLights.muzzleFlash.intensity = this.muzzleFlashIntensity.value;
		this.playerLights.muzzleFlash.intensity = this.muzzleFlashIntensity.value;		

		this.worldLights.playerTorch.position.copy(this.player.position);
	},

	beginMuzzleFlash: function(color) {
		this.muzzleFlashIntensity.value = this.muzzleFlashMaxIntensity;
		this.worldLights.muzzleFlash.color.copy(color);
		this.playerLights.muzzleFlash.color.copy(color);
	},

	endMuzzleFlash: function() {
		this.muzzleFlashIntensity.setTargetValue(0);
	},

	addProjectileLight: function(projectile) {
		var light;

		light = this.projectileLights.shift();

		light.active = true;
		light.projectile = projectile;
		light.intensity.value = this.projectileIntensity;
		light.intensity.setTargetValue(this.projectileIntensity);
		light.pointLight.color.setHex(projectile.color);
		light.pointLight.position.copy(projectile.position);
		light.pointLight.intensity = light.intensity.value;		
		
		this.projectileLights.push(light);
	},

	update: function() {
		for (var i = 0; i < this.projectileLights.length; i++) {
			var light = this.projectileLights[i];

			if (!light.active) {
				continue;
			}

			if (light.projectile.removed) {
				light.intensity.setTargetValue(0);
			}

			light.intensity.update();
			light.pointLight.intensity = light.intensity.value;
			light.pointLight.position.copy(light.projectile.position);

			if (light.intensity.value === 0) {
				light.active = false;
			}
		}
	},
};;GS.ParticleMovementTypes = {
	Static: 0,
	Falling: 1,
	Gushing: 2,
};

GS.ParticleView = function(grid) {
	this.grid = grid;
	this.scene = grid.scene;

	this.particles = [];
	this.geometries = {};
	this.materials = {};

	this.particleSpeed = 0.00075;
	this.particleGravity = new THREE.Vector3(0, -0.003, 0);
};

GS.ParticleView.prototype = {
	constructor: GS.ParticleView,

	init: function() {
		this.root = new THREE.Object3D();
		this.root.userData = "particle root";
		this.scene.add(this.root);
	},

	update: function() {
		// GS.DebugUI.trackNumericValue("particles", this.particles.length);

		for (var i = 0; i < this.particles.length; i++) {
			var particle = this.particles[i];

			if (particle.movementType != GS.ParticleMovementTypes.Static) {
				if (particle.landed !== true) {
					particle.acceleration.add(particle.gravity);
					particle.velocity.add(particle.acceleration);
					particle.mesh.position.add(particle.velocity);
					particle.mesh.rotation.y += particle.rotationSpeed;
					particle.life++;

					if (particle.floorImpactY !== undefined && particle.mesh.position.y < particle.floorImpactY) {
						particle.mesh.position.y = particle.floorImpactY + 0.5;
						particle.landed = true;
					}
				} else {
					particle.decayTime -= 0.01;
					particle.mesh.scale.set(particle.decayTime, particle.decayTime, particle.decayTime);
					if (particle.decayTime <= 0) {
						particle.toBeRemoved = true;
					}
				}
			}
		}

		for (var i = this.particles.length - 1; i >= 0; i--) {
			if (this.particles[i].toBeRemoved) {
				this.removeParticle(this.particles[i], i);
			}
		}
	},

	addParticle: function(width, height, depth, color, movementType, position) {
		var geometry = this.getGeometry(width, height, depth);
		var material = this.getMaterial(color);
		var mesh = new THREE.Mesh(geometry, material);

		movementType = (movementType !== undefined) ? movementType : GS.ParticleMovementTypes.Static;

		var particle = {
			mesh: mesh,
			position: position,
			rotationSpeed: Math.random() * 0.25,
			movementType: movementType,
			color: color,
			decayTime: 1,
		};

		if (movementType != GS.ParticleMovementTypes.Static) {
			particle.gravity = this.particleGravity.clone();

			if (movementType == GS.ParticleMovementTypes.Falling) {
				particle.horizontalSpeed = 15;
				particle.verticalSpeed = Math.random() * 10;
			} else
			if (movementType == GS.ParticleMovementTypes.Gushing) {
				particle.horizontalSpeed = 20;
				particle.verticalSpeed = Math.random() * 10 + 60;
			}

			this.calculateAcceleration(particle);		
			
			particle.velocity = new THREE.Vector3();

			this.calculateFloorImpactY(particle);
		}

		this.root.add(mesh);
		this.particles.push(particle);

		return particle;
	},

	removeParticle: function(particle, index) {
		var i = (index !== undefined) ? index : this.particles.indexOf(particle);
		if (i > -1) {
			this.root.remove(particle.mesh);
			this.particles.splice(i, 1);
		}
	},

	calculateFloorImpactY: function() {
		var fauxGridObject = {
			grid: null,
			position: new THREE.Vector3(),
			linkedGridCells: null,
		};
		var position2d = new THREE.Vector2();

		return function(particle) {
			particle.position.toVector2(position2d);
			var gridLocation = this.grid.getGridLocationFromPoints([position2d]);

			if (gridLocation !== undefined) {
				fauxGridObject.grid = this.grid;
				fauxGridObject.position.copy(particle.position);
				fauxGridObject.linkedGridCells = this.grid.getCellsFromGridLocation(gridLocation);

				var sector = GS.GridObject.prototype.getSector.call(fauxGridObject);
				if (sector !== undefined) {
					particle.floorImpactY = sector.floorTopY;
				}

				fauxGridObject.grid = null;
				fauxGridObject.linkedGridCells = null;
			}
		}
	}(),

	calculateAcceleration: function(particle) {
		particle.acceleration = new THREE.Vector3(Math.random() * 2 - 1, 0, Math.random() * 2 - 1);
		particle.acceleration.normalize();
		particle.acceleration.multiplyScalar(particle.horizontalSpeed);
		particle.acceleration.y = particle.verticalSpeed;
		particle.acceleration.multiplyScalar(this.particleSpeed);
	},

	alignParticleTrajectoryToNormal: function() {
		var normal2d = new THREE.Vector2();
		var axis = new THREE.Vector2(1, 0);

		return function(particle, normal) {
			if (normal.x === 0 && normal.z === 0) {
				if (normal.y == -1) {
					return;
				}

				particle.horizontalSpeed = 20;
				particle.verticalSpeed = Math.random() * 10 + 30;

				this.calculateAcceleration(particle);

				// this.grid.addDebugLine(particle.position.clone(), 
				// particle.position.clone().add(particle.acceleration.clone().normalize().multiplyScalar(5)), 0x0080ff);

				return;
			}

			normal.toVector2(normal2d);
			var angle = GS.MathHelper.vec2AngleDirected(axis, normal2d) + Math.PI;

			var k = angle - Math.random() * Math.PI;
			normal2d.set(Math.sin(k), Math.cos(k));

			particle.acceleration.x = normal2d.x;
			particle.acceleration.z = normal2d.y;
			particle.acceleration.multiplyScalar(particle.horizontalSpeed * this.particleSpeed);
			particle.acceleration.y = particle.verticalSpeed * this.particleSpeed;

			// this.grid.addDebugLine(particle.position.clone(), 
			// 	particle.position.clone().add(particle.acceleration.clone().normalize().multiplyScalar(5)), 0x0080ff);

			particle.mesh.rotation.y += angle;

			this.calculateFloorImpactY(particle);			
		}
	}(),

	getGeometry: function(width, height, depth) {
		var id = width.toFixed(2) + height.toFixed(2) + depth.toFixed(2);
		if (!(id in this.geometries)) {
			this.geometries[id] = new THREE.BoxGeometry(width, height, depth);
		}
		return this.geometries[id];
	},

	getMaterial: function(color) {
		var id = color.toString();
		if (!(id in this.materials)) {
			this.materials[id] = new THREE.MeshBasicMaterial({ color: color });
		}
		return this.materials[id];
	},
};;GS.PlayerView = function() {
	this.weapons = {
		pistol: {
			position: new THREE.Vector3(2.75, -2.5, -4),
			startPosition: new THREE.Vector3(2.5, -6.5, 1),
			scale: new THREE.Vector3(0.4, 0.4, 0.4),
			rotation: new THREE.Vector3(0, THREE.Math.degToRad(-90), 0),
			pushback: 1,
			shootBackwardFactor: 0.5,
			shootForwardFactor: 0.5,
			muzzleDuration: GS.msToFrames(250),
			muzzleFlashColor: new THREE.Color().setRGB(1, 1, 1),
		},
		double_shotgun: {
			position: new THREE.Vector3(2.25, -3.5, -3),
			startPosition: new THREE.Vector3(2.5, -6.5, 1),
			scale: new THREE.Vector3(0.4, 0.4, 0.4),
			rotation: new THREE.Vector3(0, THREE.Math.degToRad(180), 0),
			pushback: 2,
			shootBackwardFactor: 0.1,
			shootForwardFactor: 0.9,
			muzzleDuration: GS.msToFrames(250),
			muzzleFlashColor: new THREE.Color().setRGB(1, 1, 1),
		},
		hyper_blaster: {
			position: new THREE.Vector3(2.75, -2.5, -3),
			startPosition: new THREE.Vector3(2.5, -6.5, 1),
			scale: new THREE.Vector3(0.4, 0.4, 0.4),
			rotation: new THREE.Vector3(0, THREE.Math.degToRad(-90), 0),
			pushback: 1,
			shootBackwardFactor: 0.5,
			shootForwardFactor: 0.5,
			muzzleDuration: GS.msToFrames(125),
			muzzleFlashColor: new THREE.Color().setRGB(1, 1, 1),
		},
	}
	$.extend(true, this.weapons, GS.Weapons);

	this.scene = new THREE.Scene();
	this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);

	this.screenOverlayColor = new THREE.Color(0x000000);
	this.screenOverlayColorFadeSpeed = 0.02;
	this.muzzleCooldown = 0;

	this.weaponReady = false;

	this.weaponBob = {
		enabled: GS.Settings.weaponBob,
		magnitudeX: 0.5,
		magnitudeY: 0.5,
		offset: new THREE.Vector3(),
		radian: 0,
		speed: 0.1,
	};

	this.viewBob = {
		enabled: GS.Settings.viewBob,
		magnitude: 1.5,
		offset: 0,
		radian: 0,
		speed: 0.2,
	};

	this.viewThrottle = new GS.SmoothNumber(0, 0.1);
	this.weaponThrottle = new GS.SmoothNumber(0, 0.1);

	this.tweens = {
		shoot: {
			easing: TWEEN.Easing.Sinusoidal.InOut,
		},
		show: {
			easing: TWEEN.Easing.Back.Out,
			duration: 500,
		},
		hide: {
			easing: TWEEN.Easing.Back.InOut,
			duration: 250,
		},
	};
};

GS.PlayerView.prototype = {
	init: function() {
		var that = this;
		Object.keys(this.weapons).forEach(function(key) {
			that.initWeaponMesh(key);
		});
	},

	addWeaponMesh: function(name, mesh) {
		this.weapons[name].mesh = mesh;
	},

	getWeaponMeshes: function() {
		var that = this;
		var meshes = [];
		Object.keys(this.weapons).forEach(function(key) {
			var weapon = that.weapons[key];
			meshes.push(weapon.mesh);
		});
		return meshes;
	},

	initWeaponMesh: function(name) {
		var weapon = this.weapons[name];

		if (weapon.mesh !== undefined) {
			weapon.mesh.visible = false;
			weapon.mesh.position.copy(weapon.position);
			weapon.mesh.rotation.x = weapon.rotation.x;
			weapon.mesh.rotation.y = weapon.rotation.y;
			weapon.mesh.rotation.z = weapon.rotation.z;
			weapon.mesh.scale.copy(weapon.scale);

			this.scene.add(weapon.mesh);
		}
	},

	update: function() {
		this.lightingView.updatePlayerLights();
		this.updateMuzzleFlash();
		this.updateLightLevel();
		this.updateViewBob();
		this.updateWeaponBob();
		this.updateScreenOverlay();
	},

	updateMuzzleFlash: function() {
		if (this.muzzleCooldown > 0) {
			this.muzzleCooldown--;
			if (this.muzzleCooldown === 0) {
				this.lightingView.endMuzzleFlash();				
			}
		}
	},

	updateLightLevel: function() {
		if (this.weapon !== undefined) {
			this.player.getLightColorFromSector(this.weapon.mesh.material.emissive);
		}
	},

	updateThrottle: function(oldPos, newPos) {
		var velocity = oldPos.toVector2().distanceTo(newPos.toVector2());
		this.viewThrottle.setTargetValue(velocity / this.player.moveSpeed);
		this.viewThrottle.update();
		if (!this.player.shooting && this.weaponReady) {			
			this.weaponThrottle.setTargetValue(velocity / this.player.moveSpeed);
			this.weaponThrottle.update();
		}
	},

	resetWeaponThrottle: function() {
		this.weaponThrottle.value = 0;
		this.weaponBob.radian = 0;
	},

	updateViewBob: function() {
		if (this.viewBob.enabled) {
			this.player.controls.setViewOffsetY(this.viewBob.offset);
			this.viewBob.radian += this.viewBob.speed;
			this.viewBob.offset = this.viewThrottle.value * this.viewBob.magnitude * Math.sin(this.viewBob.radian);			
		}
	},

	updateWeaponBob: function() {
		if (this.weaponBob.enabled && !this.player.shooting) {			
			this.weaponBob.radian += this.weaponBob.speed;

			var x = this.weaponThrottle.value * this.weaponBob.magnitudeX * Math.sin(this.weaponBob.radian);
			var y = -Math.abs(this.weaponThrottle.value * this.weaponBob.magnitudeY * Math.sin(this.weaponBob.radian));

			this.weaponBob.offset.set(x, y, 0);

			if (this.weapon !== undefined) {
				this.weapon.mesh.position.copy(this.weapon.position.clone().add(this.weaponBob.offset));
			}
		}
	},

	shoot: function() {
		var that = this;

		this.resetWeaponThrottle();	

		this.weapon.mesh.position.copy(this.weapon.position);

		var backward = this.weapon.position.clone();
		backward.z += this.weapon.pushback;
		var tweenShootBackward = new TWEEN.Tween(this.weapon.mesh.position).to(backward, 
			this.weapon.cooldown * this.weapon.shootBackwardFactor);
		tweenShootBackward.easing(this.tweens.shoot.easing);

		var tweenShootForward = new TWEEN.Tween(this.weapon.mesh.position).to(this.weapon.position, 
			this.weapon.cooldown * this.weapon.shootForwardFactor);
		tweenShootForward.easing(this.tweens.shoot.easing);

		tweenShootBackward.chain(tweenShootForward);
		tweenShootBackward.start();

		this.showMuzzleFlash();
	},

	showMuzzleFlash: function() {
		this.lightingView.beginMuzzleFlash(this.weapon.muzzleFlashColor);
		this.muzzleCooldown = this.weapon.muzzleDuration;
	},

	changeToWeaponInstant: function(name) {
		this.resetWeaponThrottle();

		if (this.weapon !== undefined) {
			this.weapon.mesh.visible = false;
		}

		this.weaponReady = true;
		this.weapon = this.weapons[name];
		this.weapon.mesh.visible = true;
		this.weapon.mesh.position.copy(this.weapon.startPosition);
	},

	changeToWeapon: function(name) {
		var that = this;

		this.resetWeaponThrottle();

		this.weaponReady = false;
		if (this.weapon !== undefined) {
			this.hideWeapon(function() {
				that.showWeapon(name);
			})
		} else {
			this.showWeapon(name);
		}
	},

	showWeapon: function(name, callback) {
		var that = this;

		this.weapon = this.weapons[name];
		this.weapon.mesh.visible = true;		
		this.weapon.mesh.position.copy(this.weapon.startPosition);

		var tween = new TWEEN.Tween(this.weapon.mesh.position).to(this.weapon.position, this.tweens.show.duration);
		tween.easing(this.tweens.show.easing);
		tween.onComplete(function() {
			tween.onComplete(null);
			that.weaponReady = true;
			if (callback !== undefined) {
				callback();
			}
		});
		tween.start();
	},

	hideWeapon: function(callback) {
		var that = this;
		this.weaponReady = false;

		var tween = new TWEEN.Tween(this.weapon.mesh.position).to(this.weapon.startPosition, this.tweens.hide.duration);
		tween.easing(this.tweens.hide.easing);
		tween.onComplete(function() {
			tween.onComplete(null);
			that.weapon.mesh.visible = false;
			if (callback !== undefined) {
				callback();
			}
		})
		tween.start();
	},	

	onResize: function() {
		this.camera.aspect = window.innerWidth / window.innerHeight;
		this.camera.updateProjectionMatrix();
	},

	onItemPickup: function() {
		this.screenOverlayColor.setRGB(0.3, 0.3, 0);
		this.dispatchEvent({ type: "screenOverlayColorChange", color: this.screenOverlayColor });
	},

	onDamage: function() {
		this.screenOverlayColor.setRGB(0.6, 0, 0);
		this.dispatchEvent({ type: "screenOverlayColorChange", color: this.screenOverlayColor });
	},

	onDeath: function() {
		this.player.controls.eye.y -= this.player.size.y;
		this.player.controls.updateCamera();

		if (this.weapon !== undefined) {
			this.hideWeapon();
		}
	},

	updateScreenOverlay: function() {
		if (this.screenOverlayColor.r > 0 ||
			this.screenOverlayColor.g > 0 ||
			this.screenOverlayColor.b > 0) {

			this.screenOverlayColor.addScalar(-this.screenOverlayColorFadeSpeed);

			if (this.screenOverlayColor.r < 0) {
				this.screenOverlayColor.r = 0;
			}
			if (this.screenOverlayColor.g < 0) {
				this.screenOverlayColor.g = 0;
			}
			if (this.screenOverlayColor.b < 0) {
				this.screenOverlayColor.b = 0;
			}

			this.dispatchEvent({ type: "screenOverlayColorChange", color: this.screenOverlayColor });
		}
	},
};

THREE.EventDispatcher.prototype.apply(GS.PlayerView.prototype);
;
GS.GameVersion = "v1.2.2";
GS.ReleaseDate = "april 2017";

GS.GameStates = {
	Dispose: 0,
	PreLoad: 1,
	Loading: 2,
	PostLoad: 3,
	Play: 4,
	Menu: 5,
};

GS.Game = function() {
	GS.Base.call(this);
};

GS.Game.prototype = GS.inherit(GS.Base, {
	constructor: GS.Game,

	preInit: function() {
		GS.Settings.loadSettings();



		this.state = GS.GameStates.PreLoad;
		this.nextState = null;
		this.updated = false;
		this.firstLoad = true;
		this.firstPlay = true;
		this.onlinePlay = false;
		this.mapWon = false;
		this.restartedLevel = false;

		this.antialias = false;
		this.clearColor = 0x336699;
		this.cameraFov = GS.Settings.fov;
		this.cameraFar = 1500;

		if (this.isTestMap()) {
			this.noMenu = true;
		} else {
			this.noMenu = false;
		}

		this.firstTimeInMenu = true;

		this.showFPS = GS.Settings.showFPS;
		this.showPerformanceDebugMeters = false;
	},

	init: function() {
		GS.DebugUI.init();
		GS.DebugUI.visible = false;

		this.loadingUI = new GS.LoadingUI();
		this.loadingUI.init();

		this.uiManager = new GS.UIManager();
		this.uiManager.init();

		this.onlineManager = new GS.OnlineManager();
		this.onlineManager.init();

		this.soundManager = new GS.SoundManager();
		this.soundManager.init();

		this.musicManager = new GS.MusicManager();
		this.musicManager.init();

		this.initAssetLoader();

		this.keys = {
			Enter: 13,
			Escape: 27,
			Tab: 9,
		};

		GS.Base.prototype.init.call(this);

		this.graphicsManager = new GS.GraphicsManager(this.renderer, this.camera);
		this.graphicsManager.init();
	},

	preLoad: function() {
		this.uiManager.reset();

		this.loadingUI.percentLoaded = 0;
		this.loadingUI.show();

		this.scene = new THREE.Scene();
		this.scene.fog = new THREE.Fog(new THREE.Color().setRGB(0, 0, 0).getHex(), 500, 900);

		if (!this.assetLoader.loaded) {
			this.assetLoader.load();
			this.nextState = GS.GameStates.Loading;
		} else {
			this.nextState = GS.GameStates.PostLoad;
		}
	},

	initAssetLoader: function() {
		var that = this;

		this.assetLoader = new GS.ZipAssetLoader(this.soundManager.ctx);

		this.assetLoader.init();
		this.assetLoader.addEventListener("progress", function(e) {
			that.loadingUI.updateProgress(e);
		});
		this.assetLoader.addEventListener("load", function(e) {
			that.loadingUI.updateProgress(e);
			that.nextState = GS.GameStates.PostLoad;
		});
	},

	postLoad: function() {
    if (this.onlinePlay) {
      if (this.firstLoad) {
        this.loadingUI.spinnerOnly = true;
        this.uiManager.initComponents(this.assetLoader.assets);
        // this.openMenu();
        this.firstLoad = false;

        this.onlineManager.setGrid(this.grid);
        // if (this.noMenu) {
        //   this.newGame();
        // }
      } else {
        this.initComponents(this.assetLoader.assets);
        this.uiManager.initComponents(this.assetLoader.assets, this.grid);
        this.uiManager.useIngameMenu();
        // TODO add useOnlineMenu

        this.nextState = GS.GameStates.Play;
        this.graphicsManager.monochromeEnabled = false;

        if (this.grid.aiManager.script !== undefined && !this.restartedLevel) {
          this.musicManager.playTrack(this.grid.aiManager.script.musicTrack);
        }
        this.restartedLevel = false;

      }
    } else {
      if (this.firstLoad) {
        this.loadingUI.spinnerOnly = true;
        this.uiManager.initComponents(this.assetLoader.assets);
        this.openMenu();
        this.firstLoad = false;

        if (this.noMenu) {
          this.newGame();
        }
      } else {
        this.initComponents(this.assetLoader.assets);
        this.uiManager.initComponents(this.assetLoader.assets, this.grid);
        this.uiManager.useIngameMenu();
        // TODO add useOnlineMenu

        this.nextState = GS.GameStates.Play;
        this.graphicsManager.monochromeEnabled = false;

        if (this.grid.aiManager.script !== undefined && !this.restartedLevel) {
          this.musicManager.playTrack(this.grid.aiManager.script.musicTrack);
        }
        this.restartedLevel = false;

      }
    }
	},

	play: function() {
    GS.InputHelper.checkPressedKeys();
    if (this.onlinePlay) {
        this.grid.update();
        TWEEN.update();
        this.onlineManager.setupClients();
        if (this.grid.player.dead && !GS.InputHelper.keysPressed && GS.InputHelper.isKeyDown(this.keys.Enter)) {
          this.grid.respawn();
        }
    } else {

      if (!GS.InputHelper.keysPressed && GS.InputHelper.isKeyDown(this.keys.Escape)) {
        this.openMenu();
      }

      if (!this.grid.aiManager.mapWon && !GS.InputHelper.keysPressed && GS.InputHelper.isKeyDown(this.keys.Tab)) {
        this.uiManager.automap.visible = !this.uiManager.automap.visible;
        this.uiManager.overrideRedraw = true;
        this.graphicsManager.monochromeEnabled = this.uiManager.automap.visible;
      }

      if (this.grid.player.dead && !GS.InputHelper.keysPressed && GS.InputHelper.isKeyDown(this.keys.Enter)) {
        this.restartLevel();
      }

      if (this.grid.aiManager.mapWon && !GS.InputHelper.keysPressed && GS.InputHelper.isKeyDown(this.keys.Enter)) {
        if (this.grid.aiManager.script.nextMap !== undefined) {
          this.playerPersistencePackage = this.grid.player.getPersistencePackage();
          this.loadLevel(this.grid.aiManager.script.nextMap);
        }
      }

      if (!this.mapWon && this.grid.aiManager.mapWon) {
        this.mapWon = true;
        this.onMapWon();
      }

      if (!this.grid.aiManager.mapWon) {
        this.grid.update();
        TWEEN.update();
      }
    }
    GS.DebugUI.update();

    this.uiManager.update();
	},

	onMapWon: function() {
		this.graphicsManager.monochromeEnabled = false;
	},

	menu: function() {
		GS.InputHelper.checkPressedKeys();

		if (!GS.InputHelper.keysPressed && GS.InputHelper.isKeyDown(this.keys.Escape)) {
			if (this.grid !== undefined) {
				this.closeMenu();
			}
		}

		this.uiManager.update();
	},

	openMenu: function() {
		this.nextState = GS.GameStates.Menu;

		if (this.grid !== undefined) {
			this.grid.player.inMenu = true;
			this.grid.player.controls.disable();
			this.grid.player.controls.detachEvents();
		}

		this.graphicsManager.monochromeEnabled = true;
		this.uiManager.menuActive = true;

		GS.DebugUI.visible = false;
	},

	closeMenu: function() {
		this.nextState = GS.GameStates.Play;

		if (this.grid !== undefined) {
			this.grid.player.inMenu = false;
			this.grid.player.controls.attachEvents();
			this.grid.player.controls.enable();
			this.grid.aiManager.resume();

			if (this.mapWon || !this.uiManager.automap.visible) {
				this.graphicsManager.monochromeEnabled = false;
			}
		} else {
			this.graphicsManager.monochromeEnabled = false;
		}

		if (this.firstTimeInMenu) {
			this.uiManager.removeNewsBox();
			this.firstTimeInMenu = false;
		}

		this.uiManager.menuActive = false;
		GS.DebugUI.visible = GS.Settings.showHUD;
	},

	restartLevel: function() {
		this.nextState = GS.GameStates.Dispose;
		this.restartedLevel = true;
	},

	loadLevel: function(name) {
    this.onlinePlay = false;
		if (this.uiManager.menuActive) {
			this.closeMenu();
		}

		this.mapName = name;
		this.nextState = GS.GameStates.Dispose;
	},

	loadOnlineLevel: function(name) {
    this.onlinePlay = true;
		if (this.uiManager.menuActive) {
			this.closeMenu();
		}

		this.mapName = name;
		this.nextState = GS.GameStates.Dispose;
	},

	newGame: function() {
    this.onlinePlay = false;
		if (this.uiManager.menuActive) {
			this.closeMenu();
		}

		if (this.isTestMap()) {
			this.mapName = "testMap";
		} else {
			this.mapName = "airstrip1";
		}

		this.nextState = GS.GameStates.Dispose;
	},

	join: function() {
		if (this.uiManager.menuActive) {
			this.closeMenu();
		}

		if (this.isTestMap()) {
			this.mapName = "testMap";
		} else {
			this.mapName = "airstrip1";
		}

		this.nextState = GS.GameStates.Dispose;
	},

	isTestMap: function() {
		return window.location.search.toLowerCase().indexOf("testmap") > -1;
	},

	initComponents: function(assets) {
		var that = this;
		var map = this.assetLoader.mapLoader.parse(assets[GS.AssetTypes.Map][this.mapName]);
		this.mapWon = false;

		var viewFactory = new GS.ViewFactory(this.renderer, map, assets);
		viewFactory.init();
		var gridFactory = new GS.GridFactory(viewFactory, this.soundManager, this.renderer, this.scene, this.camera);
		this.grid = gridFactory.getGrid(map);

		this.soundManager.initSounds(assets[GS.AssetTypes.Sound]);
		this.musicManager.initTracks(assets[GS.AssetTypes.MusicTrack]);

		if (this.playerPersistencePackage !== undefined) {
			this.grid.player.applyPersistencePackage(this.playerPersistencePackage);
			this.playerPersistencePackage = undefined;
		}

		this.grid.update();
		this.graphicsManager.setGrid(this.grid);

		// this.grid.player.controls.addEventListener("pointerLockDisabled", function() { that.openMenu(); });

		// console.log("collision triangles", viewFactory.triangleCount);
	},

	update: function() {
		var time;
		if (this.showPerformanceDebugMeters) {
			time = window.performance.now();
		}

		if (this.state == GS.GameStates.Dispose) {
			if (!this.updated) {
				this.updated = true;
				this.dispose();
			}
		} else
		if (this.state == GS.GameStates.PreLoad) {
			if (!this.updated) {
				this.updated = true;
				this.preLoad();
			}
		} else
		if (this.state == GS.GameStates.Loading) {
			this.updated = true;
		} else
		if (this.state == GS.GameStates.PostLoad) {
			if (!this.updated) {
				this.updated = true;
				this.postLoad();
			}
		} else
		if (this.state == GS.GameStates.Play) {
			this.updated = true;
			this.play();
		} else
		if (this.state == GS.GameStates.Menu) {
			this.updated = true;
			this.menu();
		}

		if (this.nextState !== null) {
			if (this.updated) {
				if (this.nextState == GS.GameStates.Play || this.nextState == GS.GameStates.Menu) {
					this.loadingUI.hide();
					this.uiManager.show();
				}

				this.state = this.nextState;
				this.nextState = null;
				this.updated = false;
			}
		}

		if (this.showPerformanceDebugMeters) {
			this.updateTime = (window.performance.now() - time).toFixed(2);
			GS.DebugUI.trackNumericValue("updateTime", this.updateTime);
		}
	},

	draw: function() {
		var time;
		if (this.showPerformanceDebugMeters) {
			time = window.performance.now();
		}

		if (this.state == GS.GameStates.PreLoad) {
			this.loadingUI.draw();
		} else
		if (this.state == GS.GameStates.Loading) {
			this.loadingUI.draw();
		} else
		if (this.state == GS.GameStates.PostLoad) {
			this.loadingUI.draw();
		} else
		if (this.state == GS.GameStates.Play || this.state == GS.GameStates.Menu) {
			if (this.grid !== undefined) {
				this.graphicsManager.draw();
			}

			this.uiManager.draw();
		}

		if (this.showPerformanceDebugMeters) {
			this.drawTime = (window.performance.now() - time).toFixed(2);
			GS.DebugUI.trackNumericValue("drawTime", this.drawTime);
		}
	},

	onResize: function() {
		GS.Base.prototype.onResize.call(this);

		this.uiManager.onResize();
		this.loadingUI.onResize();

		if (this.graphicsManager !== undefined) {
			this.graphicsManager.onResize();
		}

		if (this.grid !== undefined) {
			this.grid.onResize();
			this.grid.player.playerView.onResize();
		}
	},

	customMap: function() {
		var that = this;

		var customMapInput = $("#customMapInput");
		var files = customMapInput[0].files;

		if (files === undefined || files.length === 0) {
			customMapInput.trigger("click");
			return;
		}

		var file = files[0];
		var fileReader = new FileReader();

		fileReader.onload = function(e) {
			that.assetLoader.assets[GS.AssetTypes.Map].customMap = e.target.result;

			that.loadLevel("customMap");
		};

		fileReader.onerror = function(e) {
			GAME.handleFatalError("file read error - " + e.target.error.code);
		};

		fileReader.readAsText(file);
		customMapInput.val("");
	},


	handleFatalError: function(message) {
		var that = this;

		document.body.innerHTML = "<span class='fatal-error'> fatal error: '" + message + "'</span><br/>";
		document.body.style.padding = "20px";

		var a = document.createElement("a");
		a.innerHTML = "click here or refresh page to restart";
		a.className = "fatal-error-link";
		a.onclick = function() {
			window.location.reload();
		};

		document.body.appendChild(a);

		this.nextState = GS.GameStates.Dispose;
	},

	updateFov: function() {
		this.cameraFov = GS.Settings.fov;
		this.camera.fov = GS.Settings.fov;
		this.camera.updateProjectionMatrix();

		if (this.state == GS.GameStates.Play) {
			this.grid.updateFov();
		}
	},

	disposeEnd: function() {
		TWEEN.removeAll();
		this.grid = undefined;
		this.graphicsManager.reset();
		this.scene = undefined;
		this.uiManager.dispose();

		this.nextState = GS.GameStates.PreLoad;
	},

	dispose: function() {
		var that = this;

		if (this.grid !== undefined) {
			this.grid.player.controls.dispose(function() {
				that.disposeEnd();
			});
		} else {
			this.disposeEnd();
		}
	},



});

var GAME;
window.addEventListener("load", function() {
	GS.Detector.run(function() {
		GAME = new GS.Game();

		GAME.preInit();
		GAME.init();

	});
}, false);
;GS.KeybindSettings = {
	keybinds: [
		{
			actionName: "moveForward",
			controlName: "W",
			code: 87
		},
		{
			actionName: "moveBackward",
			controlName: "S",
			code: 83
		},
		{
			actionName: "strafeLeft",
			controlName: "A",
			code: 65
		},
		{
			actionName: "strafeRight",
			controlName: "D",
			code: 68
		},
		{
			actionName: "use",
			controlName: "E",
			code: 69
		},
		{
			actionName: "shoot",
			controlName: "MOUSE LEFT",
			mouse: true,
			button: 1
		},
		{
			actionName: "pistol",
			controlName: "2",
			code: 50
		},
		{
			actionName: "shotgun",
			controlName: "3",
			code: 51
		},
		{
			actionName: "hyperblaster",
			controlName: "4",
			code: 52
		},
	],

	init: function() {
		this.textinput = new GS.TextInput();
		this.textinput.init();

		this.rebound = new GS.Rebound(GS.KeybindSettings.keybinds);
		this.rebound.init();

		GS.Keybinds = {};

		for (var i = 0; i < this.keybinds.length; i++) {
			var keybind = this.keybinds[i];
			GS.Keybinds[keybind.actionName] = keybind;
		}
	},
};
;
GS.Settings = function() {
	var settings = {
		fovMin: 60,
		fovMax: 120,
		fov: 75,

		ssao: true,
		bloom: true,
		noise: true,
		vignette: true,
		fxaa: true,


		halfSize: true,
		showFPS: true,

		viewBob: true,
		weaponBob: true,

		showHUD: true,
		showWeapon: true,

		soundMin: 0,
		soundMax: 10,
		sound: 5,

		musicMin: 0,
		musicMax: 10,
		music: 5,

		mouseMin: 1,
		mouseMax: 10,
		mouse: 5,
		mouseInvertY: false,

		keybinds: null,

    roomName: ''
	};

	return {
		loadSettings: function() {
			var jsonStr = localStorage["gs-settings"];
			if (jsonStr !== undefined) {
				var loadedSettings = JSON.parse(jsonStr);
				for (var i in loadedSettings) {
					if (i in settings) {
						settings[i] = loadedSettings[i];
					}
				}

				if (loadedSettings.keybinds) {
					GS.KeybindSettings.keybinds = loadedSettings.keybinds;
				}
			}

			GS.KeybindSettings.init();
			settings.keybinds = GS.KeybindSettings.keybinds;
		},


		saveSettings: function() {
			var jsonStr = JSON.stringify(settings);
			localStorage["gs-settings"] = jsonStr;

		},

		get fovMin() {
			return settings.fovMin;
		},

		get fovMax() {
			return settings.fovMax;
		},

		set fov(value) {
			var n = parseInt(value);
			if (!isNaN(n)) {
				n = Math.floor(GS.MathHelper.clamp(n, settings.fovMin, settings.fovMax));
				settings.fov = n;

				GAME.updateFov();
				this.saveSettings();
			}
		},

		get fov() {
			return settings.fov;
		},

		set ssao(value) {
			settings.ssao = (value === true);
			GAME.graphicsManager.ssaoEnabled = settings.ssao;
			this.saveSettings();
		},

		get ssao() {
			return settings.ssao;
		},

		set bloom(value) {
			settings.bloom = (value === true);
			GAME.graphicsManager.bloomEnabled = settings.bloom;
			this.saveSettings();
		},

		get bloom() {
			return settings.bloom;
		},

		set noise(value) {
			settings.noise = (value === true);
			GAME.graphicsManager.noiseEnabled = settings.noise;
			this.saveSettings();
		},

		get noise() {
			return settings.noise;
		},

		set vignette(value) {
			settings.vignette = (value === true);
			GAME.graphicsManager.vignetteEnabled = settings.vignette;
			this.saveSettings();
		},

		get vignette() {
			return settings.vignette;
		},

		set fxaa(value) {
			settings.fxaa = (value === true);
			GAME.graphicsManager.fxaaEnabled = settings.fxaa;
			this.saveSettings();
		},

		get fxaa() {
			return settings.fxaa;
		},

		set viewBob(value) {
			settings.viewBob = (value === true);
			this.saveSettings();
			if (GAME.grid !== undefined) {
				GAME.grid.player.playerView.viewBob.enabled = settings.viewBob;
			}
		},

		get viewBob() {
			return settings.viewBob;
		},

		set weaponBob(value) {
			settings.weaponBob = (value === true);
			this.saveSettings();
			if (GAME.grid !== undefined) {
				GAME.grid.player.playerView.weaponBob.enabled = settings.weaponBob;
			}
		},

		get weaponBob() {
			return settings.weaponBob;
		},



		set halfSize(value) {
			settings.halfSize = (value === true);
			this.saveSettings();
			GAME.graphicsManager.halfSizeEnabled = settings.halfSize;
		},

		get halfSize() {
			return settings.halfSize;
		},

		set showFPS(value) {
			settings.showFPS = (value === true);
			this.saveSettings();
			GAME.showFPS = settings.showFPS;
		},

		get showFPS() {
			return settings.showFPS;
		},

		get soundMin() {
			return settings.soundMin;
		},

		get soundMax() {
			return settings.soundMax;
		},

		set sound(value) {
			var n = parseInt(value);
			if (!isNaN(n)) {
				n = Math.floor(GS.MathHelper.clamp(n, settings.soundMin, settings.soundMax));
				settings.sound = n;

				GAME.soundManager.volume = settings.sound / 10;
				this.saveSettings();
			}
		},

		get sound() {
			return settings.sound;
		},

		get musicMin() {
			return settings.musicMin;
		},

		get musicMax() {
			return settings.musicMax;
		},

		set music(value) {
			var n = parseInt(value);
			if (!isNaN(n)) {
				n = Math.floor(GS.MathHelper.clamp(n, settings.musicMin, settings.musicMax));
				settings.music = n;

				GAME.musicManager.volume = settings.music / 10;
				this.saveSettings();
			}
		},

		get music() {
			return settings.music;
		},

		get mouseMin() {
			return settings.mouseMin;
		},

		get mouseMax() {
			return settings.mouseMax;
		},

		set mouse(value) {
			var n = parseInt(value);
			if (!isNaN(n)) {
				n = Math.floor(GS.MathHelper.clamp(n, settings.mouseMin, settings.mouseMax));
				settings.mouse = n;

				if (GAME.grid !== undefined) {
					GAME.grid.player.controls.lookSpeed = 0.066 * (settings.mouse / 5);
				}
				this.saveSettings();
			}
		},

		get mouse() {
			return settings.mouse;
		},

		set showHUD(value) {
			settings.showHUD = (value === true);
			this.saveSettings();
			GAME.uiManager.showHUD = settings.showHUD;
			GAME.uiManager.overrideRedraw = true;
		},

		get showHUD() {
			return settings.showHUD;
		},

		set showWeapon(value) {
			settings.showWeapon = (value === true);
			this.saveSettings();
			GAME.graphicsManager.showWeapon = settings.showWeapon;
		},

		get showWeapon() {
			return settings.showWeapon;
		},

		set mouseInvertY(value) {
			settings.mouseInvertY = (value === true);
			this.saveSettings();
			if (GAME.grid !== undefined) {
				GAME.grid.player.controls.mouseInvertY = settings.mouseInvertY;
			}
		},

		get mouseInvertY() {
			return settings.mouseInvertY;
		},

    get roomName() {
      return settings.roomName;
    },

    set roomName(value) {
      settings.roomName = value;
      this.saveSettings();
    }
	}
}();
;GS.Socket = function() {
  let that = this;
  return {
    init: function() {
      // let url = 'http://localhost:3030';
      let url = 'http://socket.pixelrocketstudio.com';
      // let url = 'http://192.168.86.26:3030';
      GS.Socket.io = io(url);
      // GS.Socket.p2p = new P2P(GS.Socket.io);
    },
    close: function() {
      if (GS.Socket.io) {
        GS.Socket.io.close();
      }
    },
  };
}();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJhc2UuanMiLCJDYW52YXMyZC5qcyIsIkN1YmUuanMiLCJEZXRlY3Rvci5qcyIsIkV4dGVuc2lvbnMuanMiLCJJbnB1dEhlbHBlci5qcyIsIkxpbmVIZWxwZXIuanMiLCJNYXBFbnVtcy5qcyIsIk1hdGhIZWxwZXIuanMiLCJPbmxpbmVSb29tLmpzIiwiUG9seWdvbkhlbHBlci5qcyIsIlJlYm91bmQuanMiLCJUZXh0SW5wdXQuanMiLCJEZWJ1Z1VJLmpzIiwiTG9hZGluZ1VJLmpzIiwiVUlFbnVtcy5qcyIsIlVJTWFuYWdlci5qcyIsIlZlY3RvckNhbnZhcy5qcyIsIkF1dG9tYXAuanMiLCJDcm9zc2hhaXIuanMiLCJNZW51LmpzIiwiTWVudUJ1dHRvbi5qcyIsIk1lbnVJbWFnZUJ1dHRvbi5qcyIsIk1lbnVMYWJlbC5qcyIsIk1lbnVOdW1iZXJQaWNrZXIuanMiLCJNZW51UGFuZWwuanMiLCJOb3RpZmljYXRpb25zLmpzIiwiUG93ZXJCYXJzLmpzIiwiV2luU2NyZWVuLmpzIiwiQ29sbGlzaW9uSGVscGVyLmpzIiwiSGl0c2NhbkhlbHBlci5qcyIsIlJlZ2lvbkhlbHBlci5qcyIsIkJyaWdodG5lc3NGaWx0ZXJTaGFkZXIuanMiLCJDb2xvclNoYWRlci5qcyIsIkdsb3dTaGFkZXIuanMiLCJNZXNoUGhvbmdHbG93TWF0ZXJpYWwuanMiLCJNZXNoVmVydGV4Q29sb3JNYXRlcmlhbC5qcyIsIk5vaXNlU2hhZGVyLmpzIiwiUGhvbmdHbG93U2hhZGVyLmpzIiwiUmFuZG9tTm9pc2VTaGFkZXIuanMiLCJWZXJ0ZXhDb2xvclNoYWRlci5qcyIsIkFzc2V0cy5qcyIsIk1vbnN0ZXJzLmpzIiwiUHJvamVjdGlsZXMuanMiLCJXZWFwb25zLmpzIiwiR3JpZE9iamVjdC5qcyIsIkNvbmNyZXRlLmpzIiwiRG9vci5qcyIsIkVsZXZhdG9yLmpzIiwiSXRlbS5qcyIsIk1vbnN0ZXIuanMiLCJPbmxpbmVQbGF5ZXIuanMiLCJQbGF5ZXIuanMiLCJQcm9qZWN0aWxlLmpzIiwiU3Bhd24uanMiLCJTd2l0Y2guanMiLCJUVlNjcmVlbi5qcyIsIkZvbnRMb2FkZXIuanMiLCJNYXBMb2FkZXIuanMiLCJaaXBBc3NldExvYWRlci5qcyIsIkdyaWRGYWN0b3J5LmpzIiwiVmlld0ZhY3RvcnkuanMiLCJBSU1hbmFnZXIuanMiLCJDaHJvbWVBcHBGUFNDb250cm9scy5qcyIsIkNvbGxpc2lvbk1hbmFnZXIuanMiLCJGUFNDb250cm9scy5qcyIsIkdyYXBoaWNzTWFuYWdlci5qcyIsIkdyaWQuanMiLCJNYXBTY3JpcHQuanMiLCJNdXNpY01hbmFnZXIuanMiLCJPbmxpbmVNYW5hZ2VyLmpzIiwiU291bmRNYW5hZ2VyLmpzIiwiQW5pbWF0aW9uVmlldy5qcyIsIkxpZ2h0aW5nVmlldy5qcyIsIlBhcnRpY2xlVmlldy5qcyIsIlBsYXllclZpZXcuanMiLCJHYW1lLmpzIiwiS2V5YmluZFNldHRpbmdzLmpzIiwiU2V0dGluZ3MuanMiLCJTb2NrZXQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQzVLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N2VEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0N0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQ3pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDNW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0N4SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQzdMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDaC9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDdk1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDaklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0NsT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0MvR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQzlMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQzdMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0M5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDcmlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDaEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDNU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDbEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0NyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDakhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDL2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDOUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDekpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0NyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQzVHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0NwR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQzFKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0MvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0NwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDeEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDOVpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N6VEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3RjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElDbEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDeEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0VDcFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ2hPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDdnRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0M5U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0M1a0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUN2UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQ2pTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ3JjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDeldBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQzdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0MvSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQ3RLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0MzTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQy9UQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N2aUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQ2pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDN1NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnb3Jlc2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBHUyA9IEdTIHx8IHt9O1xyXG5cclxuR1MuaW5oZXJpdCA9IGZ1bmN0aW9uKGNsYXNzT2JqLCBtZW1iZXJzKSB7XHJcblx0dmFyIGJhc2UgPSBPYmplY3QuY3JlYXRlKGNsYXNzT2JqLnByb3RvdHlwZSk7XHJcblxyXG5cdE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG1lbWJlcnMpLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xyXG5cdFx0dmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG1lbWJlcnMsIHByb3ApO1xyXG5cclxuXHRcdGlmIChkZXNjLmdldCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdGJhc2UuX19kZWZpbmVHZXR0ZXJfXyhwcm9wLCBkZXNjLmdldCk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRiYXNlW3Byb3BdID0gbWVtYmVyc1twcm9wXTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZGVzYy5zZXQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRiYXNlLl9fZGVmaW5lU2V0dGVyX18ocHJvcCwgZGVzYy5zZXQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRyZXR1cm4gYmFzZTtcclxufTtcclxuXHJcbkdTLnB1c2hBcnJheSA9IGZ1bmN0aW9uKGRzdCwgc3JjKSB7XHJcblx0c3JjLmZvckVhY2goZnVuY3Rpb24oeCkge1xyXG5cdFx0dGhpcy5wdXNoKHgpO1xyXG5cdH0sIGRzdCk7XHJcbn07XHJcblxyXG5HUy5tc1RvRnJhbWVzID0gZnVuY3Rpb24obXMpIHtcclxuXHRyZXR1cm4gTWF0aC5yb3VuZChtcyAvIDE2LjY2KTtcclxufTtcclxuXHJcbkdTLnBhZCA9IGZ1bmN0aW9uKG4sIHdpZHRoLCB6KSB7XHJcblx0eiA9IHogfHwgXCIwXCI7XHJcblx0biA9IG4gKyBcIlwiO1xyXG5cdHJldHVybiBuLmxlbmd0aCA+PSB3aWR0aCA/IG4gOiBuZXcgQXJyYXkod2lkdGggLSBuLmxlbmd0aCArIDEpLmpvaW4oeikgKyBuO1xyXG59O1xyXG5cclxuR1MubG9nT25jZSA9IGZ1bmN0aW9uKGlkLCBzdHIpIHtcclxuXHRpZiAoR1MubG9nT25jZVtpZC50b1N0cmluZygpXSA9PT0gdHJ1ZSkge1xyXG5cdFx0cmV0dXJuO1xyXG5cdH1cclxuXHJcblx0R1MubG9nT25jZVtpZC50b1N0cmluZygpXSA9IHRydWU7XHJcblx0Y29uc29sZS5sb2coc3RyKTtcclxufSxcclxuXHJcbkdTLmlzRmlyZWZveCA9IHR5cGVvZiBJbnN0YWxsVHJpZ2dlciAhPT0gXCJ1bmRlZmluZWRcIjsgLy8ganNoaW50IGlnbm9yZTpsaW5lXHJcbkdTLmlzSUZyYW1lID0gZnVuY3Rpb24oKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJldHVybiB3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcDtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufSgpO1xyXG5cclxuR1MuQmFzZSA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMuY2xlYXJDb2xvciA9IDB4MDAwMDAwO1xyXG5cdHRoaXMuYW50aWFsaWFzID0gdHJ1ZTtcclxuXHJcblx0dGhpcy5jYW1lcmFGb3YgPSA5MDtcclxuXHR0aGlzLmNhbWVyYU5lYXIgPSAwLjE7XHJcblx0dGhpcy5jYW1lcmFGYXIgPSAxMDAwO1xyXG5cdHRoaXMudGltZVN0ZXAgPSAwLjAxNjY2O1xyXG5cclxuXHR0aGlzLmZwc0NvdW50ZXIgPSB7XHJcblx0XHR1cGRhdGVSYXRlOiAwLFxyXG5cdFx0ZnJhbWVSYXRlOiAwLFxyXG5cdFx0dXBkYXRlczogMCxcclxuXHRcdGZyYW1lczogMCxcclxuXHRcdGN1cnJlbnRUaW1lOiB0aGlzLmdldEN1cnJlbnRUaW1lKCksXHJcblx0fTtcclxuXHJcblx0dGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVJZCA9IG51bGw7XHJcbn07XHJcblxyXG5HUy5CYXNlLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuQmFzZSxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHsgYW50aWFsaWFzOiB0aGlzLmFudGlhbGlhcyB9KTtcclxuXHRcdHRoaXMucmVuZGVyZXIuc2V0Q2xlYXJDb2xvcih0aGlzLmNsZWFyQ29sb3IsIDEpO1xyXG5cdFx0dGhpcy5yZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG5cdFx0dGhpcy5yZW5kZXJlci5kb21FbGVtZW50LmlkID0gXCJnYW1lLWNhbnZhc1wiO1xyXG5cclxuXHRcdHRoaXMuY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKHRoaXMuY2FtZXJhRm92LCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgdGhpcy5jYW1lcmFOZWFyLCB0aGlzLmNhbWVyYUZhcik7XHJcblxyXG5cdFx0dGhpcy5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGZ1bmN0aW9uKCkgeyB0aGF0Lm9uUmVzaXplKCk7IH0sIGZhbHNlKTtcclxuXHRcdHRoaXMub25SZXNpemUoKTtcclxuXHJcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMucmVuZGVyZXIuZG9tRWxlbWVudCk7XHJcblxyXG5cdFx0dGhpcy5sb2FkKCk7XHJcblx0fSxcclxuXHJcblx0bG9hZDogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVJZCAhPT0gbnVsbCkge1xyXG5cdFx0XHRjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZUlkKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmN1cnJlbnRUaW1lID0gdGhpcy5nZXRDdXJyZW50VGltZSgpO1xyXG5cdFx0dGhpcy5hY2N1bXVsYXRvciA9IDAuMDtcclxuXHJcblx0XHR0aGlzLmdhbWVMb29wKCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHR9LFxyXG5cclxuXHRkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMuc2NlbmUsIHRoaXMuY2FtZXJhKTtcclxuXHR9LFxyXG5cclxuXHQvLyBodHRwOi8vZ2FmZmVyb25nYW1lcy5jb20vZ2FtZS1waHlzaWNzL2ZpeC15b3VyLXRpbWVzdGVwL1xyXG5cdGdhbWVMb29wOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR2YXIgbmV3VGltZSA9IHRoaXMuZ2V0Q3VycmVudFRpbWUoKTtcclxuXHRcdHZhciBmcmFtZVRpbWUgPSAobmV3VGltZSAtIHRoaXMuY3VycmVudFRpbWUpIC8gMTAwMDtcclxuXHRcdGlmIChmcmFtZVRpbWUgPiAwLjMzKSB7XHJcblx0XHRcdGZyYW1lVGltZSA9IDAuMzM7XHJcblx0XHR9XHJcblx0XHR0aGlzLmN1cnJlbnRUaW1lID0gbmV3VGltZTtcclxuXHRcdHRoaXMuYWNjdW11bGF0b3IgKz0gZnJhbWVUaW1lO1xyXG5cclxuXHRcdHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IHRoaXMudGltZVN0ZXApIHtcclxuXHRcdFx0dGhpcy51cGRhdGUoKTtcclxuXHRcdFx0dGhpcy5mcHNDb3VudGVyLnVwZGF0ZXMrKztcclxuXHJcblx0XHQgXHR0aGlzLmFjY3VtdWxhdG9yIC09IHRoaXMudGltZVN0ZXA7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5kcmF3KCk7XHJcblx0XHR0aGlzLmZwc0NvdW50ZXIuZnJhbWVzKys7XHJcblxyXG5cdFx0aWYgKG5ld1RpbWUgLSB0aGlzLmZwc0NvdW50ZXIuY3VycmVudFRpbWUgPj0gMTAwMCkge1xyXG5cdFx0XHR0aGlzLmZwc0NvdW50ZXIudXBkYXRlUmF0ZSA9IHRoaXMuZnBzQ291bnRlci51cGRhdGVzO1xyXG5cdFx0XHR0aGlzLmZwc0NvdW50ZXIuZnJhbWVSYXRlID0gdGhpcy5mcHNDb3VudGVyLmZyYW1lcztcclxuXHRcdFx0dGhpcy5mcHNDb3VudGVyLnVwZGF0ZXMgPSAwO1xyXG5cdFx0XHR0aGlzLmZwc0NvdW50ZXIuZnJhbWVzID0gMDtcclxuXHRcdFx0dGhpcy5mcHNDb3VudGVyLmN1cnJlbnRUaW1lID0gbmV3VGltZTtcclxuXHJcblx0XHRcdC8vIEdTLkRlYnVnVUkudHJhY2tOdW1lcmljVmFsdWUoXCJ1cGRhdGUgcmF0ZVwiLCB0aGlzLmZwc0NvdW50ZXIudXBkYXRlUmF0ZSk7XHJcblx0XHRcdEdTLkRlYnVnVUkudHJhY2tOdW1lcmljVmFsdWUoXCJmcHNcIiwgdGhpcy5mcHNDb3VudGVyLmZyYW1lUmF0ZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHsgdGhhdC5nYW1lTG9vcCgpOyB9KTtcclxuXHR9LFxyXG5cclxuXHRvblJlc2l6ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmNhbWVyYS5hc3BlY3QgPSB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodDtcclxuXHRcdHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuXHJcblx0XHR0aGlzLnJlbmRlcmVyLnNldFNpemUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XHJcblx0fSxcclxuXHJcblx0Z2V0Q3VycmVudFRpbWU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIChzZWxmLnBlcmZvcm1hbmNlICE9PSB1bmRlZmluZWQgJiYgc2VsZi5wZXJmb3JtYW5jZS5ub3cgIT09IHVuZGVmaW5lZCkgPyBzZWxmLnBlcmZvcm1hbmNlLm5vdygpIDogRGF0ZS5ub3coKTtcclxuXHR9LFxyXG5cclxuXHRzZXQgc2hvd0ZQUyh2YWx1ZSkge1xyXG5cdFx0R1MuRGVidWdVSS5zZXRTdGF0aWNMaW5lVmlzaWJpbGl0eShcImZwc1wiLCB2YWx1ZSk7XHJcblx0fSxcclxuXHJcblx0Z2V0IHNob3dGUFMoKSB7XHJcblx0XHRyZXR1cm4gR1MuRGVidWdVSS5nZXRTdGF0aWNMaW5lVmlzaWJpbGl0eShcImZwc1wiKTtcclxuXHR9XHJcbn07XHJcbiIsIkdTLkNhbnZhczJkID0gZnVuY3Rpb24oaGlkZU9uU3RhcnQpIHtcclxuXHR0aGlzLmNhbnZhc0lkID0gXCJjYW52YXMyZFwiO1xyXG5cdHRoaXMuaGlkZU9uU3RhcnQgPSAoaGlkZU9uU3RhcnQgIT09IHVuZGVmaW5lZCkgPyBoaWRlT25TdGFydCA6IGZhbHNlO1xyXG5cclxuXHR0aGlzLm1pbldpZHRoID0gMTI4MDtcclxuXHR0aGlzLm1pbkhlaWdodCA9IDcyMDtcclxuXHJcblx0dGhpcy5hbHBoYSA9IDE7XHJcblx0dGhpcy5yZWRyYXdPblJlc2l6ZSA9IHRydWU7XHJcbn07XHJcblxyXG5HUy5DYW52YXMyZC5wcm90b3R5cGUgPSB7XHJcblx0Y29uc3RydWN0b3I6IEdTLkNhbnZhczJkLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR2YXIgc2NyZWVuQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuXHRcdHNjcmVlbkNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG5cdFx0c2NyZWVuQ2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuXHRcdHNjcmVlbkNhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJnYmEoMCwgMCwgMCwgXCIgKyB0aGlzLmFscGhhICsgXCIpXCI7XHJcblx0XHRzY3JlZW5DYW52YXMuaWQgPSB0aGlzLmNhbnZhc0lkO1xyXG5cdFx0dGhpcy5zY3JlZW5DYW52YXMgPSBzY3JlZW5DYW52YXM7XHJcblxyXG5cdFx0aWYgKHRoaXMuaGlkZU9uU3RhcnQpIHtcclxuXHRcdFx0dGhpcy5oaWRlKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnNjcmVlbkNhbnZhcyk7XHJcblxyXG5cdFx0dmFyIHNjcmVlbkN0eCA9IHNjcmVlbkNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblx0XHRzY3JlZW5DdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xyXG5cdFx0c2NyZWVuQ3R4LnNhdmUoKTtcclxuXHRcdHRoaXMuc2NyZWVuQ3R4ID0gc2NyZWVuQ3R4O1xyXG5cclxuXHRcdHZhciBidWZmZXJDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xyXG5cdFx0YnVmZmVyQ2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcblx0XHRidWZmZXJDYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5cdFx0YnVmZmVyQ2FudmFzLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiYSgwLCAwLCAwLCAxKVwiO1xyXG5cdFx0dGhpcy5idWZmZXJDYW52YXMgPSBidWZmZXJDYW52YXM7XHJcblxyXG5cdFx0dmFyIGJ1ZmZlckN0eCA9IGJ1ZmZlckNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblx0XHRidWZmZXJDdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xyXG5cdFx0YnVmZmVyQ3R4LnNhdmUoKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4ID0gYnVmZmVyQ3R4O1xyXG5cclxuXHRcdCQod2luZG93KS5vbihcInJlc2l6ZS5cIiArIHRoaXMuY2FudmFzSWQsIGZ1bmN0aW9uKCkgeyB0aGF0Lm9uUmVzaXplKCk7IH0pO1xyXG5cdFx0dGhpcy5vblJlc2l6ZSgpO1xyXG5cdH0sXHJcblxyXG5cdHNob3c6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5zY3JlZW5DYW52YXMuc3R5bGUuZGlzcGxheSA9IFwiXCI7XHJcblx0fSxcclxuXHJcblx0aGlkZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnNjcmVlbkNhbnZhcy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcblx0fSxcclxuXHJcblx0Y2xlYXI6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5idWZmZXJDdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuYnVmZmVyQ2FudmFzLndpZHRoLCB0aGlzLmJ1ZmZlckNhbnZhcy5oZWlnaHQpO1xyXG5cdH0sXHJcblxyXG5cdGZsaXA6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5zY3JlZW5DdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuc2NyZWVuQ2FudmFzLndpZHRoLCB0aGlzLnNjcmVlbkNhbnZhcy5oZWlnaHQpO1xyXG5cdFx0dGhpcy5zY3JlZW5DdHguZHJhd0ltYWdlKHRoaXMuYnVmZmVyQ2FudmFzLCAwLCAwKTtcclxuXHR9LFxyXG5cclxuXHRsaW5lOiBmdW5jdGlvbihwMCwgcDEsIGNvbG9yLCBsaW5lV2lkdGgpIHtcclxuXHRcdGNvbG9yID0gKGNvbG9yICE9PSB1bmRlZmluZWQpID8gY29sb3IgOiBcIiNmZmZcIjtcclxuXHRcdGxpbmVXaWR0aCA9IGxpbmVXaWR0aCB8fCAzO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnNhdmUoKTtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xyXG5cdFx0dGhpcy5idWZmZXJDdHgubGluZVdpZHRoID0gbGluZVdpZHRoO1xyXG5cdFx0dGhpcy5idWZmZXJDdHguYmVnaW5QYXRoKCk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5tb3ZlVG8ocDAueCwgcDAueSk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5saW5lVG8ocDEueCwgcDEueSk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5jbG9zZVBhdGgoKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnN0cm9rZSgpO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnJlc3RvcmUoKTtcclxuXHR9LFxyXG5cclxuXHRib3g6IGZ1bmN0aW9uKHAwLCBwMSwgY29sb3IsIGxpbmVXaWR0aCkge1xyXG5cdFx0Y29sb3IgPSAoY29sb3IgIT09IHVuZGVmaW5lZCkgPyBjb2xvciA6IFwiI2ZmZlwiO1xyXG5cdFx0bGluZVdpZHRoID0gbGluZVdpZHRoIHx8IDM7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHguc2F2ZSgpO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnN0cm9rZVN0eWxlID0gY29sb3I7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5iZWdpblBhdGgoKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4Lm1vdmVUbyhwMC54LCBwMC55KTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmxpbmVUbyhwMS54LCBwMC55KTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmxpbmVUbyhwMS54LCBwMS55KTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmxpbmVUbyhwMC54LCBwMS55KTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmNsb3NlUGF0aCgpO1xyXG5cdFx0dGhpcy5idWZmZXJDdHguc3Ryb2tlKCk7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHgucmVzdG9yZSgpO1xyXG5cdH0sXHJcblxyXG5cdGJveEZpbGw6IGZ1bmN0aW9uKHAwLCBwMSwgY29sb3IpIHtcclxuXHRcdGNvbG9yID0gKGNvbG9yICE9PSB1bmRlZmluZWQpID8gY29sb3IgOiBcIiNmZmZcIjtcclxuXHJcblx0XHR2YXIgeDAgPSBNYXRoLm1pbihwMC54LCBwMS54KTtcclxuXHRcdHZhciB5MCA9IE1hdGgubWluKHAwLnksIHAxLnkpO1xyXG5cdFx0dmFyIHgxID0gTWF0aC5tYXgocDAueCwgcDEueCk7XHJcblx0XHR2YXIgeTEgPSBNYXRoLm1heChwMC55LCBwMS55KTtcclxuXHRcdHZhciB3ID0geDEgLSB4MDtcclxuXHRcdHZhciBoID0geTEgLSB5MDtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zYXZlKCk7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHguZmlsbFN0eWxlID0gY29sb3I7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5maWxsUmVjdCh4MCwgeTAsIHcsIGgpO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnJlc3RvcmUoKTtcclxuXHR9LFxyXG5cclxuXHRfcm91bmRlZEJveDogZnVuY3Rpb24ocDAsIHAxLCByYWRpdXMsIGZpbGxlZCwgY29sb3IsIGxpbmVXaWR0aCkge1xyXG5cdFx0Y29sb3IgPSAoY29sb3IgIT09IHVuZGVmaW5lZCkgPyBjb2xvciA6IFwiI2ZmZlwiO1xyXG5cdFx0bGluZVdpZHRoID0gbGluZVdpZHRoIHx8IDM7XHJcblxyXG5cdFx0dmFyIHgwID0gTWF0aC5taW4ocDAueCwgcDEueCk7XHJcblx0XHR2YXIgeTAgPSBNYXRoLm1pbihwMC55LCBwMS55KTtcclxuXHRcdHZhciB4MSA9IE1hdGgubWF4KHAwLngsIHAxLngpO1xyXG5cdFx0dmFyIHkxID0gTWF0aC5tYXgocDAueSwgcDEueSk7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHguc2F2ZSgpO1xyXG5cclxuXHRcdGlmIChmaWxsZWQpIHtcclxuXHRcdFx0dGhpcy5idWZmZXJDdHguZmlsbFN0eWxlID0gY29sb3I7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmJ1ZmZlckN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xyXG5cdFx0XHR0aGlzLmJ1ZmZlckN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHguYmVnaW5QYXRoKCk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5tb3ZlVG8oeDAsIHkwICsgcmFkaXVzKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmxpbmVUbyh4MCwgeTEgLSByYWRpdXMpO1xyXG5cdFx0dGhpcy5idWZmZXJDdHgucXVhZHJhdGljQ3VydmVUbyh4MCwgeTEsIHgwICsgcmFkaXVzLCB5MSk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5saW5lVG8oeDEgLSByYWRpdXMsIHkxKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnF1YWRyYXRpY0N1cnZlVG8oeDEsIHkxLCB4MSwgeTEgLSByYWRpdXMpO1xyXG5cdFx0dGhpcy5idWZmZXJDdHgubGluZVRvKHgxLCB5MCArIHJhZGl1cyk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHgxLCB5MCwgeDEgLSByYWRpdXMsIHkwKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmxpbmVUbyh4MCArIHJhZGl1cywgeTApO1xyXG5cdFx0dGhpcy5idWZmZXJDdHgucXVhZHJhdGljQ3VydmVUbyh4MCwgeTAsIHgwLCB5MCArIHJhZGl1cyk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5jbG9zZVBhdGgoKTtcclxuXHJcblx0XHRpZiAoZmlsbGVkKSB7XHJcblx0XHRcdHRoaXMuYnVmZmVyQ3R4LmZpbGwoKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuYnVmZmVyQ3R4LnN0cm9rZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnJlc3RvcmUoKTtcclxuXHR9LFxyXG5cclxuXHRyb3VuZGVkQm94OiBmdW5jdGlvbihwMCwgcDEsIHJhZGl1cywgY29sb3IsIGxpbmVXaWR0aCkge1xyXG5cdFx0dGhpcy5fcm91bmRlZEJveChwMCwgcDEsIHJhZGl1cywgZmFsc2UsIGNvbG9yLCBsaW5lV2lkdGgpO1xyXG5cdH0sXHJcblxyXG5cdHJvdW5kZWRCb3hGaWxsOiBmdW5jdGlvbihwMCwgcDEsIHJhZGl1cywgY29sb3IpIHtcclxuXHRcdHRoaXMuX3JvdW5kZWRCb3gocDAsIHAxLCByYWRpdXMsIHRydWUsIGNvbG9yKTtcclxuXHR9LFxyXG5cclxuXHRwb2x5Z29uOiBmdW5jdGlvbihwb2ludHMsIGNvbG9yLCBsaW5lV2lkdGgpIHtcclxuXHRcdGNvbG9yID0gKGNvbG9yICE9PSB1bmRlZmluZWQpID8gY29sb3IgOiBcIiNmZmZcIjtcclxuXHRcdGxpbmVXaWR0aCA9IGxpbmVXaWR0aCB8fCAzO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnNhdmUoKTtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xyXG5cdFx0dGhpcy5idWZmZXJDdHgubGluZVdpZHRoID0gbGluZVdpZHRoO1xyXG5cdFx0dGhpcy5idWZmZXJDdHguYmVnaW5QYXRoKCk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5tb3ZlVG8ocG9pbnRzWzBdLngsIHBvaW50c1swXS55KTtcclxuXHRcdGZvciAodmFyIGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHRoaXMuYnVmZmVyQ3R4LmxpbmVUbyhwb2ludHNbaV0ueCwgcG9pbnRzW2ldLnkpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5idWZmZXJDdHguY2xvc2VQYXRoKCk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zdHJva2UoKTtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5yZXN0b3JlKCk7XHJcblx0fSxcclxuXHJcblx0cG9seWdvbkZpbGw6IGZ1bmN0aW9uKHBvaW50cywgY29sb3IpIHtcclxuXHRcdGNvbG9yID0gKGNvbG9yICE9PSB1bmRlZmluZWQpID8gY29sb3IgOiBcIiNmZmZcIjtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zYXZlKCk7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHguZmlsbFN0eWxlID0gY29sb3I7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5iZWdpblBhdGgoKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4Lm1vdmVUbyhwb2ludHNbMF0ueCwgcG9pbnRzWzBdLnkpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDE7IGkgPCBwb2ludHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dGhpcy5idWZmZXJDdHgubGluZVRvKHBvaW50c1tpXS54LCBwb2ludHNbaV0ueSk7XHJcblx0XHR9XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5jbG9zZVBhdGgoKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmZpbGwoKTtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5yZXN0b3JlKCk7XHJcblx0fSxcclxuXHJcblx0Y2lyY2xlOiBmdW5jdGlvbihwb3MsIHJhZGl1cywgY29sb3IsIGxpbmVXaWR0aCkge1xyXG5cdFx0Y29sb3IgPSAoY29sb3IgIT09IHVuZGVmaW5lZCkgPyBjb2xvciA6IFwiI2ZmZlwiO1xyXG5cdFx0bGluZVdpZHRoID0gbGluZVdpZHRoIHx8IDM7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHguc2F2ZSgpO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0dGhpcy5idWZmZXJDdHguYXJjKHBvcy54LCBwb3MueSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSk7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xyXG5cdFx0dGhpcy5idWZmZXJDdHgubGluZVdpZHRoID0gbGluZVdpZHRoO1xyXG5cdFx0dGhpcy5idWZmZXJDdHguc3Ryb2tlKCk7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHgucmVzdG9yZSgpO1xyXG5cdH0sXHJcblxyXG5cdGNpcmNsZUZpbGw6IGZ1bmN0aW9uKHBvcywgcmFkaXVzLCBjb2xvcikge1xyXG5cdFx0Y29sb3IgPSAoY29sb3IgIT09IHVuZGVmaW5lZCkgPyBjb2xvciA6IFwiI2ZmZlwiO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnNhdmUoKTtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5iZWdpblBhdGgoKTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmFyYyhwb3MueCwgcG9zLnksIHJhZGl1cywgMCwgMiAqIE1hdGguUEkpO1xyXG5cdFx0dGhpcy5idWZmZXJDdHguZmlsbFN0eWxlID0gY29sb3I7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5maWxsKCk7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHgucmVzdG9yZSgpO1xyXG5cdH0sXHJcblxyXG5cdHRleHQ6IGZ1bmN0aW9uKHBvcywgc3RyLCBjb2xvciwgZm9udFNpemUsIHRleHRCYXNlbGluZSwgdGV4dEFsaWduLCBmb250RmFtaWx5KSB7XHJcblx0XHRjb2xvciA9IChjb2xvciAhPT0gdW5kZWZpbmVkKSA/IGNvbG9yIDogXCIjZmZmXCI7XHJcblx0XHRmb250U2l6ZSA9IChmb250U2l6ZSAhPT0gdW5kZWZpbmVkKSA/IGZvbnRTaXplIDogMTY7XHJcblx0XHR0ZXh0QmFzZWxpbmUgPSB0ZXh0QmFzZWxpbmUgfHwgXCJ0b3BcIjtcclxuXHRcdHRleHRBbGlnbiA9IHRleHRBbGlnbiB8fCBcImxlZnRcIjtcclxuXHRcdGZvbnRGYW1pbHkgPSBmb250RmFtaWx5IHx8IFwiJ0x1Y2lkYSBDb25zb2xlJywgTW9uYWNvLCBtb25vc3BhY2VcIjtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zYXZlKCk7XHJcblxyXG5cdFx0dmFyIG9mZnNldCA9IEdTLmlzRmlyZWZveCA/IDQgOiAwOyAvLyByZW1vdmUgb25jZSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD03Mzc4NTIgaXMgZml4ZWRcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC50ZXh0QmFzZWxpbmUgPSB0ZXh0QmFzZWxpbmU7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC50ZXh0QWxpZ24gPSB0ZXh0QWxpZ247XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5mb250ID0gZm9udFNpemUgKyBcInB4IFwiICsgZm9udEZhbWlseTtcclxuXHRcdHRoaXMuYnVmZmVyQ3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xyXG5cdFx0dGhpcy5idWZmZXJDdHguZmlsbFRleHQoc3RyLCBwb3MueCwgcG9zLnkgKyBvZmZzZXQpO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnJlc3RvcmUoKTtcclxuXHR9LFxyXG5cclxuXHRkcmF3SW1hZ2U6IGZ1bmN0aW9uKHBvcywgaW1nLCBzaXplKSB7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5kcmF3SW1hZ2UoaW1nLCBwb3MueCwgcG9zLnksIHNpemUueCwgc2l6ZS55KTtcclxuXHR9LFxyXG5cclxuXHRkcmF3SW1hZ2VGcm9tQXRsYXM6IGZ1bmN0aW9uKHBvcywgaW1nLCBhdGxhc09mZnNldCwgYXRsYXNTaXplKSB7XHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5kcmF3SW1hZ2UoaW1nLCBhdGxhc09mZnNldC54LCBhdGxhc09mZnNldC55LCBhdGxhc1NpemUueCwgYXRsYXNTaXplLnksIHBvcy54LCBwb3MueSwgYXRsYXNTaXplLngsIGF0bGFzU2l6ZS55KTtcclxuXHR9LFxyXG5cclxuXHRnZXRUZXh0V2lkdGg6IGZ1bmN0aW9uKHN0ciwgZm9udFNpemUsIGZvbnRGYW1pbHkpIHtcclxuXHRcdGZvbnRTaXplID0gKGZvbnRTaXplICE9PSB1bmRlZmluZWQpID8gZm9udFNpemUgOiAxNjtcclxuXHRcdGZvbnRGYW1pbHkgPSBmb250RmFtaWx5IHx8IFwiJ0x1Y2lkYSBDb25zb2xlJywgTW9uYWNvLCBtb25vc3BhY2VcIjtcclxuXHJcblx0XHR0aGlzLmJ1ZmZlckN0eC5zYXZlKCk7XHJcblxyXG5cdFx0dGhpcy5idWZmZXJDdHguZm9udCA9IGZvbnRTaXplICsgXCJweCAnXCIgKyBmb250RmFtaWx5ICsgXCInXCI7XHJcblx0XHR2YXIgd2lkdGggPSB0aGlzLmJ1ZmZlckN0eC5tZWFzdXJlVGV4dChzdHIpLndpZHRoO1xyXG5cclxuXHRcdHRoaXMuYnVmZmVyQ3R4LnJlc3RvcmUoKTtcclxuXHJcblx0XHRyZXR1cm4gd2lkdGg7XHJcblx0fSxcclxuXHJcblx0b25SZXNpemU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGNhbnZhcztcclxuXHRcdGlmICh0aGlzLnJlZHJhd09uUmVzaXplKSB7XHJcblx0XHRcdGNhbnZhcyA9IHRoaXMuY2xvbmUoKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnNjcmVlbkNhbnZhcy53aWR0aCA9IE1hdGgubWF4KHdpbmRvdy5pbm5lcldpZHRoLCB0aGlzLm1pbldpZHRoKTtcclxuXHRcdHRoaXMuc2NyZWVuQ2FudmFzLmhlaWdodCA9IE1hdGgubWF4KHdpbmRvdy5pbm5lckhlaWdodCwgdGhpcy5taW5IZWlnaHQpO1xyXG5cdFx0dGhpcy5idWZmZXJDYW52YXMud2lkdGggPSBNYXRoLm1heCh3aW5kb3cuaW5uZXJXaWR0aCwgdGhpcy5taW5XaWR0aCk7XHJcblx0XHR0aGlzLmJ1ZmZlckNhbnZhcy5oZWlnaHQgPSBNYXRoLm1heCh3aW5kb3cuaW5uZXJIZWlnaHQsIHRoaXMubWluSGVpZ2h0KTtcclxuXHJcblx0XHQkKHRoaXMuc2NyZWVuQ2FudmFzKS5jc3MoXCJ3aWR0aFwiLCB3aW5kb3cuaW5uZXJXaWR0aCArIFwicHhcIikuY3NzKFwiaGVpZ2h0XCIsIHdpbmRvdy5pbm5lckhlaWdodCArIFwicHhcIik7XHJcblxyXG5cdFx0aWYgKHRoaXMucmVkcmF3T25SZXNpemUpIHtcclxuXHRcdFx0dGhpcy5zY3JlZW5DdHguZHJhd0ltYWdlKGNhbnZhcywgMCwgMCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Y2xvbmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcblx0XHRjYW52YXMud2lkdGggPSB0aGlzLnNjcmVlbkNhbnZhcy53aWR0aDtcclxuXHRcdGNhbnZhcy5oZWlnaHQgPSB0aGlzLnNjcmVlbkNhbnZhcy5oZWlnaHQ7XHJcblxyXG5cdFx0dmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblx0XHRjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xyXG5cdFx0Y3R4LnNhdmUoKTtcclxuXHJcblx0XHRjdHguZHJhd0ltYWdlKHRoaXMuc2NyZWVuQ2FudmFzLCAwLCAwKTtcclxuXHJcblx0XHRyZXR1cm4gY2FudmFzO1xyXG5cdH0sXHJcblxyXG5cdGRpc3Bvc2U6IGZ1bmN0aW9uKCkge1xyXG5cdFx0JCh3aW5kb3cpLm9mZihcInJlc2l6ZS5cIiArIHRoaXMuY2FudmFzSWQpO1xyXG5cdFx0JChcIiNcIiArIHRoaXMuY2FudmFzSWQpLnJlbW92ZSgpO1xyXG5cdH0sXHJcbn07XHJcbiIsIkdTLkN1YmUgPSB7XHJcblx0Z2V0VmVydGljZXM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHZlcnRpY2VzID0gW1xyXG5cdFx0XHQvLyBwb3MgeFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygxLCAxLCAtMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKDEsIDEsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygxLCAtMSwgLTEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygxLCAxLCAxKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgLTEsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygxLCAtMSwgLTEpLFxyXG5cclxuXHRcdFx0Ly8gbmVnIHhcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoLTEsIDEsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygtMSwgMSwgLTEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygtMSwgLTEsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygtMSwgMSwgLTEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygtMSwgLTEsIC0xKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoLTEsIC0xLCAxKSxcclxuXHJcblx0XHRcdC8vIHBvcyB5XHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKC0xLCAxLCAxKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgMSwgMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKC0xLCAxLCAtMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKDEsIDEsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygxLCAxLCAtMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKC0xLCAxLCAtMSksXHJcblxyXG5cdFx0XHQvLyBuZWcgeVxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygtMSwgLTEsIC0xKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgLTEsIC0xKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoLTEsIC0xLCAxKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgLTEsIC0xKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgLTEsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygtMSwgLTEsIDEpLFxyXG5cclxuXHRcdFx0Ly8gcG9zIHpcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgMSwgMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKC0xLCAxLCAxKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgLTEsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMygtMSwgMSwgMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKC0xLCAtMSwgMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKDEsIC0xLCAxKSxcclxuXHJcblx0XHRcdC8vIG5lZyB6XHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKC0xLCAxLCAtMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKDEsIDEsIC0xKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoLTEsIC0xLCAtMSksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKDEsIDEsIC0xKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoMSwgLTEsIC0xKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoLTEsIC0xLCAtMSksXHJcblx0XHRdO1xyXG5cclxuXHRcdHJldHVybiB2ZXJ0aWNlcztcclxuXHR9LFxyXG59OyIsIkdTLkRldGVjdG9yID0ge1xyXG5cdHJ1bjogZnVuY3Rpb24oY2FsbGJhY2spIHtcclxuXHRcdHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xyXG5cdFx0aWYgKGNhbnZhcy5nZXRDb250ZXh0ID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy5kaXNwbGF5RXJyb3JNZXNzYWdlKFwiSFRNTDUgY2FudmFzXCIpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHdlYkdMID0gKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0dHJ5IHtcclxuXHRcdFx0XHR2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuXHRcdFx0XHRyZXR1cm4gISF3aW5kb3cuV2ViR0xSZW5kZXJpbmdDb250ZXh0ICYmIChjYW52YXMuZ2V0Q29udGV4dChcIndlYmdsXCIpIHx8IGNhbnZhcy5nZXRDb250ZXh0KFwiZXhwZXJpbWVudGFsLXdlYmdsXCIpKTtcclxuXHRcdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fSkoKTtcclxuXHRcdGlmICghd2ViR0wpIHtcclxuXHRcdFx0dGhpcy5kaXNwbGF5RXJyb3JNZXNzYWdlKFwiV2ViR0wsIG9yIFdlYkdMIGZhaWxlZCB0byBpbml0aWFsaXplXCIpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHdlYkF1ZGlvID0gKHR5cGVvZiBBdWRpb0NvbnRleHQgIT09IFwidW5kZWZpbmVkXCIpIHx8ICh0eXBlb2Ygd2Via2l0QXVkaW9Db250ZXh0ICE9PSBcInVuZGVmaW5lZFwiKTtcclxuXHRcdGlmICghd2ViQXVkaW8pIHtcclxuXHRcdFx0dGhpcy5kaXNwbGF5RXJyb3JNZXNzYWdlKFwidGhlIFdlYiBBdWRpbyBBUElcIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcG9pbnRlckxvY2sgPSBcInBvaW50ZXJMb2NrRWxlbWVudFwiIGluIGRvY3VtZW50IHx8IFwibW96UG9pbnRlckxvY2tFbGVtZW50XCIgaW4gZG9jdW1lbnQgfHwgXCJ3ZWJraXRQb2ludGVyTG9ja0VsZW1lbnRcIiBpbiBkb2N1bWVudDtcclxuXHRcdGlmICghcG9pbnRlckxvY2spIHtcclxuXHRcdFx0dGhpcy5kaXNwbGF5RXJyb3JNZXNzYWdlKFwidGhlIFBvaW50ZXIgTG9jayBBUElcIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgbG9jYWxTdG9yYWdlO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0bG9jYWxTdG9yYWdlID0gXCJsb2NhbFN0b3JhZ2VcIiBpbiB3aW5kb3cgJiYgd2luZG93W1wibG9jYWxTdG9yYWdlXCJdICE9PSBudWxsO1xyXG5cdFx0fSBjYXRjaChlKSB7XHJcblx0XHRcdGxvY2FsU3RvcmFnZSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdFx0aWYgKCFsb2NhbFN0b3JhZ2UpIHtcclxuXHRcdFx0dGhpcy5kaXNwbGF5RXJyb3JNZXNzYWdlKFwiSFRNTDUgbG9jYWwgc3RvcmFnZVwiKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNhbGxiYWNrKCk7XHJcblx0fSxcclxuXHJcblx0ZGlzcGxheUVycm9yTWVzc2FnZTogZnVuY3Rpb24oaHRtbCkge1xyXG5cdFx0dmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcblxyXG5cdFx0ZGl2LnN0eWxlLndpZHRoID0gXCI0NTBweFwiO1xyXG5cdFx0ZGl2LnN0eWxlLmhlaWdodCA9IFwiMTUwcHhcIjtcclxuXHRcdGRpdi5zdHlsZS5tYXJnaW5MZWZ0ID0gXCItMjI1cHhcIjtcclxuXHRcdGRpdi5zdHlsZS5tYXJnaW5Ub3AgPSBcIi03NXB4XCI7XHJcblx0XHRkaXYuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XHJcblx0XHRkaXYuc3R5bGUudG9wID0gXCI1MCVcIjtcclxuXHRcdGRpdi5zdHlsZS5sZWZ0ID0gXCI1MCVcIjtcclxuXHRcdGRpdi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiMwMDBcIjtcclxuXHRcdGRpdi5zdHlsZS5jb2xvciA9IFwiI2ZmZlwiO1xyXG5cdFx0ZGl2LnN0eWxlLmZvbnRTaXplID0gXCIyMHB4XCI7XHJcblx0XHRkaXYuc3R5bGUuZm9udEZhbWlseSA9IFwiQXJpYWwsIEhlbHZldGljYSwgc2Fucy1zZXJpZlwiO1xyXG5cdFx0ZGl2LnN0eWxlLmZvbnRXZWlnaHQgPSBcIm5vcm1hbFwiO1xyXG5cdFx0ZGl2LnN0eWxlLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcblx0XHRkaXYuc3R5bGUuYm9yZGVyID0gXCIxcHggZGFzaGVkICNmZmZcIjtcclxuXHJcblx0XHR2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG5cdFx0c3Bhbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cdFx0c3Bhbi5zdHlsZS5tYXJnaW5Ub3AgPSBcIjUwcHhcIjtcclxuXHRcdHNwYW4uaW5uZXJIVE1MID0gXCJZb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydDxici8+XCIgKyBodG1sICsgXCIuXCI7XHJcblxyXG5cdFx0ZGl2LmFwcGVuZENoaWxkKHNwYW4pO1xyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpO1xyXG5cdH1cclxufTsiLCIoZnVuY3Rpb24oKSB7XHJcblxyXG5cdC8vIFZlY3RvcjNcclxuXHJcblx0VEhSRUUuVmVjdG9yMy5wcm90b3R5cGUudG9WZWN0b3IyID0gZnVuY3Rpb24ob3B0aW9uYWxUYXJnZXQpIHtcclxuXHRcdHZhciB2ID0gb3B0aW9uYWxUYXJnZXQgfHwgbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHYueCA9IHRoaXMueDtcclxuXHRcdHYueSA9IHRoaXMuejtcclxuXHRcdHJldHVybiB2O1xyXG5cdH07XHJcblxyXG5cdFRIUkVFLlZlY3RvcjMucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oZCkge1xyXG5cdFx0ZCA9IGQgfHwgMDtcclxuXHRcdHJldHVybiBbXCJbXCIsIHRoaXMueC50b0ZpeGVkKGQpLCB0aGlzLnkudG9GaXhlZChkKSwgdGhpcy56LnRvRml4ZWQoZCksIFwiXVwiXS5qb2luKFwiIFwiKTtcclxuXHR9O1xyXG5cclxuXHRUSFJFRS5WZWN0b3IzLnByb3RvdHlwZS5lcXVhbHNFcHNpbG9uID0gZnVuY3Rpb24odiwgZSkge1xyXG5cdFx0ZSA9IGUgfHwgMC4wMDAxO1xyXG5cdFx0cmV0dXJuIChNYXRoLmFicyh2LnggLSB0aGlzLngpIDwgZSAmJlxyXG5cdFx0XHRcdE1hdGguYWJzKHYueSAtIHRoaXMueSkgPCBlICYmXHJcblx0XHRcdFx0TWF0aC5hYnModi56IC0gdGhpcy56KSA8IGUpO1xyXG5cdH07XHJcblxyXG5cdFRIUkVFLlZlY3RvcjMucHJvdG90eXBlLm1pbkNvb3JkID0gZnVuY3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gTWF0aC5taW4oTWF0aC5taW4odGhpcy54LCB0aGlzLnkpLCBNYXRoLm1pbih0aGlzLnksIHRoaXMueikpO1xyXG5cdH07XHJcblxyXG5cdFRIUkVFLlZlY3RvcjMucHJvdG90eXBlLm1heENvb3JkID0gZnVuY3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gTWF0aC5tYXgoTWF0aC5tYXgodGhpcy54LCB0aGlzLnkpLCBNYXRoLm1heCh0aGlzLnksIHRoaXMueikpO1xyXG5cdH07XHJcblx0XHJcblx0Ly8gaHR0cDovL3d3dy5nYW1lZGV2Lm5ldC9wYWdlL3Jlc291cmNlcy9fL3RlY2huaWNhbC9nYW1lLXByb2dyYW1taW5nL3N3ZXB0LWFhYmItY29sbGlzaW9uLWRldGVjdGlvbi1hbmQtcmVzcG9uc2UtcjMwODRcclxuXHRUSFJFRS5Cb3gzLnByb3RvdHlwZS5pc0ludGVyc2VjdGlvbkJveFN3ZXB0ID0gZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgYXV4MSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgYXV4MiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgYXV4Qm94ID0gbmV3IFRIUkVFLkJveDMoKTtcclxuXHJcblx0XHR2YXIgdmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIGludkVudHJ5ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBpbnZFeGl0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBlbnRyeSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgZXhpdCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgc2l6ZTEgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHNpemUyID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ob2xkUG9zLCBuZXdQb3MsIGJveCwgYm94UG9zLCBwb2ludCkge1xyXG5cdFx0XHR2ZWxvY2l0eS5jb3B5KG5ld1Bvcykuc3ViKG9sZFBvcyk7XHJcblx0XHRcdGF1eDEuY29weSh0aGlzLm1pbikuYWRkKHZlbG9jaXR5KTtcclxuXHRcdFx0YXV4Mi5jb3B5KHRoaXMubWF4KS5hZGQodmVsb2NpdHkpO1xyXG5cdFx0XHRhdXhCb3guc2V0RnJvbVBvaW50cyhbdGhpcy5taW4sIHRoaXMubWF4LCBhdXgxLCBhdXgyXSk7XHJcblxyXG5cdFx0XHRpZiAoIWF1eEJveC5pc0ludGVyc2VjdGlvbkJveChib3gpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAodGhpcy5pc0ludGVyc2VjdGlvbkJveChib3gpKSB7XHJcblx0XHRcdFx0cG9pbnQuY29weShvbGRQb3MpO1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRhdXhCb3gubWluLmNvcHkodGhpcy5taW4pLmFkZCh2ZWxvY2l0eSk7XHJcblx0XHRcdGF1eEJveC5tYXguY29weSh0aGlzLm1heCkuYWRkKHZlbG9jaXR5KTtcclxuXHJcblx0XHRcdGlmIChhdXhCb3guaXNJbnRlcnNlY3Rpb25Cb3goYm94KSkge1xyXG5cdFx0XHRcdHBvaW50LmNvcHkobmV3UG9zKTtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0c2l6ZTEuY29weSh0aGlzLm1heCkuc3ViKHRoaXMubWluKTtcclxuXHRcdFx0c2l6ZTIuY29weShib3gubWF4KS5zdWIoYm94Lm1pbik7XHJcblxyXG5cdFx0XHRpZiAodmVsb2NpdHkueCA+IDApIHtcclxuXHRcdFx0XHRpbnZFbnRyeS54ID0gYm94Lm1pbi54IC0gKHRoaXMubWluLnggKyBzaXplMS54KTtcclxuXHRcdFx0XHRpbnZFeGl0LnggPSAoYm94Lm1pbi54ICsgc2l6ZTIueCkgLSB0aGlzLm1pbi54O1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGludkVudHJ5LnggPSAoYm94Lm1pbi54ICsgc2l6ZTIueCkgLSB0aGlzLm1pbi54O1xyXG5cdFx0XHRcdGludkV4aXQueCA9IGJveC5taW4ueCAtICh0aGlzLm1pbi54ICsgc2l6ZTEueCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHZlbG9jaXR5LnkgPiAwKSB7XHJcblx0XHRcdFx0aW52RW50cnkueSA9IGJveC5taW4ueSAtICh0aGlzLm1pbi55ICsgc2l6ZTEueSk7XHJcblx0XHRcdFx0aW52RXhpdC55ID0gKGJveC5taW4ueSArIHNpemUyLnkpIC0gdGhpcy5taW4ueTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRpbnZFbnRyeS55ID0gKGJveC5taW4ueSArIHNpemUyLnkpIC0gdGhpcy5taW4ueTtcclxuXHRcdFx0XHRpbnZFeGl0LnkgPSBib3gubWluLnkgLSAodGhpcy5taW4ueSArIHNpemUxLnkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh2ZWxvY2l0eS56ID4gMCkge1xyXG5cdFx0XHRcdGludkVudHJ5LnogPSBib3gubWluLnogLSAodGhpcy5taW4ueiArIHNpemUxLnopO1xyXG5cdFx0XHRcdGludkV4aXQueiA9IChib3gubWluLnogKyBzaXplMi56KSAtIHRoaXMubWluLno7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aW52RW50cnkueiA9IChib3gubWluLnogKyBzaXplMi56KSAtIHRoaXMubWluLno7XHJcblx0XHRcdFx0aW52RXhpdC56ID0gYm94Lm1pbi56IC0gKHRoaXMubWluLnogKyBzaXplMS56KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHZlbG9jaXR5LnggPT09IDApIHtcclxuXHRcdFx0XHRlbnRyeS54ID0gLUluZmluaXR5O1xyXG5cdFx0XHRcdGV4aXQueCA9IEluZmluaXR5O1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGVudHJ5LnggPSBpbnZFbnRyeS54IC8gdmVsb2NpdHkueDtcclxuXHRcdFx0XHRleGl0LnggPSBpbnZFeGl0LnggLyB2ZWxvY2l0eS54O1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh2ZWxvY2l0eS55ID09PSAwKSB7XHJcblx0XHRcdFx0ZW50cnkueSA9IC1JbmZpbml0eTtcclxuXHRcdFx0XHRleGl0LnkgPSBJbmZpbml0eTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRlbnRyeS55ID0gaW52RW50cnkueSAvIHZlbG9jaXR5Lnk7XHJcblx0XHRcdFx0ZXhpdC55ID0gaW52RXhpdC55IC8gdmVsb2NpdHkueTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodmVsb2NpdHkueiA9PT0gMCkge1xyXG5cdFx0XHRcdGVudHJ5LnogPSAtSW5maW5pdHk7XHJcblx0XHRcdFx0ZXhpdC56ID0gSW5maW5pdHk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0ZW50cnkueiA9IGludkVudHJ5LnogLyB2ZWxvY2l0eS56O1xyXG5cdFx0XHRcdGV4aXQueiA9IGludkV4aXQueiAvIHZlbG9jaXR5Lno7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBlbnRyeVRpbWUgPSBlbnRyeS5tYXhDb29yZCgpO1xyXG5cdFx0XHR2YXIgZXhpdFRpbWUgPSBleGl0Lm1pbkNvb3JkKCk7XHJcblxyXG5cdFx0XHRpZiAoZW50cnlUaW1lID4gZXhpdFRpbWUgfHwgZW50cnkueCA8IDAgJiYgZW50cnkueSA8IDAgJiYgZW50cnkueiA8IDAgfHwgZW50cnkueCA+IDEgfHwgZW50cnkueSA+IDEgfHwgZW50cnkueiA+IDEpIHtcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoZW50cnlUaW1lKTtcclxuXHRcdFx0XHRwb2ludC5jb3B5KG9sZFBvcykuYWRkKHZlbG9jaXR5KTtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKTtcclxuXHJcblx0VEhSRUUuUmF5LnByb3RvdHlwZS5pbnRlcnNlY3RzT3JTdGFydHNJbkJveCA9IGZ1bmN0aW9uKGJveCwgb3B0aW9uYWxUYXJnZXQpIHtcclxuXHRcdHZhciByZXN1bHQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdGlmIChib3guY29udGFpbnNQb2ludCh0aGlzLm9yaWdpbikpIHtcclxuXHRcdFx0cmVzdWx0LmNvcHkodGhpcy5vcmlnaW4pO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5pbnRlcnNlY3RCb3goYm94LCByZXN1bHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fTtcclxuXHJcblx0Ly8gVmVjdG9yMlxyXG5cclxuXHRUSFJFRS5WZWN0b3IyLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKGQpIHtcclxuXHRcdGQgPSBkIHx8IDA7XHJcblx0XHRyZXR1cm4gW1wiW1wiLCB0aGlzLngudG9GaXhlZChkKSwgdGhpcy55LnRvRml4ZWQoZCksIFwiXVwiXS5qb2luKFwiIFwiKTtcclxuXHR9O1xyXG5cclxuXHRUSFJFRS5WZWN0b3IyLnByb3RvdHlwZS5lcXVhbHNFcHNpbG9uID0gZnVuY3Rpb24odiwgZSkge1xyXG5cdFx0ZSA9IGUgfHwgMC4wMDAxO1xyXG5cdFx0cmV0dXJuIChNYXRoLmFicyh2LnggLSB0aGlzLngpIDwgZSAmJlxyXG5cdFx0XHRcdE1hdGguYWJzKHYueSAtIHRoaXMueSkgPCBlKTtcclxuXHR9O1xyXG5cclxuXHRUSFJFRS5WZWN0b3IyLnByb3RvdHlwZS5taW5Db29yZCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIE1hdGgubWluKHRoaXMueCwgdGhpcy55KTtcclxuXHR9O1xyXG5cclxuXHRUSFJFRS5WZWN0b3IyLnByb3RvdHlwZS5tYXhDb29yZCA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIE1hdGgubWF4KHRoaXMueCwgdGhpcy55KTtcclxuXHR9O1xyXG5cclxuXHQvLyBodHRwOi8vd3d3LmdhbWVkZXYubmV0L3BhZ2UvcmVzb3VyY2VzL18vdGVjaG5pY2FsL2dhbWUtcHJvZ3JhbW1pbmcvc3dlcHQtYWFiYi1jb2xsaXNpb24tZGV0ZWN0aW9uLWFuZC1yZXNwb25zZS1yMzA4NFxyXG5cdFRIUkVFLkJveDIucHJvdG90eXBlLmlzSW50ZXJzZWN0aW9uQm94U3dlcHQgPSBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBhdXgxID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBhdXgyID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBhdXhCb3ggPSBuZXcgVEhSRUUuQm94MigpO1xyXG5cclxuXHRcdHZhciB2ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgaW52RW50cnkgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGludkV4aXQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGVudHJ5ID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBleGl0ID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBzaXplMSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgc2l6ZTIgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihvbGRQb3MsIG5ld1BvcywgYm94LCBib3hQb3MsIHBvaW50KSB7XHJcblx0XHRcdHZlbG9jaXR5LmNvcHkobmV3UG9zKS5zdWIob2xkUG9zKTtcclxuXHRcdFx0YXV4MS5jb3B5KHRoaXMubWluKS5hZGQodmVsb2NpdHkpO1xyXG5cdFx0XHRhdXgyLmNvcHkodGhpcy5tYXgpLmFkZCh2ZWxvY2l0eSk7XHJcblx0XHRcdGF1eEJveC5zZXRGcm9tUG9pbnRzKFt0aGlzLm1pbiwgdGhpcy5tYXgsIGF1eDEsIGF1eDJdKTtcclxuXHJcblx0XHRcdGlmICghYXV4Qm94LmlzSW50ZXJzZWN0aW9uQm94KGJveCkpIHtcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh0aGlzLmlzSW50ZXJzZWN0aW9uQm94KGJveCkpIHtcclxuXHRcdFx0XHRwb2ludC5jb3B5KG9sZFBvcyk7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGF1eEJveC5taW4uY29weSh0aGlzLm1pbikuYWRkKHZlbG9jaXR5KTtcclxuXHRcdFx0YXV4Qm94Lm1heC5jb3B5KHRoaXMubWF4KS5hZGQodmVsb2NpdHkpO1xyXG5cclxuXHRcdFx0aWYgKGF1eEJveC5pc0ludGVyc2VjdGlvbkJveChib3gpKSB7XHJcblx0XHRcdFx0cG9pbnQuY29weShuZXdQb3MpO1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzaXplMS5jb3B5KHRoaXMubWF4KS5zdWIodGhpcy5taW4pO1xyXG5cdFx0XHRzaXplMi5jb3B5KGJveC5tYXgpLnN1Yihib3gubWluKTtcclxuXHJcblx0XHRcdGlmICh2ZWxvY2l0eS54ID4gMCkge1xyXG5cdFx0XHRcdGludkVudHJ5LnggPSBib3gubWluLnggLSAodGhpcy5taW4ueCArIHNpemUxLngpO1xyXG5cdFx0XHRcdGludkV4aXQueCA9IChib3gubWluLnggKyBzaXplMi54KSAtIHRoaXMubWluLng7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0aW52RW50cnkueCA9IChib3gubWluLnggKyBzaXplMi54KSAtIHRoaXMubWluLng7XHJcblx0XHRcdFx0aW52RXhpdC54ID0gYm94Lm1pbi54IC0gKHRoaXMubWluLnggKyBzaXplMS54KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodmVsb2NpdHkueSA+IDApIHtcclxuXHRcdFx0XHRpbnZFbnRyeS55ID0gYm94Lm1pbi55IC0gKHRoaXMubWluLnkgKyBzaXplMS55KTtcclxuXHRcdFx0XHRpbnZFeGl0LnkgPSAoYm94Lm1pbi55ICsgc2l6ZTIueSkgLSB0aGlzLm1pbi55O1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGludkVudHJ5LnkgPSAoYm94Lm1pbi55ICsgc2l6ZTIueSkgLSB0aGlzLm1pbi55O1xyXG5cdFx0XHRcdGludkV4aXQueSA9IGJveC5taW4ueSAtICh0aGlzLm1pbi55ICsgc2l6ZTEueSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh2ZWxvY2l0eS54ID09PSAwKSB7XHJcblx0XHRcdFx0ZW50cnkueCA9IC1JbmZpbml0eTtcclxuXHRcdFx0XHRleGl0LnggPSBJbmZpbml0eTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRlbnRyeS54ID0gaW52RW50cnkueCAvIHZlbG9jaXR5Lng7XHJcblx0XHRcdFx0ZXhpdC54ID0gaW52RXhpdC54IC8gdmVsb2NpdHkueDtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodmVsb2NpdHkueSA9PT0gMCkge1xyXG5cdFx0XHRcdGVudHJ5LnkgPSAtSW5maW5pdHk7XHJcblx0XHRcdFx0ZXhpdC55ID0gSW5maW5pdHk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0ZW50cnkueSA9IGludkVudHJ5LnkgLyB2ZWxvY2l0eS55O1xyXG5cdFx0XHRcdGV4aXQueSA9IGludkV4aXQueSAvIHZlbG9jaXR5Lnk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBlbnRyeVRpbWUgPSBlbnRyeS5tYXhDb29yZCgpO1xyXG5cdFx0XHR2YXIgZXhpdFRpbWUgPSBleGl0Lm1pbkNvb3JkKCk7XHJcblxyXG5cdFx0XHRpZiAoZW50cnlUaW1lID4gZXhpdFRpbWUgfHwgZW50cnkueCA8IDAgJiYgZW50cnkueSA8IDAgfHwgZW50cnkueCA+IDEgfHwgZW50cnkueSA+IDEpIHtcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dmVsb2NpdHkubXVsdGlwbHlTY2FsYXIoZW50cnlUaW1lKTtcclxuXHRcdFx0XHRwb2ludC5jb3B5KG9sZFBvcykuYWRkKHZlbG9jaXR5KTtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKTtcclxuXHJcblx0Ly8gaHR0cDovL2dhbWVkZXYuc3RhY2tleGNoYW5nZS5jb20vcXVlc3Rpb25zLzI5NDc5L3N3ZXB0LWFhYmItdnMtbGluZS1zZWdtZW50LTJkXHJcblx0VEhSRUUuQm94Mi5wcm90b3R5cGUuaXNJbnRlcnNlY3Rpb25MaW5lU3dlcHQgPSBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB2ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgYm94RXh0ZW50ID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBib3hDZW50ZXIgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGxpbmVOb3JtYWwgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGxpbmVEaXIgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGxpbmVNaW4gPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGxpbmVNYXggPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGF1eCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKG9sZFBvcywgbmV3UG9zLCBsaW5lKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSB7XHJcblx0XHRcdFx0Zm91bmRDb2xsaXNpb246IGZhbHNlLFxyXG5cdFx0XHRcdHBvczogbmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdFx0XHRkaXN0YW5jZTogMCxcclxuXHRcdFx0XHRub3JtYWw6IG5ldyBUSFJFRS5WZWN0b3IyKCksXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHR2ZWxvY2l0eS5jb3B5KG5ld1Bvcykuc3ViKG9sZFBvcyk7XHJcblxyXG5cdFx0XHRib3hFeHRlbnQuY29weSh0aGlzLm1heCkuc3ViKHRoaXMubWluKS5tdWx0aXBseVNjYWxhcigwLjUpO1xyXG5cdFx0XHRib3hDZW50ZXIuY29weSh0aGlzLm1heCkuYWRkKHRoaXMubWluKS5tdWx0aXBseVNjYWxhcigwLjUpO1xyXG5cdFx0XHRHUy5NYXRoSGVscGVyLnZlYzJOb3JtYWwobGluZS5zdGFydCwgbGluZS5lbmQsIGxpbmVOb3JtYWwpO1xyXG5cclxuXHRcdFx0aWYgKGxpbmVOb3JtYWwuZG90KHZlbG9jaXR5KSA+PSAwKSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bGluZURpci5jb3B5KGxpbmUuZW5kKS5zdWIobGluZS5zdGFydCk7XHJcblxyXG5cdFx0XHRpZiAobGluZURpci54ID4gMCkge1xyXG5cdFx0XHRcdGxpbmVNaW4ueCA9IGxpbmUuc3RhcnQueDtcclxuXHRcdFx0XHRsaW5lTWF4LnggPSBsaW5lLmVuZC54O1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGxpbmVNaW4ueCA9IGxpbmUuZW5kLng7XHJcblx0XHRcdFx0bGluZU1heC54ID0gbGluZS5zdGFydC54O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAobGluZURpci55ID4gMCkge1xyXG5cdFx0XHRcdGxpbmVNaW4ueSA9IGxpbmUuc3RhcnQueTtcclxuXHRcdFx0XHRsaW5lTWF4LnkgPSBsaW5lLmVuZC55O1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGxpbmVNaW4ueSA9IGxpbmUuZW5kLnk7XHJcblx0XHRcdFx0bGluZU1heC55ID0gbGluZS5zdGFydC55O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgaGl0VGltZSA9IDA7XHJcblx0XHRcdHZhciBvdXRUaW1lID0gMTtcclxuXHJcblx0XHRcdHZhciByID0gYm94RXh0ZW50LnggKiBNYXRoLmFicyhsaW5lTm9ybWFsLngpICsgYm94RXh0ZW50LnkgKiBNYXRoLmFicyhsaW5lTm9ybWFsLnkpO1xyXG5cdFx0XHRhdXguY29weShsaW5lLnN0YXJ0KS5zdWIoYm94Q2VudGVyKTtcclxuXHRcdFx0dmFyIGJveFByb2ogPSBhdXguZG90KGxpbmVOb3JtYWwpO1xyXG5cdFx0XHR2YXIgdmVsUHJvaiA9IHZlbG9jaXR5LmRvdChsaW5lTm9ybWFsKTtcclxuXHJcblx0XHRcdGlmICh2ZWxQcm9qIDwgMCkge1xyXG5cdFx0XHRcdHIgKj0gLTE7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGhpdFRpbWUgPSBNYXRoLm1heCgoYm94UHJvaiAtIHIpIC8gdmVsUHJvaiwgaGl0VGltZSk7XHJcblx0XHRcdG91dFRpbWUgPSBNYXRoLm1pbigoYm94UHJvaiArIHIpIC8gdmVsUHJvaiwgb3V0VGltZSk7XHJcblxyXG5cdFx0XHRpZiAodmVsb2NpdHkueCA8IDApIHtcclxuXHRcdFx0XHRpZiAodGhpcy5tYXgueCA8IGxpbmVNaW4ueCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGhpdFRpbWUgPSBNYXRoLm1heCgobGluZU1heC54IC0gdGhpcy5taW4ueCkgLyB2ZWxvY2l0eS54LCBoaXRUaW1lKTtcclxuXHRcdFx0XHRvdXRUaW1lID0gTWF0aC5taW4oKGxpbmVNaW4ueCAtIHRoaXMubWF4LngpIC8gdmVsb2NpdHkueCwgb3V0VGltZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRpZiAodmVsb2NpdHkueCA+IDApIHtcclxuXHRcdFx0XHRpZiAodGhpcy5taW4ueCA+IGxpbmVNYXgueCkgeyBcclxuXHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGhpdFRpbWUgPSBNYXRoLm1heCgobGluZU1pbi54IC0gdGhpcy5tYXgueCkgLyB2ZWxvY2l0eS54LCBoaXRUaW1lKTtcclxuXHRcdFx0XHRvdXRUaW1lID0gTWF0aC5taW4oKGxpbmVNYXgueCAtIHRoaXMubWluLngpIC8gdmVsb2NpdHkueCwgb3V0VGltZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRpZiAobGluZU1pbi54ID4gdGhpcy5tYXgueCB8fCBsaW5lTWF4LnggPCB0aGlzLm1pbi54KSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKGhpdFRpbWUgPiBvdXRUaW1lKSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHZlbG9jaXR5LnkgPCAwKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMubWF4LnkgPCBsaW5lTWluLnkpIHsgXHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aGl0VGltZSA9IE1hdGgubWF4KChsaW5lTWF4LnkgLSB0aGlzLm1pbi55KSAvIHZlbG9jaXR5LnksIGhpdFRpbWUpO1xyXG5cdFx0XHRcdG91dFRpbWUgPSBNYXRoLm1pbigobGluZU1pbi55IC0gdGhpcy5tYXgueSkgLyB2ZWxvY2l0eS55LCBvdXRUaW1lKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIFxyXG5cdFx0XHRpZiAodmVsb2NpdHkueSA+IDApIHtcclxuXHRcdFx0XHRpZiAodGhpcy5taW4ueSA+IGxpbmVNYXgueSkgeyBcclxuXHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRoaXRUaW1lID0gTWF0aC5tYXgoKGxpbmVNaW4ueSAtIHRoaXMubWF4LnkpIC8gdmVsb2NpdHkueSwgaGl0VGltZSk7XHJcblx0XHRcdFx0b3V0VGltZSA9IE1hdGgubWluKChsaW5lTWF4LnkgLSB0aGlzLm1pbi55KSAvIHZlbG9jaXR5LnksIG91dFRpbWUpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2VcclxuXHRcdFx0aWYgKGxpbmVNaW4ueSA+IHRoaXMubWF4LnkgfHwgbGluZU1heC55IDwgdGhpcy5taW4ueSkgeyBcclxuXHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoaGl0VGltZSA+IG91dFRpbWUpIHsgXHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmVzdWx0LmZvdW5kQ29sbGlzaW9uID0gdHJ1ZTtcclxuXHRcdFx0cmVzdWx0LnBvcy5jb3B5KG9sZFBvcykuYWRkKHZlbG9jaXR5Lm11bHRpcGx5U2NhbGFyKGhpdFRpbWUpKTtcclxuXHRcdFx0cmVzdWx0LmRpc3RhbmNlID0gdmVsb2NpdHkubGVuZ3RoKCkgKiBoaXRUaW1lO1xyXG5cdFx0XHRyZXN1bHQubm9ybWFsLmNvcHkobGluZU5vcm1hbCk7XHJcblxyXG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0fVxyXG5cdH0oKTtcclxuXHJcblx0Ly8gR2VvbWV0cnlcclxuXHJcblx0VEhSRUUuR2VvbWV0cnkucHJvdG90eXBlLm1lcmdlID0gZnVuY3Rpb24gKCBnZW9tZXRyeSwgbWF0cml4LCBtYXRlcmlhbEluZGV4T2Zmc2V0ICkge1xyXG5cclxuXHRcdGlmICggZ2VvbWV0cnkgaW5zdGFuY2VvZiBUSFJFRS5HZW9tZXRyeSA9PT0gZmFsc2UgKSB7XHJcblxyXG5cdFx0XHRjb25zb2xlLmVycm9yKCAnVEhSRUUuR2VvbWV0cnkubWVyZ2UoKTogZ2VvbWV0cnkgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLkdlb21ldHJ5LicsIGdlb21ldHJ5ICk7XHJcblx0XHRcdHJldHVybjtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIG5vcm1hbE1hdHJpeCxcclxuXHRcdHZlcnRleE9mZnNldCA9IHRoaXMudmVydGljZXMubGVuZ3RoLFxyXG5cdFx0dmVydGljZXMxID0gdGhpcy52ZXJ0aWNlcyxcclxuXHRcdHZlcnRpY2VzMiA9IGdlb21ldHJ5LnZlcnRpY2VzLFxyXG5cdFx0ZmFjZXMxID0gdGhpcy5mYWNlcyxcclxuXHRcdGZhY2VzMiA9IGdlb21ldHJ5LmZhY2VzLFxyXG5cdFx0dXZzMSA9IHRoaXMuZmFjZVZlcnRleFV2c1sgMCBdLFxyXG5cdFx0dXZzMiA9IGdlb21ldHJ5LmZhY2VWZXJ0ZXhVdnNbIDAgXTtcclxuXHJcblx0XHRpZiAoIG1hdGVyaWFsSW5kZXhPZmZzZXQgPT09IHVuZGVmaW5lZCApIG1hdGVyaWFsSW5kZXhPZmZzZXQgPSAwO1xyXG5cclxuXHRcdGlmICggbWF0cml4ICE9PSB1bmRlZmluZWQgKSB7XHJcblxyXG5cdFx0XHRub3JtYWxNYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIHZlcnRpY2VzXHJcblxyXG5cdFx0Zm9yICggdmFyIGkgPSAwLCBpbCA9IHZlcnRpY2VzMi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHtcclxuXHJcblx0XHRcdHZhciB2ZXJ0ZXggPSB2ZXJ0aWNlczJbIGkgXTtcclxuXHJcblx0XHRcdHZhciB2ZXJ0ZXhDb3B5ID0gdmVydGV4LmNsb25lKCk7XHJcblxyXG5cdFx0XHRpZiAoIG1hdHJpeCAhPT0gdW5kZWZpbmVkICkgdmVydGV4Q29weS5hcHBseU1hdHJpeDQoIG1hdHJpeCApO1xyXG5cclxuXHRcdFx0dmVydGljZXMxLnB1c2goIHZlcnRleENvcHkgKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gZmFjZXNcclxuXHJcblx0XHRmb3IgKCBpID0gMCwgaWwgPSBmYWNlczIubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7XHJcblxyXG5cdFx0XHR2YXIgZmFjZSA9IGZhY2VzMlsgaSBdLCBmYWNlQ29weSwgbm9ybWFsLCBjb2xvcixcclxuXHRcdFx0ZmFjZVZlcnRleE5vcm1hbHMgPSBmYWNlLnZlcnRleE5vcm1hbHMsXHJcblx0XHRcdGZhY2VWZXJ0ZXhDb2xvcnMgPSBmYWNlLnZlcnRleENvbG9ycztcclxuXHJcblx0XHRcdGZhY2VDb3B5ID0gbmV3IFRIUkVFLkZhY2UzKCBmYWNlLmEgKyB2ZXJ0ZXhPZmZzZXQsIGZhY2UuYiArIHZlcnRleE9mZnNldCwgZmFjZS5jICsgdmVydGV4T2Zmc2V0ICk7XHJcblx0XHRcdGZhY2VDb3B5Lm5vcm1hbC5jb3B5KCBmYWNlLm5vcm1hbCApO1xyXG5cclxuXHRcdFx0aWYgKCBub3JtYWxNYXRyaXggIT09IHVuZGVmaW5lZCApIHtcclxuXHJcblx0XHRcdFx0ZmFjZUNvcHkubm9ybWFsLmFwcGx5TWF0cml4Myggbm9ybWFsTWF0cml4ICkubm9ybWFsaXplKCk7XHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmb3IgKCB2YXIgaiA9IDAsIGpsID0gZmFjZVZlcnRleE5vcm1hbHMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7XHJcblxyXG5cdFx0XHRcdG5vcm1hbCA9IGZhY2VWZXJ0ZXhOb3JtYWxzWyBqIF0uY2xvbmUoKTtcclxuXHJcblx0XHRcdFx0aWYgKCBub3JtYWxNYXRyaXggIT09IHVuZGVmaW5lZCApIHtcclxuXHJcblx0XHRcdFx0XHRub3JtYWwuYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKTtcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRmYWNlQ29weS52ZXJ0ZXhOb3JtYWxzLnB1c2goIG5vcm1hbCApO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0ZmFjZUNvcHkuY29sb3IuY29weSggZmFjZS5jb2xvciApO1xyXG5cdFx0XHRmYWNlQ29weS5lbWlzc2l2ZSA9IGZhY2UuZW1pc3NpdmUuY2xvbmUoKTtcclxuXHJcblx0XHRcdGZvciAoIHZhciBqID0gMCwgamwgPSBmYWNlVmVydGV4Q29sb3JzLmxlbmd0aDsgaiA8IGpsOyBqICsrICkge1xyXG5cclxuXHRcdFx0XHRjb2xvciA9IGZhY2VWZXJ0ZXhDb2xvcnNbIGogXTtcclxuXHRcdFx0XHRmYWNlQ29weS52ZXJ0ZXhDb2xvcnMucHVzaCggY29sb3IuY2xvbmUoKSApO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0ZmFjZUNvcHkubWF0ZXJpYWxJbmRleCA9IGZhY2UubWF0ZXJpYWxJbmRleCArIG1hdGVyaWFsSW5kZXhPZmZzZXQ7XHJcblxyXG5cdFx0XHRmYWNlczEucHVzaCggZmFjZUNvcHkgKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gdXZzXHJcblxyXG5cdFx0Zm9yICggaSA9IDAsIGlsID0gdXZzMi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHtcclxuXHJcblx0XHRcdHZhciB1diA9IHV2czJbIGkgXSwgdXZDb3B5ID0gW107XHJcblxyXG5cdFx0XHRpZiAoIHV2ID09PSB1bmRlZmluZWQgKSB7XHJcblxyXG5cdFx0XHRcdGNvbnRpbnVlO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Zm9yICggdmFyIGogPSAwLCBqbCA9IHV2Lmxlbmd0aDsgaiA8IGpsOyBqICsrICkge1xyXG5cclxuXHRcdFx0XHR1dkNvcHkucHVzaCggbmV3IFRIUkVFLlZlY3RvcjIoIHV2WyBqIF0ueCwgdXZbIGogXS55ICkgKTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHV2czEucHVzaCggdXZDb3B5ICk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9O1xyXG5cclxuXHQvLyBCdWZmZXJHZW9tZXRyeVxyXG5cdC8vIGpzaGludCBpZ25vcmU6c3RhcnRcclxuXHJcblx0VEhSRUUuQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmZyb21HZW9tZXRyeSA9IGZ1bmN0aW9uICggZ2VvbWV0cnksIHNldHRpbmdzICkge1x0XHRcclxuXHJcblx0XHRzZXR0aW5ncyA9IHNldHRpbmdzIHx8IHsgJ3ZlcnRleENvbG9ycyc6IFRIUkVFLk5vQ29sb3JzIH07XHJcblxyXG5cdFx0dmFyIHZlcnRpY2VzID0gZ2VvbWV0cnkudmVydGljZXM7XHJcblx0XHR2YXIgZmFjZXMgPSBnZW9tZXRyeS5mYWNlcztcclxuXHRcdHZhciBmYWNlVmVydGV4VXZzID0gZ2VvbWV0cnkuZmFjZVZlcnRleFV2cztcclxuXHRcdHZhciB2ZXJ0ZXhDb2xvcnMgPSBzZXR0aW5ncy52ZXJ0ZXhDb2xvcnM7XHJcblx0XHR2YXIgaGFzRmFjZVZlcnRleFV2ID0gZmFjZVZlcnRleFV2c1sgMCBdLmxlbmd0aCA+IDA7XHJcblx0XHR2YXIgaGFzRmFjZVZlcnRleE5vcm1hbHMgPSBmYWNlc1sgMCBdLnZlcnRleE5vcm1hbHMubGVuZ3RoID09IDM7XHJcblxyXG5cdFx0dmFyIHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoIGZhY2VzLmxlbmd0aCAqIDMgKiAzICk7XHJcblx0XHR0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25zLCAzICkgKTtcclxuXHJcblx0XHR2YXIgbm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoIGZhY2VzLmxlbmd0aCAqIDMgKiAzICk7XHJcblx0XHR0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApO1xyXG5cclxuXHRcdGlmICggdmVydGV4Q29sb3JzICE9PSBUSFJFRS5Ob0NvbG9ycyApIHtcclxuXHJcblx0XHRcdHZhciBjb2xvcnMgPSBuZXcgRmxvYXQzMkFycmF5KCBmYWNlcy5sZW5ndGggKiAzICogMyApO1xyXG5cdFx0XHR0aGlzLmFkZEF0dHJpYnV0ZSggJ2NvbG9yJywgbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTtcclxuXHJcblx0XHRcdHZhciBlbWlzc2l2ZXMgPSBuZXcgRmxvYXQzMkFycmF5KCBmYWNlcy5sZW5ndGggKiAzICogMyApO1xyXG5cdFx0XHR0aGlzLmFkZEF0dHJpYnV0ZSggJ2VtaXNzaXZlJywgbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSggZW1pc3NpdmVzLCAzICkgKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCBoYXNGYWNlVmVydGV4VXYgPT09IHRydWUgKSB7XHJcblxyXG5cdFx0XHR2YXIgdXZzID0gbmV3IEZsb2F0MzJBcnJheSggZmFjZXMubGVuZ3RoICogMyAqIDIgKTtcclxuXHRcdFx0dGhpcy5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAoIHZhciBpID0gMCwgaTIgPSAwLCBpMyA9IDA7IGkgPCBmYWNlcy5sZW5ndGg7IGkgKyssIGkyICs9IDYsIGkzICs9IDkgKSB7XHJcblxyXG5cdFx0XHR2YXIgZmFjZSA9IGZhY2VzWyBpIF07XHJcblxyXG5cdFx0XHR2YXIgYSA9IHZlcnRpY2VzWyBmYWNlLmEgXTtcclxuXHRcdFx0dmFyIGIgPSB2ZXJ0aWNlc1sgZmFjZS5iIF07XHJcblx0XHRcdHZhciBjID0gdmVydGljZXNbIGZhY2UuYyBdO1xyXG5cclxuXHRcdFx0cG9zaXRpb25zWyBpMyAgICAgXSA9IGEueDtcclxuXHRcdFx0cG9zaXRpb25zWyBpMyArIDEgXSA9IGEueTtcclxuXHRcdFx0cG9zaXRpb25zWyBpMyArIDIgXSA9IGEuejtcclxuXHJcblx0XHRcdHBvc2l0aW9uc1sgaTMgKyAzIF0gPSBiLng7XHJcblx0XHRcdHBvc2l0aW9uc1sgaTMgKyA0IF0gPSBiLnk7XHJcblx0XHRcdHBvc2l0aW9uc1sgaTMgKyA1IF0gPSBiLno7XHJcblxyXG5cdFx0XHRwb3NpdGlvbnNbIGkzICsgNiBdID0gYy54O1xyXG5cdFx0XHRwb3NpdGlvbnNbIGkzICsgNyBdID0gYy55O1xyXG5cdFx0XHRwb3NpdGlvbnNbIGkzICsgOCBdID0gYy56O1xyXG5cclxuXHRcdFx0aWYgKCBoYXNGYWNlVmVydGV4Tm9ybWFscyA9PT0gdHJ1ZSApIHtcclxuXHJcblx0XHRcdFx0dmFyIG5hID0gZmFjZS52ZXJ0ZXhOb3JtYWxzWyAwIF07XHJcblx0XHRcdFx0dmFyIG5iID0gZmFjZS52ZXJ0ZXhOb3JtYWxzWyAxIF07XHJcblx0XHRcdFx0dmFyIG5jID0gZmFjZS52ZXJ0ZXhOb3JtYWxzWyAyIF07XHJcblxyXG5cdFx0XHRcdG5vcm1hbHNbIGkzICAgICBdID0gbmEueDtcclxuXHRcdFx0XHRub3JtYWxzWyBpMyArIDEgXSA9IG5hLnk7XHJcblx0XHRcdFx0bm9ybWFsc1sgaTMgKyAyIF0gPSBuYS56O1xyXG5cclxuXHRcdFx0XHRub3JtYWxzWyBpMyArIDMgXSA9IG5iLng7XHJcblx0XHRcdFx0bm9ybWFsc1sgaTMgKyA0IF0gPSBuYi55O1xyXG5cdFx0XHRcdG5vcm1hbHNbIGkzICsgNSBdID0gbmIuejtcclxuXHJcblx0XHRcdFx0bm9ybWFsc1sgaTMgKyA2IF0gPSBuYy54O1xyXG5cdFx0XHRcdG5vcm1hbHNbIGkzICsgNyBdID0gbmMueTtcclxuXHRcdFx0XHRub3JtYWxzWyBpMyArIDggXSA9IG5jLno7XHJcblxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cclxuXHRcdFx0XHR2YXIgbiA9IGZhY2Uubm9ybWFsO1xyXG5cclxuXHRcdFx0XHRub3JtYWxzWyBpMyAgICAgXSA9IG4ueDtcclxuXHRcdFx0XHRub3JtYWxzWyBpMyArIDEgXSA9IG4ueTtcclxuXHRcdFx0XHRub3JtYWxzWyBpMyArIDIgXSA9IG4uejtcclxuXHJcblx0XHRcdFx0bm9ybWFsc1sgaTMgKyAzIF0gPSBuLng7XHJcblx0XHRcdFx0bm9ybWFsc1sgaTMgKyA0IF0gPSBuLnk7XHJcblx0XHRcdFx0bm9ybWFsc1sgaTMgKyA1IF0gPSBuLno7XHJcblxyXG5cdFx0XHRcdG5vcm1hbHNbIGkzICsgNiBdID0gbi54O1xyXG5cdFx0XHRcdG5vcm1hbHNbIGkzICsgNyBdID0gbi55O1xyXG5cdFx0XHRcdG5vcm1hbHNbIGkzICsgOCBdID0gbi56O1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCB2ZXJ0ZXhDb2xvcnMgPT09IFRIUkVFLkZhY2VDb2xvcnMgKSB7XHJcblxyXG5cdFx0XHRcdHZhciBmYyA9IGZhY2UuY29sb3I7XHJcblxyXG5cdFx0XHRcdGNvbG9yc1sgaTMgICAgIF0gPSBmYy5yO1xyXG5cdFx0XHRcdGNvbG9yc1sgaTMgKyAxIF0gPSBmYy5nO1xyXG5cdFx0XHRcdGNvbG9yc1sgaTMgKyAyIF0gPSBmYy5iO1xyXG5cclxuXHRcdFx0XHRjb2xvcnNbIGkzICsgMyBdID0gZmMucjtcclxuXHRcdFx0XHRjb2xvcnNbIGkzICsgNCBdID0gZmMuZztcclxuXHRcdFx0XHRjb2xvcnNbIGkzICsgNSBdID0gZmMuYjtcclxuXHJcblx0XHRcdFx0Y29sb3JzWyBpMyArIDYgXSA9IGZjLnI7XHJcblx0XHRcdFx0Y29sb3JzWyBpMyArIDcgXSA9IGZjLmc7XHJcblx0XHRcdFx0Y29sb3JzWyBpMyArIDggXSA9IGZjLmI7XHJcblxyXG5cdFx0XHRcdHZhciBlbSA9IGZhY2UuZW1pc3NpdmU7XHJcblxyXG5cdFx0XHRcdGVtaXNzaXZlc1sgaTMgICAgIF0gPSBlbS5yO1xyXG5cdFx0XHRcdGVtaXNzaXZlc1sgaTMgKyAxIF0gPSBlbS5nO1xyXG5cdFx0XHRcdGVtaXNzaXZlc1sgaTMgKyAyIF0gPSBlbS5iO1xyXG5cclxuXHRcdFx0XHRlbWlzc2l2ZXNbIGkzICsgMyBdID0gZW0ucjtcclxuXHRcdFx0XHRlbWlzc2l2ZXNbIGkzICsgNCBdID0gZW0uZztcclxuXHRcdFx0XHRlbWlzc2l2ZXNbIGkzICsgNSBdID0gZW0uYjtcclxuXHJcblx0XHRcdFx0ZW1pc3NpdmVzWyBpMyArIDYgXSA9IGVtLnI7XHJcblx0XHRcdFx0ZW1pc3NpdmVzWyBpMyArIDcgXSA9IGVtLmc7XHJcblx0XHRcdFx0ZW1pc3NpdmVzWyBpMyArIDggXSA9IGVtLmI7XHJcblxyXG5cdFx0XHR9IGVsc2UgaWYgKCB2ZXJ0ZXhDb2xvcnMgPT09IFRIUkVFLlZlcnRleENvbG9ycyApIHtcclxuXHJcblx0XHRcdFx0dmFyIHZjYSA9IGZhY2UudmVydGV4Q29sb3JzWyAwIF07XHJcblx0XHRcdFx0dmFyIHZjYiA9IGZhY2UudmVydGV4Q29sb3JzWyAxIF07XHJcblx0XHRcdFx0dmFyIHZjYyA9IGZhY2UudmVydGV4Q29sb3JzWyAyIF07XHJcblxyXG5cdFx0XHRcdGNvbG9yc1sgaTMgICAgIF0gPSB2Y2EucjtcclxuXHRcdFx0XHRjb2xvcnNbIGkzICsgMSBdID0gdmNhLmc7XHJcblx0XHRcdFx0Y29sb3JzWyBpMyArIDIgXSA9IHZjYS5iO1xyXG5cclxuXHRcdFx0XHRjb2xvcnNbIGkzICsgMyBdID0gdmNiLnI7XHJcblx0XHRcdFx0Y29sb3JzWyBpMyArIDQgXSA9IHZjYi5nO1xyXG5cdFx0XHRcdGNvbG9yc1sgaTMgKyA1IF0gPSB2Y2IuYjtcclxuXHJcblx0XHRcdFx0Y29sb3JzWyBpMyArIDYgXSA9IHZjYy5yO1xyXG5cdFx0XHRcdGNvbG9yc1sgaTMgKyA3IF0gPSB2Y2MuZztcclxuXHRcdFx0XHRjb2xvcnNbIGkzICsgOCBdID0gdmNjLmI7XHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIGhhc0ZhY2VWZXJ0ZXhVdiA9PT0gdHJ1ZSApIHtcclxuXHJcblx0XHRcdFx0dmFyIHV2YSA9IGZhY2VWZXJ0ZXhVdnNbIDAgXVsgaSBdWyAwIF07XHJcblx0XHRcdFx0dmFyIHV2YiA9IGZhY2VWZXJ0ZXhVdnNbIDAgXVsgaSBdWyAxIF07XHJcblx0XHRcdFx0dmFyIHV2YyA9IGZhY2VWZXJ0ZXhVdnNbIDAgXVsgaSBdWyAyIF07XHJcblxyXG5cdFx0XHRcdHV2c1sgaTIgICAgIF0gPSB1dmEueDtcclxuXHRcdFx0XHR1dnNbIGkyICsgMSBdID0gdXZhLnk7XHJcblxyXG5cdFx0XHRcdHV2c1sgaTIgKyAyIF0gPSB1dmIueDtcclxuXHRcdFx0XHR1dnNbIGkyICsgMyBdID0gdXZiLnk7XHJcblxyXG5cdFx0XHRcdHV2c1sgaTIgKyA0IF0gPSB1dmMueDtcclxuXHRcdFx0XHR1dnNbIGkyICsgNSBdID0gdXZjLnk7XHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKClcclxuXHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHJcblx0fTtcclxuXHJcblx0Ly8ganNoaW50IGlnbm9yZTplbmRcclxuXHJcbn0oKSk7XHJcbiIsIkdTLklucHV0SGVscGVyID0ge1xyXG5cdGtleVN0YXRlOiBbXSxcclxuXHRsZWZ0TW91c2VEb3duOiBmYWxzZSxcclxuXHRtaWRkbGVNb3VzZURvd246IGZhbHNlLFxyXG5cdHJpZ2h0TW91c2VEb3duOiBmYWxzZSxcclxuXHRtb3VzZVg6IDAsXHJcblx0bW91c2VZOiAwLFxyXG5cdHNjcmVlblJhdGlvWDogMSxcclxuXHRzY3JlZW5SYXRpb1k6IDEsXHJcblx0bW91c2VXaGVlbEV2ZW50czogW10sXHJcblx0Y3RybDogZmFsc2UsXHJcblx0c2hpZnQ6IGZhbHNlLFxyXG5cdGFsdDogZmFsc2UsXHJcblx0cHJlc3NlZEtleXM6IFtdLFxyXG5cdGtleXNQcmVzc2VkOiBmYWxzZSxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0JChkb2N1bWVudCkub24oXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbigpe1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9KTtcclxuXHJcblx0XHQkKGRvY3VtZW50KS5rZXlkb3duKGZ1bmN0aW9uKGUpe1xyXG5cdFx0XHR0aGF0LmtleVN0YXRlW2Uua2V5Q29kZV0gPSB0cnVlO1xyXG5cdFx0XHR0aGF0LmN0cmwgPSBlLmN0cmxLZXk7XHJcblx0XHRcdHRoYXQuYWx0ID0gZS5hbHRLZXk7XHJcblx0XHRcdHRoYXQuc2hpZnQgPSBlLnNoaWZ0S2V5O1xyXG5cclxuXHRcdFx0Ly8gYXZvaWQgbm9ybWFsIGJlaGF2aW9yOiB0YWIsIGN0cmwrYSwgY3RybCt6LCBjdHJsK2csIGN0cmwtbWludXMsIGN0cmwtcGx1cywgY3RybC16ZXJvXHJcblx0XHRcdGlmIChlLmtleUNvZGUgPT0gOSB8fCAoZS5rZXlDb2RlID09IDY1ICYmIGUuY3RybEtleSkgfHxcclxuXHRcdFx0XHQoZS5rZXlDb2RlID09IDkwICYmIGUuY3RybEtleSkgfHwgKGUua2V5Q29kZSA9PSA3MSAmJiBlLmN0cmxLZXkpIHx8XHJcblx0XHRcdFx0KGUua2V5Q29kZSA9PSAxODkgJiYgZS5jdHJsS2V5KSB8fCAoZS5rZXlDb2RlID09IDE4NyAmJiBlLmN0cmxLZXkpIHx8XHJcblx0XHRcdFx0KGUua2V5Q29kZSA9PSA0OCAmJiBlLmN0cmxLZXkpKSB7XHJcblxyXG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHQkKGRvY3VtZW50KS5rZXl1cChmdW5jdGlvbihlKXtcclxuXHRcdFx0dGhhdC5rZXlTdGF0ZVtlLmtleUNvZGVdID0gZmFsc2U7XHJcblx0XHRcdHRoYXQuY3RybCA9IGUuY3RybEtleTtcclxuXHRcdFx0dGhhdC5hbHQgPSBlLmFsdEtleTtcclxuXHRcdFx0dGhhdC5zaGlmdCA9IGUuc2hpZnRLZXk7XHJcblxyXG5cdFx0fSk7XHJcblx0XHQkKGRvY3VtZW50KS5tb3VzZWRvd24oZnVuY3Rpb24oZSl7XHJcblx0XHRcdGlmIChlLndoaWNoID09IDEpXHJcblx0XHRcdFx0dGhhdC5sZWZ0TW91c2VEb3duID0gdHJ1ZTtcclxuXHRcdFx0aWYgKGUud2hpY2ggPT0gMilcclxuXHRcdFx0XHR0aGF0Lm1pZGRsZU1vdXNlRG93biA9IHRydWU7XHJcblx0XHRcdGlmIChlLndoaWNoID09IDMpXHJcblx0XHRcdFx0dGhhdC5yaWdodE1vdXNlRG93biA9IHRydWU7XHJcblx0XHR9KTtcclxuXHRcdCQoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24oZSl7XHJcblx0XHRcdGlmIChlLndoaWNoID09IDEpXHJcblx0XHRcdFx0dGhhdC5sZWZ0TW91c2VEb3duID0gZmFsc2U7XHJcblx0XHRcdGlmIChlLndoaWNoID09IDIpXHJcblx0XHRcdFx0dGhhdC5taWRkbGVNb3VzZURvd24gPSBmYWxzZTtcclxuXHRcdFx0aWYgKGUud2hpY2ggPT0gMylcclxuXHRcdFx0XHR0aGF0LnJpZ2h0TW91c2VEb3duID0gZmFsc2U7XHJcblx0XHR9KTtcclxuXHRcdCQoZG9jdW1lbnQpLm1vdXNlbW92ZShmdW5jdGlvbihlKXtcclxuXHRcdFx0dGhhdC5tb3VzZVggPSBlLnBhZ2VYICogdGhhdC5zY3JlZW5SYXRpb1g7XHJcblx0XHRcdHRoYXQubW91c2VZID0gZS5wYWdlWSAqIHRoYXQuc2NyZWVuUmF0aW9ZO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHR0aGF0Lm1vdXNlV2hlZWxFdmVudHMucHVzaChlLndoZWVsRGVsdGEpO1xyXG5cdFx0fSwgZmFsc2UpO1xyXG5cclxuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Nb3VzZVNjcm9sbFwiLCBmdW5jdGlvbihlKSB7XHJcblx0XHRcdHRoYXQubW91c2VXaGVlbEV2ZW50cy5wdXNoKGUuZGV0YWlsICogLTEpO1xyXG5cdFx0fSwgZmFsc2UpO1xyXG5cdH0sXHJcblxyXG5cdGlzS2V5VXA6IGZ1bmN0aW9uKGtleUNvZGUpIHtcclxuXHRcdHJldHVybiAhdGhpcy5rZXlTdGF0ZVtrZXlDb2RlXTtcclxuXHR9LFxyXG5cclxuXHRpc0tleURvd246IGZ1bmN0aW9uKGtleUNvZGUsIGRvbnRNb2RpZnlQcmVzc2VkKSB7XHJcblx0XHRpZiAoIWRvbnRNb2RpZnlQcmVzc2VkKSB7XHJcblx0XHRcdGlmICh0aGlzLmtleVN0YXRlW2tleUNvZGVdKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMucHJlc3NlZEtleXMuaW5kZXhPZihrZXlDb2RlKSA9PSAtMSkge1xyXG5cdFx0XHRcdFx0dGhpcy5wcmVzc2VkS2V5cy5wdXNoKGtleUNvZGUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLmtleXNQcmVzc2VkID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRoaXMua2V5U3RhdGVba2V5Q29kZV07XHJcblx0fSxcclxuXHJcblx0Y2hlY2tQcmVzc2VkS2V5czogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5wcmVzc2VkS2V5cy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdHZhciBuID0gMDtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnByZXNzZWRLZXlzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuaXNLZXlVcCh0aGlzLnByZXNzZWRLZXlzW2ldKSkge1xyXG5cdFx0XHRcdFx0bisrO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChuID09IHRoaXMucHJlc3NlZEtleXMubGVuZ3RoKSB7XHJcblx0XHRcdFx0dGhpcy5rZXlzUHJlc3NlZCA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSxcclxufTtcclxuXHJcbkdTLklucHV0SGVscGVyLmluaXQoKTsiLCJHUy5MaW5lSGVscGVyID0ge1xyXG5cdGNvbXBhcmU6IGZ1bmN0aW9uKHAsIHEpIHtcclxuXHRcdGlmIChwLnggPT0gcS54KSB7XHJcblx0XHRcdHJldHVybiBwLnkgLSBxLnk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcC54IC0gcS54O1xyXG5cdH0sXHJcblxyXG5cdHNsb3BlOiBmdW5jdGlvbihzKSB7XHJcblx0XHRyZXR1cm4gKHMuZW5kLnkgLSBzLnN0YXJ0LnkpIC8gKHMuZW5kLnggLSBzLnN0YXJ0LngpO1xyXG5cdH0sXHJcblxyXG5cdGludGVyc2VjdGlvbkxpbmVTZWdtZW50czogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgcDAgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHMxLCBzMiwgcCkge1xyXG5cdFx0XHRwID0gcCB8fCBwMDtcclxuXHRcdFx0cmV0dXJuIHRoaXMuaW50ZXJzZWN0aW9uTGluZXMoczEsIHMyLCBwLCB0cnVlKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGludGVyc2VjdGlvbkxpbmVzOiBmdW5jdGlvbihzMSwgczIsIHAsIGNvbXBhcmVMaW5lU2VnbWVudHMpIHtcclxuXHRcdHZhciB4MSA9IHMxLnN0YXJ0LngsIHgyID0gczEuZW5kLngsIHgzID0gczIuc3RhcnQueCwgeDQgPSBzMi5lbmQueDtcclxuXHRcdHZhciB5MSA9IHMxLnN0YXJ0LnksIHkyID0gczEuZW5kLnksIHkzID0gczIuc3RhcnQueSwgeTQgPSBzMi5lbmQueTtcclxuXHJcblx0XHR2YXIgZGVub20gPSAoeTQgLSB5MykgKiAoeDIgLSB4MSkgLSAoeDQgLSB4MykgKiAoeTIgLSB5MSk7XHJcblx0XHRpZiAoZGVub20gPT09IDApIHtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciB1YSA9ICgoeDQgLSB4MykgKiAoeTEgLSB5MykgLSAoeTQgLSB5MykgKiAoeDEgLSB4MykpIC8gZGVub207XHJcblx0XHR2YXIgdWIgPSAoKHgyIC0geDEpICogKHkxIC0geTMpIC0gKHkyIC0geTEpICogKHgxIC0geDMpKSAvIGRlbm9tO1xyXG5cclxuXHRcdGlmICghY29tcGFyZUxpbmVTZWdtZW50cyB8fCAodWEgPj0gMCAmJiB1YSA8PSAxICYmIHViID49IDAgJiYgdWIgPD0gMSkpIHtcclxuXHRcdFx0cC54ID0geDEgKyB1YSAqICh4MiAtIHgxKTtcclxuXHRcdFx0cC55ID0geTEgKyB1YSAqICh5MiAtIHkxKTtcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdGludGVyc2VjdGlvbkxpbmVTZWdtZW50Qm94OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBib3gwID0gbmV3IFRIUkVFLkJveDIoKTtcclxuXHRcdHZhciBzZWcwID0geyBzdGFydDogbmV3IFRIUkVFLlZlY3RvcjIoKSwgZW5kOiBuZXcgVEhSRUUuVmVjdG9yMigpIH07XHJcblx0XHR2YXIgcCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHNlZywgYm94KSB7XHJcblx0XHRcdGJveDAuc2V0RnJvbVBvaW50cyhbc2VnLnN0YXJ0LCBzZWcuZW5kXSk7XHJcblxyXG5cdFx0XHRpZiAoIWJveC5pc0ludGVyc2VjdGlvbkJveChib3gwKSkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoYm94LmNvbnRhaW5zUG9pbnQoc2VnLnN0YXJ0KSAmJiBib3guY29udGFpbnNQb2ludChzZWcuZW5kKSkge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzZWcwLnN0YXJ0LnggPSBib3gubWluLng7IHNlZzAuc3RhcnQueSA9IGJveC5taW4ueTsgc2VnMC5lbmQueCA9IGJveC5tYXgueDsgc2VnMC5lbmQueSA9IGJveC5taW4ueTtcclxuXHRcdFx0aWYgKHRoaXMuaW50ZXJzZWN0aW9uTGluZVNlZ21lbnRzKHNlZywgc2VnMCwgcCkpIHtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0c2VnMC5zdGFydC54ID0gYm94Lm1heC54OyBzZWcwLnN0YXJ0LnkgPSBib3gubWluLnk7IHNlZzAuZW5kLnggPSBib3gubWF4Lng7IHNlZzAuZW5kLnkgPSBib3gubWF4Lnk7XHJcblx0XHRcdGlmICh0aGlzLmludGVyc2VjdGlvbkxpbmVTZWdtZW50cyhzZWcsIHNlZzAsIHApKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHNlZzAuc3RhcnQueCA9IGJveC5tYXgueDsgc2VnMC5zdGFydC55ID0gYm94Lm1heC55OyBzZWcwLmVuZC54ID0gYm94Lm1pbi54OyBzZWcwLmVuZC55ID0gYm94Lm1heC55O1xyXG5cdFx0XHRpZiAodGhpcy5pbnRlcnNlY3Rpb25MaW5lU2VnbWVudHMoc2VnLCBzZWcwLCBwKSkge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzZWcwLnN0YXJ0LnggPSBib3gubWluLng7IHNlZzAuc3RhcnQueSA9IGJveC5tYXgueTsgc2VnMC5lbmQueCA9IGJveC5taW4ueDsgc2VnMC5lbmQueSA9IGJveC5taW4ueTtcclxuXHRcdFx0aWYgKHRoaXMuaW50ZXJzZWN0aW9uTGluZVNlZ21lbnRzKHNlZywgc2VnMCwgcCkpIHtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fTtcclxuXHR9KCksXHJcblxyXG5cdGxpbmVTZWdtZW50c1RvR3JhcGg6IGZ1bmN0aW9uKHNlZ21lbnRzLCBncmlkQ2VsbFNpemUpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR2YXIgZ3JhcGggPSBuZXcgR1MuUGxhbmFyR3JhcGgoKTtcclxuXHJcblx0XHR2YXIgcCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBjdXRzID0gW107XHJcblx0XHRcdGN1dHMucHVzaChzZWdtZW50c1tpXS5zdGFydC5jbG9uZSgpKTtcclxuXHRcdFx0Y3V0cy5wdXNoKHNlZ21lbnRzW2ldLmVuZC5jbG9uZSgpKTtcclxuXHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgc2VnbWVudHMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRpZiAoaSAhPSBqKSB7XHJcblx0XHRcdFx0XHR2YXIgcmVzdWx0ID0gdGhpcy5pbnRlcnNlY3Rpb25MaW5lU2VnbWVudHMoc2VnbWVudHNbaV0sIHNlZ21lbnRzW2pdLCBwKTtcclxuXHJcblx0XHRcdFx0XHRpZiAocmVzdWx0KSB7XHJcblx0XHRcdFx0XHRcdGN1dHMucHVzaChwLmNsb25lKCkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRjdXRzLnNvcnQoc29ydCk7XHJcblxyXG5cdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGN1dHMubGVuZ3RoIC0gMTsgaisrKSB7XHJcblx0XHRcdFx0Z3JhcGguYWRkRWRnZShjdXRzW2pdLCBjdXRzW2ogKyAxXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZ3JpZENlbGxTaXplICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBncmFwaC52ZXJ0aWNlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciB2ID0gZ3JhcGgudmVydGljZXNbaV07XHJcblx0XHRcdFx0di54ID0gTWF0aC5mbG9vcih2LnggLyBncmlkQ2VsbFNpemUpICogZ3JpZENlbGxTaXplO1xyXG5cdFx0XHRcdHYueSA9IE1hdGguZmxvb3Iodi55IC8gZ3JpZENlbGxTaXplKSAqIGdyaWRDZWxsU2l6ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIHNvcnQoYSwgYikge1xyXG5cdFx0XHRyZXR1cm4gdGhhdC5jb21wYXJlKGEsIGIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBncmFwaDtcclxuXHR9LFxyXG5cclxuXHRwb2ludE9uTGluZVNlZ21lbnQ6IGZ1bmN0aW9uKHNlZywgcCkge1xyXG5cdFx0dmFyIG9mZnNldCA9IHRoaXMucG9pbnRPZmZzZXRPbkxpbmVTZWdtZW50KHNlZywgcCk7XHJcblx0XHRyZXR1cm4gKG9mZnNldCAhPSAtMSk7XHJcblx0fSxcclxuXHJcblx0cG9pbnRPZmZzZXRPbkxpbmVTZWdtZW50OiBmdW5jdGlvbihzZWcsIHApIHtcclxuXHRcdHZhciBlcHNpbG9uID0gMC4wMDAxO1xyXG5cclxuXHRcdHZhciBjcm9zcyA9IChwLnkgLSBzZWcuc3RhcnQueSkgKiAoc2VnLmVuZC54IC0gc2VnLnN0YXJ0LngpIC0gKHAueCAtIHNlZy5zdGFydC54KSAqIChzZWcuZW5kLnkgLSBzZWcuc3RhcnQueSk7XHJcblx0XHRpZiAoTWF0aC5hYnMoY3Jvc3MpID4gZXBzaWxvbikge1xyXG5cdFx0XHRyZXR1cm4gLTE7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGRvdCA9IChwLnggLSBzZWcuc3RhcnQueCkgKiAoc2VnLmVuZC54IC0gc2VnLnN0YXJ0LngpICsgKHAueSAtIHNlZy5zdGFydC55KSAqIChzZWcuZW5kLnkgLSBzZWcuc3RhcnQueSk7XHJcblx0XHRpZiAoZG90IDwgMCkge1xyXG5cdFx0XHRyZXR1cm4gLTE7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGxlbmd0aFNxID0gKHNlZy5lbmQueCAtIHNlZy5zdGFydC54KSAqIChzZWcuZW5kLnggLSBzZWcuc3RhcnQueCkgKyAoc2VnLmVuZC55IC0gc2VnLnN0YXJ0LnkpICogKHNlZy5lbmQueSAtIHNlZy5zdGFydC55KTtcclxuXHRcdGlmIChkb3QgPiBsZW5ndGhTcSkge1xyXG5cdFx0XHRyZXR1cm4gLTE7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIG9mZnNldCA9IChsZW5ndGhTcSAhPT0gMCkgPyAoZG90IC8gbGVuZ3RoU3EpIDogMTtcclxuXHRcdHJldHVybiBvZmZzZXQ7XHJcblx0fSxcclxuXHJcblx0YXJlUG9pbnRzQ29sbGluZWFyOiBmdW5jdGlvbihwMSwgcDIsIHAzKSB7XHJcblx0XHRyZXR1cm4gKHAxLnkgLSBwMi55KSAqIChwMS54IC0gcDMueCkgPT0gKHAxLnkgLSBwMy55KSAqIChwMS54IC0gcDIueCk7XHJcblx0fVxyXG59OyIsIkdTLk1hcExheWVycyA9IHtcclxuXHRTZWdtZW50OiAwLFxyXG5cdFNlY3RvcjogMixcclxuXHRFbnRpdHk6IDMsXHJcblx0Wm9uZTogNCxcclxufTtcclxuXHJcbkdTLlNlZ21lbnRUeXBlcyA9IHtcclxuXHRVc2VyOiAwLFxyXG5cdEludGVyaW9yRmxvb3I6IDEsXHJcblx0SW50ZXJpb3JDZWlsaW5nOiAyLFxyXG5cdEV4dGVyaW9yOiAzLFxyXG5cdFRWU2NyZWVuOiA0LFxyXG5cdFN3aXRjaDogNSxcclxufTtcclxuXHJcbkdTLk1hcEVudGl0aWVzID0ge1xyXG5cdFwiTVwiOiB7XHJcblx0XHRuYW1lOiBcIm1lZGtpdFwiLFxyXG5cdFx0dHlwZTogXCJJdGVtXCIsXHJcblx0fSxcclxuXHRcIkFcIjoge1xyXG5cdFx0bmFtZTogXCJhbW1vXCIsXHJcblx0XHR0eXBlOiBcIkl0ZW1cIixcclxuXHR9LFxyXG5cdFwiSFwiOiB7XHJcblx0XHRuYW1lOiBcImh5cGVyX2JsYXN0ZXJcIixcclxuXHRcdHR5cGU6IFwiSXRlbVwiLFxyXG5cdH0sXHJcblx0XCJEXCI6IHtcclxuXHRcdG5hbWU6IFwiZG91YmxlX3Nob3RndW5cIixcclxuXHRcdHR5cGU6IFwiSXRlbVwiLFxyXG5cdH0sXHJcblx0XCJOXCI6IHtcclxuXHRcdG5hbWU6IFwibm9tXCIsXHJcblx0XHR0eXBlOiBcIk1vbnN0ZXJcIixcclxuXHRcdGFuaW1hdGlvbnM6IHtcclxuXHRcdFx0d2FsazogNixcclxuXHRcdFx0ZGVhdGg6IDQsXHJcblx0XHR9LFxyXG5cdH0sXHJcblx0XCJFXCI6IHtcclxuXHRcdG5hbWU6IFwiZXllXCIsXHJcblx0XHR0eXBlOiBcIk1vbnN0ZXJcIixcclxuXHRcdGFuaW1hdGlvbnM6IHtcclxuXHRcdFx0d2FsazogNCxcclxuXHRcdFx0ZGVhdGg6IDQsXHJcblx0XHRcdGF0dGFjazogMixcclxuXHRcdH0sXHJcblx0fSxcclxuICBcIlNcIjoge1xyXG5cdFx0bmFtZTogXCJzcGF3blwiLFxyXG5cdFx0dHlwZTogXCJTcGF3blwiLFxyXG4gIH0sXHJcbiAgXCJPXCI6IHtcclxuICAgIG5hbWU6IFwib25saW5lX3BsYXllclwiLFxyXG4gICAgdHlwZTogXCJPbmxpbmVQbGF5ZXJcIixcclxuXHRcdGFuaW1hdGlvbnM6IHtcclxuXHRcdFx0d2FsazogNixcclxuXHRcdFx0ZGVhdGg6IDQsXHJcblx0XHR9LFxyXG4gIH1cclxuXHJcbn07XHJcbiIsIkdTLk1hdGhIZWxwZXIgPSB7XHJcblx0Y2xhbXA6IGZ1bmN0aW9uKHgsIG1pbiwgbWF4KSB7XHJcblx0XHRpZiAoeCA8IG1pbikgeCA9IG1pbjtcclxuXHRcdGlmICh4ID4gbWF4KSB4ID0gbWF4O1xyXG5cclxuXHRcdHJldHVybiB4O1xyXG5cdH0sXHJcblxyXG5cdC8vIEFuZHJldydzIG1vbm90b25lIGNoYWluIGNvbnZleCBodWxsIGFsZ29yaXRobVxyXG5cdC8vIGh0dHA6Ly9lbi53aWtpYm9va3Mub3JnL3dpa2kvQWxnb3JpdGhtX0ltcGxlbWVudGF0aW9uL0dlb21ldHJ5L0NvbnZleF9odWxsL01vbm90b25lX2NoYWluXHJcblx0Z2V0Q29udmV4SHVsbFBvaW50czogZnVuY3Rpb24oUCkge1x0XHJcblx0XHR2YXIgY3Jvc3MgPSBmdW5jdGlvbihPLCBBLCBCKSB7XHJcblx0XHRcdHJldHVybiAoQS54IC0gTy54KSAqIChCLnkgLSBPLnkpIC0gKEEueSAtIE8ueSkgKiAoQi54IC0gTy54KTtcclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIG4gPSBQLmxlbmd0aDtcclxuXHRcdHZhciBrID0gMDtcclxuXHRcdHZhciBIID0gW107XHJcblxyXG5cdFx0UC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcdFxyXG5cdFx0XHRpZiAoYS54ID09IGIueCkge1xyXG5cdFx0XHRcdHJldHVybiBhLnkgLSBiLnk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIGEueCAtIGIueDsgXHJcblx0XHR9KTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xyXG5cdFx0XHR3aGlsZSAoayA+PSAyICYmIGNyb3NzKEhbayAtIDJdLCBIW2sgLSAxXSwgUFtpXSkgPD0gMCkge1xyXG5cdFx0XHRcdGstLTtcclxuXHRcdFx0fVxyXG5cdFx0XHRIW2srK10gPSBQW2ldO1xyXG5cdFx0fVxyXG5cdCBcclxuXHRcdHZhciB0ID0gayArIDE7XHJcblx0XHRmb3IgKHZhciBpID0gbiAtIDI7IGkgPj0gMDsgaS0tKSB7XHJcblx0XHRcdHdoaWxlIChrID49IHQgJiYgY3Jvc3MoSFtrIC0gMl0sIEhbayAtIDFdLCBQW2ldKSA8PSAwKSB7XHJcblx0XHRcdFx0ay0tO1xyXG5cdFx0XHR9XHJcblx0XHRcdEhbaysrXSA9IFBbaV07XHJcblx0XHR9XHJcblx0IFxyXG5cdFx0SC5sZW5ndGggPSBrIC0gMTtcclxuXHRcdHJldHVybiBIO1xyXG5cdH0sXHJcblxyXG5cdHBvaW50SW5UcmlhbmdsZTogZnVuY3Rpb24oUCwgQSwgQiwgQykge1xyXG5cdFx0dmFyIHJlc3VsdCA9IHRoaXMuZ2V0VHJpYW5nbGVCYXJ5Y2VudHJpY0Nvb3JkaW5hdGVzKFAsIEEsIEIsIEMpO1xyXG5cdFx0cmV0dXJuIHJlc3VsdC5pblRyaWFuZ2xlO1xyXG5cdH0sXHJcblxyXG5cdC8vIEJhcnljZW50cmljIFRlY2huaXF1ZVxyXG5cdC8vIGh0dHA6Ly93d3cuYmxhY2twYXduLmNvbS90ZXh0cy9wb2ludGlucG9seS9cclxuXHRnZXRUcmlhbmdsZUJhcnljZW50cmljQ29vcmRpbmF0ZXM6IGZ1bmN0aW9uKFAsIEEsIEIsIEMpIHtcclxuXHRcdHZhciB2MCA9IG5ldyBUSFJFRS5WZWN0b3IyKCkuc3ViVmVjdG9ycyhDLCBBKTtcclxuXHRcdHZhciB2MSA9IG5ldyBUSFJFRS5WZWN0b3IyKCkuc3ViVmVjdG9ycyhCLCBBKTtcclxuXHRcdHZhciB2MiA9IG5ldyBUSFJFRS5WZWN0b3IyKCkuc3ViVmVjdG9ycyhQLCBBKTtcclxuXHJcblx0XHR2YXIgZG90MDAgPSB2MC5kb3QodjApO1xyXG5cdFx0dmFyIGRvdDAxID0gdjAuZG90KHYxKTtcclxuXHRcdHZhciBkb3QwMiA9IHYwLmRvdCh2Mik7XHJcblx0XHR2YXIgZG90MTEgPSB2MS5kb3QodjEpO1xyXG5cdFx0dmFyIGRvdDEyID0gdjEuZG90KHYyKTtcclxuXHJcblx0XHR2YXIgaW52RGVub20gPSAxIC8gKGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxKTtcclxuXHRcdHZhciB1ID0gKGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyKSAqIGludkRlbm9tO1xyXG5cdFx0dmFyIHYgPSAoZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIpICogaW52RGVub207XHJcblxyXG5cdFx0dmFyIGluVHJpYW5nbGUgPSAodSA+PSAwICYmIHYgPj0gMCAmJiAodSArIHYgPCAxKSk7XHJcblxyXG5cdFx0cmV0dXJuIHsgdTogdSwgdjogdiwgaW5UcmlhbmdsZTogaW5UcmlhbmdsZSB9O1xyXG5cdH0sXHJcblxyXG5cdHZlYzJSb3RhdGU6IGZ1bmN0aW9uKHYsIGFuZ2xlKSB7XHJcblx0XHR2YXIgc24gPSBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogYW5nbGUpO1xyXG5cdFx0dmFyIGNzID0gTWF0aC5jb3MoTWF0aC5QSSAvIDE4MCAqIGFuZ2xlKTtcclxuXHJcblx0XHR2YXIgeCA9IHYueCAqIGNzIC0gdi55ICogc247XHJcblx0XHR2YXIgeSA9IHYueCAqIHNuICsgdi55ICogY3M7XHJcblxyXG5cdFx0di54ID0geDtcclxuXHRcdHYueSA9IHk7XHJcblx0fSxcclxuXHJcblx0dmVjMlJvdGF0ZVJhZGlhbnM6IGZ1bmN0aW9uKHYsIHJhZGlhbnMpIHtcclxuXHRcdHZhciBzbiA9IE1hdGguc2luKHJhZGlhbnMpO1xyXG5cdFx0dmFyIGNzID0gTWF0aC5jb3MocmFkaWFucyk7XHJcblxyXG5cdFx0dmFyIHggPSB2LnggKiBjcyAtIHYueSAqIHNuO1xyXG5cdFx0dmFyIHkgPSB2LnggKiBzbiArIHYueSAqIGNzO1xyXG5cclxuXHRcdHYueCA9IHg7XHJcblx0XHR2LnkgPSB5O1xyXG5cdH0sXHJcblxyXG5cdHZlYzJBbmdsZTogZnVuY3Rpb24odjAsIHYxKSB7XHJcblx0XHRyZXR1cm4gLU1hdGguYXRhbjIodjEueSAtIHYwLnksIHYxLnggLSB2MC54KSAqICgxODAgLyBNYXRoLlBJKSAqIDI7XHJcblx0fSxcclxuXHJcblx0dmVjMkFuZ2xlUmFkaWFuczogZnVuY3Rpb24odjAsIHYxKSB7XHJcblx0XHRyZXR1cm4gLU1hdGguYXRhbjIodjEueSAtIHYwLnksIHYxLnggLSB2MC54KSAqIDI7XHJcblx0fSxcclxuXHJcblx0dmVjMkFuZ2xlRGlyZWN0ZWQ6IGZ1bmN0aW9uKHYwLCB2MSkge1xyXG5cdFx0cmV0dXJuIE1hdGguYXRhbjIodjAueSwgdjAueCkgLSBNYXRoLmF0YW4yKHYxLnksIHYxLngpO1xyXG5cdH0sXHJcblxyXG5cdHZlYzJOb3JtYWw6IGZ1bmN0aW9uKHYwLCB2MSwgb3B0aW9uYWxUYXJnZXQpIHtcclxuXHRcdHZhciByZXN1bHQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHZhciBkeCA9IHYxLnggLSB2MC54O1xyXG5cdFx0dmFyIGR5ID0gdjEueSAtIHYwLnk7XHJcblxyXG5cdFx0cmVzdWx0LnNldChkeSwgLWR4KS5ub3JtYWxpemUoKTtcclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fSxcclxuXHJcblx0dmVjMlBvaW50U2lkZTogZnVuY3Rpb24oYSwgYiwgYykge1xyXG5cdFx0cmV0dXJuICgoYi54IC0gYS54KSAqIChjLnkgLSBhLnkpIC0gKGIueSAtIGEueSkgKiAoYy54IC0gYS54KSkgPiAwO1xyXG5cdH0sXHJcbn07XHJcblxyXG5HUy5TbW9vdGhOdW1iZXIgPSBmdW5jdGlvbihpbml0aWFsVmFsdWUsIHNwZWVkKSB7XHJcblx0dGhpcy52YWx1ZSA9IGluaXRpYWxWYWx1ZTtcclxuXHR0aGlzLnRhcmdldFZhbHVlID0gaW5pdGlhbFZhbHVlO1xyXG5cdHRoaXMuc3BlZWQgPSBzcGVlZDtcclxufTtcclxuXHJcbkdTLlNtb290aE51bWJlci5wcm90b3R5cGUgPSB7XHJcblx0c2V0VGFyZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldFZhbHVlKSB7XHJcblx0XHR0aGlzLnRhcmdldFZhbHVlID0gdGFyZ2V0VmFsdWU7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLnZhbHVlIDwgdGhpcy50YXJnZXRWYWx1ZSkge1xyXG5cdFx0XHR0aGlzLnZhbHVlICs9IHRoaXMuc3BlZWQ7XHJcblx0XHRcdGlmICh0aGlzLnZhbHVlID4gdGhpcy50YXJnZXRWYWx1ZSkge1xyXG5cdFx0XHRcdHRoaXMudmFsdWUgPSB0aGlzLnRhcmdldFZhbHVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAodGhpcy52YWx1ZSA+IHRoaXMudGFyZ2V0VmFsdWUpIHtcclxuXHRcdFx0dGhpcy52YWx1ZSAtPSB0aGlzLnNwZWVkO1xyXG5cdFx0XHRpZiAodGhpcy52YWx1ZSA8IHRoaXMudGFyZ2V0VmFsdWUpIHtcclxuXHRcdFx0XHR0aGlzLnZhbHVlID0gdGhpcy50YXJnZXRWYWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcbn07XHJcblxyXG5HUy5TbW9vdGhWZWN0b3IzID0gZnVuY3Rpb24oeCwgeSwgeiwgc3BlZWQpIHtcclxuXHRUSFJFRS5WZWN0b3IzLmNhbGwodGhpcywgeCwgeSwgeik7XHJcblxyXG5cdHRoaXMudGFyZ2V0VmFsdWUgPSB0aGlzLmNsb25lKCk7XHJcblx0dGhpcy5zcGVlZCA9IChzcGVlZCAhPT0gdW5kZWZpbmVkKSA/IHNwZWVkIDogMC4xO1xyXG5cdHRoaXMuY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoKTtcclxufTtcclxuXHJcbkdTLlNtb290aFZlY3RvcjMucHJvdG90eXBlID0gR1MuaW5oZXJpdChUSFJFRS5WZWN0b3IzLCB7XHJcblx0c2V0VGFyZ2V0VmFsdWU6IGZ1bmN0aW9uKHRhcmdldFZhbHVlKSB7XHJcblx0XHR0aGlzLnRhcmdldFZhbHVlID0gdGFyZ2V0VmFsdWUuY2xvbmUoKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy51cGRhdGVQcm9wZXJ0eShcInhcIik7XHJcblx0XHR0aGlzLnVwZGF0ZVByb3BlcnR5KFwieVwiKTtcclxuXHRcdHRoaXMudXBkYXRlUHJvcGVydHkoXCJ6XCIpO1xyXG5cclxuXHRcdHRoaXMudXBkYXRlQ29sb3IoKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVDb2xvcjogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmNvbG9yLnIgPSB0aGlzLng7XHJcblx0XHR0aGlzLmNvbG9yLmcgPSB0aGlzLnk7XHJcblx0XHR0aGlzLmNvbG9yLmIgPSB0aGlzLno7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlUHJvcGVydHk6IGZ1bmN0aW9uKG5hbWUpIHtcclxuXHRcdGlmICh0aGlzW25hbWVdIDwgdGhpcy50YXJnZXRWYWx1ZVtuYW1lXSkge1xyXG5cdFx0XHR0aGlzW25hbWVdICs9IHRoaXMuc3BlZWQ7XHJcblx0XHRcdGlmICh0aGlzW25hbWVdID4gdGhpcy50YXJnZXRWYWx1ZVtuYW1lXSkge1xyXG5cdFx0XHRcdHRoaXNbbmFtZV0gPSB0aGlzLnRhcmdldFZhbHVlW25hbWVdO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAodGhpc1tuYW1lXSA+IHRoaXMudGFyZ2V0VmFsdWVbbmFtZV0pIHtcclxuXHRcdFx0dGhpc1tuYW1lXSAtPSB0aGlzLnNwZWVkO1xyXG5cdFx0XHRpZiAodGhpc1tuYW1lXSA8IHRoaXMudGFyZ2V0VmFsdWVbbmFtZV0pIHtcclxuXHRcdFx0XHR0aGlzW25hbWVdID0gdGhpcy50YXJnZXRWYWx1ZVtuYW1lXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcbn0pOyIsIkdTLk9ubGluZVJvb20gPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5jbGllbnRzID0gW107XG59XG5cbkdTLk9ubGluZVJvb20ucHJvdG90eXBlID0ge1xuXHRpbml0OiBmdW5jdGlvbigpIHtcblx0fSxcblxuICBzZXR1cFJvb206IGZ1bmN0aW9uIChyb29tKSB7XG4gICAgdGhpcy5yb29tID0gcm9vbTtcbiAgICBsZXQgbWFwTmFtZSA9IFwiYWlyc3RyaXAxb25saW5lXCI7Ly8gcm9vbS5tYXBOYW1lO1xuICAgIEdBTUUubG9hZE9ubGluZUxldmVsKG1hcE5hbWUpO1xuICB9LFxuXG4gIHNldHVwQ2xpZW50czogZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5maXJzdFJ1bkhhY2spXG4gICAgICB0aGlzLnJvb20uY2xpZW50cy5mb3JFYWNoKChlKSA9PiB0aGlzLmFkZENsaWVudChlKSk7XG4gICAgdGhpcy5maXJzdFJ1bkhhY2sgPSB0cnVlO1xuICB9LFxuXG4gIHJvb21QaW5nOiBmdW5jdGlvbiAocm9vbSwgaWQpIHtcbiAgICBmb3IgKGkgaW4gcm9vbS5jbGllbnRzKSB7XG4gICAgICB1cGRhdGVkQ2xpZW50ID0gcm9vbS5jbGllbnRzW2ldO1xuICAgICAgY29uc29sZS5sb2codXBkYXRlZENsaWVudC5pZCArIFwiOiBcIiArIHVwZGF0ZWRDbGllbnQuc2NvcmUpXG4gICAgICBpZiAodXBkYXRlZENsaWVudC5pZCA9PT0gaWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBsZXQgY2xpZW50ID0gdGhpcy5maW5kQ2xpZW50KHVwZGF0ZWRDbGllbnQuaWQpO1xuICAgICAgaWYgKCFjbGllbnQpIHtcbiAgICAgICAgLy8gdGhpcy5hZGRDbGllbnQodXBkYXRlZENsaWVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnVwZGF0ZUNsaWVudCh1cGRhdGVkQ2xpZW50KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgYWRkQ2xpZW50OiBmdW5jdGlvbiAoY2xpZW50KSB7XG4gICAgaWYgKEdBTUUub25saW5lTWFuYWdlci5zb2NrZXQuaWQgPT09IGNsaWVudC5pZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgbnR0ID0ge1xuICAgICAgaWQ6IGNsaWVudC5pZCxcbiAgICAgIHBvczogbmV3IFRIUkVFLlZlY3RvcjIoY2xpZW50LnggfHwgMCwgY2xpZW50LnkgfHwgMCksXG4gICAgICB0eXBlOiBcIk9cIixcbiAgICAgIHk6IDAsXG4gICAgICBpc1N0YXRpYzpmYWxzZSxcbiAgICAgIHJvdGF0aW9uOiBjbGllbnQuZGlyZWN0aW9uIHx8IDBcbiAgICB9O1xuICAgIGxldCBncmlkT2JqID0gR0FNRS5ncmlkLnNwYXduRW50aXR5QXRSdW50aW1lKG50dCwgR0FNRS5ncmlkKTtcbiAgICB0aGlzLmNsaWVudHMucHVzaChncmlkT2JqKTtcbiAgICBHQU1FLmdyaWQubWFwLmxheWVyT2JqZWN0c1tHUy5NYXBMYXllcnMuRW50aXR5XS5wdXNoKGdyaWRPYmopO1xuICB9LFxuXG4gIGZpbmRDbGllbnQ6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmIChHQU1FLm9ubGluZU1hbmFnZXIuc29ja2V0LmlkID09PSBpZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jbGllbnRzLmZpbHRlcigoZSkgPT4gZS5pZCA9PT0gaWQgJiYgZS5pZCAhPT0gR0FNRS5vbmxpbmVNYW5hZ2VyLnNvY2tldC5pZClbMF0gfHwgZmFsc2U7XG4gIH0sXG5cbiAgY2xpZW50RGllOiBmdW5jdGlvbiAoaWQpIHtcbiAgICBsZXQgY2xpZW50ID0gdGhpcy5maW5kQ2xpZW50KGlkKTtcbiAgICBpZiAoY2xpZW50KSB7XG4gICAgICBjbGllbnQub25EZWF0aCgpO1xuICAgIH1cbiAgfSxcblxuICBjbGllbnRSZXNwYXduOiBmdW5jdGlvbiAoaWQpIHtcbiAgICBsZXQgY2xpZW50ID0gdGhpcy5maW5kQ2xpZW50KGlkKTtcbiAgICBpZiAoY2xpZW50KSB7XG4gICAgICBjbGllbnQub25SZXNwYXduKCk7XG4gICAgfVxuICB9LFxuXG4gIHJlbW92ZUNsaWVudDogZnVuY3Rpb24gKGlkKSB7XG4gICAgbGV0IGNsaWVudCA9IHRoaXMuZmluZENsaWVudChpZCk7XG4gICAgaWYgKGNsaWVudCkge1xuICAgICAgY2xpZW50Lm9uRGVhdGgoKTtcbiAgICAgIHRoaXMuY2xpZW50cy5zcGxpY2UodGhpcy5jbGllbnRzLmluZGV4T2YoY2xpZW50KSwgMSk7XG4gICAgfVxuICB9LFxuXG4gIGFkZFByb2plY3RpbGU6IGZ1bmN0aW9uIChpZCkge1xuICAgIGxldCBjbGllbnQgPSB0aGlzLmZpbmRDbGllbnQoaWQpO1xuICAgIGlmIChjbGllbnQpIHtcbiAgICAgIGNsaWVudC5vblBsYXllclNob290KCk7XG4gICAgfVxuICB9LFxuXG4gIHJlbW92ZUFsbENsaWVudHM6IGZ1bmN0aW9uIChpZCkge1xuICAgIHRoaXMuY2xpZW50cyA9IFtdO1xuICB9LFxuXG4gIHVwZGF0ZUNsaWVudDogZnVuY3Rpb24gKHVwZGF0ZWRDbGllbnQpIHtcbiAgICBsZXQgY2xpZW50ID0gdGhpcy5maW5kQ2xpZW50KHVwZGF0ZWRDbGllbnQuaWQpO1xuICAgIGNsaWVudC5vblVwZGF0ZU1vdmUoY2xpZW50KTtcbiAgfVxufTtcblxuXG4iLCIvLyBQb2x5Z29uIGRldGVjdGlvbiBmcm9tIGxpbmUgc2VnbWVudHNcclxuXHJcbi8vIHJldHJpZXZlcyBub24tb3ZlcmxhcHBpbmcgcG9seWdvbnMgZm9yIGluZHVjZWQgZ3JhcGhzIHdpdGggTiA8PSAxMDAgY3ljbGVzIHVzaW5nIHRoZSBCcm9u4oCTS2VyYm9zY2ggYWxnb3JpdGhtXHJcbi8vIGZvciBncmFwaHMgd2l0aCBOID4gMTAwIGN5Y2xlcyB1c2VzIEhvcnRvbidzIGFsZ29yaXRobSBhcyBhIGZhbGxiYWNrXHJcblxyXG4vLyBiYXNlZCBvbiB0aGUgYWxnb3JpdGhtIGRlc2NyaWJlZCBpbiBcIlBvbHlnb24gRGV0ZWN0aW9uIGZyb20gYSBTZXQgb2YgTGluZXNcIjpcclxuLy8gaHR0cDovL3d3dy5yZXNlYXJjaGdhdGUubmV0L3B1YmxpY2F0aW9uLzI5MzM5OTdfUG9seWdvbl9EZXRlY3Rpb25fZnJvbV9hX1NldF9vZl9MaW5lcy9maWxlLzc5ZTQxNTA3ZGRlYzdjYzBhZS5wZGZcclxuXHJcbkdTLlBvbHlnb25IZWxwZXIgPSB7XHJcblx0Z2V0UG9seWdvbnNGcm9tTGluZVNlZ21lbnRzOiBmdW5jdGlvbihzZWdtZW50cywgZ3JpZENlbGxTaXplKSB7XHJcblx0XHR2YXIgZ3JhcGggPSBHUy5MaW5lSGVscGVyLmxpbmVTZWdtZW50c1RvR3JhcGgoc2VnbWVudHMsIGdyaWRDZWxsU2l6ZSk7XHJcblx0XHRcclxuXHRcdGdyYXBoLmNvbXB1dGVTaG9ydGVzdFBhdGhzKCk7XHRcclxuXHRcdGdyYXBoLmNvbXB1dGVNaW5pbXVtQ3ljbGVCYXNpcygpO1xyXG5cdFx0Z3JhcGgucmVtb3ZlTm9uQ3ljbGVFZGdlcygpO1xyXG5cclxuXHRcdHZhciB2ZXJ0aWNlcyA9IGdyYXBoLnZlcnRpY2VzO1xyXG5cdFx0dmFyIHBvbHlnb25zID0gW107XHJcblx0XHR2YXIgbWNiID0gZ3JhcGgubWluaW11bUN5Y2xlQmFzaXM7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG1jYi5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgY3ljbGUgPSBncmFwaC5jeWNsZXNbbWNiW2ldXS5lbGVtZW50cztcclxuXHRcdFx0cG9seWdvbnNbaV0gPSBbXTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBjeWNsZS5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdHBvbHlnb25zW2ldLnB1c2godmVydGljZXNbY3ljbGVbal0uc3RhcnRdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdHZlcnRpY2VzOiB2ZXJ0aWNlcyxcclxuXHRcdFx0cG9seWdvbnM6IHBvbHlnb25zLFxyXG5cdFx0XHRncmFwaDogZ3JhcGgsXHJcblx0XHR9O1xyXG5cdH0sXHJcblxyXG5cdGdldFRyaWFuZ3VsYXRlZFBvbHlnb25zRnJvbUxpbmVTZWdtZW50czogZnVuY3Rpb24oc2VnbWVudHMsIGdyaWRDZWxsU2l6ZSkge1xyXG5cdFx0dmFyIHJlc3VsdCA9IHRoaXMuZ2V0UG9seWdvbnNGcm9tTGluZVNlZ21lbnRzKHNlZ21lbnRzLCBncmlkQ2VsbFNpemUpO1xyXG5cdFx0XHJcblx0XHR2YXIgcG9seWdvbnMgPSBbXTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0LnBvbHlnb25zLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBwb2x5Z29uID0gcmVzdWx0LnBvbHlnb25zW2ldO1xyXG5cdFx0XHR2YXIgdmVydGljZXMgPSB0aGlzLnZlY3RvcjJUb1ZlcnRleEFycmF5KHBvbHlnb24pO1xyXG5cdFx0XHRpZiAodGhpcy5hcmVWZXJ0aWNlc0Nsb2Nrd2lzZSh2ZXJ0aWNlcykpIHtcclxuXHRcdFx0XHR0aGlzLnJldmVyc2VWZXJ0aWNlcyh2ZXJ0aWNlcyk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmVzdWx0LnBvbHlnb25zW2ldID0ge1xyXG5cdFx0XHRcdHZlcnRpY2VzOiB0aGlzLnZlcnRleFRvVmVjdG9yMkFycmF5KHZlcnRpY2VzKSxcclxuXHRcdFx0XHRpbmRpY2VzOiBQb2x5Sy5Ucmlhbmd1bGF0ZSh2ZXJ0aWNlcyksXHJcblx0XHRcdFx0YXJlYTogUG9seUsuR2V0QXJlYSh2ZXJ0aWNlcyksXHJcblx0XHRcdH07XHJcblx0XHR9XHJcblxyXG5cdFx0cmVzdWx0LnBvbHlnb25zLnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG5cdFx0XHRyZXR1cm4gYi5hcmVhIC0gYS5hcmVhO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9LFxyXG5cclxuXHR2ZWN0b3IyVG9WZXJ0ZXhBcnJheTogZnVuY3Rpb24odmVjdG9ycykge1xyXG5cdFx0dmFyIHZlcnRpY2VzID0gW107XHJcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHZlY3RvcnMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0dmVydGljZXMucHVzaCh2ZWN0b3JzW2pdLngpO1xyXG5cdFx0XHR2ZXJ0aWNlcy5wdXNoKHZlY3RvcnNbal0ueSk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdmVydGljZXM7XHJcblx0fSxcclxuXHJcblx0dmVydGV4VG9WZWN0b3IyQXJyYXk6IGZ1bmN0aW9uKHZlcnRpY2VzKSB7XHJcblx0XHR2YXIgdmVjdG9ycyA9IFtdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2ZXJ0aWNlcy5sZW5ndGg7IGkgKz0gMikge1xyXG5cdFx0XHR2ZWN0b3JzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjIodmVydGljZXNbaV0sIHZlcnRpY2VzW2kgKyAxXSkpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHZlY3RvcnM7XHJcblx0fSxcclxuXHJcblx0cmV2ZXJzZVZlcnRpY2VzOiBmdW5jdGlvbih2ZXJ0aWNlcykge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2ZXJ0aWNlcy5sZW5ndGggLyAyOyBpICs9IDIpIHtcclxuXHRcdFx0dmFyIGogPSB2ZXJ0aWNlcy5sZW5ndGggLSBpIC0gMjtcclxuXHRcdFx0dmFyIHggPSB2ZXJ0aWNlc1tpXTtcclxuXHRcdFx0dmVydGljZXNbaV0gPSB2ZXJ0aWNlc1tqXTtcclxuXHRcdFx0dmVydGljZXNbal0gPSB4O1xyXG5cdFx0XHR2YXIgeSA9IHZlcnRpY2VzW2kgKyAxXTtcclxuXHRcdFx0dmVydGljZXNbaSArIDFdID0gdmVydGljZXNbaiArIDFdO1xyXG5cdFx0XHR2ZXJ0aWNlc1tqICsgMV0gPSB5O1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGFyZVZlcnRpY2VzQ2xvY2t3aXNlOiBmdW5jdGlvbih2ZXJ0aWNlcykge1xyXG5cdFx0dmFyIHN1bSA9IDA7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHZlcnRpY2VzLmxlbmd0aCAtIDI7IGkgKz0gMikge1xyXG5cdFx0XHR2YXIgeDEgPSB2ZXJ0aWNlc1tpXTtcclxuXHRcdFx0dmFyIHkxID0gdmVydGljZXNbaSArIDFdO1xyXG5cdFx0XHR2YXIgeDIgPSB2ZXJ0aWNlc1tpICsgMl07XHJcblx0XHRcdHZhciB5MiA9IHZlcnRpY2VzW2kgKyAzXTtcclxuXHRcdFx0c3VtICs9ICh4MiAtIHgxKSAqICh5MiArIHkxKTtcclxuXHRcdH1cclxuXHRcdHZhciB4MSA9IHZlcnRpY2VzW3ZlcnRpY2VzLmxlbmd0aCAtIDJdO1xyXG5cdFx0dmFyIHkxID0gdmVydGljZXNbdmVydGljZXMubGVuZ3RoIC0gMV07XHJcblx0XHR2YXIgeDIgPSB2ZXJ0aWNlc1swXTtcclxuXHRcdHZhciB5MiA9IHZlcnRpY2VzWzFdO1xyXG5cdFx0c3VtICs9ICh4MiAtIHgxKSAqICh5MiArIHkxKTtcclxuXHRcdHJldHVybiBzdW0gPj0gMDtcclxuXHR9LFx0XHJcblxyXG5cdC8vIGh0dHBzOi8vZGwuZHJvcGJveHVzZXJjb250ZW50LmNvbS91LzcwNTk5OS9wb2x5ZmluZGVyL2luZGV4Lmh0bWxcclxuXHRzZWN0b3JDb250YWluc1BvaW50OiBmdW5jdGlvbihzZWN0b3IsIHAsIHVzZUNvbGxpc2lvblZlcnRpY2VzKSB7XHJcblx0XHR2YXIgdiA9IHVzZUNvbGxpc2lvblZlcnRpY2VzID8gc2VjdG9yLmNvbGxpc2lvblZlcnRpY2VzIDogc2VjdG9yLnZlcnRpY2VzO1xyXG5cdFx0dmFyIG4gPSB2Lmxlbmd0aDtcclxuXHRcdHZhciBjID0gZmFsc2U7XHJcblxyXG5cdFx0dmFyIGksIGogPSAwO1xyXG5cdFx0Zm9yIChpID0gMCwgaiA9IG4gLSAxOyBpIDwgbjsgaiA9IGkrKykge1xyXG5cdFx0XHR2YXIgc3RhcnQgPSB2W2ldO1xyXG5cdFx0XHR2YXIgZW5kID0gdltqXTtcclxuXHJcblx0XHRcdGlmICgoKHN0YXJ0LnkgPiBwLnkpICE9IChlbmQueSA+IHAueSkpICYmXHJcblx0XHRcdFx0KHAueCA8IChlbmQueCAtIHN0YXJ0LngpICogKHAueSAtIHN0YXJ0LnkpIC8gKGVuZC55IC0gc3RhcnQueSkgKyBzdGFydC54KSkge1xyXG5cdFx0XHRcdGMgPSAhYztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBjO1xyXG5cdH0sXHJcblxyXG5cdGludGVyc2VjdGlvblNlY3RvckJveDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgYm94MCA9IG5ldyBUSFJFRS5Cb3gyKCk7XHJcblx0XHR2YXIgc2VnMCA9IHsgc3RhcnQ6IG5ldyBUSFJFRS5WZWN0b3IyKCksIGVuZDogbmV3IFRIUkVFLlZlY3RvcjIoKSB9O1xyXG5cdFx0dmFyIHAgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGJveFBvaW50cyA9IFtcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdF07XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHNlY3RvciwgYm94KSB7XHJcblx0XHRcdGJveDAuc2V0RnJvbVBvaW50cyhzZWN0b3IudmVydGljZXMpO1xyXG5cclxuXHRcdFx0aWYgKCFib3guaXNJbnRlcnNlY3Rpb25Cb3goYm94MCkpIHtcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGJveC5jb250YWluc0JveChib3gwKSkge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRib3hQb2ludHNbMF0ueCA9IGJveC5taW4ueDsgYm94UG9pbnRzWzBdLnkgPSBib3gubWluLnk7XHJcblx0XHRcdGJveFBvaW50c1sxXS54ID0gYm94Lm1heC54OyBib3hQb2ludHNbMV0ueSA9IGJveC5taW4ueTtcclxuXHRcdFx0Ym94UG9pbnRzWzJdLnggPSBib3gubWF4Lng7IGJveFBvaW50c1syXS55ID0gYm94Lm1heC55O1xyXG5cdFx0XHRib3hQb2ludHNbM10ueCA9IGJveC5taW4ueDsgYm94UG9pbnRzWzNdLnkgPSBib3gubWF4Lnk7XHJcblxyXG5cdFx0XHR2YXIgdjAsIHYxLCB2MjtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWN0b3IuaW5kaWNlcy5sZW5ndGg7IGkgKz0gMykge1xyXG5cdFx0XHRcdHYwID0gc2VjdG9yLnZlcnRpY2VzW3NlY3Rvci5pbmRpY2VzW2ldXTtcclxuXHRcdFx0XHR2MSA9IHNlY3Rvci52ZXJ0aWNlc1tzZWN0b3IuaW5kaWNlc1tpICsgMV1dO1xyXG5cdFx0XHRcdHYyID0gc2VjdG9yLnZlcnRpY2VzW3NlY3Rvci5pbmRpY2VzW2kgKyAyXV07XHJcblxyXG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgNDsgaisrKSB7XHJcblx0XHRcdFx0XHRpZiAoR1MuTWF0aEhlbHBlci5wb2ludEluVHJpYW5nbGUoYm94UG9pbnRzW2pdLCB2MCwgdjEsIHYyKSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2VjdG9yLnZlcnRpY2VzLmxlbmd0aCAtIDE7IGkrKykge1xyXG5cdFx0XHRcdHNlZzAuc3RhcnQuY29weShzZWN0b3IudmVydGljZXNbaV0pO1xyXG5cdFx0XHRcdHNlZzAuZW5kLmNvcHkoc2VjdG9yLnZlcnRpY2VzW2kgKyAxXSk7XHJcblx0XHRcdFx0aWYgKEdTLkxpbmVIZWxwZXIuaW50ZXJzZWN0aW9uTGluZVNlZ21lbnRCb3goc2VnMCwgYm94KSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHNlZzAuc3RhcnQuY29weShzZWN0b3IudmVydGljZXNbc2VjdG9yLnZlcnRpY2VzLmxlbmd0aCAtIDFdKTtcclxuXHRcdFx0c2VnMC5lbmQuY29weShzZWN0b3IudmVydGljZXNbMF0pO1xyXG5cdFx0XHRpZiAoR1MuTGluZUhlbHBlci5pbnRlcnNlY3Rpb25MaW5lU2VnbWVudEJveChzZWcwLCBib3gpKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH07XHJcblx0fSgpLFxyXG5cclxuXHRyZXRyaWFuZ3VsYXRlU2VjdG9yczogZnVuY3Rpb24oc2VjdG9ycykge1xyXG5cdFx0ZnVuY3Rpb24gc2VjdG9yRWRnZUNvbnRhaW5zVmVydGV4KGEsIHYpIHtcclxuXHRcdFx0dmFyIHJlc3VsdCA9IHsgZWRnZUluZGV4OiAwLCBvZmZzZXQ6IDAgfTtcclxuXHRcdFx0dmFyIGksIG9mZnNldDtcclxuXHJcblx0XHRcdGZvciAoaSA9IDA7IGkgPCBhLnZlcnRpY2VzLmxlbmd0aCAtIDE7IGkrKykge1xyXG5cdFx0XHRcdGlmIChhLnZlcnRpY2VzW2ldLmVxdWFsc0Vwc2lsb24odikgfHwgYS52ZXJ0aWNlc1tpICsgMV0uZXF1YWxzRXBzaWxvbih2KSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0b2Zmc2V0ID0gR1MuTGluZUhlbHBlci5wb2ludE9mZnNldE9uTGluZVNlZ21lbnQoeyBzdGFydDogYS52ZXJ0aWNlc1tpXSwgZW5kOiBhLnZlcnRpY2VzW2kgKyAxXSB9LCB2KTtcclxuXHRcdFx0XHRpZiAob2Zmc2V0ICE9IC0xKSB7XHJcblx0XHRcdFx0XHRyZXN1bHQuZWRnZUluZGV4ID0gaTtcclxuXHRcdFx0XHRcdHJlc3VsdC5vZmZzZXQgPSBvZmZzZXQ7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKGEudmVydGljZXNbaV0uZXF1YWxzRXBzaWxvbih2KSB8fCBhLnZlcnRpY2VzWzBdLmVxdWFsc0Vwc2lsb24odikpIHtcclxuXHRcdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xyXG5cdFx0XHR9XHJcblx0XHRcdG9mZnNldCA9IEdTLkxpbmVIZWxwZXIucG9pbnRPZmZzZXRPbkxpbmVTZWdtZW50KHsgc3RhcnQ6IGEudmVydGljZXNbaV0sIGVuZDogYS52ZXJ0aWNlc1swXSB9LCB2KTtcclxuXHRcdFx0aWYgKG9mZnNldCAhPSAtMSkge1xyXG5cdFx0XHRcdHJlc3VsdC5lZGdlSW5kZXggPSBpO1xyXG5cdFx0XHRcdHJlc3VsdC5vZmZzZXQgPSBvZmZzZXQ7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBlZGdlU2V0RXF1YWxzKGEsIGIpIHtcclxuXHRcdFx0cmV0dXJuIGEudmVydGV4LmVxdWFsc0Vwc2lsb24oYi52ZXJ0ZXgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIHNvcnRDb21wYXJlKGEsIGIpIHtcclxuXHRcdFx0cmV0dXJuIGIub2Zmc2V0IC0gYS5vZmZzZXQ7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0U2VjdG9yRWRnZUluZGV4KGEsIHN0YXJ0LCBlbmQpIHtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhLnZlcnRpY2VzLmxlbmd0aCAtIDE7IGkrKykge1xyXG5cdFx0XHRcdGlmIChhLnZlcnRpY2VzW2ldLmVxdWFsc0Vwc2lsb24oc3RhcnQpICYmIGEudmVydGljZXNbaSArIDFdLmVxdWFsc0Vwc2lsb24oZW5kKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChhLnZlcnRpY2VzW2ldLmVxdWFsc0Vwc2lsb24oc3RhcnQpICYmIGEudmVydGljZXNbMF0uZXF1YWxzRXBzaWxvbihlbmQpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIC0xO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGFkZFZlcnRpY2VzVG9TZWN0b3IoYSwgdikge1xyXG5cdFx0XHR2YXIgZWRnZUluZGV4ID0gZ2V0U2VjdG9yRWRnZUluZGV4KGEsIHYuZWRnZVN0YXJ0LCB2LmVkZ2VFbmQpO1xyXG5cdFx0XHRpZiAoZWRnZUluZGV4ICE9IC0xKSB7XHJcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2LnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRhLnZlcnRpY2VzLnNwbGljZShlZGdlSW5kZXggKyAxLCAwLCB2LnZlcnRpY2VzW2ldKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgc2VjdG9yRWRnZXMgPSBbXTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2VjdG9ycy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgZWRnZXMgPSBbXTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBzZWN0b3JzW2ldLnZlcnRpY2VzLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0ZWRnZXMucHVzaChuZXcgR1MuU2V0KFtdLCBlZGdlU2V0RXF1YWxzKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0c2VjdG9yRWRnZXMucHVzaChlZGdlcyk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gYWRkVmVydGljZXMoYUluZGV4LCBiSW5kZXgpIHtcclxuXHRcdFx0dmFyIGEgPSBzZWN0b3JzW2FJbmRleF07XHJcblx0XHRcdHZhciBiID0gc2VjdG9yc1tiSW5kZXhdO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBiLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIHJlc3VsdCA9IHNlY3RvckVkZ2VDb250YWluc1ZlcnRleChhLCBiLnZlcnRpY2VzW2ldKTtcclxuXHRcdFx0XHRpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHZhciBlZGdlcyA9IHNlY3RvckVkZ2VzW2FJbmRleF07XHJcblx0XHRcdFx0XHRlZGdlc1tyZXN1bHQuZWRnZUluZGV4XS5hZGQoe1xyXG5cdFx0XHRcdFx0XHR2ZXJ0ZXg6IGIudmVydGljZXNbaV0sXHJcblx0XHRcdFx0XHRcdG9mZnNldDogcmVzdWx0Lm9mZnNldCxcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2VjdG9ycy5sZW5ndGggLSAxOyBpKyspIHtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IGkgKyAxOyBqIDwgc2VjdG9ycy5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdGlmIChpICE9IGopIHtcclxuXHRcdFx0XHRcdGFkZFZlcnRpY2VzKGksIGopO1xyXG5cdFx0XHRcdFx0YWRkVmVydGljZXMoaiwgaSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHRcdFxyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2VjdG9ycy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgdG9BZGQgPSBbXTtcclxuXHRcdFx0dmFyIG4gPSBzZWN0b3JzW2ldLnZlcnRpY2VzLmxlbmd0aDtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBuOyBqKyspIHtcclxuXHRcdFx0XHR2YXIgbmV3UG9pbnRzID0gc2VjdG9yRWRnZXNbaV1bal0uZWxlbWVudHM7XHJcblx0XHRcdFx0aWYgKG5ld1BvaW50cy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0XHRuZXdQb2ludHMuc29ydChzb3J0Q29tcGFyZSk7XHJcblx0XHRcdFx0XHR2YXIgaXRlbSA9IHsgdmVydGljZXM6IFtdLCBlZGdlU3RhcnQ6IHNlY3RvcnNbaV0udmVydGljZXNbal0sIGVkZ2VFbmQ6IHNlY3RvcnNbaV0udmVydGljZXNbKGogPT0gbiAtIDEpID8gMCA6IChqICsgMSldIH07XHJcblx0XHRcdFx0XHRmb3IgKHZhciBrID0gMDsgayA8IG5ld1BvaW50cy5sZW5ndGg7IGsrKykge1xyXG5cdFx0XHRcdFx0XHRpdGVtLnZlcnRpY2VzLnB1c2gobmV3UG9pbnRzW2tdLnZlcnRleCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR0b0FkZC5wdXNoKGl0ZW0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCB0b0FkZC5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdGFkZFZlcnRpY2VzVG9TZWN0b3Ioc2VjdG9yc1tpXSwgdG9BZGRbal0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgdmVydGljZXMgPSB0aGlzLnZlY3RvcjJUb1ZlcnRleEFycmF5KHNlY3RvcnNbaV0udmVydGljZXMpO1xyXG5cdFx0XHRpZiAodGhpcy5hcmVWZXJ0aWNlc0Nsb2Nrd2lzZSh2ZXJ0aWNlcykpIHtcclxuXHRcdFx0XHR0aGlzLnJldmVyc2VWZXJ0aWNlcyh2ZXJ0aWNlcyk7XHJcblx0XHRcdH1cclxuXHRcdFx0c2VjdG9yc1tpXS52ZXJ0aWNlcyA9IHRoaXMudmVydGV4VG9WZWN0b3IyQXJyYXkodmVydGljZXMpO1xyXG5cdFx0XHRzZWN0b3JzW2ldLmluZGljZXMgPSBQb2x5Sy5Ucmlhbmd1bGF0ZSh2ZXJ0aWNlcyk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0cmV0cmlhbmd1bGF0ZVNlZ21lbnRzOiBmdW5jdGlvbihzZWdtZW50cykge1xyXG5cdFx0ZnVuY3Rpb24gcmlnaHRTaWRlQ29tcGFyZShhLCBiKSB7XHJcblx0XHRcdHJldHVybiBiIC0gYTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBsZWZ0U2lkZUNvbXBhcmUoYSwgYikge1xyXG5cdFx0XHRyZXR1cm4gYSAtIGI7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gYWRkVmVydGljZXMoc2VnLCBlbmRQb2ludCwgY29tcGFyZSkge1xyXG5cdFx0XHR2YXIgcG9pbnRzID0gbmV3IEdTLlNldCgpO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWdtZW50cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciBzID0gc2VnbWVudHNbaV07XHJcblx0XHRcdFx0aWYgKHMgPT09IHNlZykge1xyXG5cdFx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmICghcy5zdGFydC5lcXVhbHNFcHNpbG9uKGVuZFBvaW50KSAmJiAhcy5lbmQuZXF1YWxzRXBzaWxvbihlbmRQb2ludCkpIHtcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKHMudG9wWSA8IHNlZy50b3BZICYmIHMudG9wWSA+IHNlZy5ib3R0b21ZKSB7XHJcblx0XHRcdFx0XHRwb2ludHMuYWRkKHMudG9wWSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmIChzLmJvdHRvbVkgPCBzZWcudG9wWSAmJiBzLmJvdHRvbVkgPiBzZWcuYm90dG9tWSkge1xyXG5cdFx0XHRcdFx0cG9pbnRzLmFkZChzLmJvdHRvbVkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKHBvaW50cy5lbGVtZW50cy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdFx0cG9pbnRzLmVsZW1lbnRzLnNvcnQoY29tcGFyZSk7XHJcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBwb2ludHMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdHNlZy52ZXJ0aWNlcy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKGVuZFBvaW50LngsIHBvaW50cy5lbGVtZW50c1tpXSwgZW5kUG9pbnQueSkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0cmV0dXJuIHBvaW50cy5lbGVtZW50cy5sZW5ndGg7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWdtZW50cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgc2VnID0gc2VnbWVudHNbaV07XHJcblxyXG5cdFx0XHRpZiAoc2VnLnR5cGUgPT09IEdTLlNlZ21lbnRUeXBlcy5UVlNjcmVlbiB8fCBzZWcudHlwZSA9PT0gR1MuU2VnbWVudFR5cGVzLlN3aXRjaCkge1xyXG5cdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzZWcuaW5kaWNlcyA9IFswLCAxLCAyXTtcclxuXHJcblx0XHRcdHNlZy52ZXJ0aWNlcyA9IFtcclxuXHRcdFx0XHRuZXcgVEhSRUUuVmVjdG9yMyhzZWcuc3RhcnQueCwgc2VnLnRvcFksIHNlZy5zdGFydC55KSxcclxuXHRcdFx0XHRuZXcgVEhSRUUuVmVjdG9yMyhzZWcuZW5kLngsIHNlZy50b3BZLCBzZWcuZW5kLnkpLFxyXG5cdFx0XHRdO1xyXG5cclxuXHRcdFx0dmFyIG4gPSBhZGRWZXJ0aWNlcyhzZWcsIHNlZy5lbmQsIHJpZ2h0U2lkZUNvbXBhcmUpO1xyXG5cdFx0XHRpZiAobiA+IDApIHtcclxuXHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IG47IGorKykge1xyXG5cdFx0XHRcdFx0c2VnLmluZGljZXMucHVzaCgwKTtcclxuXHRcdFx0XHRcdHNlZy5pbmRpY2VzLnB1c2goaiArIDIpO1xyXG5cdFx0XHRcdFx0c2VnLmluZGljZXMucHVzaChqICsgMyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzZWcudmVydGljZXMucHVzaChuZXcgVEhSRUUuVmVjdG9yMyhzZWcuZW5kLngsIHNlZy5ib3R0b21ZLCBzZWcuZW5kLnkpKTtcclxuXHRcdFx0c2VnLnZlcnRpY2VzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoc2VnLnN0YXJ0LngsIHNlZy5ib3R0b21ZLCBzZWcuc3RhcnQueSkpO1xyXG5cclxuXHRcdFx0dmFyIG0gPSBzZWcudmVydGljZXMubGVuZ3RoIC0gMjtcclxuXHRcdFx0biA9IGFkZFZlcnRpY2VzKHNlZywgc2VnLnN0YXJ0LCBsZWZ0U2lkZUNvbXBhcmUpO1xyXG5cdFx0XHRpZiAobiA+IDApIHtcclxuXHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IG47IGorKykge1xyXG5cdFx0XHRcdFx0c2VnLmluZGljZXMucHVzaChtKTtcclxuXHRcdFx0XHRcdHNlZy5pbmRpY2VzLnB1c2gobSArIGogKyAxKTtcclxuXHRcdFx0XHRcdHNlZy5pbmRpY2VzLnB1c2gobSArIGogKyAyKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0c2VnLmluZGljZXMucHVzaChtKTtcclxuXHRcdFx0c2VnLmluZGljZXMucHVzaChtICsgbiArIDEpO1xyXG5cdFx0XHRzZWcuaW5kaWNlcy5wdXNoKDApO1xyXG5cclxuXHRcdFx0c2VnLmJvdHRvbVJpZ2h0SW5kZXggPSBtO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdC8vIGh0dHA6Ly93d3cuZW1hbnVlbGVmZXJvbmF0by5jb20vMjAxMy8xMC8yNC9nZXQtc2ltcGxlci1wb2x5Z29ucy1ieS1yZW1vdmluZy1jb2xsaW5lYXItcG9pbnRzL1xyXG5cdGRldHJpYW5ndWxhdGVTZWN0b3JzOiBmdW5jdGlvbihzZWN0b3JzKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNlY3RvcnMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIHNlY3RvciA9IHNlY3RvcnNbaV07XHJcblx0XHRcdHZhciBwb2ludHMgPSBbIHNlY3Rvci52ZXJ0aWNlc1swXSBdO1xyXG5cdFx0XHR2YXIgbiA9IHNlY3Rvci52ZXJ0aWNlcy5sZW5ndGg7XHJcblxyXG5cdFx0XHRmb3IgKHZhciBqID0gMTsgaiA8IG47IGorKykge1xyXG5cdFx0XHRcdGlmIChqIDwgbiAtIDEpIHtcclxuXHRcdFx0XHRcdGlmICghR1MuTGluZUhlbHBlci5hcmVQb2ludHNDb2xsaW5lYXIoc2VjdG9yLnZlcnRpY2VzW2ogLSAxXSwgc2VjdG9yLnZlcnRpY2VzW2pdLCBzZWN0b3IudmVydGljZXNbaiArIDFdKSkge1xyXG5cdFx0XHRcdFx0XHRwb2ludHMucHVzaChzZWN0b3IudmVydGljZXNbal0pO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRwb2ludHMucHVzaChzZWN0b3IudmVydGljZXNbal0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHZlcnRpY2VzID0gdGhpcy52ZWN0b3IyVG9WZXJ0ZXhBcnJheShwb2ludHMpO1xyXG5cdFx0XHRpZiAodGhpcy5hcmVWZXJ0aWNlc0Nsb2Nrd2lzZSh2ZXJ0aWNlcykpIHtcclxuXHRcdFx0XHR0aGlzLnJldmVyc2VWZXJ0aWNlcyh2ZXJ0aWNlcyk7XHJcblx0XHRcdH1cdFx0XHRcclxuXHRcdFx0c2VjdG9yLmNvbGxpc2lvblZlcnRpY2VzID0gdGhpcy52ZXJ0ZXhUb1ZlY3RvcjJBcnJheSh2ZXJ0aWNlcyk7XHJcblx0XHRcdHNlY3Rvci5jb2xsaXNpb25JbmRpY2VzID0gUG9seUsuVHJpYW5ndWxhdGUodmVydGljZXMpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzk5MzkwNzEvMzY0MDQ4OVxyXG5cdGdldFNlY3RvckNlbnRyb2lkOiBmdW5jdGlvbihzZWN0b3IpIHtcclxuXHRcdHZhciB0d2ljZWFyZWEgPSAwLCB4ID0gMCwgeSA9IDAsIG5QdHMgPSBzZWN0b3IudmVydGljZXMubGVuZ3RoLCBwMSwgcDIsIGY7XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0UG9pbnQobikge1x0XHRcclxuXHRcdFx0aWYgKG4gPT09IHNlY3Rvci52ZXJ0aWNlcy5sZW5ndGgpIHtcclxuXHRcdFx0XHRuID0gMDtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gc2VjdG9yLnZlcnRpY2VzW25dO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwLCBqID0gblB0cyAtIDE7IGkgPCBuUHRzOyBqID0gaSsrKSB7XHJcblx0XHRcdHAxID0gZ2V0UG9pbnQoaSk7XHJcblx0XHRcdHAyID0gZ2V0UG9pbnQoaik7XHJcblx0XHRcdGYgPSBwMS54ICogcDIueSAtIHAyLnggKiBwMS55O1xyXG5cdFx0XHR0d2ljZWFyZWEgKz0gZjtcclxuXHRcdFx0eCArPSAocDEueCArIHAyLngpICogZjtcclxuXHRcdFx0eSArPSAocDEueSArIHAyLnkpICogZjtcclxuXHRcdH1cclxuXHRcdGYgPSB0d2ljZWFyZWEgKiAzO1xyXG5cclxuXHRcdHJldHVybiBuZXcgVEhSRUUuVmVjdG9yMih4L2YsIHkvZik7XHJcblx0fSxcclxufTtcclxuXHJcbkdTLkdyYXBoID0gZnVuY3Rpb24oZXF1YWxzRnVuYykge1xyXG5cdHRoaXMuZXF1YWxzRnVuYyA9IGVxdWFsc0Z1bmMgfHwgZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYSA9PSBiOyB9O1xyXG5cclxuXHR0aGlzLnZlcnRpY2VzID0gW107XHJcblx0dGhpcy5lZGdlcyA9IFtdO1xyXG59O1xyXG5cclxuR1MuR3JhcGgucHJvdG90eXBlID0ge1xyXG5cdGFkZEVkZ2U6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHtcclxuXHRcdGlmICh0aGlzLmVxdWFsc0Z1bmMoc3RhcnQsIGVuZCkpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZWRnZXMucHVzaCh7XHJcblx0XHRcdHN0YXJ0OiB0aGlzLmFkZFZlcnRleChzdGFydCksXHJcblx0XHRcdGVuZDogdGhpcy5hZGRWZXJ0ZXgoZW5kKSxcclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdHJlbW92ZUVkZ2U6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHtcclxuXHRcdGlmICh0aGlzLmVxdWFsc0Z1bmMoc3RhcnQsIGVuZCkpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdGZ1bmN0aW9uIGVxdWFscyhhLCBiKSB7XHJcblx0XHRcdHJldHVybiAodGhhdC5lcXVhbHNGdW5jKGEuc3RhcnQsIGIuc3RhcnQpICYmIHRoYXQuZXF1YWxzRnVuYyhhLmVuZCwgYi5lbmQpIHx8XHJcblx0XHRcdFx0XHR0aGF0LmVxdWFsc0Z1bmMoYS5lbmQsIGIuc3RhcnQpICYmIHRoYXQuZXF1YWxzRnVuYyhhLnN0YXJ0LCBiLmVuZCkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBlZGdlID0geyBzdGFydDogc3RhcnQsIGVuZDogZW5kIH07XHJcblx0XHRmb3IgKHZhciBpID0gdGhpcy5lZGdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHRpZiAoZXF1YWxzKGVkZ2UsIHRoaXMuZWRnZXNbaV0pKSB7XHJcblx0XHRcdFx0dGhpcy5lZGdlcy5zcGxpY2UoaSwgMSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhZGRWZXJ0ZXg6IGZ1bmN0aW9uKHZlcnRleCkge1xyXG5cdFx0dmFyIHJlc3VsdCA9IHRoaXMudmVydGV4RXhpc3RzKHZlcnRleCk7XHJcblx0XHRpZiAocmVzdWx0ID4gLTEpIHtcclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH1cclxuXHRcdHRoaXMudmVydGljZXMucHVzaCh2ZXJ0ZXgpO1xyXG5cdFx0cmV0dXJuIHRoaXMudmVydGljZXMubGVuZ3RoIC0gMTtcclxuXHR9LFxyXG5cclxuXHR2ZXJ0ZXhFeGlzdHM6IGZ1bmN0aW9uKHZlcnRleCkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmICh0aGlzLmVxdWFsc0Z1bmModGhpcy52ZXJ0aWNlc1tpXSwgdmVydGV4KSkge1xyXG5cdFx0XHRcdHJldHVybiBpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gLTE7XHJcblx0fSxcclxuXHJcblx0Ly8gRmxveWQtV2Fyc2hhbGw6IGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmxveWQlRTIlODAlOTNXYXJzaGFsbF9hbGdvcml0aG1cclxuXHRjb21wdXRlU2hvcnRlc3RQYXRoczogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgZGlzdCA9IFtdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGRpc3RbaV0gPSBbXTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0ZGlzdFtpXS5wdXNoKEluZmluaXR5KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0dGhpcy5kaXN0ID0gZGlzdDtcclxuXHJcblx0XHR2YXIgbmV4dCA9IFtdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdG5leHRbaV0gPSBbXTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0bmV4dFtpXS5wdXNoKG51bGwpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLm5leHQgPSBuZXh0O1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52ZXJ0aWNlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRkaXN0W2ldW2ldID0gMDtcclxuXHRcdH1cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lZGdlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgZWRnZSA9IHRoaXMuZWRnZXNbaV07XHJcblx0XHRcdGRpc3RbZWRnZS5zdGFydF1bZWRnZS5lbmRdID0gMTtcclxuXHRcdFx0ZGlzdFtlZGdlLmVuZF1bZWRnZS5zdGFydF0gPSAxO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuaW5pdE5leHRBcnJheSgpO1xyXG5cclxuXHRcdGZvciAodmFyIGsgPSAwOyBrIDwgdGhpcy52ZXJ0aWNlcy5sZW5ndGg7IGsrKykge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRcdGlmIChkaXN0W2ldW2tdICsgZGlzdFtrXVtqXSA8IGRpc3RbaV1bal0pIHtcclxuXHRcdFx0XHRcdFx0ZGlzdFtpXVtqXSA9IGRpc3RbaV1ba10gKyBkaXN0W2tdW2pdO1xyXG5cdFx0XHRcdFx0XHRuZXh0W2ldW2pdID0gbmV4dFtrXVtqXTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRpbml0TmV4dEFycmF5OiBmdW5jdGlvbigpIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52ZXJ0aWNlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHRpZiAoaSA9PSBqIHx8IHRoaXMuZGlzdFtpXVtqXSA9PSBJbmZpbml0eSkge1xyXG5cdFx0XHRcdFx0dGhpcy5uZXh0W2ldW2pdID0gMDtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5uZXh0W2ldW2pdID0gaTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRQYXRoOiBmdW5jdGlvbihpLCBqKSB7XHJcblx0XHRpZiAoaSA9PSBqKSB7XHJcblx0XHRcdHJldHVybiBbXTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcGF0aCA9IHRoaXMuY29uc3RydWN0UGF0aChpLCBqKTtcclxuXHRcdGlmIChwYXRoICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0cGF0aC51bnNoaWZ0KGkpO1xyXG5cdFx0XHRwYXRoLnB1c2goaik7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcGF0aDtcclxuXHR9LFxyXG5cclxuXHRjb25zdHJ1Y3RQYXRoOiBmdW5jdGlvbihpLCBqKSB7XHJcblx0XHRpZiAodGhpcy5kaXN0W2ldW2pdID09IEluZmluaXR5KSB7XHJcblx0XHRcdHJldHVybiB1bmRlZmluZWQ7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGludGVybWVkaWF0ZSA9IHRoaXMubmV4dFtpXVtqXTtcclxuXHRcdGlmIChpbnRlcm1lZGlhdGUgPT0gaSkge1xyXG5cdFx0XHRyZXR1cm4gW107XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR2YXIgcHJldiA9IHRoaXMuY29uc3RydWN0UGF0aChpLCBpbnRlcm1lZGlhdGUpO1xyXG5cdFx0XHR2YXIgcGF0aCA9IFtpbnRlcm1lZGlhdGVdO1xyXG5cdFx0XHR2YXIgbmV4dCA9IHRoaXMuY29uc3RydWN0UGF0aChpbnRlcm1lZGlhdGUsIGopO1xyXG5cdFx0XHRpZiAocHJldiAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0Zm9yICh2YXIgaSA9IHByZXYubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuXHRcdFx0XHRcdHBhdGgudW5zaGlmdChwcmV2W2ldKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKG5leHQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbmV4dC5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0cGF0aC5wdXNoKG5leHRbaV0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gcGF0aDtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRjb21wdXRlVmVydGV4TmVpZ2hib3JTZXRzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBuZWlnaGJvclNldHMgPSBbXTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIHYgPSB0aGlzLnZlcnRpY2VzW2ldO1xyXG5cdFx0XHR2YXIgbmVpZ2hib3JzID0gbmV3IEdTLlNldCgpO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmVkZ2VzLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0dmFyIGVkZ2UgPSB0aGlzLmVkZ2VzW2pdO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5lcXVhbHNGdW5jKHYsIHRoaXMudmVydGljZXNbZWRnZS5zdGFydF0pKSB7XHJcblx0XHRcdFx0XHRuZWlnaGJvcnMuYWRkKHRoaXMudmVydGljZXNbZWRnZS5lbmRdKTtcclxuXHRcdFx0XHR9IGVsc2VcclxuXHRcdFx0XHRpZiAodGhpcy5lcXVhbHNGdW5jKHYsIHRoaXMudmVydGljZXNbZWRnZS5lbmRdKSkge1xyXG5cdFx0XHRcdFx0bmVpZ2hib3JzLmFkZCh0aGlzLnZlcnRpY2VzW2VkZ2Uuc3RhcnRdKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG5laWdoYm9yU2V0cy5wdXNoKG5laWdoYm9ycyk7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5uZWlnaGJvclNldHMgPSBuZWlnaGJvclNldHM7XHJcblx0fSxcclxuXHJcblx0Ly8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Ccm9uJUUyJTgwJTkzS2VyYm9zY2hfYWxnb3JpdGhtXHJcblx0Y29tcHV0ZU1heGltYWxDbGlxdWVzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdHRoaXMubWF4aW1hbENsaXF1ZXMgPSBbXTtcclxuXHRcdHRoaXMuY29tcHV0ZVZlcnRleE5laWdoYm9yU2V0cygpO1xyXG5cclxuXHRcdGZ1bmN0aW9uIGJyb25LZXJib3NjaChSLCBQLCBYKSB7XHJcblx0XHRcdGlmIChQLmVsZW1lbnRzLmxlbmd0aCA9PT0gMCAmJiBYLmVsZW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHRcdHRoYXQubWF4aW1hbENsaXF1ZXMucHVzaChSKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IFAuZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgdiA9IFAuZWxlbWVudHNbaV07XHJcblx0XHRcdFx0dmFyIE4gPSB0aGF0Lm5laWdoYm9yU2V0c1t2XTtcclxuXHRcdFx0XHRicm9uS2VyYm9zY2goUi5jbG9uZSgpLmFkZCh2KSwgUC5jbG9uZSgpLmludGVyc2VjdGlvbihOKSwgWC5jbG9uZSgpLmludGVyc2VjdGlvbihOKSk7XHJcblx0XHRcdFx0UC5yZW1vdmUodik7XHJcblx0XHRcdFx0WC5hZGQodik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgUiA9IG5ldyBHUy5TZXQodW5kZWZpbmVkLCB0aGlzLmVxdWFsc0Z1bmMpO1xyXG5cdFx0dmFyIFAgPSBuZXcgR1MuU2V0KHRoaXMudmVydGljZXMsIHRoaXMuZXF1YWxzRnVuYyk7XHJcblx0XHR2YXIgWCA9IG5ldyBHUy5TZXQodW5kZWZpbmVkLCB0aGlzLmVxdWFsc0Z1bmMpO1xyXG5cdFx0YnJvbktlcmJvc2NoKFIsIFAsIFgpO1xyXG5cclxuXHRcdHRoaXMubWF4aW1hbENsaXF1ZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XHJcblx0XHRcdHJldHVybiBhLmxlbmd0aCAtIGIubGVuZ3RoO1xyXG5cdFx0fSk7XHJcblx0fSxcclxuXHJcblx0Z2V0VmVydGV4SW5kZXg6IGZ1bmN0aW9uKHZlcnRleCkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmICh0aGlzLmVxdWFsc0Z1bmModGhpcy52ZXJ0aWNlc1tpXSwgdmVydGV4KSkge1xyXG5cdFx0XHRcdHJldHVybiBpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gLTE7XHJcblx0fSxcclxufTtcclxuXHJcbkdTLlBsYW5hckdyYXBoID0gZnVuY3Rpb24oKSB7XHJcblx0R1MuR3JhcGguY2FsbCh0aGlzKTtcclxuXHJcblx0dmFyIGVwc2lsb24gPSAwLjAwMDE7XHJcblx0dGhpcy5lcXVhbHNGdW5jID0gZnVuY3Rpb24oYSwgYikge1xyXG5cdFx0cmV0dXJuIChNYXRoLmFicyhhLnggLSBiLngpIDwgZXBzaWxvbiAmJlxyXG5cdFx0XHRcdE1hdGguYWJzKGEueSAtIGIueSkgPCBlcHNpbG9uKTtcclxuXHR9O1xyXG59O1xyXG5cclxuR1MuUGxhbmFyR3JhcGgucHJvdG90eXBlID0gR1MuaW5oZXJpdChHUy5HcmFwaCwge1xyXG5cdGNvbXB1dGVNaW5pbXVtQ3ljbGVCYXNpczogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmNvbXB1dGVBbGxDeWNsZXMoKTtcclxuXHJcblx0XHRpZiAodGhpcy5jeWNsZXMubGVuZ3RoID4gMTAwKSB7XHJcblx0XHRcdGNvbnNvbGUubG9nKFwiY3ljbGUgY291bnQgPiAxMDA7IHVzaW5nIGhvcnRvblwiKTtcclxuXHRcdFx0dGhpcy5zZWxlY3RDeWNsZXNIb3J0b24oKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuc2VsZWN0Q3ljbGVzTm9uT3ZlcmxhcHBpbmcoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRjb21wdXRlQWxsQ3ljbGVzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdHZhciBjeWNsZXMgPSBbXTtcclxuXHJcblx0XHRmdW5jdGlvbiBpbkN5Y2xlcyhjeWNsZSkge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGN5Y2xlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdGlmIChjeWNsZXNbaV0uZXF1YWxzKGN5Y2xlKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBlcXVhbHMoYSwgYikge1xyXG5cdFx0XHRyZXR1cm4gKGEuc3RhcnQgPT0gYi5zdGFydCAmJiBhLmVuZCA9PSBiLmVuZCB8fFxyXG5cdFx0XHRcdFx0YS5lbmQgPT0gYi5zdGFydCAmJiBiLmVuZCA9PSBhLnN0YXJ0KTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBmcm9tUGF0aFNldChzZXQpIHtcclxuXHRcdFx0dmFyIGEgPSBuZXcgR1MuU2V0KHVuZGVmaW5lZCwgZXF1YWxzKTtcclxuXHRcdFx0dmFyIGUgPSBzZXQuZWxlbWVudHM7XHJcblx0XHRcdHZhciBuID0gZS5sZW5ndGg7XHJcblxyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG4gLSAxOyBpKyspIHtcclxuXHRcdFx0XHRhLmFkZCh7IHN0YXJ0OiBlW2ldLCBlbmQ6IGVbaSArIDFdIH0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGEuYWRkKHsgc3RhcnQ6IGVbbiAtIDFdLCBlbmQ6IGVbMF0gfSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gYTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dmFyIHBhdGgwID0gbmV3IEdTLlNldCgpO1xyXG5cdFx0dmFyIHBhdGgxID0gbmV3IEdTLlNldCgpO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52ZXJ0aWNlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuZWRnZXMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHR2YXIgZWRnZSA9IHRoaXMuZWRnZXNbal07XHJcblx0XHRcdFx0cGF0aDAuZWxlbWVudHMgPSB0aGlzLmdldFBhdGgoZWRnZS5zdGFydCwgaSkgfHwgW107XHJcblx0XHRcdFx0cGF0aDEuZWxlbWVudHMgPSB0aGlzLmdldFBhdGgoaSwgZWRnZS5lbmQpIHx8IFtdO1xyXG5cclxuXHRcdFx0XHR2YXIgaXQgPSBwYXRoMC5pbnRlcnNlY3Rpb24ocGF0aDEpO1xyXG5cdFx0XHRcdGlmIChpdC5lbGVtZW50cy5sZW5ndGggPT0gMSAmJiBpdC5lbGVtZW50c1swXSA9PSBpKSB7XHJcblx0XHRcdFx0XHR2YXIgY3ljbGUgPSBmcm9tUGF0aFNldChwYXRoMC51bmlvbihwYXRoMSkpO1xyXG5cdFx0XHRcdFx0Y3ljbGUuYWRkKGVkZ2UpO1xyXG5cdFx0XHRcdFx0aWYgKCFpbkN5Y2xlcyhjeWNsZSkpIHtcclxuXHRcdFx0XHRcdFx0Y3ljbGVzLnB1c2goY3ljbGUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGN5Y2xlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcclxuXHRcdFx0dmFyIHdlaWdodEEgPSB0aGF0LmdldEN5Y2xlV2VpZ2h0KGEpO1xyXG5cdFx0XHR2YXIgd2VpZ2h0QiA9IHRoYXQuZ2V0Q3ljbGVXZWlnaHQoYik7XHJcblx0XHRcdHJldHVybiB3ZWlnaHRBIC0gd2VpZ2h0QjtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuY3ljbGVzID0gY3ljbGVzO1xyXG5cdH0sXHJcblxyXG5cdGdldEN5Y2xlV2VpZ2h0OiBmdW5jdGlvbihjeWNsZSkge1xyXG5cdFx0cmV0dXJuIGN5Y2xlLmVsZW1lbnRzLmxlbmd0aDtcclxuXHR9LFxyXG5cclxuXHQvLyBodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vdS83MDU5OTkvcG9seWZpbmRlci9pbmRleC5odG1sXHJcblx0cG9pbnRJbkN5Y2xlOiBmdW5jdGlvbihwLCBjeWNsZSkge1xyXG5cdFx0dmFyIHYgPSB0aGlzLnZlcnRpY2VzO1xyXG5cdFx0dmFyIGlkeCA9IGN5Y2xlLmVsZW1lbnRzO1xyXG5cdFx0dmFyIG4gPSBpZHgubGVuZ3RoIC0gMTtcclxuXHRcdHZhciBjID0gZmFsc2U7XHJcblxyXG5cdFx0dmFyIGksIGogPSAwO1xyXG5cdFx0Zm9yIChpID0gMCwgaiA9IG4gLSAxOyBpIDwgbjsgaiA9IGkrKykge1xyXG5cdFx0XHR2YXIgc3RhcnQgPSB2W2lkeFtpXS5zdGFydF07XHJcblx0XHRcdHZhciBlbmQgPSB2W2lkeFtqXS5zdGFydF07XHJcblxyXG5cdFx0XHRpZiAoKChzdGFydC55ID4gcC55KSAhPSAoZW5kLnkgPiBwLnkpKSAmJlxyXG5cdFx0XHRcdChwLnggPCAoZW5kLnggLSBzdGFydC54KSAqIChwLnkgLSBzdGFydC55KSAvIChlbmQueSAtIHN0YXJ0LnkpICsgc3RhcnQueCkpIHtcclxuXHRcdFx0XHRjID0gIWM7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gYztcclxuXHR9LFxyXG5cclxuXHRjeWNsZXNPdmVybGFwOiBmdW5jdGlvbihhLCBiKSB7XHJcblx0XHR2YXIgY2VudGVyID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBlZGdlc0EgPSBhLmRpZmZlcmVuY2UoYikuZWxlbWVudHM7XHJcblx0XHR2YXIgdiA9IHRoaXMudmVydGljZXM7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBlZGdlc0EubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIGVkZ2UgPSBlZGdlc0FbaV07XHJcblx0XHRcdGNlbnRlci54ID0gKHZbZWRnZS5zdGFydF0ueCArIHZbZWRnZS5lbmRdLngpIC8gMjtcclxuXHRcdFx0Y2VudGVyLnkgPSAodltlZGdlLnN0YXJ0XS55ICsgdltlZGdlLmVuZF0ueSkgLyAyO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMucG9pbnRJbkN5Y2xlKGNlbnRlciwgYikpIHtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBlZGdlc0IgPSBiLmRpZmZlcmVuY2UoYSkuZWxlbWVudHM7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBlZGdlc0IubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIGVkZ2UgPSBlZGdlc0JbaV07XHJcblx0XHRcdGNlbnRlci54ID0gKHZbZWRnZS5zdGFydF0ueCArIHZbZWRnZS5lbmRdLngpIC8gMjtcclxuXHRcdFx0Y2VudGVyLnkgPSAodltlZGdlLnN0YXJ0XS55ICsgdltlZGdlLmVuZF0ueSkgLyAyO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMucG9pbnRJbkN5Y2xlKGNlbnRlciwgYSkpIHtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9LFx0XHJcblxyXG5cdHNlbGVjdEN5Y2xlc05vbk92ZXJsYXBwaW5nOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBuID0gdGhpcy5jeWNsZXMubGVuZ3RoO1xyXG5cclxuXHRcdHZhciBncmFwaCA9IG5ldyBHUy5HcmFwaCgpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHtcclxuXHRcdFx0Z3JhcGguYWRkVmVydGV4KGkpO1xyXG5cdFx0fVxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBuIC0gMTsgaSsrKSB7XHJcblx0XHRcdGZvciAodmFyIGogPSBpICsgMTsgaiA8IG47IGorKykge1xyXG5cdFx0XHRcdGdyYXBoLmFkZEVkZ2UoaSwgaik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG4gLSAxOyBpKyspIHtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IGkgKyAxOyBqIDwgbjsgaisrKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuY3ljbGVzT3ZlcmxhcCh0aGlzLmN5Y2xlc1tpXSwgdGhpcy5jeWNsZXNbal0pKSB7XHJcblx0XHRcdFx0XHRncmFwaC5yZW1vdmVFZGdlKGksIGopO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGdyYXBoLmNvbXB1dGVNYXhpbWFsQ2xpcXVlcygpO1xyXG5cdFx0aWYgKGdyYXBoLm1heGltYWxDbGlxdWVzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0dGhpcy5taW5pbXVtQ3ljbGVCYXNpcyA9IGdyYXBoLm1heGltYWxDbGlxdWVzWzBdLmVsZW1lbnRzO1xyXG5cdFx0fVx0XHRcclxuXHR9LFxyXG5cclxuXHQvLyBodHRwOi8vcHJvbG9nLmhpbC51bmIuY2E6ODA4MC94bWx1aS9iaXRzdHJlYW0vaGFuZGxlLzE4ODIvMzA4MDcvVFI4NC0wMjYucGRmP3NlcXVlbmNlPTFcclxuXHRzZWxlY3RDeWNsZXNIb3J0b246IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG0gPSB0aGlzLmN5Y2xlcy5sZW5ndGg7XHJcblx0XHR2YXIgbiA9IHRoaXMuZWRnZXMubGVuZ3RoO1xyXG5cclxuXHRcdHZhciBtYXRyaXggPSBuZXcgR1MuTWF0cml4KG0sIG4pO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbTsgaSsrKSB7XHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgbjsgaisrKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuY3ljbGVzW2ldLmVsZW1FeGlzdHModGhpcy5lZGdlc1tqXSkpIHtcclxuXHRcdFx0XHRcdG1hdHJpeC5tYXRyaXhbaV1bal0gPSAxO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdG1hdHJpeC5iaW5hcnlHYXVzc2lhbkVsaW1pbmF0aW9uKCk7XHJcblx0XHR0aGlzLm1pbmltdW1DeWNsZUJhc2lzID0gbWF0cml4LmdldE5vblplcm9Sb3dJbmRpY2VzKCk7XHJcblx0fSxcclxuXHJcblx0cmVtb3ZlTm9uQ3ljbGVFZGdlczogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLm5vbkN5Y2xlVmVydGljZXMgPSBbXTtcclxuXHRcdGZvciAodmFyIGkgPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcblx0XHRcdHZhciBleGlzdHMgPSBmYWxzZTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmN5Y2xlcy5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdHZhciBjeWNsZSA9IHRoaXMuY3ljbGVzW2pdO1xyXG5cdFx0XHRcdGlmIChjeWNsZS5lbGVtRXhpc3RzKGkpKSB7XHJcblx0XHRcdFx0XHRleGlzdHMgPSB0cnVlO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmICghZXhpc3RzKSB7XHJcblx0XHRcdFx0dGhpcy5ub25DeWNsZVZlcnRpY2VzLnB1c2goaSk7XHJcblx0XHRcdFx0Zm9yICh2YXIgaiA9IHRoaXMuZWRnZXMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pIHtcclxuXHRcdFx0XHRcdHZhciBlZGdlID0gdGhpcy5lZGdlc1tqXTtcclxuXHRcdFx0XHRcdGlmIChlZGdlLnN0YXJ0ID09IGkgfHwgZWRnZS5lbmQgPT0gaSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmVkZ2VzLnNwbGljZShqLCAxKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn0pO1xyXG5cclxuR1MuU2V0ID0gZnVuY3Rpb24oc291cmNlLCBlcXVhbHNGdW5jKSB7XHJcblx0dGhpcy5lcXVhbHNGdW5jID0gZXF1YWxzRnVuYyB8fCBmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhID09IGI7IH07XHJcblx0dGhpcy5lbGVtZW50cyA9IChzb3VyY2UgIT09IHVuZGVmaW5lZCkgPyBzb3VyY2UgOiBbXTtcclxufTtcclxuXHJcbkdTLlNldC5wcm90b3R5cGUgPSB7XHJcblx0YWRkOiBmdW5jdGlvbihlbGVtKSB7XHJcblx0XHRpZiAoIXRoaXMuZWxlbUV4aXN0cyhlbGVtKSkge1xyXG5cdFx0XHR0aGlzLmVsZW1lbnRzLnB1c2goZWxlbSk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9LFxyXG5cclxuXHRyZW1vdmU6IGZ1bmN0aW9uKGVsZW0pIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRpZiAodGhpcy5lcXVhbHNGdW5jKHRoaXMuZWxlbWVudHNbaV0sIGVsZW0pKSB7XHJcblx0XHRcdFx0dGhpcy5lbGVtZW50cy5zcGxpY2UoaSwgMSk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH0sXHJcblxyXG5cdGVsZW1FeGlzdHM6IGZ1bmN0aW9uKGVsZW0pIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRpZiAodGhpcy5lcXVhbHNGdW5jKHRoaXMuZWxlbWVudHNbaV0sIGVsZW0pKSB7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9LFxyXG5cclxuXHRpbnRlcnNlY3Rpb246IGZ1bmN0aW9uKHNldCkge1xyXG5cdFx0dmFyIGVsZW1lbnRzID0gc2V0LmVsZW1lbnRzO1xyXG5cdFx0dmFyIGl0ID0gW107XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBlbGVtZW50cy5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdGlmICh0aGlzLmVxdWFsc0Z1bmModGhpcy5lbGVtZW50c1tpXSwgZWxlbWVudHNbal0pKSB7XHJcblx0XHRcdFx0XHRpdC5wdXNoKHRoaXMuZWxlbWVudHNbaV0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG5ldyBHUy5TZXQoaXQsIHRoaXMuZXF1YWxzRnVuYyk7XHJcblx0fSxcclxuXHJcblx0dW5pb246IGZ1bmN0aW9uKHNldCkge1xyXG5cdFx0dmFyIHVuID0gbmV3IEdTLlNldCh0aGlzLmVsZW1lbnRzLnNsaWNlKCksIHRoaXMuZXF1YWxzRnVuYyk7XHJcblx0XHR2YXIgZWxlbWVudHMgPSBzZXQuZWxlbWVudHM7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHVuLmFkZChlbGVtZW50c1tpXSk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdW47XHJcblx0fSxcclxuXHJcblx0ZGlmZmVyZW5jZTogZnVuY3Rpb24oc2V0KSB7XHJcblx0XHR2YXIgZGlmZiA9IFtdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmICghc2V0LmVsZW1FeGlzdHModGhpcy5lbGVtZW50c1tpXSkpIHtcclxuXHRcdFx0XHRkaWZmLnB1c2godGhpcy5lbGVtZW50c1tpXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBuZXcgR1MuU2V0KGRpZmYsIHRoaXMuZXF1YWxzRnVuYyk7XHJcblx0fSxcclxuXHJcblx0ZXF1YWxzOiBmdW5jdGlvbihzZXQpIHtcclxuXHRcdHZhciBkaWZmMSA9IHRoaXMuZGlmZmVyZW5jZShzZXQpO1xyXG5cdFx0dmFyIGRpZmYyID0gc2V0LmRpZmZlcmVuY2UodGhpcyk7XHJcblx0XHRyZXR1cm4gZGlmZjEuZWxlbWVudHMubGVuZ3RoID09PSAwICYmIGRpZmYyLmVsZW1lbnRzLmxlbmd0aCA9PT0gMDtcclxuXHR9LFxyXG5cclxuXHRjbG9uZTogZnVuY3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gbmV3IEdTLlNldCh0aGlzLmVsZW1lbnRzLnNsaWNlKCksIHRoaXMuZXF1YWxzRnVuYyk7XHJcblx0fSxcclxufTtcclxuXHJcbkdTLk1hdHJpeCA9IGZ1bmN0aW9uKG0sIG4pIHtcdFxyXG5cdHZhciBtYXRyaXggPSBbXTtcclxuXHRmb3IgKHZhciBpID0gMDsgaSA8IG07IGkrKykge1xyXG5cdFx0bWF0cml4W2ldID0gW107XHJcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IG47IGorKykge1xyXG5cdFx0XHRtYXRyaXhbaV0ucHVzaCgwKTtcclxuXHRcdH1cclxuXHR9XHJcblx0dGhpcy5tYXRyaXggPSBtYXRyaXg7XHJcblx0dGhpcy5yb3dDb3VudCA9IG07XHJcblx0dGhpcy5jb2x1bW5Db3VudCA9IG47XHJcbn07XHJcblxyXG5HUy5NYXRyaXgucHJvdG90eXBlID0ge1xyXG5cdC8vIGh0dHA6Ly93d3cuY3MudW1kLmVkdS9+Z2FzYXJjaC9UT1BJQ1MvZmFjdG9yaW5nL2Zhc3RnYXVzcy5wZGZcclxuXHRiaW5hcnlHYXVzc2lhbkVsaW1pbmF0aW9uOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdHZhciBhZGRSb3cgPSBmdW5jdGlvbihyMCwgcjEpIHtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGF0LmNvbHVtbkNvdW50OyBpKyspIHtcclxuXHRcdFx0XHR0aGF0Lm1hdHJpeFtyMF1baV0gPSB0aGF0Lm1hdHJpeFtyMF1baV0gXiB0aGF0Lm1hdHJpeFtyMV1baV07XHJcblx0XHRcdH1cclxuXHRcdH07XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJvd0NvdW50OyBpKyspIHtcclxuXHRcdFx0dmFyIGZvdW5kID0gZmFsc2U7XHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5jb2x1bW5Db3VudDsgaisrKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMubWF0cml4W2ldW2pdID09IDEpIHtcclxuXHRcdFx0XHRcdGZvdW5kID0gdHJ1ZTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVx0XHRcdFxyXG5cdFx0XHRpZiAoZm91bmQpIHtcclxuXHRcdFx0XHRmb3IgKHZhciBrID0gMDsgayA8IHRoaXMucm93Q291bnQ7IGsrKykge1xyXG5cdFx0XHRcdFx0aWYgKGsgIT0gaSkge1xyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5tYXRyaXhba11bal0gPT0gMSkge1xyXG5cdFx0XHRcdFx0XHRcdGFkZFJvdyhrLCBpKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGNsZWFyOiBmdW5jdGlvbih2YWx1ZSkge1xyXG5cdFx0dmFsdWUgPSB2YWx1ZSB8fCAwO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJvd0NvdW50OyBpKyspIHtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmNvbHVtbkNvdW50OyBqKyspIHtcclxuXHRcdFx0XHR0aGlzLm1hdHJpeFtpXVtqXSA9IHZhbHVlOyBcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGdldE5vblplcm9Sb3dJbmRpY2VzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciByb3dJbmRpY2VzID0gW107XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucm93Q291bnQ7IGkrKykge1xyXG5cdFx0XHR2YXIgbm9uWmVybyA9IGZhbHNlO1xyXG5cdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuY29sdW1uQ291bnQ7IGorKykge1xyXG5cdFx0XHRcdGlmICh0aGlzLm1hdHJpeFtpXVtqXSA+IDApIHtcclxuXHRcdFx0XHRcdG5vblplcm8gPSB0cnVlO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChub25aZXJvKSB7XHJcblx0XHRcdFx0cm93SW5kaWNlcy5wdXNoKGkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcm93SW5kaWNlcztcclxuXHR9LFxyXG5cclxuXHR0b1N0cmluZzogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgc3RyID0gXCJcIjtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yb3dDb3VudDsgaSsrKSB7XHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5jb2x1bW5Db3VudDsgaisrKSB7XHJcblx0XHRcdFx0c3RyICs9IHRoaXMubWF0cml4W2ldW2pdICsgXCIgXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0c3RyICs9IFwiXFxuXCI7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gc3RyO1xyXG5cdH0sXHJcbn07IiwiR1MuUmVib3VuZCA9IGZ1bmN0aW9uKGtleWJpbmRzKSB7XG5cdHRoaXMua2V5YmluZHMgPSBrZXliaW5kcztcblxuXHR0aGlzLm1vZGlmeWluZ0tleWJpbmQgPSBmYWxzZTtcblxuXHR0aGlzLm9uTW9kaWZ5aW5nS2V5YmluZFN0YXJ0ID0gZnVuY3Rpb24oKSB7fTtcblx0dGhpcy5vbk1vZGlmeWluZ0tleWJpbmRTdG9wID0gZnVuY3Rpb24oKSB7fTtcbn1cblxuR1MuUmVib3VuZC5wcm90b3R5cGUgPSB7XG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xuXHRcdHZhciB0aGF0ID0gdGhpcztcblxuXHRcdCQoZG9jdW1lbnQpLm9uKFwia2V5ZG93bi5rZXliaW5kVXNlXCIsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdGlmICh0aGF0Lm1vZGlmeWluZ0tleWJpbmQpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIga2V5YmluZCA9IF8uZmluZCh0aGF0LmtleWJpbmRzLCB7IGNvZGU6IGUua2V5Q29kZSB9KTtcblx0XHRcdGlmIChrZXliaW5kKSB7XG5cdFx0XHRcdGtleWJpbmQuaW5Vc2UgPSB0cnVlO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQkKGRvY3VtZW50KS5vbihcImtleXVwLmtleWJpbmRVc2VcIiwgZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKHRoYXQubW9kaWZ5aW5nS2V5YmluZCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHZhciBrZXliaW5kID0gXy5maW5kKHRoYXQua2V5YmluZHMsIHsgY29kZTogZS5rZXlDb2RlIH0pO1xuXHRcdFx0aWYgKGtleWJpbmQpIHtcblx0XHRcdFx0a2V5YmluZC5pblVzZSA9IGZhbHNlO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQkKGRvY3VtZW50KS5vbihcIm1vdXNlZG93bi5rZXliaW5kVXNlXCIsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdGlmICh0aGF0Lm1vZGlmeWluZ0tleWJpbmQpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIga2V5YmluZCA9IF8uZmluZCh0aGF0LmtleWJpbmRzLCB7IG1vdXNlOiB0cnVlLCBidXR0b246IGUud2hpY2ggfSk7XG5cdFx0XHRpZiAoa2V5YmluZCkge1xuXHRcdFx0XHRrZXliaW5kLmluVXNlID0gdHJ1ZTtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0JChkb2N1bWVudCkub24oXCJtb3VzZXVwLmtleWJpbmRVc2VcIiwgZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKHRoYXQubW9kaWZ5aW5nS2V5YmluZCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHZhciBrZXliaW5kID0gXy5maW5kKHRoYXQua2V5YmluZHMsIHsgbW91c2U6IHRydWUsIGJ1dHRvbjogZS53aGljaCB9KTtcblx0XHRcdGlmIChrZXliaW5kKSB7XG5cdFx0XHRcdGtleWJpbmQuaW5Vc2UgPSBmYWxzZTtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9LFxuXG5cdGdldEtleWJpbmRCeUFjdGlvbk5hbWU6IGZ1bmN0aW9uKGFjdGlvbk5hbWUpIHtcblx0XHRyZXR1cm4gXy5maW5kKHRoaXMua2V5YmluZHMsIHsgYWN0aW9uTmFtZTogYWN0aW9uTmFtZSB9KTtcblx0fSxcblxuXHRtb2RpZnlLZXliaW5kOiBmdW5jdGlvbihrZXliaW5kKSB7XG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xuXG5cdFx0aWYgKHRoaXMubW9kaWZ5aW5nS2V5YmluZCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHRoaXMubW9kaWZ5aW5nS2V5YmluZCA9IHRydWU7XG5cdFx0dGhpcy5vbk1vZGlmeWluZ0tleWJpbmRTdGFydCh7IGtleWJpbmQ6IGtleWJpbmQgfSk7XG5cblx0XHQkKGRvY3VtZW50KS5vbihcImtleWRvd24ubW9kaWZ5S2V5YmluZFwiLCBmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgY29kZSA9IGUua2V5Q29kZSB8fCBlLndoaWNoO1xuXHRcdFx0JChkb2N1bWVudCkub2ZmKFwia2V5ZG93bi5tb2RpZnlLZXliaW5kXCIpO1xuXHRcdFx0JChkb2N1bWVudCkub2ZmKFwibW91c2Vkb3duLm1vZGlmeUtleWJpbmRcIik7XG5cblx0XHRcdHZhciBvayA9IHRoYXQuY2hhbmdlS2V5KGtleWJpbmQsIGUpO1xuXHRcdFx0dGhhdC5tb2RpZnlpbmdLZXliaW5kID0gZmFsc2U7XG5cdFx0XHR0aGF0Lm9uTW9kaWZ5aW5nS2V5YmluZFN0b3AoeyBrZXliaW5kOiBrZXliaW5kLCBzdWNjZXNzOiBvayB9KTtcblxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH0pO1xuXG5cdFx0JChkb2N1bWVudCkub24oXCJtb3VzZWRvd24ubW9kaWZ5S2V5YmluZFwiLCBmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgY29kZSA9IGUua2V5Q29kZSB8fCBlLndoaWNoO1xuXHRcdFx0JChkb2N1bWVudCkub2ZmKFwia2V5ZG93bi5tb2RpZnlLZXliaW5kXCIpO1xuXHRcdFx0JChkb2N1bWVudCkub2ZmKFwibW91c2Vkb3duLm1vZGlmeUtleWJpbmRcIik7XG5cblx0XHRcdHZhciBvayA9IHRoYXQuY2hhbmdlTW91c2Uoa2V5YmluZCwgZSk7XG5cdFx0XHR0aGF0Lm1vZGlmeWluZ0tleWJpbmQgPSBmYWxzZTtcblx0XHRcdHRoYXQub25Nb2RpZnlpbmdLZXliaW5kU3RvcCh7IGtleWJpbmQ6IGtleWJpbmQsIHN1Y2Nlc3M6IG9rIH0pO1xuXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSk7XG5cdH0sXG5cblx0Y2hhbmdlS2V5OiBmdW5jdGlvbihrZXliaW5kLCBlKSB7XG5cdFx0dmFyIG5hbWUgPSB0aGlzLmlzS2V5QWxsb3dlZChlKTtcblx0XHRpZiAoIW5hbWUpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHR2YXIgY29kZSA9IGUua2V5Q29kZTtcblx0XHR2YXIgZXhpc3RpbmcgPSBfLmZpbmQodGhpcy5rZXliaW5kcywgeyBjb2RlOiBjb2RlIH0pO1xuXG5cdFx0aWYgKGV4aXN0aW5nKSB7XG5cdFx0XHRleGlzdGluZy5jb2RlID0gdW5kZWZpbmVkO1xuXHRcdFx0ZXhpc3RpbmcubW91c2UgPSB1bmRlZmluZWQ7XG5cdFx0XHRleGlzdGluZy5idXR0b24gPSB1bmRlZmluZWQ7XG5cdFx0XHRleGlzdGluZy5jb250cm9sTmFtZSA9IFwiTk9UIEJPVU5EXCI7XG5cdFx0fVxuXG5cdFx0a2V5YmluZC5jb2RlID0gY29kZTtcblx0XHRrZXliaW5kLm1vdXNlID0gdW5kZWZpbmVkO1xuXHRcdGtleWJpbmQuYnV0dG9uID0gdW5kZWZpbmVkO1xuXHRcdGtleWJpbmQuY29udHJvbE5hbWUgPSBuYW1lO1xuXG5cdFx0cmV0dXJuIHRydWU7XG5cdH0sXG5cblx0Y2hhbmdlTW91c2U6IGZ1bmN0aW9uKGtleWJpbmQsIGUpIHtcblx0XHR2YXIgbmFtZTtcblxuXHRcdGlmIChlLndoaWNoID09PSAxKSB7XG5cdFx0XHRuYW1lID0gXCJNT1VTRSBMRUZUXCI7XG5cdFx0fSBlbHNlXG5cdFx0aWYgKGUud2hpY2ggPT09IDIpIHtcblx0XHRcdG5hbWUgPSBcIk1PVVNFIE1JRERMRVwiO1xuXHRcdH1cblx0XHQvLyBlbHNlXG5cdFx0Ly8gaWYgKGUud2hpY2ggPT09IDMpIHtcblx0XHQvLyBcdG5hbWUgPSBcIk1PVVNFIFJJR0hUXCI7XG5cdFx0Ly8gfVxuXG5cdFx0aWYgKCFuYW1lKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0dmFyIGV4aXN0aW5nID0gXy5maW5kKHRoaXMua2V5YmluZHMsIHsgbW91c2U6IHRydWUsIGJ1dHRvbjogZS53aGljaCB9KTtcblxuXHRcdGlmIChleGlzdGluZykge1xuXHRcdFx0ZXhpc3RpbmcuY29kZSA9IHVuZGVmaW5lZDtcblx0XHRcdGV4aXN0aW5nLm1vdXNlID0gdW5kZWZpbmVkO1xuXHRcdFx0ZXhpc3RpbmcuYnV0dG9uID0gdW5kZWZpbmVkO1xuXHRcdFx0ZXhpc3RpbmcuY29udHJvbE5hbWUgPSBcIk5PVCBCT1VORFwiO1xuXHRcdH1cblxuXHRcdGtleWJpbmQuY29kZSA9IHVuZGVmaW5lZDtcblx0XHRrZXliaW5kLm1vdXNlID0gdHJ1ZTtcblx0XHRrZXliaW5kLmJ1dHRvbiA9IGUud2hpY2g7XG5cdFx0a2V5YmluZC5jb250cm9sTmFtZSA9IG5hbWU7XG5cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fSxcblxuXHRpc0tleUFsbG93ZWQ6IGZ1bmN0aW9uKGUpIHtcblx0XHQvLyBBLVosIGEtelxuXHRcdGlmIChlLmtleUNvZGUgPj0gNjUgJiYgZS5rZXlDb2RlIDw9IDkwKSB7XG5cdFx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShlLmtleUNvZGUpO1xuXHRcdH1cblxuXHRcdC8vIDAtOVxuXHRcdGlmIChlLmtleUNvZGUgPj0gNDggJiYgZS5rZXlDb2RlIDw9IDU3KSB7XG5cdFx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShlLmtleUNvZGUpO1xuXHRcdH1cblxuXHRcdC8vIGFycm93c1xuXHRcdGlmIChlLmtleUNvZGUgPj0gMzcgJiYgZS5rZXlDb2RlIDw9IDQwKSB7XG5cdFx0XHRyZXR1cm4gZS5vcmlnaW5hbEV2ZW50LmtleUlkZW50aWZpZXIudG9VcHBlckNhc2UoKTtcblx0XHR9XG5cblx0XHQvLyBzaGlmdCwgY29udHJvbCwgYWx0XG5cdFx0aWYgKGUua2V5Q29kZSA+PSAxNiAmJiBlLmtleUNvZGUgPD0gMTgpIHtcblx0XHRcdHJldHVybiBlLm9yaWdpbmFsRXZlbnQua2V5SWRlbnRpZmllci50b1VwcGVyQ2FzZSgpO1xuXHRcdH1cblxuXHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XG5cdFx0XHRjYXNlIDMyOlxuXHRcdFx0XHRyZXR1cm4gXCJTUEFDRVwiO1xuXHRcdFx0Y2FzZSAxMzpcblx0XHRcdFx0cmV0dXJuIFwiRU5URVJcIjtcblx0XHRcdC8vIGNhc2UgOTpcblx0XHRcdC8vIFx0cmV0dXJuIFwiVEFCXCI7XG5cdFx0XHRjYXNlIDg6XG5cdFx0XHRcdHJldHVybiBcIkJBQ0tTUEFDRVwiO1xuXHRcdFx0Y2FzZSA5MTpcblx0XHRcdGNhc2UgOTM6XG5cdFx0XHRcdHJldHVybiBcIkNPTU1BTkRcIjtcblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn07IiwiR1MuVGV4dElucHV0ID0gZnVuY3Rpb24oYnV0dG9uKSB7XG5cdHRoaXMudGV4dEJ1dHRvbiA9IGJ1dHRvbjtcblxuXHR0aGlzLm1vZGlmeWluZ1RleHQgPSBmYWxzZTtcblxuXHR0aGlzLm9uTW9kaWZ5aW5nVGV4dFN0YXJ0ID0gZnVuY3Rpb24oKSB7fTtcblx0dGhpcy5vbk1vZGlmeWluZ1RleHRTdG9wID0gZnVuY3Rpb24oKSB7fTtcbn1cblxuR1MuVGV4dElucHV0LnByb3RvdHlwZSA9IHtcblx0aW5pdDogZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xuXG5cdFx0JChkb2N1bWVudCkub24oXCJrZXlkb3duLmtleWJpbmRVc2VcIiwgZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKHRoYXQubW9kaWZ5aW5nVGV4dCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHZhciBrZXliaW5kID0gXy5maW5kKHRoYXQua2V5YmluZHMsIHsgY29kZTogZS5rZXlDb2RlIH0pO1xuXHRcdFx0aWYgKGtleWJpbmQpIHtcblx0XHRcdFx0a2V5YmluZC5pblVzZSA9IHRydWU7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdCQoZG9jdW1lbnQpLm9uKFwia2V5dXAua2V5YmluZFVzZVwiLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAodGhhdC5tb2RpZnlpbmdUZXh0KSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dmFyIGtleWJpbmQgPSBfLmZpbmQodGhhdC5rZXliaW5kcywgeyBjb2RlOiBlLmtleUNvZGUgfSk7XG5cdFx0XHRpZiAoa2V5YmluZCkge1xuXHRcdFx0XHRrZXliaW5kLmluVXNlID0gZmFsc2U7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdCQoZG9jdW1lbnQpLm9uKFwibW91c2Vkb3duLmtleWJpbmRVc2VcIiwgZnVuY3Rpb24oZSkge1xuXHRcdFx0aWYgKHRoYXQubW9kaWZ5aW5nVGV4dCkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHZhciBrZXliaW5kID0gXy5maW5kKHRoYXQua2V5YmluZHMsIHsgbW91c2U6IHRydWUsIGJ1dHRvbjogZS53aGljaCB9KTtcblx0XHRcdGlmIChrZXliaW5kKSB7XG5cdFx0XHRcdGtleWJpbmQuaW5Vc2UgPSB0cnVlO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQkKGRvY3VtZW50KS5vbihcIm1vdXNldXAua2V5YmluZFVzZVwiLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAodGhhdC5tb2RpZnlpbmdUZXh0KSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dmFyIGtleWJpbmQgPSBfLmZpbmQodGhhdC5rZXliaW5kcywgeyBtb3VzZTogdHJ1ZSwgYnV0dG9uOiBlLndoaWNoIH0pO1xuXHRcdFx0aWYgKGtleWJpbmQpIHtcblx0XHRcdFx0a2V5YmluZC5pblVzZSA9IGZhbHNlO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0sXG5cblx0Z2V0S2V5YmluZEJ5QWN0aW9uTmFtZTogZnVuY3Rpb24oYWN0aW9uTmFtZSkge1xuXHRcdHJldHVybiBfLmZpbmQodGhpcy5rZXliaW5kcywgeyBhY3Rpb25OYW1lOiBhY3Rpb25OYW1lIH0pO1xuXHR9LFxuXG5cdG1vZGlmeVRleHQ6IGZ1bmN0aW9uKGJ1dHRvbikge1xuXHRcdHZhciB0aGF0ID0gdGhpcztcblxuXHRcdGlmICh0aGlzLm1vZGlmeWluZ1RleHQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLm1vZGlmeWluZ1RleHQgPSB0cnVlO1xuICAgIGJ1dHRvbi50ZXh0ID0gJyc7XG5cdFx0dGhpcy5vbk1vZGlmeWluZ1RleHRTdGFydCh7IGJ1dHRvbjogYnV0dG9uIH0pO1xuXG5cdFx0JChkb2N1bWVudCkub24oXCJrZXlkb3duLm1vZGlmeVRleHRcIiwgZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyIGNvZGUgPSBlLmtleUNvZGUgfHwgZS53aGljaDtcblxuICAgICAgaWYgKGNvZGUgPT09IDEzKSB7XG5cdFx0XHQgICQoZG9jdW1lbnQpLm9mZihcImtleWRvd24ubW9kaWZ5VGV4dFwiKTtcbiAgICAgICAgdGhhdC5tb2RpZnlpbmdUZXh0ID0gZmFsc2U7XG4gICAgICAgIHRoYXQub25Nb2RpZnlpbmdUZXh0U3RvcCh7IGJ1dHRvbjogYnV0dG9uLCBzdWNjZXNzOiB0cnVlIH0pO1xuICAgICAgICByZXR1cm5cbiAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gOCkge1xuICAgICAgICBidXR0b24udGV4dCA9IChidXR0b24udGV4dCB8fCBcIlwiKS5zdWJzdHJpbmcoMCwgYnV0dG9uLnRleHQubGVuZ3RoIC0gMSk7XG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgdmFyIG9rID0gdGhhdC5jaGFuZ2VUZXh0KGJ1dHRvbiwgZSk7XG5cbiAgICAgIH1cblxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH0pO1xuXHR9LFxuXG5cdGNoYW5nZVRleHQ6IGZ1bmN0aW9uKGJ1dHRvbiwgZSkge1xuXHRcdHZhciBuYW1lID0gdGhpcy5pc0tleUFsbG93ZWQoZSk7XG5cdFx0aWYgKCFuYW1lKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgYnV0dG9uLnRleHQgKz0gbmFtZVxuXG5cdFx0cmV0dXJuIHRydWU7XG5cdH0sXG5cblx0aXNLZXlBbGxvd2VkOiBmdW5jdGlvbihlKSB7XG5cdFx0Ly8gQS1aLCBhLXpcblx0XHRpZiAoZS5rZXlDb2RlID49IDY1ICYmIGUua2V5Q29kZSA8PSA5MCkge1xuXHRcdFx0cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKTtcblx0XHR9XG5cblx0XHQvLyAwLTlcblx0XHRpZiAoZS5rZXlDb2RlID49IDQ4ICYmIGUua2V5Q29kZSA8PSA1Nykge1xuXHRcdFx0cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKTtcblx0XHR9XG5cblx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0Y2FzZSAzMjpcblx0XHRcdFx0cmV0dXJuIFwiIFwiO1xuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufTtcbiIsIkdTLkRlYnVnVUkgPSB7XHJcblx0Zm9udFNpemU6IDI0LFxyXG5cdG1heFRlbXBMaW5lczogNSxcclxuXHRkZWZhdWx0VGltZW91dDogR1MubXNUb0ZyYW1lcyg1MDAwKSxcclxuXHJcblx0b3ZlcmxheU1hcmdpbjogMTAsXHJcblx0b3ZlcmxheVBhZGRpbmc6IDUsXHJcblx0b3ZlcmxheVdpZHRoOiAwLFxyXG5cdG92ZXJsYXlIZWlnaHQ6IDAsXHRcclxuXHRvdmVybGF5WDogMCxcclxuXHRvdmVybGF5WTogMCxcclxuXHJcblx0dmlzaWJsZVN0YXRpY0xpbmVzOiAwLFxyXG5cclxuXHRzdGF0aWNMaW5lczoge30sXHJcblx0dGVtcExpbmVzOiBbXSxcclxuXHR2YWx1ZVRyYWNraW5nOiB7fSxcclxuXHJcblx0aGFzQ2hhbmdlZDogZmFsc2UsXHJcblxyXG5cdF92aXNpYmxlOiBmYWxzZSxcclxuXHRzZXQgdmlzaWJsZSh2YWx1ZSkge1xyXG5cdFx0dGhpcy5fdmlzaWJsZSA9IHZhbHVlO1xyXG5cdFx0aWYgKCF2YWx1ZSAmJiB0aGlzLmN0eCkge1xyXG5cdFx0XHR0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGdldCB2aXNpYmxlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Zpc2libGU7XHJcblx0fSxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5taW5XaWR0aCA9IDEyODA7XHJcblx0XHR0aGlzLm1pbkhlaWdodCA9IDcyMDtcclxuXHJcblx0XHR0aGlzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcblx0XHR0aGlzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuXHJcblx0XHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCBmdW5jdGlvbigpIHsgdGhhdC5vblJlc2l6ZSgpOyB9LCBmYWxzZSk7XHRcdFxyXG5cclxuXHRcdHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xyXG5cdFx0Y2FudmFzLmlkID0gXCJkZWJ1Zy11aS1jYW52YXNcIjtcclxuXHRcdGNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XHJcblx0XHRjYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XHJcblx0XHRjYW52YXMuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZ2JhKDAsIDAsIDAsIDApXCI7XHJcblx0XHRjYW52YXMuc3R5bGUuekluZGV4ID0gMTAwO1xyXG5cdFx0dGhpcy5jYW52YXMgPSBjYW52YXM7XHJcblxyXG5cdFx0dmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblx0XHRjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xyXG5cdFx0Y3R4LnNhdmUoKTtcclxuXHRcdHRoaXMuY3R4ID0gY3R4O1xyXG5cdFx0dGhpcy51cGRhdGVGb250KCk7XHJcblx0XHRcclxuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jYW52YXMpO1xyXG5cclxuXHRcdHRoaXMub25SZXNpemUoKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGhhc0NoYW5nZWQgPSBmYWxzZTtcclxuXHRcdGZvciAodmFyIGkgPSB0aGlzLnRlbXBMaW5lcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHR2YXIgbGluZSA9IHRoaXMudGVtcExpbmVzW2ldO1xyXG5cdFx0XHRsaW5lLnRpbWVvdXQtLTtcclxuXHRcdFx0aWYgKGxpbmUudGltZW91dCA9PT0gMCkge1xyXG5cdFx0XHRcdHRoaXMudGVtcExpbmVzLnNwbGljZShpLCAxKTtcclxuXHRcdFx0XHR0aGlzLmhhc0NoYW5nZWQgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuaGFzQ2hhbmdlZCkge1xyXG5cdFx0XHR0aGlzLmNhbGN1bGF0ZU92ZXJsYXlDb29yZHMoKTtcclxuXHRcdFx0dGhpcy5kcmF3KCk7XHJcblx0XHRcdHRoaXMuaGFzQ2hhbmdlZCA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGRyYXc6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKCF0aGlzLl92aXNpYmxlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG5cclxuXHRcdGlmICh0aGlzLnZpc2libGVTdGF0aWNMaW5lcyA+IDAgfHwgdGhpcy50ZW1wTGluZXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHR0aGlzLmN0eC5zYXZlKCk7XHJcblxyXG5cdFx0XHR0aGlzLmN0eC5maWxsU3R5bGUgPSBcInJnYmEoMCwgMCwgMCwgMC41KVwiO1xyXG5cdFx0XHR0aGlzLmN0eC5maWxsUmVjdCh0aGlzLm92ZXJsYXlYLCB0aGlzLm92ZXJsYXlZLCB0aGlzLm92ZXJsYXlXaWR0aCwgdGhpcy5vdmVybGF5SGVpZ2h0KTtcclxuXHRcdFx0dGhpcy5jdHguZmlsbFN0eWxlID0gXCIjZmZmXCI7XHJcblxyXG5cdFx0XHR2YXIgeSA9IHRoaXMub3ZlcmxheVkgKyB0aGlzLm92ZXJsYXlQYWRkaW5nO1xyXG5cdFx0XHRmb3IgKHZhciBpIGluIHRoaXMuc3RhdGljTGluZXMpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5zdGF0aWNMaW5lc1tpXS52aXNpYmxlKSB7XHJcblx0XHRcdFx0XHR0aGlzLmN0eC5maWxsVGV4dCh0aGlzLnN0YXRpY0xpbmVzW2ldLnRleHQsIHRoaXMub3ZlcmxheVggKyB0aGlzLm92ZXJsYXlQYWRkaW5nLCB5KTtcclxuXHRcdFx0XHRcdHkgKz0gdGhpcy5mb250U2l6ZSArIHRoaXMub3ZlcmxheVBhZGRpbmc7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGVtcExpbmVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0dGhpcy5jdHguZmlsbFRleHQodGhpcy50ZW1wTGluZXNbaV0udGV4dCwgdGhpcy5vdmVybGF5WCArIHRoaXMub3ZlcmxheVBhZGRpbmcsIHkpO1xyXG5cdFx0XHRcdHkgKz0gdGhpcy5mb250U2l6ZSArIHRoaXMub3ZlcmxheVBhZGRpbmc7XHRcdFx0XHRcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5jdHgucmVzdG9yZSgpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZUZvbnQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jdHguZm9udCA9IHRoaXMuZm9udFNpemUgKyBcInB4ICdMdWNpZGEgQ29uc29sZScsIE1vbmFjbywgbW9ub3NwYWNlXCI7XHJcblx0XHR0aGlzLmN0eC50ZXh0QmFzZWxpbmUgPSBcInRvcFwiO1xyXG5cdH0sXHJcblxyXG5cdGNhbGN1bGF0ZU92ZXJsYXlDb29yZHM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5vdmVybGF5V2lkdGggPSAwO1xyXG5cdFx0dGhpcy52aXNpYmxlU3RhdGljTGluZXMgPSAwO1xyXG5cclxuXHRcdGZvciAodmFyIGkgaW4gdGhpcy5zdGF0aWNMaW5lcykge1xyXG5cdFx0XHRpZiAodGhpcy5zdGF0aWNMaW5lc1tpXS52aXNpYmxlKSB7XHJcblx0XHRcdFx0dGhpcy52aXNpYmxlU3RhdGljTGluZXMrKztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMub3ZlcmxheUhlaWdodCA9ICh0aGlzLnZpc2libGVTdGF0aWNMaW5lcyArIHRoaXMudGVtcExpbmVzLmxlbmd0aCkgKiAodGhpcy5mb250U2l6ZSArIHRoaXMub3ZlcmxheVBhZGRpbmcpICsgdGhpcy5vdmVybGF5UGFkZGluZztcclxuXHJcblx0XHQvLyBsb3dlciByaWdodFxyXG5cdFx0Ly8gdGhpcy5vdmVybGF5WCA9IHRoaXMud2lkdGggLSB0aGlzLm92ZXJsYXlXaWR0aCAtIHRoaXMub3ZlcmxheU1hcmdpbjtcclxuXHRcdC8vIHRoaXMub3ZlcmxheVkgPSB0aGlzLmhlaWdodCAtIHRoaXMub3ZlcmxheUhlaWdodCAtIHRoaXMub3ZlcmxheU1hcmdpbjtcclxuXHJcblx0XHQvLyB1cHBlciBsZWZ0XHJcblx0XHR0aGlzLm92ZXJsYXlYID0gdGhpcy5vdmVybGF5TWFyZ2luO1xyXG5cdFx0dGhpcy5vdmVybGF5WSA9IHRoaXMub3ZlcmxheU1hcmdpbjtcclxuXHJcblx0XHRmb3IgKHZhciBpIGluIHRoaXMuc3RhdGljTGluZXMpIHtcclxuXHRcdFx0aWYgKHRoaXMuc3RhdGljTGluZXNbaV0udmlzaWJsZSkge1xyXG5cdFx0XHRcdHRoaXMub3ZlcmxheVdpZHRoID0gTWF0aC5tYXgodGhpcy5vdmVybGF5V2lkdGgsIHRoaXMuY3R4Lm1lYXN1cmVUZXh0KHRoaXMuc3RhdGljTGluZXNbaV0udGV4dCkud2lkdGggKyB0aGlzLm92ZXJsYXlQYWRkaW5nICogMik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGVtcExpbmVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHRoaXMub3ZlcmxheVdpZHRoID0gTWF0aC5tYXgodGhpcy5vdmVybGF5V2lkdGgsIHRoaXMuY3R4Lm1lYXN1cmVUZXh0KHRoaXMudGVtcExpbmVzW2ldLnRleHQpLndpZHRoICsgdGhpcy5vdmVybGF5UGFkZGluZyAqIDIpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHRyYWNrTnVtZXJpY1ZhbHVlOiBmdW5jdGlvbihpZCwgbnVtZXJpY1ZhbHVlKSB7XHJcblx0XHRpZiAodGhpcy52YWx1ZVRyYWNraW5nW2lkXSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMudmFsdWVUcmFja2luZ1tpZF0gPSB7fTtcclxuXHRcdFx0dGhpcy52YWx1ZVRyYWNraW5nW2lkXS5taW4gPSBJbmZpbml0eTtcclxuXHRcdFx0dGhpcy52YWx1ZVRyYWNraW5nW2lkXS5tYXggPSAtSW5maW5pdHk7XHJcblx0XHRcdHRoaXMudmFsdWVUcmFja2luZ1tpZF0uYXZnID0gMDtcclxuXHRcdFx0dGhpcy52YWx1ZVRyYWNraW5nW2lkXS5jb3VudCA9IDA7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHYgPSB0aGlzLnZhbHVlVHJhY2tpbmdbaWRdO1xyXG5cdFx0di5taW4gPSBNYXRoLm1pbih2Lm1pbiwgbnVtZXJpY1ZhbHVlKTtcclxuXHRcdHYubWF4ID0gTWF0aC5tYXgodi5tYXgsIG51bWVyaWNWYWx1ZSk7XHJcblx0XHR2LmNvdW50Kys7XHJcblx0XHR2LmF2ZyArPSAobnVtZXJpY1ZhbHVlIC0gdi5hdmcpIC8gdi5jb3VudDtcclxuXHRcdHRoaXMuc2V0U3RhdGljTGluZShpZCwgbnVtZXJpY1ZhbHVlICsgXCIgKG1pbjogXCIgKyB2Lm1pbiArIFwiLCBtYXg6IFwiICsgdi5tYXggKyBcIiwgYXZnOiBcIiArIHYuYXZnLnRvRml4ZWQoMCkgKyBcIilcIik7XHJcblx0fSxcclxuXHJcblx0c2V0U3RhdGljTGluZTogZnVuY3Rpb24oaWQsIHRleHQpIHtcclxuXHRcdHRleHQgPSBpZCArIFwiOiBcIiArIHRleHQ7XHJcblx0XHRpZiAoaWQgaW4gdGhpcy5zdGF0aWNMaW5lcykge1xyXG5cdFx0XHR0aGlzLnN0YXRpY0xpbmVzW2lkXS50ZXh0ID0gdGV4dDtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuc3RhdGljTGluZXNbaWRdID0ge1xyXG5cdFx0XHRcdHRleHQ6IHRleHQsXHJcblx0XHRcdFx0dmlzaWJsZTogdHJ1ZSxcclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHRcdHRoaXMuaGFzQ2hhbmdlZCA9IHRydWU7XHJcblx0fSxcclxuXHJcblx0cmVtb3ZlU3RhdGljTGluZTogZnVuY3Rpb24oaWQpIHtcclxuXHRcdGRlbGV0ZSB0aGlzLnN0YXRpY0xpbmVzW2lkXTtcclxuXHRcdHRoaXMuaGFzQ2hhbmdlZCA9IHRydWU7XHJcblx0fSxcclxuXHJcblx0c2V0U3RhdGljTGluZVZpc2liaWxpdHk6IGZ1bmN0aW9uKGlkLCB2YWx1ZSkge1xyXG5cdFx0aWYgKGlkIGluIHRoaXMuc3RhdGljTGluZXMpIHtcclxuXHRcdFx0dGhpcy5zdGF0aWNMaW5lc1tpZF0udmlzaWJsZSA9ICh2YWx1ZSA9PT0gdHJ1ZSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnN0YXRpY0xpbmVzW2lkXSA9IHtcclxuXHRcdFx0XHR0ZXh0OiBcIlwiLFxyXG5cdFx0XHRcdHZpc2libGU6IHZhbHVlLFxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0U3RhdGljTGluZVZpc2liaWxpdHk6IGZ1bmN0aW9uKGlkKSB7XHJcblx0XHRpZiAoaWQgaW4gdGhpcy5zdGF0aWNMaW5lcykge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5zdGF0aWNMaW5lc1tpZF0udmlzaWJsZTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhZGRUZW1wTGluZTogZnVuY3Rpb24odGV4dCwgdGltZW91dCkge1xyXG5cdFx0aWYgKHRoaXMudGVtcExpbmVzLmxlbmd0aCA9PSB0aGlzLm1heFRlbXBMaW5lcykge1xyXG5cdFx0XHR0aGlzLnRlbXBMaW5lcy5zaGlmdCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRpbWVvdXQgPSAodGltZW91dCAhPT0gdW5kZWZpbmVkKSA/IHRpbWVvdXQgOiB0aGlzLmRlZmF1bHRUaW1lb3V0O1xyXG5cdFx0dmFyIGxpbmUgPSB7XHJcblx0XHRcdHRleHQ6IHRleHQsXHJcblx0XHRcdHRpbWVvdXQ6IHRpbWVvdXQsXHJcblx0XHR9O1xyXG5cdFx0dGhpcy50ZW1wTGluZXMucHVzaChsaW5lKTtcclxuXHRcdHRoaXMuaGFzQ2hhbmdlZCA9IHRydWU7XHJcblx0fSxcclxuXHJcblx0b25SZXNpemU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy53aWR0aCA9IE1hdGgubWF4KHdpbmRvdy5pbm5lcldpZHRoLCB0aGlzLm1pbldpZHRoKTtcclxuXHRcdHRoaXMuaGVpZ2h0ID0gTWF0aC5tYXgod2luZG93LmlubmVySGVpZ2h0LCB0aGlzLm1pbkhlaWdodCk7XHJcblxyXG5cdFx0dGhpcy5jYW52YXMud2lkdGggPSB0aGlzLndpZHRoO1xyXG5cdFx0dGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XHJcblxyXG5cdFx0JCh0aGlzLmNhbnZhcykuY3NzKFwid2lkdGhcIiwgd2luZG93LmlubmVyV2lkdGggKyBcInB4XCIpLmNzcyhcImhlaWdodFwiLCB3aW5kb3cuaW5uZXJIZWlnaHQgKyBcInB4XCIpO1xyXG5cclxuXHRcdHRoaXMuY3R4LmZvbnQgPSB0aGlzLmZvbnRTaXplICsgXCJweCAnTHVjaWRhIENvbnNvbGUnLCBNb25hY28sIG1vbm9zcGFjZVwiO1xyXG5cdFx0dGhpcy5jdHgudGV4dEJhc2VsaW5lID0gXCJ0b3BcIjtcclxuXHRcdHRoaXMuZHJhdygpO1xyXG5cdH0sXHJcbn07IiwiR1MuTG9hZGluZ1VJID0gZnVuY3Rpb24oKSB7XHRcclxuXHR0aGlzLnJlZHJhdyA9IHRydWU7XHJcblx0dGhpcy5oaWRkZW4gPSB0cnVlO1xyXG5cclxuXHR0aGlzLnNwaW5uZXJPbmx5ID0gZmFsc2U7XHJcblxyXG5cdHRoaXMuc2NyZWVuSW5mbyA9IHtcclxuXHRcdHdpZHRoOiBudWxsLFxyXG5cdFx0aGVpZ2h0OiBudWxsLFxyXG5cdFx0Y2VudGVyOiBuZXcgVEhSRUUuVmVjdG9yMigpLFxyXG5cdH07XHJcblxyXG5cdHRoaXMubG9hZGluZ0JveCA9IHtcclxuXHRcdHdpZHRoOiAwLjUsXHJcblx0XHRoZWlnaHQ6IDAuMDUsXHJcblx0XHRjb250ZW50UGFkZGluZzogMC4wMDUsXHJcblx0XHR0b3BMZWZ0OiBuZXcgVEhSRUUuVmVjdG9yMigpLFxyXG5cdFx0Ym90dG9tUmlnaHQ6IG5ldyBUSFJFRS5WZWN0b3IyKCksXHJcblx0XHRjb250ZW50VG9wTGVmdDogbmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdGNvbnRlbnRCb3R0b21SaWdodDogbmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdGNvbnRlbnRDdXJyZW50Qm90dG9tUmlnaHQ6IG5ldyBUSFJFRS5WZWN0b3IyKCksXHJcblx0fTtcclxuXHJcblx0dGhpcy5wZXJjZW50TG9hZGVkID0gMDtcclxufTtcclxuXHJcbkdTLkxvYWRpbmdVSS5wcm90b3R5cGUgPSB7XHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmN2cyA9IG5ldyBHUy5DYW52YXMyZCh0cnVlKTtcclxuXHRcdHRoaXMuY3ZzLmNhbnZhc0lkID0gXCJsb2FkaW5nLWNhbnZhc1wiO1xyXG5cdFx0dGhpcy5jdnMuaW5pdCgpO1xyXG5cdFx0dGhpcy5jdnMuc2NyZWVuQ2FudmFzLnN0eWxlLnpJbmRleCA9IDUwO1xyXG5cclxuXHRcdHRoaXMub25SZXNpemUoKTtcclxuXHR9LFxyXG5cclxuXHRkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLmhpZGRlbiB8fCAhdGhpcy5yZWRyYXcpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMucmVkcmF3ID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5jdnMuY2xlYXIoKTtcclxuXHJcblx0XHRpZiAodGhpcy5zcGlubmVyT25seSkge1xyXG5cdFx0XHR0aGlzLmN2cy50ZXh0KHRoaXMuc2NyZWVuSW5mby5jZW50ZXIsIFwiSW1hZ2luZSBpdCdzIDE5OTQuLi5cIiwgXCIjZmZmXCIsIDQwLCBcIm1pZGRsZVwiLCBcImNlbnRlclwiLCBHUy5VSUZvbnQpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuY3ZzLmJveCh0aGlzLmxvYWRpbmdCb3gudG9wTGVmdCwgdGhpcy5sb2FkaW5nQm94LmJvdHRvbVJpZ2h0LCBcIiNmZmZcIiwgMyk7XHJcblx0XHRcdHRoaXMuY3ZzLmJveEZpbGwodGhpcy5sb2FkaW5nQm94LmNvbnRlbnRUb3BMZWZ0LCB0aGlzLmxvYWRpbmdCb3guY29udGVudEN1cnJlbnRCb3R0b21SaWdodCwgXCIjZmZmXCIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY3ZzLmZsaXAoKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVQcm9ncmVzczogZnVuY3Rpb24oZSkge1xyXG5cdFx0dGhpcy5wZXJjZW50TG9hZGVkID0gZS5wZXJjZW50TG9hZGVkO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZUxvYWRpbmdCb3hDb250ZW50OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB3aWR0aCA9IHRoaXMubG9hZGluZ0JveC5jb250ZW50Qm90dG9tUmlnaHQueCAtIHRoaXMubG9hZGluZ0JveC5jb250ZW50VG9wTGVmdC54O1xyXG5cdFx0dGhpcy5sb2FkaW5nQm94LmNvbnRlbnRDdXJyZW50Qm90dG9tUmlnaHQueCA9IHRoaXMubG9hZGluZ0JveC5jb250ZW50VG9wTGVmdC54ICsgTWF0aC5mbG9vcih3aWR0aCAqIHRoaXMucGVyY2VudExvYWRlZCAqIDAuMDEpO1xyXG5cclxuXHRcdHRoaXMucmVkcmF3ID0gdHJ1ZTtcclxuXHR9LFxyXG5cclxuXHRzaG93OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuY3ZzLnNob3coKTtcclxuXHRcdHRoaXMuaGlkZGVuID0gZmFsc2U7XHJcblx0fSxcclxuXHJcblx0aGlkZTogZnVuY3Rpb24oKSB7XHRcdFxyXG5cdFx0dGhpcy5jdnMuaGlkZSgpO1xyXG5cdFx0dGhpcy5oaWRkZW4gPSB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdG9uUmVzaXplOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuc2NyZWVuSW5mby53aWR0aCA9IHRoaXMuY3ZzLmJ1ZmZlckNhbnZhcy53aWR0aDtcclxuXHRcdHRoaXMuc2NyZWVuSW5mby5oZWlnaHQgPSB0aGlzLmN2cy5idWZmZXJDYW52YXMuaGVpZ2h0O1xyXG5cdFx0dGhpcy5zY3JlZW5JbmZvLmNlbnRlci5zZXQoTWF0aC5mbG9vcih0aGlzLnNjcmVlbkluZm8ud2lkdGggLyAyKSwgTWF0aC5mbG9vcih0aGlzLnNjcmVlbkluZm8uaGVpZ2h0IC8gMikpO1xyXG5cclxuXHRcdHRoaXMubG9hZGluZ0JveC50b3BMZWZ0LmNvcHkodGhpcy5zY3JlZW5JbmZvLmNlbnRlcik7XHJcblx0XHR0aGlzLmxvYWRpbmdCb3gudG9wTGVmdC54IC09IE1hdGguZmxvb3IodGhpcy5sb2FkaW5nQm94LndpZHRoICogMC41ICogdGhpcy5zY3JlZW5JbmZvLndpZHRoKTtcclxuXHRcdHRoaXMubG9hZGluZ0JveC50b3BMZWZ0LnkgLT0gTWF0aC5mbG9vcih0aGlzLmxvYWRpbmdCb3guaGVpZ2h0ICogMC41ICogdGhpcy5zY3JlZW5JbmZvLmhlaWdodCk7XHJcblxyXG5cdFx0dGhpcy5sb2FkaW5nQm94LmJvdHRvbVJpZ2h0LmNvcHkodGhpcy5zY3JlZW5JbmZvLmNlbnRlcik7XHJcblx0XHR0aGlzLmxvYWRpbmdCb3guYm90dG9tUmlnaHQueCArPSBNYXRoLmZsb29yKHRoaXMubG9hZGluZ0JveC53aWR0aCAqIDAuNSAqIHRoaXMuc2NyZWVuSW5mby53aWR0aCk7XHJcblx0XHR0aGlzLmxvYWRpbmdCb3guYm90dG9tUmlnaHQueSArPSBNYXRoLmZsb29yKHRoaXMubG9hZGluZ0JveC5oZWlnaHQgKiAwLjUgKiB0aGlzLnNjcmVlbkluZm8uaGVpZ2h0KTtcclxuXHJcblx0XHR0aGlzLmxvYWRpbmdCb3guY29udGVudFRvcExlZnQuY29weSh0aGlzLmxvYWRpbmdCb3gudG9wTGVmdCk7XHJcblx0XHR0aGlzLmxvYWRpbmdCb3guY29udGVudFRvcExlZnQueCArPSBNYXRoLmZsb29yKHRoaXMubG9hZGluZ0JveC5jb250ZW50UGFkZGluZyAqIHRoaXMuc2NyZWVuSW5mby53aWR0aCk7XHJcblx0XHR0aGlzLmxvYWRpbmdCb3guY29udGVudFRvcExlZnQueSArPSBNYXRoLmZsb29yKHRoaXMubG9hZGluZ0JveC5jb250ZW50UGFkZGluZyAqIHRoaXMuc2NyZWVuSW5mby53aWR0aCk7XHJcblxyXG5cdFx0dGhpcy5sb2FkaW5nQm94LmNvbnRlbnRCb3R0b21SaWdodC5jb3B5KHRoaXMubG9hZGluZ0JveC5ib3R0b21SaWdodCk7XHJcblx0XHR0aGlzLmxvYWRpbmdCb3guY29udGVudEJvdHRvbVJpZ2h0LnggLT0gTWF0aC5mbG9vcih0aGlzLmxvYWRpbmdCb3guY29udGVudFBhZGRpbmcgKiB0aGlzLnNjcmVlbkluZm8ud2lkdGgpO1xyXG5cdFx0dGhpcy5sb2FkaW5nQm94LmNvbnRlbnRCb3R0b21SaWdodC55IC09IE1hdGguZmxvb3IodGhpcy5sb2FkaW5nQm94LmNvbnRlbnRQYWRkaW5nICogdGhpcy5zY3JlZW5JbmZvLndpZHRoKTtcclxuXHJcblx0XHR0aGlzLmxvYWRpbmdCb3guY29udGVudEN1cnJlbnRCb3R0b21SaWdodC55ID0gdGhpcy5sb2FkaW5nQm94LmNvbnRlbnRCb3R0b21SaWdodC55O1xyXG5cclxuXHRcdHRoaXMudXBkYXRlTG9hZGluZ0JveENvbnRlbnQoKTtcclxuXHR9LFxyXG5cclxuXHRzZXQgcGVyY2VudExvYWRlZCh2YWx1ZSkge1xyXG5cdFx0dGhpcy5fcGVyY2VudExvYWRlZCA9IHZhbHVlO1xyXG5cdFx0dGhpcy51cGRhdGVMb2FkaW5nQm94Q29udGVudCgpO1xyXG5cdH0sXHJcblxyXG5cdGdldCBwZXJjZW50TG9hZGVkKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3BlcmNlbnRMb2FkZWQ7XHJcblx0fSxcclxufTsiLCJHUy5VSUNvbG9ycyA9IHtcclxuXHRiYWNrZ3JvdW5kOiBcInJnYmEoMCwgMCwgMCwgMC43NSlcIixcclxuXHRtZW51QmFja2dyb3VuZDogXCJyZ2JhKDAsIDAsIDAsIDAuOSlcIixcdFxyXG5cdGZvcmVncm91bmQ6IFwicmdiYSgyNTUsIDI1NSwgMjU1LCAxKVwiLFxyXG5cdGZvcmVncm91bmREaXNhYmxlZDogXCJyZ2JhKDY0LCA2NCwgNjQsIDEpXCIsXHJcblx0YnV0dG9uSG92ZXI6IFwicmdiYSgxMjgsIDAsIDAsIDAuNSlcIixcclxuXHRidXR0b25BY3RpdmU6IFwicmdiYSgyNTUsIDAsIDAsIDAuNSlcIixcclxufTtcclxuXHJcbkdTLlVJRm9udCA9IFwiaHVkRm9udFwiOyIsIkdTLlVJQ29tcG9uZW50cyA9IEdTLlVJQ29tcG9uZW50cyB8fCB7fTtcclxuXHJcbkdTLlVJTWFuYWdlciA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMucmVzZXQoKTtcclxuXHR0aGlzLm1lbnVPbmx5ID0gdHJ1ZTtcclxuXHR0aGlzLm1lbnVBY3RpdmUgPSBmYWxzZTtcclxuXHJcblx0dGhpcy5tZW51QmFja09mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApO1xyXG5cdHRoaXMubWVudUJhY2tQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMigwLCAwKTtcclxuXHR0aGlzLm1lbnVCYWNrU2l6ZSA9IG5ldyBUSFJFRS5WZWN0b3IyKDEsIDEpO1xyXG5cclxuXHR0aGlzLnNob3dIVUQgPSBHUy5TZXR0aW5ncy5zaG93SFVEO1xyXG59O1xyXG5cclxuR1MuVUlNYW5hZ2VyLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlNYW5hZ2VyLFxyXG5cclxuXHRyZXNldDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmdyaWQgPSB1bmRlZmluZWQ7XHJcblx0XHR0aGlzLmhpZGRlbiA9IHRydWU7XHJcblx0fSxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmN2cyA9IG5ldyBHUy5DYW52YXMyZCh0cnVlKTtcclxuXHJcblx0XHR0aGlzLmN2cy5hbHBoYSA9IDA7XHJcblx0XHR0aGlzLmN2cy5jYW52YXNJZCA9IFwidWktY2FudmFzXCI7XHJcblx0XHR0aGlzLmN2cy5yZWRyYXdPblJlc2l6ZSA9IGZhbHNlO1xyXG5cclxuXHRcdHRoaXMuY3ZzLmluaXQoKTtcclxuXHRcdHRoaXMuY3ZzLnNjcmVlbkNhbnZhcy5zdHlsZS56SW5kZXggPSAzMDtcclxuXHJcblx0XHR0aGlzLnZlY3RvckNhbnZhcyA9IG5ldyBHUy5WZWN0b3JDYW52YXModGhpcy5jdnMpO1xyXG5cdFx0dGhpcy52ZWN0b3JDYW52YXMuaW5pdCgpO1xyXG5cdH0sXHJcblxyXG5cdGluaXRDb21wb25lbnRzOiBmdW5jdGlvbihhc3NldHMsIGdyaWQpIHtcclxuXHRcdHRoaXMuZ3JpZCA9IGdyaWQ7XHJcblx0XHR0aGlzLmFzc2V0cyA9IHtcclxuXHRcdFx0aW1hZ2VzOiBhc3NldHNbR1MuQXNzZXRUeXBlcy5VSVdpZGdldF0sXHJcblx0XHR9O1xyXG5cdFx0dGhpcy5jb21wb25lbnRzID0gW107XHJcblxyXG5cdFx0aWYgKHRoaXMuZ3JpZCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMucG93ZXJCYXJzID0gbmV3IEdTLlVJQ29tcG9uZW50cy5Qb3dlckJhcnModGhpcy52ZWN0b3JDYW52YXMsIHRoaXMuYXNzZXRzLCB0aGlzLmdyaWQucGxheWVyKTtcclxuXHRcdFx0dGhpcy5wb3dlckJhcnMuaW5pdCgpO1xyXG5cdFx0XHR0aGlzLmNvbXBvbmVudHMucHVzaCh0aGlzLnBvd2VyQmFycyk7XHJcblxyXG5cdFx0XHR0aGlzLmNyb3NzaGFpciA9IG5ldyBHUy5VSUNvbXBvbmVudHMuQ3Jvc3NoYWlyKHRoaXMudmVjdG9yQ2FudmFzLCB0aGlzLmFzc2V0cywgdGhpcy5ncmlkLnBsYXllcik7XHJcblx0XHRcdHRoaXMuY3Jvc3NoYWlyLmluaXQoKTtcclxuXHRcdFx0dGhpcy5jb21wb25lbnRzLnB1c2godGhpcy5jcm9zc2hhaXIpO1xyXG5cclxuXHRcdFx0dGhpcy5ub3RpZmljYXRpb25zID0gbmV3IEdTLlVJQ29tcG9uZW50cy5Ob3RpZmljYXRpb25zKHRoaXMudmVjdG9yQ2FudmFzLCB0aGlzLmFzc2V0cywgdGhpcy5ncmlkLnBsYXllcik7XHJcblx0XHRcdHRoaXMubm90aWZpY2F0aW9ucy5pbml0KCk7XHJcblx0XHRcdHRoaXMuY29tcG9uZW50cy5wdXNoKHRoaXMubm90aWZpY2F0aW9ucyk7XHJcblxyXG5cdFx0XHR0aGlzLndpblNjcmVlbiA9IG5ldyBHUy5VSUNvbXBvbmVudHMuV2luU2NyZWVuKHRoaXMudmVjdG9yQ2FudmFzLCB0aGlzLmFzc2V0cywgdGhpcy5ncmlkLnBsYXllcik7XHJcblx0XHRcdHRoaXMud2luU2NyZWVuLmluaXQoKTtcclxuXHRcdFx0dGhpcy5jb21wb25lbnRzLnB1c2godGhpcy53aW5TY3JlZW4pO1xyXG5cclxuXHRcdFx0dGhpcy5hdXRvbWFwID0gbmV3IEdTLlVJQ29tcG9uZW50cy5BdXRvbWFwKHRoaXMudmVjdG9yQ2FudmFzLCB0aGlzLmFzc2V0cywgdGhpcy5ncmlkLnBsYXllcik7XHJcblx0XHRcdHRoaXMuYXV0b21hcC5pbml0KCk7XHJcblx0XHRcdHRoaXMuY29tcG9uZW50cy5wdXNoKHRoaXMuYXV0b21hcCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMubWVudSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMubWVudSA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudSh0aGlzLnZlY3RvckNhbnZhcywgdGhpcy5hc3NldHMpO1xyXG5cdFx0XHR0aGlzLm1lbnUuaW5pdCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMub3ZlcnJpZGVSZWRyYXcgPSB0cnVlO1xyXG5cdH0sXHJcblxyXG4gIHJlaW5pdDogZnVuY3Rpb24gKCkge1xyXG4gICAgbGV0IHBsYXllciA9IEdBTUUuZ3JpZC5wbGF5ZXI7XHJcbiAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcclxuICAgIHRoaXMucG93ZXJCYXJzLnBsYXllciA9IHBsYXllcjtcclxuICAgIHRoaXMuY3Jvc3NoYWlyLnBsYXllciA9IHBsYXllcjtcclxuICAgIHRoaXMubm90aWZpY2F0aW9ucy5wbGF5ZXIgPSBwbGF5ZXI7XHJcbiAgICB0aGlzLndpblNjcmVlbi5wbGF5ZXIgPSBwbGF5ZXI7XHJcbiAgICB0aGlzLmF1dG9tYXAucGxheWVyID0gcGxheWVyO1xyXG4gIH0sXHJcblxyXG5cdHNob3c6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5vdmVycmlkZVJlZHJhdyA9IHRydWU7XHJcblx0XHR0aGlzLmN2cy5zaG93KCk7XHJcblx0XHR0aGlzLmhpZGRlbiA9IGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdGhpZGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jdnMuaGlkZSgpO1xyXG5cdFx0dGhpcy5oaWRkZW4gPSB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29tcG9uZW50cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR0aGlzLmNvbXBvbmVudHNbaV0udXBkYXRlKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMubWVudUFjdGl2ZSkge1xyXG5cdFx0XHR0aGlzLm1lbnUudXBkYXRlKCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZHJhdzogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5tZW51QWN0aXZlKSB7XHJcblx0XHRcdHRoaXMuY3ZzLmNsZWFyKCk7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5tZW51T25seSkge1xyXG5cdFx0XHRcdHRoaXMudmVjdG9yQ2FudmFzLmRyYXdJbWFnZSh0aGlzLm1lbnVCYWNrT2Zmc2V0LCB0aGlzLm1lbnVCYWNrUG9zLCB0aGlzLmFzc2V0cy5pbWFnZXMubWVudV9iYWNrLCB0aGlzLm1lbnVCYWNrU2l6ZSwgZmFsc2UpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMubWVudS5kcmF3KCk7XHJcblxyXG5cdFx0XHR0aGlzLmN2cy5mbGlwKCk7XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICh0aGlzLndpblNjcmVlbi52aXNpYmxlKSB7XHJcblx0XHRcdHRoaXMuY3ZzLmNsZWFyKCk7XHJcblx0XHRcdHRoaXMud2luU2NyZWVuLmRyYXcoKTtcclxuXHRcdFx0dGhpcy5jdnMuZmxpcCgpO1xyXG5cdFx0fSBlbHNlXHJcblx0XHRpZiAodGhpcy5hdXRvbWFwLnZpc2libGUpIHtcclxuXHRcdFx0aWYgKHRoaXMub3ZlcnJpZGVSZWRyYXcgfHwgdGhpcy5hdXRvbWFwLm5lZWRzUmVkcmF3KSB7XHJcblx0XHRcdFx0aWYgKHRoaXMub3ZlcnJpZGVSZWRyYXcpIHtcclxuXHRcdFx0XHRcdHRoaXMub3ZlcnJpZGVSZWRyYXcgPSBmYWxzZTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRoaXMuY3ZzLmNsZWFyKCk7XHJcblx0XHRcdFx0dGhpcy5hdXRvbWFwLmRyYXcoKTtcclxuXHRcdFx0XHR0aGlzLmF1dG9tYXAubmVlZHNSZWRyYXcgPSBmYWxzZTtcclxuXHRcdFx0XHR0aGlzLmN2cy5mbGlwKCk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGlmICghdGhpcy5oaWRkZW4gJiYgdGhpcy5jaGVja0lmUmVkcmF3KCkpIHtcclxuXHRcdFx0XHR0aGlzLmN2cy5jbGVhcigpO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5zaG93SFVEKSB7XHJcblx0XHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29tcG9uZW50cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5jb21wb25lbnRzW2ldLnZpc2libGUpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLmNvbXBvbmVudHNbaV0uZHJhdygpO1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuY29tcG9uZW50c1tpXS5uZWVkc1JlZHJhdyA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0aGlzLmN2cy5mbGlwKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRjaGVja0lmUmVkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLm92ZXJyaWRlUmVkcmF3KSB7XHJcblx0XHRcdHRoaXMub3ZlcnJpZGVSZWRyYXcgPSBmYWxzZTtcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNvbXBvbmVudHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0aWYgKHRoaXMuY29tcG9uZW50c1tpXS52aXNpYmxlICYmIHRoaXMuY29tcG9uZW50c1tpXS5uZWVkc1JlZHJhdykge1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdHJlbW92ZU5ld3NCb3g6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5tZW51LnJlbW92ZU5ld3NCb3goKTtcclxuXHR9LFxyXG5cclxuXHR1c2VJbmdhbWVNZW51OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMubWVudU9ubHkgPSBmYWxzZTtcclxuXHRcdHRoaXMubWVudS5zd2l0Y2hUb0luZ2FtZSgpO1xyXG5cdH0sXHJcblxyXG5cdG9uUmVzaXplOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMub3ZlcnJpZGVSZWRyYXcgPSB0cnVlO1xyXG5cdFx0dGhpcy52ZWN0b3JDYW52YXMub25SZXNpemUoKTtcclxuXHJcblx0XHRHUy5JbnB1dEhlbHBlci5zY3JlZW5SYXRpb1ggPSB0aGlzLmN2cy5idWZmZXJDYW52YXMud2lkdGggLyB3aW5kb3cuaW5uZXJXaWR0aDtcclxuXHRcdEdTLklucHV0SGVscGVyLnNjcmVlblJhdGlvWSA9IHRoaXMuY3ZzLmJ1ZmZlckNhbnZhcy5oZWlnaHQgLyB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblx0fSxcclxuXHJcblx0ZGlzcG9zZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmdyaWQgPSB1bmRlZmluZWQ7XHJcblx0XHR0aGlzLnBvd2VyQmFycyA9IHVuZGVmaW5lZDtcclxuXHRcdHRoaXMuY3Jvc3NoYWlyID0gdW5kZWZpbmVkO1xyXG5cdFx0dGhpcy5ub3RpZmljYXRpb25zID0gdW5kZWZpbmVkO1xyXG5cdFx0dGhpcy53aW5TY3JlZW4gPSB1bmRlZmluZWQ7XHJcblx0XHR0aGlzLmNvbXBvbmVudHMgPSBbXTtcclxuXHR9LFxyXG59O1xyXG4iLCJHUy5WZWN0b3JDYW52YXMgPSBmdW5jdGlvbihjYW52YXMyZCkge1xyXG5cdHRoaXMuY3ZzID0gY2FudmFzMmQ7XHJcblxyXG5cdHRoaXMucmF0aW8gPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG59O1xyXG5cclxuR1MuVmVjdG9yQ2FudmFzLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVmVjdG9yQ2FudmFzLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMub25SZXNpemUoKTtcclxuXHR9LFxyXG5cclxuXHRvblJlc2l6ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnJhdGlvLnNldCh0aGlzLmN2cy5idWZmZXJDYW52YXMud2lkdGgsIHRoaXMuY3ZzLmJ1ZmZlckNhbnZhcy5oZWlnaHQpO1xyXG5cdH0sXHJcblxyXG5cdGNvbnZlcnRUb1NjcmVlbkNvb3JkczogZnVuY3Rpb24odjAsIHYsIGZpeGVkT2Zmc2V0KSB7XHJcblx0XHR2LnggPSBNYXRoLmZsb29yKHYwLnggKiB0aGlzLnJhdGlvLngpO1xyXG5cdFx0di55ID0gTWF0aC5mbG9vcih2MC55ICogdGhpcy5yYXRpby55KTtcclxuXHJcblx0XHRpZiAoZml4ZWRPZmZzZXQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR2LnggKz0gZml4ZWRPZmZzZXQueDtcclxuXHRcdFx0di55ICs9IGZpeGVkT2Zmc2V0Lnk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Zml4ZWRMaW5lOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB2MCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgdjEgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwb3MsIHAwLCBwMSwgY29sb3IsIGxpbmVXaWR0aCkge1xyXG5cdFx0XHR0aGlzLmNvbnZlcnRUb1NjcmVlbkNvb3Jkcyhwb3MsIHYwLCBwMCk7XHJcblx0XHRcdHRoaXMuY29udmVydFRvU2NyZWVuQ29vcmRzKHBvcywgdjEsIHAxKTtcclxuXHJcblx0XHRcdHRoaXMuY3ZzLmxpbmUodjAsIHYxLCBjb2xvciwgbGluZVdpZHRoKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGxpbmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHYwID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciB2MSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGZpeGVkT2Zmc2V0LCBwb3MsIGxpbmVPZmZzZXQsIGlzRml4ZWRMaW5lT2Zmc2V0LCBjb2xvciwgbGluZVdpZHRoKSB7XHJcblx0XHRcdHRoaXMuY29udmVydFRvU2NyZWVuQ29vcmRzKHBvcywgdjAsIGZpeGVkT2Zmc2V0KTtcclxuXHJcblx0XHRcdGlmICghaXNGaXhlZExpbmVPZmZzZXQpIHtcclxuXHRcdFx0XHR0aGlzLmNvbnZlcnRUb1NjcmVlbkNvb3JkcyhsaW5lT2Zmc2V0LCB2MSk7XHJcblx0XHRcdFx0djEuYWRkKHYwKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR2MS5jb3B5KHYwKS5hZGQobGluZU9mZnNldCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuY3ZzLmxpbmUodjAsIHYxLCBjb2xvciwgbGluZVdpZHRoKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGJveDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdjAgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIHYxID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oZml4ZWRPZmZzZXQsIHBvcywgc2l6ZSwgaXNGaXhlZFNpemUsIGNvbG9yLCBsaW5lV2lkdGgpIHtcclxuXHRcdFx0dGhpcy5jb252ZXJ0VG9TY3JlZW5Db29yZHMocG9zLCB2MCwgZml4ZWRPZmZzZXQpO1xyXG5cclxuXHRcdFx0aWYgKCFpc0ZpeGVkU2l6ZSkge1xyXG5cdFx0XHRcdHRoaXMuY29udmVydFRvU2NyZWVuQ29vcmRzKHNpemUsIHYxKTtcclxuXHRcdFx0XHR2MS5hZGQodjApO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHYxLmNvcHkodjApLmFkZChzaXplKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5jdnMuYm94KHYwLCB2MSwgY29sb3IsIGxpbmVXaWR0aCk7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRib3hGaWxsOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB2MCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgdjEgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihmaXhlZE9mZnNldCwgcG9zLCBzaXplLCBpc0ZpeGVkU2l6ZSwgY29sb3IpIHtcclxuXHRcdFx0dGhpcy5jb252ZXJ0VG9TY3JlZW5Db29yZHMocG9zLCB2MCwgZml4ZWRPZmZzZXQpO1xyXG5cclxuXHRcdFx0aWYgKCFpc0ZpeGVkU2l6ZSkge1xyXG5cdFx0XHRcdHRoaXMuY29udmVydFRvU2NyZWVuQ29vcmRzKHNpemUsIHYxKTtcclxuXHRcdFx0XHR2MS5hZGQodjApO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHYxLmNvcHkodjApLmFkZChzaXplKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5jdnMuYm94RmlsbCh2MCwgdjEsIGNvbG9yKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGNpcmNsZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdiA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGZpeGVkT2Zmc2V0LCBwb3MsIHJhZGl1cywgY29sb3IsIGxpbmVXaWR0aCkge1xyXG5cdFx0XHR0aGlzLmNvbnZlcnRUb1NjcmVlbkNvb3Jkcyhwb3MsIHYsIGZpeGVkT2Zmc2V0KTtcclxuXHJcblx0XHRcdHRoaXMuY3ZzLmNpcmNsZSh2LCByYWRpdXMsIGNvbG9yLCBsaW5lV2lkdGgpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Y2lyY2xlRmlsbDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdiA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGZpeGVkT2Zmc2V0LCBwb3MsIHJhZGl1cywgY29sb3IpIHtcclxuXHRcdFx0dGhpcy5jb252ZXJ0VG9TY3JlZW5Db29yZHMocG9zLCB2LCBmaXhlZE9mZnNldCk7XHJcblxyXG5cdFx0XHR0aGlzLmN2cy5jaXJjbGVGaWxsKHYsIHJhZGl1cywgY29sb3IpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0dGV4dDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdiA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGZpeGVkT2Zmc2V0LCBwb3MsIHN0ciwgY29sb3IsIGZvbnRTaXplLCB0ZXh0QmFzZWxpbmUsIHRleHRBbGlnbiwgZm9udEZhbWlseSkge1xyXG5cdFx0XHR0aGlzLmNvbnZlcnRUb1NjcmVlbkNvb3Jkcyhwb3MsIHYsIGZpeGVkT2Zmc2V0KTtcclxuXHJcblx0XHRcdHRoaXMuY3ZzLnRleHQodiwgc3RyLCBjb2xvciwgZm9udFNpemUsIHRleHRCYXNlbGluZSwgdGV4dEFsaWduLCBmb250RmFtaWx5KTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGRyYXdJbWFnZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdjAgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIHYxID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oZml4ZWRPZmZzZXQsIHBvcywgaW1nLCBzaXplLCBpc0ZpeGVkU2l6ZSkge1xyXG5cdFx0XHR0aGlzLmNvbnZlcnRUb1NjcmVlbkNvb3Jkcyhwb3MsIHYwLCBmaXhlZE9mZnNldCk7XHJcblxyXG5cdFx0XHRpZiAoIWlzRml4ZWRTaXplKSB7XHJcblx0XHRcdFx0dGhpcy5jb252ZXJ0VG9TY3JlZW5Db29yZHMoc2l6ZSwgdjEpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHYxLmNvcHkoc2l6ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuY3ZzLmRyYXdJbWFnZSh2MCwgaW1nLCB2MSk7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRkcmF3SW1hZ2VGcm9tQXRsYXM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHYgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihmaXhlZE9mZnNldCwgcG9zLCBpbWcsIGF0bGFzT2Zmc2V0LCBhdGxhc1NpemUpIHtcclxuXHRcdFx0dGhpcy5jb252ZXJ0VG9TY3JlZW5Db29yZHMocG9zLCB2LCBmaXhlZE9mZnNldCk7XHJcblxyXG5cdFx0XHR0aGlzLmN2cy5kcmF3SW1hZ2VGcm9tQXRsYXModiwgaW1nLCBhdGxhc09mZnNldCwgYXRsYXNTaXplKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGdldFRleHRXaWR0aDogZnVuY3Rpb24oc3RyLCBmb250U2l6ZSwgZm9udEZhbWlseSkge1xyXG5cdFx0cmV0dXJuIHRoaXMuY3ZzLmdldFRleHRXaWR0aChzdHIsIGZvbnRTaXplLCBmb250RmFtaWx5KTtcclxuXHR9LFxyXG5cclxuXHRyb3VuZGVkQm94OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB2MCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgdjEgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihmaXhlZE9mZnNldCwgcG9zLCBzaXplLCBpc0ZpeGVkU2l6ZSwgcmFkaXVzLCBjb2xvciwgbGluZVdpZHRoKSB7XHJcblx0XHRcdHRoaXMuY29udmVydFRvU2NyZWVuQ29vcmRzKHBvcywgdjAsIGZpeGVkT2Zmc2V0KTtcclxuXHJcblx0XHRcdGlmICghaXNGaXhlZFNpemUpIHtcclxuXHRcdFx0XHR0aGlzLmNvbnZlcnRUb1NjcmVlbkNvb3JkcyhzaXplLCB2MSk7XHJcblx0XHRcdFx0djEuYWRkKHYwKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR2MS5jb3B5KHYwKS5hZGQoc2l6ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuY3ZzLnJvdW5kZWRCb3godjAsIHYxLCByYWRpdXMsIGNvbG9yLCBsaW5lV2lkdGgpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0cm91bmRlZEJveEZpbGw6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHYwID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciB2MSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGZpeGVkT2Zmc2V0LCBwb3MsIHNpemUsIGlzRml4ZWRTaXplLCByYWRpdXMsIGNvbG9yKSB7XHJcblx0XHRcdHRoaXMuY29udmVydFRvU2NyZWVuQ29vcmRzKHBvcywgdjAsIGZpeGVkT2Zmc2V0KTtcclxuXHJcblx0XHRcdGlmICghaXNGaXhlZFNpemUpIHtcclxuXHRcdFx0XHR0aGlzLmNvbnZlcnRUb1NjcmVlbkNvb3JkcyhzaXplLCB2MSk7XHJcblx0XHRcdFx0djEuYWRkKHYwKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR2MS5jb3B5KHYwKS5hZGQoc2l6ZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuY3ZzLnJvdW5kZWRCb3hGaWxsKHYwLCB2MSwgcmFkaXVzLCBjb2xvcik7XHJcblx0XHR9XHJcblx0fSgpLFxyXG59OyIsIkdTLlVJQ29tcG9uZW50cy5BdXRvbWFwID0gZnVuY3Rpb24odmVjdG9yQ2FudmFzLCBhc3NldHMsIHBsYXllcikge1xyXG5cdHRoaXMuY3ZzID0gdmVjdG9yQ2FudmFzO1xyXG5cdHRoaXMuYXNzZXRzID0gYXNzZXRzO1xyXG5cdHRoaXMucGxheWVyID0gcGxheWVyO1xyXG5cdHRoaXMuYWlNYW5hZ2VyID0gcGxheWVyLmdyaWQuYWlNYW5hZ2VyO1xyXG5cclxuXHR0aGlzLmJhY2tncm91bmQgPSB7XHJcblx0XHRvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApLFxyXG5cdFx0cG9zOiBuZXcgVEhSRUUuVmVjdG9yMigwLCAwKSxcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IyKDEsIDEpLFxyXG5cdH07XHJcblxyXG5cdHRoaXMucGxheWVyRHJhdyA9IHtcclxuXHRcdG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoMCwgMCksXHJcblx0XHRwb3M6IG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSxcclxuXHR9O1xyXG5cclxuXHR0aGlzLm1hcERyYXcgPSB7XHJcblx0XHRvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApLFxyXG5cdFx0cG9zOiBuZXcgVEhSRUUuVmVjdG9yMigwLjUsIDAuNSksXHJcblx0fTtcclxuXHJcblx0dGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBHUy5VSUNvbG9ycy5tZW51QmFja2dyb3VuZDtcclxuXHJcblx0dGhpcy5vbGRSZWdpb25zRGlzY292ZXJlZCA9IE9iamVjdC5rZXlzKHRoaXMuYWlNYW5hZ2VyLnJlZ2lvbnNEaXNjb3ZlcmVkKS5sZW5ndGg7XHJcblx0dGhpcy5vbGRQbGF5ZXJQb3NpdGlvbiA9IHRoaXMucGxheWVyLnBvc2l0aW9uLnRvVmVjdG9yMigpO1xyXG5cdHRoaXMuY3VycmVudFBsYXllclBvc2l0aW9uID0gdGhpcy5wbGF5ZXIucG9zaXRpb24udG9WZWN0b3IyKCk7XHJcblx0dGhpcy5vbGRQbGF5ZXJEaXJlY3Rpb24gPSB0aGlzLnBsYXllci5kaXJlY3Rpb24udG9WZWN0b3IyKCk7XHJcblx0dGhpcy5jdXJyZW50UGxheWVyRGlyZWN0aW9uID0gdGhpcy5wbGF5ZXIuZGlyZWN0aW9uLnRvVmVjdG9yMigpO1xyXG5cclxuXHR0aGlzLnpvb21TcGVlZCA9IDAuMjU7XHJcblx0dGhpcy5taW5ab29tID0gMC41O1xyXG5cdHRoaXMubWF4Wm9vbSA9IDQ7XHJcblx0dGhpcy56b29tID0gMjtcclxuXHJcblx0dGhpcy52aXNpYmxlID0gZmFsc2U7XHJcbn07XHJcblxyXG5HUy5VSUNvbXBvbmVudHMuQXV0b21hcC5wcm90b3R5cGUgPSB7XHJcblx0Y29uc3RydWN0b3I6IEdTLlVJQ29tcG9uZW50cy5BdXRvbWFwLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJlZ2lvbnNEaXNjb3ZlcmVkID0gT2JqZWN0LmtleXModGhpcy5haU1hbmFnZXIucmVnaW9uc0Rpc2NvdmVyZWQpLmxlbmd0aDtcclxuXHRcdGlmIChyZWdpb25zRGlzY292ZXJlZCA+IHRoaXMub2xkUmVnaW9uc0Rpc2NvdmVyZWQpIHtcclxuXHRcdFx0dGhpcy5uZWVkc1JlZHJhdyA9IHRydWU7XHJcblx0XHRcdHRoaXMub2xkUmVnaW9uc0Rpc2NvdmVyZWQgPSByZWdpb25zRGlzY292ZXJlZDtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnBsYXllci5wb3NpdGlvbi50b1ZlY3RvcjIodGhpcy5jdXJyZW50UGxheWVyUG9zaXRpb24pO1xyXG5cdFx0aWYgKCF0aGlzLmN1cnJlbnRQbGF5ZXJQb3NpdGlvbi5lcXVhbHNFcHNpbG9uKHRoaXMub2xkUGxheWVyUG9zaXRpb24pKSB7XHJcblx0XHRcdHRoaXMubmVlZHNSZWRyYXcgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLm9sZFBsYXllclBvc2l0aW9uLmNvcHkodGhpcy5jdXJyZW50UGxheWVyUG9zaXRpb24pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMucGxheWVyLmRpcmVjdGlvbi50b1ZlY3RvcjIodGhpcy5jdXJyZW50UGxheWVyRGlyZWN0aW9uKTtcclxuXHRcdGlmICghdGhpcy5jdXJyZW50UGxheWVyRGlyZWN0aW9uLmVxdWFsc0Vwc2lsb24odGhpcy5vbGRQbGF5ZXJEaXJlY3Rpb24pKSB7XHJcblx0XHRcdHRoaXMubmVlZHNSZWRyYXcgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLm9sZFBsYXllckRpcmVjdGlvbi5jb3B5KHRoaXMuY3VycmVudFBsYXllckRpcmVjdGlvbik7XHJcblx0XHR9XHJcblxyXG5cdFx0d2hpbGUgKEdTLklucHV0SGVscGVyLm1vdXNlV2hlZWxFdmVudHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHR2YXIgZGVsdGEgPSBHUy5JbnB1dEhlbHBlci5tb3VzZVdoZWVsRXZlbnRzLnNoaWZ0KCk7XHJcblx0XHRcdGlmIChkZWx0YSA8IDApIHtcclxuXHRcdFx0XHR0aGlzLnpvb20gLT0gdGhpcy56b29tU3BlZWQ7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGRlbHRhID4gMCkge1xyXG5cdFx0XHRcdHRoaXMuem9vbSArPSB0aGlzLnpvb21TcGVlZDtcclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLnpvb20gPSBHUy5NYXRoSGVscGVyLmNsYW1wKHRoaXMuem9vbSwgdGhpcy5taW5ab29tLCB0aGlzLm1heFpvb20pO1xyXG5cdFx0XHR0aGlzLm5lZWRzUmVkcmF3ID0gdHJ1ZTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuY3ZzLmJveEZpbGwodGhpcy5iYWNrZ3JvdW5kLm9mZnNldCwgdGhpcy5iYWNrZ3JvdW5kLnBvcywgdGhpcy5iYWNrZ3JvdW5kLnNpemUsIGZhbHNlLCB0aGlzLmJhY2tncm91bmRDb2xvcik7XHJcblxyXG5cdFx0dmFyIHJlZ2lvbnNEaXNjb3ZlcmVkID0gdGhpcy5haU1hbmFnZXIucmVnaW9uc0Rpc2NvdmVyZWQ7XHJcblx0XHRmb3IgKHZhciBpIGluIHJlZ2lvbnNEaXNjb3ZlcmVkKSB7XHJcblx0XHRcdHRoaXMuZHJhd1JlZ2lvbihyZWdpb25zRGlzY292ZXJlZFtpXSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5kcmF3UGxheWVyKCk7XHJcblx0fSxcclxuXHJcblx0ZHJhd1BsYXllcjogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgcDAgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIHAxID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBwMiA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgYXV4ID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBjb2xvciA9IFwicmdiYSgxOTIsIDE5MiwgMTkyLCAxKVwiO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIHNpemUgPSB0aGlzLnBsYXllci5zaXplLnggKiB0aGlzLnpvb207XHJcblx0XHRcdHZhciB4QW5nbGUgPSB0aGlzLnBsYXllci54QW5nbGU7XHJcblxyXG5cdFx0XHRwMC54ID0gc2l6ZSAqIE1hdGguc2luKE1hdGguUEkgLyAxODAgKiAoMzYwICsgOTAgLSB4QW5nbGUpKTtcclxuXHRcdFx0cDAueSA9IHNpemUgKiBNYXRoLmNvcyhNYXRoLlBJIC8gMTgwICogKDM2MCArIDkwIC0geEFuZ2xlKSk7XHJcblx0XHRcdHAxLnggPSBzaXplICogTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqICgyMTAgKyA5MCAtIHhBbmdsZSkpO1xyXG5cdFx0XHRwMS55ID0gc2l6ZSAqIE1hdGguY29zKE1hdGguUEkgLyAxODAgKiAoMjEwICsgOTAgLSB4QW5nbGUpKTtcclxuXHRcdFx0cDIueCA9IHNpemUgKiBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogKDE1MCArIDkwIC0geEFuZ2xlKSk7XHJcblx0XHRcdHAyLnkgPSBzaXplICogTWF0aC5jb3MoTWF0aC5QSSAvIDE4MCAqICgxNTAgKyA5MCAtIHhBbmdsZSkpO1xyXG5cclxuXHRcdFx0dGhpcy5jdnMuZml4ZWRMaW5lKHRoaXMubWFwRHJhdy5wb3MsIHAwLCBwMSwgY29sb3IsIDMpO1xyXG5cdFx0XHR0aGlzLmN2cy5maXhlZExpbmUodGhpcy5tYXBEcmF3LnBvcywgcDEsIHAyLCBjb2xvciwgMyk7XHJcblx0XHRcdHRoaXMuY3ZzLmZpeGVkTGluZSh0aGlzLm1hcERyYXcucG9zLCBwMiwgcDAsIGNvbG9yLCAzKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGRyYXdSZWdpb246IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHAwID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBwMSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgd2FsbENvbG9yID0gXCJyZ2JhKDY0LCA2NCwgNjQsIDEpXCI7XHJcblx0XHR2YXIgZG9vckNvbG9yID0gXCJyZ2JhKDEyOCwgMCwgMCwgMSlcIjtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ocmVnaW9uKSB7XHJcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHRcdGZ1bmN0aW9uIGRyYXdTZWN0b3JMaW5lKHNlY3RvciwgeDAsIHgxLCBjb2xvciwgbGluZVdpZHRoKSB7XHJcblx0XHRcdFx0cDAuY29weShzZWN0b3IuY29sbGlzaW9uVmVydGljZXNbeDBdKTtcclxuXHRcdFx0XHRwMS5jb3B5KHNlY3Rvci5jb2xsaXNpb25WZXJ0aWNlc1t4MV0pO1xyXG5cdFx0XHRcdHAwLnN1Yih0aGF0LmN1cnJlbnRQbGF5ZXJQb3NpdGlvbikubXVsdGlwbHlTY2FsYXIodGhhdC56b29tKTtcclxuXHRcdFx0XHRwMS5zdWIodGhhdC5jdXJyZW50UGxheWVyUG9zaXRpb24pLm11bHRpcGx5U2NhbGFyKHRoYXQuem9vbSk7XHJcblx0XHRcdFx0cDEuc3ViKHAwKTtcclxuXHJcblx0XHRcdFx0dGhhdC5jdnMubGluZShwMCwgdGhhdC5tYXBEcmF3LnBvcywgcDEsIHRydWUsIGNvbG9yLCBsaW5lV2lkdGgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgc2VjdG9yRGljdCA9IHRoaXMuYWlNYW5hZ2VyLnNlY3RvckRpY3Q7XHJcblx0XHRcdGZvciAodmFyIGkgaW4gcmVnaW9uLnNlY3Rvcklkcykge1xyXG5cdFx0XHRcdHZhciBzZWN0b3IgPSBzZWN0b3JEaWN0W2ldLnNlY3RvcjtcclxuXHJcblx0XHRcdFx0aWYgKHNlY3Rvci5kb29yKSB7XHJcblx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgc2VjdG9yLmNvbGxpc2lvblZlcnRpY2VzLmxlbmd0aCAtIDE7IGorKykge1xyXG5cdFx0XHRcdFx0ZHJhd1NlY3RvckxpbmUoc2VjdG9yLCBqLCBqICsgMSwgd2FsbENvbG9yLCAxKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZHJhd1NlY3RvckxpbmUoc2VjdG9yLCBqLCAwLCB3YWxsQ29sb3IsIDEpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmb3IgKHZhciBpIGluIHJlZ2lvbi5zZWN0b3JJZHMpIHtcclxuXHRcdFx0XHR2YXIgc2VjdG9yID0gc2VjdG9yRGljdFtpXS5zZWN0b3I7XHJcblxyXG5cdFx0XHRcdGlmICghc2VjdG9yLmRvb3IgfHwgIXNlY3Rvci5kb29yT3BlbmVkRXZlcikge1xyXG5cdFx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHNlY3Rvci5jb2xsaXNpb25WZXJ0aWNlcy5sZW5ndGggLSAxOyBqKyspIHtcclxuXHRcdFx0XHRcdGRyYXdTZWN0b3JMaW5lKHNlY3RvciwgaiwgaiArIDEsIGRvb3JDb2xvciwgMyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGRyYXdTZWN0b3JMaW5lKHNlY3RvciwgaiwgMCwgZG9vckNvbG9yLCAzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxufTsiLCJHUy5VSUNvbXBvbmVudHMuQ3Jvc3NoYWlyID0gZnVuY3Rpb24odmVjdG9yQ2FudmFzLCBhc3NldHMsIHBsYXllcikge1xyXG5cdHRoaXMuY3ZzID0gdmVjdG9yQ2FudmFzO1xyXG5cdHRoaXMuYXNzZXRzID0gYXNzZXRzO1xyXG5cdHRoaXMucGxheWVyID0gcGxheWVyO1xyXG5cclxuXHR0aGlzLnNpemUgPSAxMDtcclxuXHR0aGlzLmxpbmVXaWR0aCA9IDM7XHJcblx0dGhpcy5wb3MgPSBuZXcgVEhSRUUuVmVjdG9yMigwLjUsIDAuNSk7XHJcblx0dGhpcy5oT2Zmc2V0ID0gbmV3IFRIUkVFLlZlY3RvcjIoLXRoaXMuc2l6ZSwgMCk7XHJcblx0dGhpcy5oTGluZU9mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IyKHRoaXMuc2l6ZSAqIDIsIDApO1xyXG5cdHRoaXMudk9mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IyKDAsIC10aGlzLnNpemUpO1xyXG5cdHRoaXMudkxpbmVPZmZzZXQgPSBuZXcgVEhSRUUuVmVjdG9yMigwLCB0aGlzLnNpemUgKiAyKTtcclxuXHJcblx0dGhpcy52aXNpYmxlID0gdHJ1ZTtcclxufTtcclxuXHJcbkdTLlVJQ29tcG9uZW50cy5Dcm9zc2hhaXIucHJvdG90eXBlID0ge1xyXG5cdGNvbnN0cnVjdG9yOiBHUy5VSUNvbXBvbmVudHMuQ3Jvc3NoYWlyLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdGRyYXc6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jdnMubGluZSh0aGlzLmhPZmZzZXQsIHRoaXMucG9zLCB0aGlzLmhMaW5lT2Zmc2V0LCB0cnVlLCBHUy5VSUNvbG9ycy5mb3JlZ3JvdW5kLCB0aGlzLmxpbmVXaWR0aCk7XHJcblx0XHR0aGlzLmN2cy5saW5lKHRoaXMudk9mZnNldCwgdGhpcy5wb3MsIHRoaXMudkxpbmVPZmZzZXQsIHRydWUsIEdTLlVJQ29sb3JzLmZvcmVncm91bmQsIHRoaXMubGluZVdpZHRoKTtcclxuXHR9LFxyXG59OyIsIkdTLlVJQ29tcG9uZW50cy5NZW51ID0gZnVuY3Rpb24odmVjdG9yQ2FudmFzLCBhc3NldHMpIHtcclxuXHR0aGlzLmN2cyA9IHZlY3RvckNhbnZhcztcclxuXHR0aGlzLmFzc2V0cyA9IGFzc2V0cztcclxuXHJcblx0dGhpcy5mb250U2l6ZSA9IDYwO1xyXG5cdHRoaXMuYm94Q29ybmVyUmFkaXVzID0gMTA7XHJcblxyXG5cdHRoaXMuYmFja2dyb3VuZCA9IHtcclxuXHRcdG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoMCwgMCksXHJcblx0XHRwb3M6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApLFxyXG5cdFx0c2l6ZTogbmV3IFRIUkVFLlZlY3RvcjIoMSwgMSksXHJcblx0fTtcclxuXHJcblx0dGhpcy50ZXh0ID0ge1xyXG5cdFx0b2Zmc2V0OiBuZXcgVEhSRUUuVmVjdG9yMigwLCAwKSxcclxuXHRcdHBvczogbmV3IFRIUkVFLlZlY3RvcjIoMC41LCAwLjUpLFxyXG5cdH07XHJcblxyXG5cdHRoaXMubG9nbyA9IHtcclxuXHRcdG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoLTMwMCwgLTM4NCksXHJcblx0XHRwb3M6IG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSxcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IyKDYwMCwgMjAwKSxcclxuXHRcdGltYWdlOiB0aGlzLmFzc2V0cy5pbWFnZXMubG9nbyxcclxuXHR9O1xyXG5cclxuXHR0aGlzLmNoaWxkcmVuID0gW107XHJcblx0dGhpcy5hY3RpdmVQYW5lbCA9IG51bGw7XHJcblxyXG5cdHRoaXMuYmFja2dyb3VuZENvbG9yID0gR1MuVUlDb2xvcnMubWVudUJhY2tncm91bmQ7XHJcblx0dGhpcy5pbmdhbWUgPSBmYWxzZTtcclxuXHJcblx0dGhpcy52aXNpYmxlID0gdHJ1ZTtcclxufTtcclxuXHJcbkdTLlVJQ29tcG9uZW50cy5NZW51LnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlDb21wb25lbnRzLk1lbnUsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5pbml0VG9wUGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdE9wdGlvbnNQYW5lbCgpO1xyXG5cdFx0dGhpcy5pbml0T25saW5lUGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdEdyYXBoaWNzUGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdFNvdW5kUGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdEdhbWVwbGF5UGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdENvbnRyb2xzUGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdENyZWRpdHNQYW5lbCgpO1xyXG5cdFx0dGhpcy5pbml0Q2hlYXRzUGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdExldmVsU2VsZWN0UGFuZWwoKTtcclxuXHRcdHRoaXMuaW5pdEZvb3RlcigpO1xyXG5cdFx0dGhpcy5pbml0TmV3c0JveCgpO1xyXG5cclxuXHRcdHRoaXMuYWN0aXZlUGFuZWwgPSB0aGlzLnRvcFBhbmVsO1xyXG5cdH0sXHJcblxyXG5cdGluaXRUb3BQYW5lbDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy50b3BQYW5lbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudVBhbmVsKHRoaXMuY3ZzLCBuZXcgVEhSRUUuVmVjdG9yMigtNDAwLCAtMTYwKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoMC41LCAwLjUpLCBuZXcgVEhSRUUuVmVjdG9yMig4MDAsIDUyMCksIDcyLCA4MCk7XHJcblxyXG5cdFx0dGhpcy5idG5OZXdHYW1lID0gdGhpcy50b3BQYW5lbC5hZGRCdXR0b24oXCJuZXcgZ2FtZVwiKTtcclxuXHRcdHRoaXMuYnRuTmV3R2FtZS5vbkNsaWNrID0gZnVuY3Rpb24oKSB7IEdBTUUubmV3R2FtZSgpOyB9O1xyXG5cclxuXHRcdHRoaXMuYnRuTVBHYW1lID0gdGhpcy50b3BQYW5lbC5hZGRCdXR0b24oXCJvbmxpbmUgZ2FtZVwiKTtcclxuXHRcdHRoaXMuYnRuTVBHYW1lLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgdGhhdC5sYXlvdXRPbmxpbmVQYW5lbCgpO1xyXG4gICAgICB0aGF0LmFjdGl2ZVBhbmVsID0gdGhhdC5vbmxpbmVQYW5lbDtcclxuICAgICAgbGV0IGdldFJvb21zQ2IgPSAocm9vbXMpID0+IHtcclxuICAgICAgICB0aGF0LmxheW91dE9ubGluZVBhbmVsKHJvb21zKTtcclxuICAgICAgICB0aGF0LmFjdGl2ZVBhbmVsID0gdGhhdC5vbmxpbmVQYW5lbDtcclxuICAgICAgfTtcclxuICAgICAgR0FNRS5vbmxpbmVNYW5hZ2VyLnN0YXJ0KGdldFJvb21zQ2IpXHJcbiAgICB9O1xyXG5cclxuXHRcdHRoaXMuYnRuU3RlYW1QYWdlID0gdGhpcy50b3BQYW5lbC5hZGRCdXR0b24oXCJzdGVhbSBwYWdlXCIpO1xyXG5cdFx0dGhpcy5idG5TdGVhbVBhZ2Uub25DbGljayA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG5cdFx0XHRhLmhyZWYgPSBcImh0dHBzOi8vZ29vLmdsL2FrSUNSVlwiO1xyXG5cdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xyXG5cdFx0XHRhLmNsaWNrKCk7XHJcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMuYnRuTGV2ZWxTZWxlY3QgPSB0aGlzLnRvcFBhbmVsLmFkZEJ1dHRvbihcImxldmVsIHNlbGVjdFwiKTtcclxuXHRcdHRoaXMuYnRuTGV2ZWxTZWxlY3Qub25DbGljayA9IGZ1bmN0aW9uKCkgeyB0aGF0LmFjdGl2ZVBhbmVsID0gdGhhdC5sZXZlbFNlbGVjdFBhbmVsOyB9O1xyXG5cclxuXHJcblx0XHR0aGlzLmJ0bk9wdGlvbnMgPSB0aGlzLnRvcFBhbmVsLmFkZEJ1dHRvbihcIm9wdGlvbnNcIik7XHJcblx0XHR0aGlzLmJ0bk9wdGlvbnMub25DbGljayA9IGZ1bmN0aW9uKCkgeyB0aGF0LmFjdGl2ZVBhbmVsID0gdGhhdC5vcHRpb25zUGFuZWw7IH07XHJcblxyXG5cdFx0dGhpcy5idG5DcmVkaXRzID0gdGhpcy50b3BQYW5lbC5hZGRCdXR0b24oXCJjcmVkaXRzXCIpO1xyXG5cdFx0dGhpcy5idG5DcmVkaXRzLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQuY3JlZGl0c1BhbmVsOyB9O1xyXG5cclxuXHJcblx0XHR0aGlzLmJ0blN1YnNjcmliZSA9IHRoaXMudG9wUGFuZWwuYWRkQnV0dG9uKFwic3Vic2NyaWJlXCIpO1xyXG5cdFx0dGhpcy5idG5TdWJzY3JpYmUub25DbGljayA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG5cdFx0XHRhLmhyZWYgPSBcImh0dHA6Ly9lZXB1cmwuY29tL2NFa2IzVFwiO1xyXG5cdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xyXG5cdFx0XHRhLmNsaWNrKCk7XHJcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7XHJcblx0XHR9O1xyXG5cdH0sXHJcblxyXG5cdGluaXRPcHRpb25zUGFuZWw6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMub3B0aW9uc1BhbmVsID0gbmV3IEdTLlVJQ29tcG9uZW50cy5NZW51UGFuZWwodGhpcy5jdnMsIG5ldyBUSFJFRS5WZWN0b3IyKC00MDAsIC0xNjApLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMigwLjUsIDAuNSksIG5ldyBUSFJFRS5WZWN0b3IyKDgwMCwgNTIwKSwgNjAsIDY1KTtcclxuXHJcblx0XHR0aGlzLmJ0bkdyYXBoaWNzID0gdGhpcy5vcHRpb25zUGFuZWwuYWRkQnV0dG9uKFwiZ3JhcGhpY3NcIik7XHJcblx0XHR0aGlzLmJ0bkdyYXBoaWNzLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQuZ3JhcGhpY3NQYW5lbDsgfVxyXG5cclxuXHRcdHRoaXMuYnRuU291bmQgPSB0aGlzLm9wdGlvbnNQYW5lbC5hZGRCdXR0b24oXCJzb3VuZFwiKTtcclxuXHRcdHRoaXMuYnRuU291bmQub25DbGljayA9IGZ1bmN0aW9uKCkgeyB0aGF0LmFjdGl2ZVBhbmVsID0gdGhhdC5zb3VuZFBhbmVsOyB9XHJcblxyXG5cdFx0dGhpcy5idG5HYW1lcGxheSA9IHRoaXMub3B0aW9uc1BhbmVsLmFkZEJ1dHRvbihcImdhbWVwbGF5XCIpO1xyXG5cdFx0dGhpcy5idG5HYW1lcGxheS5vbkNsaWNrID0gZnVuY3Rpb24oKSB7IHRoYXQuYWN0aXZlUGFuZWwgPSB0aGF0LmdhbWVwbGF5UGFuZWw7IH1cclxuXHJcblx0XHR0aGlzLmJ0bkNvbnRyb2xzID0gdGhpcy5vcHRpb25zUGFuZWwuYWRkQnV0dG9uKFwiY29udHJvbHNcIik7XHJcblx0XHR0aGlzLmJ0bkNvbnRyb2xzLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQuY29udHJvbHNQYW5lbDsgfVxyXG5cclxuXHRcdHRoaXMuYnRuQ2hlYXRzID0gdGhpcy5vcHRpb25zUGFuZWwuYWRkQnV0dG9uKFwiY2hlYXRzXCIpO1xyXG5cdFx0dGhpcy5idG5DaGVhdHMuZGlzYWJsZWQgPSB0cnVlO1xyXG5cdFx0dGhpcy5idG5DaGVhdHMub25DbGljayA9IGZ1bmN0aW9uKCkgeyB0aGF0LmFjdGl2ZVBhbmVsID0gdGhhdC5jaGVhdHNQYW5lbDsgfVxyXG5cclxuXHRcdHRoaXMub3B0aW9uc1BhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5PcHRpb25zQmFjayA9IHRoaXMub3B0aW9uc1BhbmVsLmFkZEJ1dHRvbihcImJhY2tcIik7XHJcblx0XHR0aGlzLmJ0bk9wdGlvbnNCYWNrLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQudG9wUGFuZWw7IH07XHJcblx0fSxcclxuXHJcblx0bGF5b3V0T25saW5lUGFuZWw6IGZ1bmN0aW9uKHJvb21zKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgbGV0IGJhY2tPbkNsaWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHRoYXQuYWN0aXZlUGFuZWwgPSB0aGF0LnRvcFBhbmVsO1xyXG4gICAgICBHQU1FLm9ubGluZU1hbmFnZXIuc3RvcCgpO1xyXG4gICAgfTtcclxuXHRcdHRoaXMub25saW5lUGFuZWwgPSBuZXcgR1MuVUlDb21wb25lbnRzLk1lbnVQYW5lbCh0aGlzLmN2cywgbmV3IFRIUkVFLlZlY3RvcjIoLTQwMCwgLTE2MCksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSwgbmV3IFRIUkVFLlZlY3RvcjIoODAwLCA1MjApLCA2MCwgNjUpO1xyXG4gICAgaWYgKHJvb21zID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aGlzLmxibExvYWRpbmcgPSB0aGlzLm9ubGluZVBhbmVsLmFkZERvdWJsZUxhYmVsKFwibG9hZGluZyBSb29tc1wiLCBcIlwiKTtcclxuICAgICAgICB0aGlzLmJ0bm9ubGluZUJhY2sgPSB0aGlzLm9ubGluZVBhbmVsLmFkZEJ1dHRvbihcImJhY2tcIik7XHJcbiAgICAgICAgdGhpcy5idG5vbmxpbmVCYWNrLm9uQ2xpY2sgPSBiYWNrT25DbGljaztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCByb29tTmFtZXMgPSByb29tcyB8fCBbXTtcclxuICAgICAgaWYgKHJvb21OYW1lcy5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLmxibFJvb21zID0gdGhpcy5vbmxpbmVQYW5lbC5hZGREb3VibGVMYWJlbChcIlJvb21zXCIsIFwiXCIpO1xyXG4gICAgICAgIGZvciAoaSBpbiByb29tTmFtZXMpIHtcclxuICAgICAgICAgIHRoaXNbJ2J0bkdyYXBoaWNzJyArIGldID0gdGhpcy5vbmxpbmVQYW5lbC5hZGREb3VibGVMYWJlbChyb29tTmFtZXNbaV0sIFwiXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmxibFJvb21zID0gdGhpcy5vbmxpbmVQYW5lbC5hZGREb3VibGVMYWJlbChcIk5vIFJvb21zIEZvdW5kXCIsIFwiXCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLm9ubGluZVBhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG4gICAgICB0aGlzLmJ0bk9ubGluZVJvb21OYW1lID0gdGhpcy5vbmxpbmVQYW5lbC5hZGRUZXh0RmllbGQoXCJOYW1lXCIsIFwiZW50ZXJcIiwgW1wiXCJdKTtcclxuXHJcbiAgICAgIHRoaXMuYnRuT25saW5lU3RhcnQgPSB0aGlzLm9ubGluZVBhbmVsLmFkZEJ1dHRvbihcImpvaW5cIik7XHJcbiAgICAgIHRoaXMuYnRuT25saW5lU3RhcnQub25DbGljayA9ICgpID0+IHtcclxuICAgICAgICBHQU1FLm9ubGluZU1hbmFnZXIuam9pblJvb20odGhhdC5idG5PbmxpbmVSb29tTmFtZS5idXR0b24udGV4dCk7XHJcbiAgICAgICAgLy8gVE9ETyBvcGVuIGxldmVsIGFmdGVyIHByb21wdGVkIGZyb20gc2VydmVyXHJcbiAgICAgICAgLy8gR0FNRS5sb2FkT25saW5lTGV2ZWwoXCJhaXJzdHJpcDFvbmxpbmVcIilcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHRoaXMuYnRub25saW5lQmFjayA9IHRoaXMub25saW5lUGFuZWwuYWRkQnV0dG9uKFwiYmFja1wiKTtcclxuICAgICAgdGhpcy5idG5vbmxpbmVCYWNrLm9uQ2xpY2sgPSBiYWNrT25DbGljaztcclxuXHJcbiAgICAgIEdTLktleWJpbmRTZXR0aW5ncy50ZXh0aW5wdXQub25Nb2RpZnlpbmdUZXh0U3RhcnQgPSAoZSkgPT4ge1xyXG4gICAgICAgIGxldCBidXR0b24gPSB0aGlzLmJ0bk9ubGluZVJvb21OYW1lLmJ1dHRvbjtcclxuICAgICAgICBsZXQgam9pbkJ1dHRvbiA9IHRoaXMuYnRuT25saW5lU3RhcnQ7XHJcbiAgICAgICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgam9pbkJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgYnV0dG9uLnRleHQgPSBcIlwiO1xyXG4gICAgICAgIGJ1dHRvbi5zdGF0ZXMgPSBbXCJcIl07XHJcbiAgICAgICAgYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gMDtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIEdTLktleWJpbmRTZXR0aW5ncy50ZXh0aW5wdXQub25Nb2RpZnlpbmdUZXh0U3RvcCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBsZXQgYnV0dG9uID0gdGhhdC5idG5PbmxpbmVSb29tTmFtZS5idXR0b247XHJcbiAgICAgICAgbGV0IGpvaW5CdXR0b24gPSB0aGF0LmJ0bk9ubGluZVN0YXJ0O1xyXG4gICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIGpvaW5CdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICBidXR0b25UZXh0ID0gYnV0dG9uLnRleHQgfHwgXCJcIjtcclxuICAgICAgICBidXR0b24uc3RhdGVzID0gW2J1dHRvblRleHRdO1xyXG4gICAgICAgIGJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IDA7XHJcblxyXG4gICAgICAgIEdTLlNldHRpbmdzLnJvb21OYW1lID0gYnV0dG9uVGV4dDtcclxuXHJcbiAgICAgICAgaWYgKGUuc3VjY2Vzcykge1xyXG4gICAgICAgICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICBqb2luQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgR1MuU2V0dGluZ3Muc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cdH0sXHJcblxyXG5cdGluaXRPbmxpbmVQYW5lbDogZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLmxheW91dE9ubGluZVBhbmVsKCk7XHJcblx0fSxcclxuXHJcblx0aW5pdEdyYXBoaWNzUGFuZWw6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMuZ3JhcGhpY3NQYW5lbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudVBhbmVsKHRoaXMuY3ZzLCBuZXcgVEhSRUUuVmVjdG9yMigtNDAwLCAtMTYwKSxcclxuXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSwgbmV3IFRIUkVFLlZlY3RvcjIoODAwLCA1MjApLCA0MCwgNDMpO1xyXG5cclxuXHRcdHRoaXMuYnRuVG9nZ2xlSGFsZlNpemUgPSB0aGlzLmdyYXBoaWNzUGFuZWwuYWRkVG9nZ2xlQnV0dG9uKFwiaGFsZi1zaXplIHJlbmRlcmluZ1wiKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlSGFsZlNpemUuYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gKEdTLlNldHRpbmdzLmhhbGZTaXplID09PSB0cnVlKSA/IDAgOiAxO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVIYWxmU2l6ZS5idXR0b24ub25DbGljayA9IGZ1bmN0aW9uKGUpIHsgR1MuU2V0dGluZ3MuaGFsZlNpemUgPSAoZS5zdGF0ZSA9PT0gXCJvblwiKTsgfTtcclxuXHJcblx0XHR0aGlzLmdyYXBoaWNzUGFuZWwuYWRkRW1wdHlSb3coKTtcclxuXHJcblx0XHR0aGlzLmJ0blRvZ2dsZVNTQU8gPSB0aGlzLmdyYXBoaWNzUGFuZWwuYWRkVG9nZ2xlQnV0dG9uKFwiU1NBT1wiKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlU1NBTy5idXR0b24uY3VycmVudFN0YXRlSW5kZXggPSAoR1MuU2V0dGluZ3Muc3NhbyA9PT0gdHJ1ZSkgPyAwIDogMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlU1NBTy5idXR0b24ub25DbGljayA9IGZ1bmN0aW9uKGUpIHsgR1MuU2V0dGluZ3Muc3NhbyA9IChlLnN0YXRlID09PSBcIm9uXCIpOyB9O1xyXG5cclxuXHRcdHRoaXMuYnRuVG9nZ2xlQmxvb20gPSB0aGlzLmdyYXBoaWNzUGFuZWwuYWRkVG9nZ2xlQnV0dG9uKFwiYmxvb21cIik7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZUJsb29tLmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IChHUy5TZXR0aW5ncy5ibG9vbSA9PT0gdHJ1ZSkgPyAwIDogMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlQmxvb20uYnV0dG9uLm9uQ2xpY2sgPSBmdW5jdGlvbihlKSB7IEdTLlNldHRpbmdzLmJsb29tID0gKGUuc3RhdGUgPT09IFwib25cIik7IH07XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVOb2lzZSA9IHRoaXMuZ3JhcGhpY3NQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJub2lzZSBmaWx0ZXJcIik7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZU5vaXNlLmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IChHUy5TZXR0aW5ncy5ub2lzZSA9PT0gdHJ1ZSkgPyAwIDogMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlTm9pc2UuYnV0dG9uLm9uQ2xpY2sgPSBmdW5jdGlvbihlKSB7IEdTLlNldHRpbmdzLm5vaXNlID0gKGUuc3RhdGUgPT09IFwib25cIik7IH07XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVWaWduZXR0ZSA9IHRoaXMuZ3JhcGhpY3NQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJ2aWduZXR0ZVwiKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlVmlnbmV0dGUuYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gKEdTLlNldHRpbmdzLnZpZ25ldHRlID09PSB0cnVlKSA/IDAgOiAxO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVWaWduZXR0ZS5idXR0b24ub25DbGljayA9IGZ1bmN0aW9uKGUpIHsgR1MuU2V0dGluZ3MudmlnbmV0dGUgPSAoZS5zdGF0ZSA9PT0gXCJvblwiKTsgfTtcclxuXHJcblx0XHR0aGlzLmJ0blRvZ2dsZUZYQUEgPSB0aGlzLmdyYXBoaWNzUGFuZWwuYWRkVG9nZ2xlQnV0dG9uKFwiRlhBQVwiKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlRlhBQS5idXR0b24uY3VycmVudFN0YXRlSW5kZXggPSAoR1MuU2V0dGluZ3MuZnhhYSA9PT0gdHJ1ZSkgPyAwIDogMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlRlhBQS5idXR0b24ub25DbGljayA9IGZ1bmN0aW9uKGUpIHsgR1MuU2V0dGluZ3MuZnhhYSA9IChlLnN0YXRlID09PSBcIm9uXCIpOyB9O1xyXG5cclxuXHRcdHRoaXMuZ3JhcGhpY3NQYW5lbC5hZGRFbXB0eVJvdygpO1xyXG5cclxuXHRcdHRoaXMubnVtYmVyUGlja2VyRk9WID0gdGhpcy5ncmFwaGljc1BhbmVsLmFkZE51bWJlclBpY2tlcihcImZpZWxkIG9mIHZpZXdcIiwgR1MuU2V0dGluZ3MuZm92LCBHUy5TZXR0aW5ncy5mb3ZNaW4sIEdTLlNldHRpbmdzLmZvdk1heCwgNSk7XHJcblx0XHR0aGlzLm51bWJlclBpY2tlckZPVi5udW1iZXJQaWNrZXIub25DaGFuZ2UgPSBmdW5jdGlvbihlKSB7IEdTLlNldHRpbmdzLmZvdiA9IGUudmFsdWU7IH07XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93RlBTID0gdGhpcy5ncmFwaGljc1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcInNob3cgRlBTXCIpO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93RlBTLmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IChHUy5TZXR0aW5ncy5zaG93RlBTID09PSB0cnVlKSA/IDAgOiAxO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93RlBTLmJ1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24oZSkgeyBHUy5TZXR0aW5ncy5zaG93RlBTID0gKGUuc3RhdGUgPT09IFwib25cIik7IH07XHJcblxyXG5cdFx0dGhpcy5ncmFwaGljc1BhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5HcmFwaGljc0JhY2sgPSB0aGlzLmdyYXBoaWNzUGFuZWwuYWRkQnV0dG9uKFwiYmFja1wiKTtcclxuXHRcdHRoaXMuYnRuR3JhcGhpY3NCYWNrLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQub3B0aW9uc1BhbmVsOyB9O1xyXG5cdH0sXHJcblxyXG5cdGluaXRTb3VuZFBhbmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR0aGlzLnNvdW5kUGFuZWwgPSBuZXcgR1MuVUlDb21wb25lbnRzLk1lbnVQYW5lbCh0aGlzLmN2cywgbmV3IFRIUkVFLlZlY3RvcjIoLTQwMCwgLTE2MCksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSwgbmV3IFRIUkVFLlZlY3RvcjIoODAwLCA1MjApLCA0MCwgNDMpO1xyXG5cclxuXHRcdHRoaXMubnVtYmVyUGlja2VyU291bmQgPSB0aGlzLnNvdW5kUGFuZWwuYWRkTnVtYmVyUGlja2VyKFwic291bmQgdm9sdW1lXCIsIEdTLlNldHRpbmdzLnNvdW5kLCBHUy5TZXR0aW5ncy5zb3VuZE1pbiwgR1MuU2V0dGluZ3Muc291bmRNYXgsIDEpO1xyXG5cdFx0dGhpcy5udW1iZXJQaWNrZXJTb3VuZC5udW1iZXJQaWNrZXIub25DaGFuZ2UgPSBmdW5jdGlvbihlKSB7IEdTLlNldHRpbmdzLnNvdW5kID0gZS52YWx1ZTsgfTtcclxuXHJcblx0XHR0aGlzLm51bWJlclBpY2tlck11c2ljID0gdGhpcy5zb3VuZFBhbmVsLmFkZE51bWJlclBpY2tlcihcIm11c2ljIHZvbHVtZVwiLCBHUy5TZXR0aW5ncy5tdXNpYywgR1MuU2V0dGluZ3MubXVzaWNNaW4sIEdTLlNldHRpbmdzLm11c2ljTWF4LCAxKTtcclxuXHRcdHRoaXMubnVtYmVyUGlja2VyTXVzaWMubnVtYmVyUGlja2VyLm9uQ2hhbmdlID0gZnVuY3Rpb24oZSkgeyBHUy5TZXR0aW5ncy5tdXNpYyA9IGUudmFsdWU7IH07XHJcblxyXG5cdFx0dGhpcy5zb3VuZFBhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5Tb3VuZEJhY2sgPSB0aGlzLnNvdW5kUGFuZWwuYWRkQnV0dG9uKFwiYmFja1wiKTtcclxuXHRcdHRoaXMuYnRuU291bmRCYWNrLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQub3B0aW9uc1BhbmVsOyB9O1xyXG5cdH0sXHJcblxyXG5cdGluaXRHYW1lcGxheVBhbmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR0aGlzLmdhbWVwbGF5UGFuZWwgPSBuZXcgR1MuVUlDb21wb25lbnRzLk1lbnVQYW5lbCh0aGlzLmN2cywgbmV3IFRIUkVFLlZlY3RvcjIoLTQwMCwgLTE2MCksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSwgbmV3IFRIUkVFLlZlY3RvcjIoODAwLCA1MjApLCA0MCwgNDMpO1xyXG5cclxuXHRcdHRoaXMuYnRuVG9nZ2xlVmlld0JvYiA9IHRoaXMuZ2FtZXBsYXlQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJ2aWV3IGJvYmJpbmdcIik7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZVZpZXdCb2IuYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gKEdTLlNldHRpbmdzLnZpZXdCb2IgPT09IHRydWUpID8gMCA6IDE7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZVZpZXdCb2IuYnV0dG9uLm9uQ2xpY2sgPSBmdW5jdGlvbihlKSB7IEdTLlNldHRpbmdzLnZpZXdCb2IgPSAoZS5zdGF0ZSA9PT0gXCJvblwiKTsgfTtcclxuXHJcblx0XHR0aGlzLmJ0blRvZ2dsZVdlYXBvbkJvYiA9IHRoaXMuZ2FtZXBsYXlQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJ3ZWFwb24gYm9iYmluZ1wiKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlV2VhcG9uQm9iLmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IChHUy5TZXR0aW5ncy53ZWFwb25Cb2IgPT09IHRydWUpID8gMCA6IDE7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZVdlYXBvbkJvYi5idXR0b24ub25DbGljayA9IGZ1bmN0aW9uKGUpIHsgR1MuU2V0dGluZ3Mud2VhcG9uQm9iID0gKGUuc3RhdGUgPT09IFwib25cIik7IH07XHJcblxyXG5cdFx0dGhpcy5nYW1lcGxheVBhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93SFVEID0gdGhpcy5nYW1lcGxheVBhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcInNob3cgSFVEXCIpO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93SFVELmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IChHUy5TZXR0aW5ncy5zaG93SFVEID09PSB0cnVlKSA/IDAgOiAxO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93SFVELmJ1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24oZSkgeyBHUy5TZXR0aW5ncy5zaG93SFVEID0gKGUuc3RhdGUgPT09IFwib25cIik7IH07XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93V2VhcG9uID0gdGhpcy5nYW1lcGxheVBhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcInNob3cgd2VhcG9uXCIpO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93V2VhcG9uLmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IChHUy5TZXR0aW5ncy5zaG93V2VhcG9uID09PSB0cnVlKSA/IDAgOiAxO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG93V2VhcG9uLmJ1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24oZSkgeyBHUy5TZXR0aW5ncy5zaG93V2VhcG9uID0gKGUuc3RhdGUgPT09IFwib25cIik7IH07XHJcblxyXG5cdFx0dGhpcy5nYW1lcGxheVBhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5HYW1lcGxheUJhY2sgPSB0aGlzLmdhbWVwbGF5UGFuZWwuYWRkQnV0dG9uKFwiYmFja1wiKTtcclxuXHRcdHRoaXMuYnRuR2FtZXBsYXlCYWNrLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQub3B0aW9uc1BhbmVsOyB9O1xyXG5cdH0sXHJcblxyXG5cdGluaXRDaGVhdHNQYW5lbDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5jaGVhdHNQYW5lbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudVBhbmVsKHRoaXMuY3ZzLCBuZXcgVEhSRUUuVmVjdG9yMigtNDAwLCAtMTYwKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoMC41LCAwLjUpLCBuZXcgVEhSRUUuVmVjdG9yMig4MDAsIDUyMCksIDQwLCA0Myk7XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVHb2QgPSB0aGlzLmNoZWF0c1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcImdvZCBtb2RlXCIpO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVHb2QuYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlR29kLmJ1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRHQU1FLmdyaWQucGxheWVyLmdvZCgpO1xyXG5cdFx0XHRHUy5EZWJ1Z1VJLmFkZFRlbXBMaW5lKFwiZ29kIG1vZGUgXCIgKyBlLnN0YXRlKTtcclxuXHRcdH07XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVGbHkgPSB0aGlzLmNoZWF0c1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcImZseSBtb2RlXCIpO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVGbHkuYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlRmx5LmJ1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRHQU1FLmdyaWQucGxheWVyLmZseSgpO1xyXG5cdFx0XHRHUy5EZWJ1Z1VJLmFkZFRlbXBMaW5lKFwiZmx5IG1vZGUgXCIgKyBlLnN0YXRlKTtcclxuXHRcdH07XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVOb2NsaXAgPSB0aGlzLmNoZWF0c1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcIm5vY2xpcCBtb2RlXCIpO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVOb2NsaXAuYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlTm9jbGlwLmJ1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRHQU1FLmdyaWQucGxheWVyLm5vQ2xpcCgpO1xyXG5cdFx0XHRHUy5EZWJ1Z1VJLmFkZFRlbXBMaW5lKFwibm9jbGlwIG1vZGUgXCIgKyBlLnN0YXRlKTtcclxuXHRcdH07XHJcblxyXG5cdFx0dGhpcy5jaGVhdHNQYW5lbC5hZGRFbXB0eVJvdygpO1xyXG5cclxuXHRcdHRoaXMuYnRuQ2hlYXRzR2l2ZUFsbCA9IHRoaXMuY2hlYXRzUGFuZWwuYWRkQnV0dG9uKFwiZ2l2ZSBhbW1vIGFuZCBhbGwgd2VhcG9uc1wiKTtcclxuXHRcdHRoaXMuYnRuQ2hlYXRzR2l2ZUFsbC5vbkNsaWNrID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdEdBTUUuZ3JpZC5wbGF5ZXIuZ2l2ZUFsbCgpO1xyXG5cdFx0XHRHUy5EZWJ1Z1VJLmFkZFRlbXBMaW5lKFwiYWxsIHdlYXBvbnMgYW5kIG1heCBhbW1vIGdpdmVuXCIpO1xyXG5cdFx0fTtcclxuXHJcblx0XHR0aGlzLmNoZWF0c1BhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5DaGVhdHNCYWNrID0gdGhpcy5jaGVhdHNQYW5lbC5hZGRCdXR0b24oXCJiYWNrXCIpO1xyXG5cdFx0dGhpcy5idG5DaGVhdHNCYWNrLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQub3B0aW9uc1BhbmVsOyB9O1xyXG5cdH0sXHJcblxyXG5cdGluaXRMZXZlbFNlbGVjdFBhbmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR0aGlzLmxldmVsU2VsZWN0UGFuZWwgPSBuZXcgR1MuVUlDb21wb25lbnRzLk1lbnVQYW5lbCh0aGlzLmN2cywgbmV3IFRIUkVFLlZlY3RvcjIoLTQwMCwgLTE2MCksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSwgbmV3IFRIUkVFLlZlY3RvcjIoODAwLCA1MjApLCA2MCwgMTQwKTtcclxuXHJcblx0XHR0aGlzLmJ0bkxldmVsMSA9IHRoaXMubGV2ZWxTZWxlY3RQYW5lbC5hZGRJbWFnZUJ1dHRvbihcImFpcnN0cmlwIG9uZVwiLCB0aGlzLmFzc2V0cy5pbWFnZXMudGh1bWJfYWlyc3RyaXAxKTtcclxuXHRcdHRoaXMuYnRuTGV2ZWwxLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgR0FNRS5sb2FkTGV2ZWwoXCJhaXJzdHJpcDFcIik7IH1cclxuXHRcdHRoaXMuYnRuTGV2ZWwxID0gdGhpcy5sZXZlbFNlbGVjdFBhbmVsLmFkZEltYWdlQnV0dG9uKFwiZHJlbmNyb21cIiwgdGhpcy5hc3NldHMuaW1hZ2VzLnRodW1iX2RyZW5jcm9tKTtcclxuXHRcdHRoaXMuYnRuTGV2ZWwxLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgR0FNRS5sb2FkTGV2ZWwoXCJkcmVuY3JvbVwiKTsgfVxyXG5cdFx0dGhpcy5idG5MZXZlbDIgPSB0aGlzLmxldmVsU2VsZWN0UGFuZWwuYWRkSW1hZ2VCdXR0b24oXCJzYWNyb3NhbmN0XCIsIHRoaXMuYXNzZXRzLmltYWdlcy50aHVtYl9zYWNyb3NhbmN0KTtcclxuXHRcdHRoaXMuYnRuTGV2ZWwyLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgR0FNRS5sb2FkTGV2ZWwoXCJzYWNyb3NhbmN0XCIpOyB9XHJcblxyXG5cdFx0dGhpcy5sZXZlbFNlbGVjdFBhbmVsLmZvbnRTaXplID0gNDA7XHJcblx0XHR0aGlzLmxldmVsU2VsZWN0UGFuZWwucm93SGVpZ2h0ID0gNDM7XHJcblxyXG5cdFx0dGhpcy5sZXZlbFNlbGVjdFBhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5MZXZlbFNlbGVjdEJhY2sgPSB0aGlzLmxldmVsU2VsZWN0UGFuZWwuYWRkQnV0dG9uKFwiYmFja1wiKTtcclxuXHRcdHRoaXMuYnRuTGV2ZWxTZWxlY3RCYWNrLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHsgdGhhdC5hY3RpdmVQYW5lbCA9IHRoYXQudG9wUGFuZWw7IH07XHJcblx0fSxcclxuXHJcblx0aW5pdENvbnRyb2xzUGFuZWw6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMuY29udHJvbHNQYW5lbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudVBhbmVsKHRoaXMuY3ZzLCBuZXcgVEhSRUUuVmVjdG9yMigtNDAwLCAtMTYwKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoMC41LCAwLjUpLCBuZXcgVEhSRUUuVmVjdG9yMig4MDAsIDUyMCksIDI4LCAzMSk7XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVNb3VzZUludmVydFkgPSB0aGlzLmNvbnRyb2xzUGFuZWwuYWRkVG9nZ2xlQnV0dG9uKFwiaW52ZXJ0IG1vdXNlIHkgYXhpc1wiKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlTW91c2VJbnZlcnRZLmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IChHUy5TZXR0aW5ncy5tb3VzZUludmVydFkgPT09IHRydWUpID8gMCA6IDE7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZU1vdXNlSW52ZXJ0WS5idXR0b24ub25DbGljayA9IGZ1bmN0aW9uKGUpIHsgR1MuU2V0dGluZ3MubW91c2VJbnZlcnRZID0gKGUuc3RhdGUgPT09IFwib25cIik7IH07XHJcblxyXG5cdFx0dGhpcy5udW1iZXJQaWNrZXJNb3VzZSA9IHRoaXMuY29udHJvbHNQYW5lbC5hZGROdW1iZXJQaWNrZXIoXCJtb3VzZSBzZW5zaXRpdml0eVwiLFxyXG5cdFx0XHRHUy5TZXR0aW5ncy5tb3VzZSwgR1MuU2V0dGluZ3MubW91c2VNaW4sIEdTLlNldHRpbmdzLm1vdXNlTWF4LCAxKTtcclxuXHRcdHRoaXMubnVtYmVyUGlja2VyTW91c2UubnVtYmVyUGlja2VyLm9uQ2hhbmdlID0gZnVuY3Rpb24oZSkgeyBHUy5TZXR0aW5ncy5tb3VzZSA9IGUudmFsdWU7IH07XHJcblxyXG5cdFx0dGhpcy5jb250cm9sc1BhbmVsLmFkZEVtcHR5Um93KCk7XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVNb3ZlRm9yd2FyZCA9IHRoaXMuY29udHJvbHNQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJtb3ZlIGZvcndhcmRcIiwgW1wiV1wiXSk7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZU1vdmVCYWNrd2FyZCA9IHRoaXMuY29udHJvbHNQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJtb3ZlIGJhY2t3YXJkXCIsIFtcIlNcIl0pO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTdHJhZmVMZWZ0ID0gdGhpcy5jb250cm9sc1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcInN0cmFmZSBsZWZ0XCIsIFtcIkFcIl0pO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTdHJhZmVSaWdodCA9IHRoaXMuY29udHJvbHNQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJzdHJhZmUgcmlnaHRcIiwgW1wiRFwiXSk7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZVVzZSA9IHRoaXMuY29udHJvbHNQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJ1c2VcIiwgW1wiRVwiXSk7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZVNob290ID0gdGhpcy5jb250cm9sc1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcInNob290XCIsIFtcIm1vdXNlIGxlZnRcIl0pO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVQaXN0b2wgPSB0aGlzLmNvbnRyb2xzUGFuZWwuYWRkVG9nZ2xlQnV0dG9uKFwicGlzdG9sXCIsIFtcIjJcIl0pO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVTaG90Z3VuID0gdGhpcy5jb250cm9sc1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcInNob3RndW5cIiwgW1wiM1wiXSk7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZUh5cGVyQmxhc3RlciA9IHRoaXMuY29udHJvbHNQYW5lbC5hZGRUb2dnbGVCdXR0b24oXCJoeXBlcmJsYXN0ZXJcIiwgW1wiNFwiXSk7XHJcblxyXG5cdFx0dGhpcy5idG5Ub2dnbGVBdXRvbWFwID0gdGhpcy5jb250cm9sc1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcImF1dG9tYXBcIiwgW1wiVEFCXCJdKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlQXV0b21hcC5idXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVNZW51ID0gdGhpcy5jb250cm9sc1BhbmVsLmFkZFRvZ2dsZUJ1dHRvbihcIm1lbnVcIiwgW1wiRVNDXCJdKTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlTWVudS5idXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG5cclxuXHRcdHRoaXMuY29udHJvbHNQYW5lbC5hZGRFbXB0eVJvdygpO1xyXG5cclxuXHRcdHRoaXMuYnRuQ29udHJvbHNCYWNrID0gdGhpcy5jb250cm9sc1BhbmVsLmFkZEJ1dHRvbihcImJhY2tcIik7XHJcblx0XHR0aGlzLmJ0bkNvbnRyb2xzQmFjay5vbkNsaWNrID0gZnVuY3Rpb24oKSB7IHRoYXQuYWN0aXZlUGFuZWwgPSB0aGF0Lm9wdGlvbnNQYW5lbDsgfTtcclxuXHJcblx0XHR0aGlzLmF0dGFjaFJlYm91bmRFdmVudEhhbmRsZXJzKCk7XHJcblx0fSxcclxuXHJcblx0YXR0YWNoUmVib3VuZEV2ZW50SGFuZGxlcnM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGtleUJ1dHRvbk1hcCA9IHtcclxuXHRcdFx0bW92ZUZvcndhcmQ6IFx0dGhpcy5idG5Ub2dnbGVNb3ZlRm9yd2FyZCxcclxuXHRcdFx0bW92ZUJhY2t3YXJkOiBcdHRoaXMuYnRuVG9nZ2xlTW92ZUJhY2t3YXJkLFxyXG5cdFx0XHRzdHJhZmVMZWZ0OiBcdHRoaXMuYnRuVG9nZ2xlU3RyYWZlTGVmdCxcclxuXHRcdFx0c3RyYWZlUmlnaHQ6IFx0dGhpcy5idG5Ub2dnbGVTdHJhZmVSaWdodCxcclxuXHRcdFx0dXNlOiBcdFx0XHR0aGlzLmJ0blRvZ2dsZVVzZSxcclxuXHRcdFx0c2hvb3Q6IFx0XHRcdHRoaXMuYnRuVG9nZ2xlU2hvb3QsXHJcblx0XHRcdHBpc3RvbDogXHRcdHRoaXMuYnRuVG9nZ2xlUGlzdG9sLFxyXG5cdFx0XHRzaG90Z3VuOiBcdFx0dGhpcy5idG5Ub2dnbGVTaG90Z3VuLFxyXG5cdFx0XHRoeXBlcmJsYXN0ZXI6IFx0dGhpcy5idG5Ub2dnbGVIeXBlckJsYXN0ZXJcclxuXHRcdH07XHJcblxyXG5cdFx0Zm9yICh2YXIgaSBpbiBrZXlCdXR0b25NYXApIHtcclxuXHRcdFx0dmFyIGJ1dHRvbiA9IGtleUJ1dHRvbk1hcFtpXS5idXR0b247XHJcblx0XHRcdGJ1dHRvbi5vbkNsaWNrID0gZ2V0T25DbGlja0V2ZW50SGFuZGxlcihpKTtcclxuXHRcdFx0YnV0dG9uLnN0YXRlcyA9IFtHUy5LZXliaW5kc1tpXS5jb250cm9sTmFtZV07XHJcblx0XHRcdGJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IDA7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0T25DbGlja0V2ZW50SGFuZGxlcihhY3Rpb25OYW1lKSB7XHJcblx0XHRcdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRHUy5LZXliaW5kU2V0dGluZ3MucmVib3VuZC5tb2RpZnlLZXliaW5kKEdTLktleWJpbmRzW2FjdGlvbk5hbWVdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdEdTLktleWJpbmRTZXR0aW5ncy5yZWJvdW5kLm9uTW9kaWZ5aW5nS2V5YmluZFN0YXJ0ID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHR2YXIgYnV0dG9uID0ga2V5QnV0dG9uTWFwW2Uua2V5YmluZC5hY3Rpb25OYW1lXS5idXR0b247XHJcblx0XHRcdGJ1dHRvbi5zdGF0ZXMgPSBbXCJwcmVzcyBuZXcga2V5XCJdO1xyXG5cdFx0XHRidXR0b24uY3VycmVudFN0YXRlSW5kZXggPSAwO1xyXG5cdFx0fTtcclxuXHJcblx0XHRHUy5LZXliaW5kU2V0dGluZ3MucmVib3VuZC5vbk1vZGlmeWluZ0tleWJpbmRTdG9wID0gZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRmb3IgKHZhciBpIGluIGtleUJ1dHRvbk1hcCkge1xyXG5cdFx0XHRcdHZhciBidXR0b24gPSBrZXlCdXR0b25NYXBbaV0uYnV0dG9uO1xyXG5cdFx0XHRcdGJ1dHRvbi5zdGF0ZXMgPSBbR1MuS2V5YmluZHNbaV0uY29udHJvbE5hbWVdO1xyXG5cdFx0XHRcdGJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IDA7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChlLnN1Y2Nlc3MpIHtcclxuXHRcdFx0XHR2YXIgYnV0dG9uMiA9IGtleUJ1dHRvbk1hcFtlLmtleWJpbmQuYWN0aW9uTmFtZV0uYnV0dG9uO1xyXG5cdFx0XHRcdHZhciBvbkNsaWNrRXZlbnRIYW5kbGVyID0gYnV0dG9uMi5vbkNsaWNrO1xyXG5cdFx0XHRcdGJ1dHRvbjIub25DbGljayA9IGZ1bmN0aW9uKCkge307XHJcblxyXG5cdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRidXR0b24yLm9uQ2xpY2sgPSBvbkNsaWNrRXZlbnRIYW5kbGVyO1xyXG5cdFx0XHRcdH0sIDEwMCk7XHJcblxyXG5cdFx0XHRcdEdTLlNldHRpbmdzLnNhdmVTZXR0aW5ncygpO1xyXG5cclxuXHRcdFx0XHR2YXIgbm90aWZpY2F0aW9ucyA9IEdBTUUudWlNYW5hZ2VyLm5vdGlmaWNhdGlvbnM7XHJcblx0XHRcdFx0aWYgKG5vdGlmaWNhdGlvbnMpIHtcclxuXHRcdFx0XHRcdG5vdGlmaWNhdGlvbnMudXNlVGV4dCA9IFwiW1wiICsgR1MuS2V5YmluZHMudXNlLmNvbnRyb2xOYW1lICsgXCJdIHRvIHVzZVwiO1xyXG5cdFx0XHRcdFx0bm90aWZpY2F0aW9ucy5jYWxjdWxhdGVTaXplcygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHR9LFxyXG5cclxuXHRpbml0Q3JlZGl0c1BhbmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR0aGlzLmNyZWRpdHNQYW5lbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudVBhbmVsKHRoaXMuY3ZzLCBuZXcgVEhSRUUuVmVjdG9yMigtNDAwLCAtMTYwKSxcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoMC41LCAwLjUpLCBuZXcgVEhSRUUuVmVjdG9yMig4MDAsIDUyMCksIDMwLCAzMyk7XHJcblxyXG5cdFx0dGhpcy5kYmxMYWJlbENyZWRpdHMxID0gdGhpcy5jcmVkaXRzUGFuZWwuYWRkRG91YmxlTGFiZWwoXCJjb2RlLCBcXFwiYXJ0XFxcIlwiLCBcInNlcmdpdSB2YWxlbnRpbiBidWN1clwiKTtcclxuXHJcblx0XHR0aGlzLmNyZWRpdHNQYW5lbC5hZGRFbXB0eVJvdygpO1xyXG5cclxuXHRcdHRoaXMuZGJsTGFiZWxDcmVkaXRzMjMgPSB0aGlzLmNyZWRpdHNQYW5lbC5hZGREb3VibGVMYWJlbChcIm11c2ljXCIsIFwiRFNUXCIpO1xyXG5cdFx0dGhpcy5kYmxMYWJlbENyZWRpdHMyNCA9IHRoaXMuY3JlZGl0c1BhbmVsLmFkZERvdWJsZUxhYmVsKFwiXCIsIFwiM3Vob3hcIik7XHJcblxyXG5cdFx0dGhpcy5jcmVkaXRzUGFuZWwuYWRkRW1wdHlSb3coKTtcclxuXHJcblx0XHR0aGlzLmRibExhYmVsQ3JlZGl0czMgPSB0aGlzLmNyZWRpdHNQYW5lbC5hZGREb3VibGVMYWJlbChcInNvdW5kIGVmZmVjdHNcIiwgXCJmcmVlc291bmQub3JnXCIpO1xyXG5cdFx0dGhpcy5kYmxMYWJlbENyZWRpdHM0ID0gdGhpcy5jcmVkaXRzUGFuZWwuYWRkRG91YmxlTGFiZWwoXCJcIiwgXCJvcGVuZ2FtZWFydC5vcmdcIik7XHJcblxyXG5cdFx0dGhpcy5jcmVkaXRzUGFuZWwuYWRkRW1wdHlSb3coKTtcclxuXHJcblx0XHR0aGlzLmRibExhYmVsQ3JlZGl0czUgPSB0aGlzLmNyZWRpdHNQYW5lbC5hZGREb3VibGVMYWJlbChcInNreWJveCB0ZXh0dXJlXCIsIFwiYWxleGNwZXRlcnNvbi5jb20vc3BhY2VzY2FwZVwiKTtcclxuXHJcblx0XHR0aGlzLmNyZWRpdHNQYW5lbC5hZGRFbXB0eVJvdygpO1xyXG5cclxuXHRcdHRoaXMuZGJsTGFiZWxDcmVkaXRzNiA9IHRoaXMuY3JlZGl0c1BhbmVsLmFkZERvdWJsZUxhYmVsKFwiZnJhbWV3b3Jrc1wiLCBcInRocmVlLmpzXCIpO1xyXG5cdFx0dGhpcy5kYmxMYWJlbENyZWRpdHM3ID0gdGhpcy5jcmVkaXRzUGFuZWwuYWRkRG91YmxlTGFiZWwoXCJcIiwgXCJ0d2Vlbi5qc1wiKTtcclxuXHRcdHRoaXMuZGJsTGFiZWxDcmVkaXRzOCA9IHRoaXMuY3JlZGl0c1BhbmVsLmFkZERvdWJsZUxhYmVsKFwiXCIsIFwianN6aXBcIik7XHJcblxyXG5cdFx0dGhpcy5jcmVkaXRzUGFuZWwuYWRkRW1wdHlSb3coKTtcclxuXHJcblx0XHR0aGlzLmJ0bkNyZWRpdHNCYWNrID0gdGhpcy5jcmVkaXRzUGFuZWwuYWRkQnV0dG9uKFwiYmFja1wiKTtcclxuXHRcdHRoaXMuYnRuQ3JlZGl0c0JhY2sub25DbGljayA9IGZ1bmN0aW9uKCkgeyB0aGF0LmFjdGl2ZVBhbmVsID0gdGhhdC50b3BQYW5lbDsgfTtcclxuXHR9LFxyXG5cclxuXHRpbml0Rm9vdGVyOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMubGFiZWwxID0gbmV3IEdTLlVJQ29tcG9uZW50cy5NZW51TGFiZWwodGhpcy5jdnMsIEdTLkdhbWVWZXJzaW9uLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMigtMjAsIC03MCksIG5ldyBUSFJFRS5WZWN0b3IyKDEsIDEpKTtcclxuXHRcdHRoaXMubGFiZWwxLnRleHRBbGlnbiA9IFwicmlnaHRcIjtcclxuXHRcdHRoaXMubGFiZWwxLmZvbnRTaXplID0gMzA7XHJcblx0XHR0aGlzLmNoaWxkcmVuLnB1c2godGhpcy5sYWJlbDEpO1xyXG5cclxuXHRcdHRoaXMubGFiZWwyID0gbmV3IEdTLlVJQ29tcG9uZW50cy5NZW51TGFiZWwodGhpcy5jdnMsIEdTLlJlbGVhc2VEYXRlLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMigtMjAsIC0zNSksIG5ldyBUSFJFRS5WZWN0b3IyKDEsIDEpKTtcclxuXHRcdHRoaXMubGFiZWwyLnRleHRBbGlnbiA9IFwicmlnaHRcIjtcclxuXHRcdHRoaXMubGFiZWwyLmZvbnRTaXplID0gMzA7XHJcblx0XHR0aGlzLmNoaWxkcmVuLnB1c2godGhpcy5sYWJlbDIpO1xyXG5cdH0sXHJcblxyXG5cdGluaXROZXdzQm94OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMubmV3c0JveCA9ICQoXCIubmV3cy1ib3hcIik7XHJcblx0XHR0aGlzLm5ld3NCb3guc2hvdygpO1xyXG5cdH0sXHJcblxyXG5cdHN3aXRjaFRvSW5nYW1lOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuaW5nYW1lID0gdHJ1ZTtcclxuXHRcdHRoaXMuYnRuQ2hlYXRzLmRpc2FibGVkID0gZmFsc2U7XHJcblx0XHR0aGlzLmJ0blRvZ2dsZUdvZC5idXR0b24uY3VycmVudFN0YXRlSW5kZXggPSAxO1xyXG5cdFx0dGhpcy5idG5Ub2dnbGVGbHkuYnV0dG9uLmN1cnJlbnRTdGF0ZUluZGV4ID0gMTtcclxuXHRcdHRoaXMuYnRuVG9nZ2xlTm9jbGlwLmJ1dHRvbi5jdXJyZW50U3RhdGVJbmRleCA9IDE7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuYWN0aXZlUGFuZWwudXBkYXRlKCk7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHRoaXMuY2hpbGRyZW5baV0udXBkYXRlKCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZHJhdzogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5pbmdhbWUpIHtcclxuXHRcdFx0dGhpcy5jdnMuYm94RmlsbCh0aGlzLmJhY2tncm91bmQub2Zmc2V0LCB0aGlzLmJhY2tncm91bmQucG9zLCB0aGlzLmJhY2tncm91bmQuc2l6ZSwgZmFsc2UsIHRoaXMuYmFja2dyb3VuZENvbG9yKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmN2cy5kcmF3SW1hZ2UodGhpcy5sb2dvLm9mZnNldCwgdGhpcy5sb2dvLnBvcywgdGhpcy5sb2dvLmltYWdlLCB0aGlzLmxvZ28uc2l6ZSwgdHJ1ZSk7XHJcblxyXG5cdFx0dGhpcy5hY3RpdmVQYW5lbC5kcmF3KCk7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dGhpcy5jaGlsZHJlbltpXS5kcmF3KCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0cmVtb3ZlTmV3c0JveDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLm5ld3NCb3gucmVtb3ZlKCk7XHJcblx0XHR0aGlzLm5ld3NCb3ggPSB1bmRlZmluZWQ7XHJcblx0fVxyXG59O1xyXG4iLCJHUy5VSUNvbXBvbmVudHMuTWVudUJ1dHRvbiA9IGZ1bmN0aW9uKHZlY3RvckNhbnZhcywgdGV4dCwgb2Zmc2V0LCBwb3MsIHNpemUsIG9uQ2xpY2ssIHN0YXRlcykge1xyXG5cdHRoaXMuY3ZzID0gdmVjdG9yQ2FudmFzO1xyXG5cclxuXHR0aGlzLmZvbnRTaXplID0gNDA7XHJcblx0dGhpcy50ZXh0ID0gdGV4dDtcclxuXHR0aGlzLnRleHRCYXNlbGluZSA9IFwibWlkZGxlXCI7XHJcblx0dGhpcy50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG5cclxuXHR0aGlzLm9mZnNldCA9IG9mZnNldDtcclxuXHR0aGlzLnBvcyA9IHBvcztcclxuXHR0aGlzLnNpemUgPSBzaXplO1xyXG5cdHRoaXMuYm9yZGVyUmFkaXVzID0gMTA7XHJcblxyXG5cdHRoaXMub25DbGljayA9IG9uQ2xpY2sgfHwgZnVuY3Rpb24oKSB7fTtcclxuXHR0aGlzLnN0YXRlcyA9IHN0YXRlcztcclxuXHR0aGlzLl9jdXJyZW50U3RhdGVJbmRleCA9IDA7XHJcblxyXG5cdHRoaXMubWluID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHR0aGlzLm1heCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdHRoaXMudGV4dE9mZnNldCA9IHRoaXMub2Zmc2V0LmNsb25lKCkuYWRkKHRoaXMuc2l6ZS5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKDAuNSkpO1xyXG5cdHRoaXMuaG92ZXIgPSBmYWxzZTtcclxuXHR0aGlzLmFjdGl2ZSA9IGZhbHNlO1xyXG5cdHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcclxuXHJcblx0dGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBHUy5VSUNvbG9ycy5idXR0b25Ib3ZlcjtcclxuXHR0aGlzLmZvcmVncm91bmRDb2xvciA9IEdTLlVJQ29sb3JzLmZvcmVncm91bmREaXNhYmxlZDtcclxufTtcclxuXHJcbkdTLlVJQ29tcG9uZW50cy5NZW51QnV0dG9uLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlDb21wb25lbnRzLk1lbnVCdXR0b24sXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgbXggPSBHUy5JbnB1dEhlbHBlci5tb3VzZVg7XHJcblx0XHR2YXIgbXkgPSBHUy5JbnB1dEhlbHBlci5tb3VzZVk7XHJcblxyXG5cdFx0dGhpcy5jdnMuY29udmVydFRvU2NyZWVuQ29vcmRzKHRoaXMucG9zLCB0aGlzLm1pbiwgdGhpcy5vZmZzZXQpO1xyXG5cdFx0dGhpcy5tYXguY29weSh0aGlzLm1pbikuYWRkKHRoaXMuc2l6ZSk7XHJcblxyXG5cdFx0aWYgKCF0aGlzLmRpc2FibGVkKSB7XHJcblx0XHRcdHRoaXMuZm9yZWdyb3VuZENvbG9yID0gR1MuVUlDb2xvcnMuZm9yZWdyb3VuZDtcclxuXHJcblx0XHRcdGlmIChteCA+PSB0aGlzLm1pbi54ICYmIG15ID49IHRoaXMubWluLnkgJiYgbXggPCB0aGlzLm1heC54ICYmIG15IDwgdGhpcy5tYXgueSkge1xyXG5cdFx0XHRcdHRoaXMuaG92ZXIgPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMuYmFja2dyb3VuZENvbG9yID0gR1MuVUlDb2xvcnMuYnV0dG9uSG92ZXI7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5ob3ZlciA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAodGhpcy5ob3Zlcikge1xyXG5cdFx0XHRcdGlmIChHUy5JbnB1dEhlbHBlci5sZWZ0TW91c2VEb3duKSB7XHJcblx0XHRcdFx0XHR0aGlzLmFjdGl2ZSA9IHRydWU7XHJcblx0XHRcdFx0XHR0aGlzLmJhY2tncm91bmRDb2xvciA9IEdTLlVJQ29sb3JzLmJ1dHRvbkFjdGl2ZTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuYWN0aXZlKSB7XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLnN0YXRlcyAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5fY3VycmVudFN0YXRlSW5kZXgrKztcclxuXHRcdFx0XHRcdFx0XHRpZiAodGhpcy5fY3VycmVudFN0YXRlSW5kZXggPj0gdGhpcy5zdGF0ZXMubGVuZ3RoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLl9jdXJyZW50U3RhdGVJbmRleCA9IDA7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdFx0XHR0aGlzLnRleHQgPSB0aGlzLnN0YXRlc1t0aGlzLl9jdXJyZW50U3RhdGVJbmRleF07XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5vbkNsaWNrKHsgc3RhdGU6IHRoaXMudGV4dCwgc3RhdGVJbmRleDogdGhpcy5fY3VycmVudFN0YXRlSW5kZXggfSk7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5vbkNsaWNrKCk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0aXZlID0gZmFsc2U7XHJcblx0XHRcdFx0XHRcdHRoaXMuYmFja2dyb3VuZENvbG9yID0gR1MuVUlDb2xvcnMuYnV0dG9uSG92ZXI7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmZvcmVncm91bmRDb2xvciA9IEdTLlVJQ29sb3JzLmZvcmVncm91bmREaXNhYmxlZDtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICghdGhpcy5kaXNhYmxlZCAmJiB0aGlzLmhvdmVyKSB7XHJcblx0XHRcdHRoaXMuY3ZzLnJvdW5kZWRCb3hGaWxsKHRoaXMub2Zmc2V0LCB0aGlzLnBvcywgdGhpcy5zaXplLCB0cnVlLCB0aGlzLmJvcmRlclJhZGl1cywgdGhpcy5iYWNrZ3JvdW5kQ29sb3IpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY3ZzLnRleHQodGhpcy50ZXh0T2Zmc2V0LCB0aGlzLnBvcywgdGhpcy50ZXh0LCB0aGlzLmZvcmVncm91bmRDb2xvciwgdGhpcy5mb250U2l6ZSwgdGhpcy50ZXh0QmFzZWxpbmUsIHRoaXMudGV4dEFsaWduLCBHUy5VSUZvbnQpO1xyXG5cdH0sXHJcblxyXG5cdHNldCBjdXJyZW50U3RhdGVJbmRleCh2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuc3RhdGVzICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0aWYgKHZhbHVlID49IDAgJiYgdmFsdWUgPCB0aGlzLnN0YXRlcy5sZW5ndGgpIHtcclxuXHRcdFx0XHR0aGlzLl9jdXJyZW50U3RhdGVJbmRleCA9IHZhbHVlO1xyXG5cdFx0XHRcdHRoaXMudGV4dCA9IHRoaXMuc3RhdGVzW3RoaXMuX2N1cnJlbnRTdGF0ZUluZGV4XTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGdldCBjdXJyZW50U3RhdGVJbmRleCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9jdXJyZW50U3RhdGVJbmRleDtcclxuXHR9LFxyXG59O1xyXG4iLCJHUy5VSUNvbXBvbmVudHMuTWVudUltYWdlQnV0dG9uID0gZnVuY3Rpb24odmVjdG9yQ2FudmFzLCBvZmZzZXQsIHBvcywgc2l6ZSwgZm9udFNpemUsIHRleHQsIGltYWdlLCBvbkNsaWNrKSB7XHJcblx0dGhpcy5jdnMgPSB2ZWN0b3JDYW52YXM7XHJcblxyXG5cdHRoaXMuZm9udFNpemUgPSBmb250U2l6ZSB8fCA0MDtcclxuXHJcblx0dGhpcy5vZmZzZXQgPSBvZmZzZXQ7XHJcblx0dGhpcy5wb3MgPSBwb3M7XHJcblx0dGhpcy5zaXplID0gc2l6ZTtcclxuXHR0aGlzLnRleHQgPSB0ZXh0O1xyXG5cdHRoaXMuaW1hZ2UgPSBpbWFnZTtcclxuXHR0aGlzLm9uQ2xpY2sgPSBvbkNsaWNrIHx8IGZ1bmN0aW9uKCkge307XHJcblxyXG5cdHRoaXMuaW5pdCgpO1xyXG59O1xyXG5cclxuR1MuVUlDb21wb25lbnRzLk1lbnVJbWFnZUJ1dHRvbi5wcm90b3R5cGUgPSB7XHJcblx0Y29uc3RydWN0b3I6IEdTLlVJQ29tcG9uZW50cy5NZW51SW1hZ2VCdXR0b24sXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHZhciBidXR0b25PZmZzZXQgPSB0aGlzLm9mZnNldC5jbG9uZSgpO1xyXG5cdFx0dmFyIGJ1dHRvblNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnNpemUueCwgdGhpcy5zaXplLnkpO1xyXG5cclxuXHRcdHZhciBidXR0b24gPSBuZXcgR1MuVUlDb21wb25lbnRzLk1lbnVCdXR0b24odGhpcy5jdnMsIHRoaXMudGV4dCwgYnV0dG9uT2Zmc2V0LCB0aGlzLnBvcywgYnV0dG9uU2l6ZSwgZnVuY3Rpb24oKSB7XHJcblx0XHRcdHRoYXQub25DbGljaygpO1xyXG5cdFx0fSk7XHJcblx0XHRidXR0b24udGV4dE9mZnNldC54IC09IHRoaXMuc2l6ZS54ICogMC4xO1xyXG5cdFx0YnV0dG9uLnRleHRBbGlnbiA9IFwibGVmdFwiO1xyXG5cdFx0YnV0dG9uLmZvbnRTaXplID0gdGhpcy5mb250U2l6ZTtcclxuXHJcblx0XHR0aGlzLmJ1dHRvbiA9IGJ1dHRvbjtcclxuXHJcblx0XHR0aGlzLmltYWdlU2l6ZSA9IG5ldyBUSFJFRS5WZWN0b3IyKDIzMSwgMTMwKTtcclxuXHRcdHRoaXMuaW1hZ2VPZmZzZXQgPSB0aGlzLm9mZnNldC5jbG9uZSgpO1xyXG5cdFx0dGhpcy5pbWFnZU9mZnNldC54ICs9IHRoaXMuc2l6ZS54ICogMC4yIC0gdGhpcy5pbWFnZVNpemUueCAvIDI7XHJcblx0XHR0aGlzLmltYWdlT2Zmc2V0LnkgKz0gdGhpcy5zaXplLnkgKiAwLjUgLSB0aGlzLmltYWdlU2l6ZS55IC8gMjtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5idXR0b24udXBkYXRlKCk7XHJcblx0fSxcclxuXHJcblx0ZHJhdzogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmJ1dHRvbi5kcmF3KCk7XHJcblx0XHR0aGlzLmN2cy5kcmF3SW1hZ2UodGhpcy5pbWFnZU9mZnNldCwgdGhpcy5wb3MsIHRoaXMuaW1hZ2UsIHRoaXMuaW1hZ2VTaXplLCB0cnVlKTtcclxuXHR9LFxyXG59OyIsIkdTLlVJQ29tcG9uZW50cy5NZW51TGFiZWwgPSBmdW5jdGlvbih2ZWN0b3JDYW52YXMsIHRleHQsIG9mZnNldCwgcG9zKSB7XHJcblx0dGhpcy5jdnMgPSB2ZWN0b3JDYW52YXM7XHJcblxyXG5cdHRoaXMuZm9udFNpemUgPSA0MDtcclxuXHR0aGlzLnRleHQgPSB0ZXh0O1xyXG5cdHRoaXMudGV4dEJhc2VsaW5lID0gXCJtaWRkbGVcIjtcclxuXHR0aGlzLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcblxyXG5cdHRoaXMub2Zmc2V0ID0gb2Zmc2V0O1xyXG5cdHRoaXMucG9zID0gcG9zO1xyXG5cclxuXHR0aGlzLmZvcmVncm91bmRDb2xvciA9IEdTLlVJQ29sb3JzLmZvcmVncm91bmQ7XHJcbn07XHJcblxyXG5HUy5VSUNvbXBvbmVudHMuTWVudUxhYmVsLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlDb21wb25lbnRzLk1lbnVMYWJlbCxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHR9LFxyXG5cclxuXHRkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuY3ZzLnRleHQodGhpcy5vZmZzZXQsIHRoaXMucG9zLCB0aGlzLnRleHQsIHRoaXMuZm9yZWdyb3VuZENvbG9yLCB0aGlzLmZvbnRTaXplLCB0aGlzLnRleHRCYXNlbGluZSwgdGhpcy50ZXh0QWxpZ24sIEdTLlVJRm9udCk7XHJcblx0fSxcclxufTsiLCJHUy5VSUNvbXBvbmVudHMuTWVudU51bWJlclBpY2tlciA9IGZ1bmN0aW9uKHZlY3RvckNhbnZhcywgb2Zmc2V0LCBwb3MsIHNpemUsIGZvbnRTaXplLCB2YWx1ZSwgbWluLCBtYXgsIHN0ZXAsIG9uQ2hhbmdlKSB7XHJcblx0dGhpcy5jdnMgPSB2ZWN0b3JDYW52YXM7XHJcblxyXG5cdHRoaXMuZm9udFNpemUgPSBmb250U2l6ZSB8fCA0MDtcclxuXHJcblx0dGhpcy5vZmZzZXQgPSBvZmZzZXQ7XHJcblx0dGhpcy5wb3MgPSBwb3M7XHJcblx0dGhpcy5zaXplID0gc2l6ZTtcclxuXHJcblx0dGhpcy52YWx1ZSA9ICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSA/IHZhbHVlIDogNTtcclxuXHR0aGlzLm1pbiA9IChtaW4gIT09IHVuZGVmaW5lZCkgPyBtaW4gOiAxO1xyXG5cdHRoaXMubWF4ID0gKG1heCAhPT0gdW5kZWZpbmVkKSA/IG1heCA6IDEwO1xyXG5cdHRoaXMuc3RlcCA9IChzdGVwICE9PSB1bmRlZmluZWQpID8gc3RlcCA6IDE7XHJcblxyXG5cdHRoaXMub25DaGFuZ2UgPSBvbkNoYW5nZSB8fCBmdW5jdGlvbigpIHt9O1xyXG5cclxuXHR0aGlzLmluaXQoKTtcclxufTtcclxuXHJcbkdTLlVJQ29tcG9uZW50cy5NZW51TnVtYmVyUGlja2VyLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlDb21wb25lbnRzLk1lbnVOdW1iZXJQaWNrZXIsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dmFyIHNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnNpemUueCAqIDAuMiwgdGhpcy5zaXplLnkpO1xyXG5cclxuXHRcdHZhciBsZWZ0T2Zmc2V0ID0gdGhpcy5vZmZzZXQuY2xvbmUoKTtcclxuXHRcdHRoaXMubGVmdEJ1dHRvbiA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUJ1dHRvbih0aGlzLmN2cywgXCI8XCIsIGxlZnRPZmZzZXQsIHRoaXMucG9zLCBzaXplKTtcclxuXHRcdHRoaXMubGVmdEJ1dHRvbi5mb250U2l6ZSA9IHRoaXMuZm9udFNpemU7XHJcblx0XHR0aGlzLmxlZnRCdXR0b24ub25DbGljayA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR0aGF0LnZhbHVlIC09IHRoYXQuc3RlcDtcclxuXHRcdFx0dGhhdC52YWx1ZSA9IE1hdGgubWF4KHRoYXQubWluLCB0aGF0LnZhbHVlKTtcclxuXHRcdFx0dGhhdC5sYWJlbC50ZXh0ID0gdGhhdC52YWx1ZTtcclxuXHRcdFx0dGhhdC5vbkNoYW5nZSh7IHZhbHVlOiB0aGF0LnZhbHVlIH0pO1xyXG5cdFx0fTtcclxuXHJcblx0XHR2YXIgcmlnaHRPZmZzZXQgPSB0aGlzLm9mZnNldC5jbG9uZSgpO1xyXG5cdFx0cmlnaHRPZmZzZXQueCArPSB0aGlzLnNpemUueCAqIDAuODtcclxuXHRcdHRoaXMucmlnaHRCdXR0b24gPSBuZXcgR1MuVUlDb21wb25lbnRzLk1lbnVCdXR0b24odGhpcy5jdnMsIFwiPlwiLCByaWdodE9mZnNldCwgdGhpcy5wb3MsIHNpemUpO1xyXG5cdFx0dGhpcy5yaWdodEJ1dHRvbi5mb250U2l6ZSA9IHRoaXMuZm9udFNpemU7XHJcblx0XHR0aGlzLnJpZ2h0QnV0dG9uLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0dGhhdC52YWx1ZSArPSB0aGF0LnN0ZXA7XHJcblx0XHRcdHRoYXQudmFsdWUgPSBNYXRoLm1pbih0aGF0Lm1heCwgdGhhdC52YWx1ZSk7XHJcblx0XHRcdHRoYXQubGFiZWwudGV4dCA9IHRoYXQudmFsdWU7XHJcblx0XHRcdHRoYXQub25DaGFuZ2UoeyB2YWx1ZTogdGhhdC52YWx1ZSB9KTtcclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIGxhYmVsT2Zmc2V0ID0gdGhpcy5vZmZzZXQuY2xvbmUoKTtcclxuXHRcdGxhYmVsT2Zmc2V0LnggKz0gdGhpcy5zaXplLnggKiAwLjU7XHJcblx0XHRsYWJlbE9mZnNldC55ICs9IHRoaXMuc2l6ZS55ICogMC41O1xyXG5cdFx0dGhpcy5sYWJlbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUxhYmVsKHRoaXMuY3ZzLCB0aGlzLnZhbHVlLCBsYWJlbE9mZnNldCwgdGhpcy5wb3MpO1xyXG5cdFx0dGhpcy5sYWJlbC5mb250U2l6ZSA9IHRoaXMuZm9udFNpemU7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMubGVmdEJ1dHRvbi51cGRhdGUoKTtcclxuXHRcdHRoaXMucmlnaHRCdXR0b24udXBkYXRlKCk7XHJcblx0fSxcclxuXHJcblx0ZHJhdzogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmxlZnRCdXR0b24uZHJhdygpO1xyXG5cdFx0dGhpcy5yaWdodEJ1dHRvbi5kcmF3KCk7XHJcblx0XHR0aGlzLmxhYmVsLmRyYXcoKTtcclxuXHR9LFxyXG59OyIsIkdTLlVJQ29tcG9uZW50cy5NZW51UGFuZWwgPSBmdW5jdGlvbih2ZWN0b3JDYW52YXMsIG9mZnNldCwgcG9zLCBzaXplLCBmb250U2l6ZSwgcm93SGVpZ2h0KSB7XHJcblx0dGhpcy5jdnMgPSB2ZWN0b3JDYW52YXM7XHJcblxyXG5cdHRoaXMuY2hpbGRyZW4gPSBbXTtcclxuXHR0aGlzLmZvbnRTaXplID0gZm9udFNpemUgfHwgNDA7XHJcblxyXG5cdHRoaXMub2Zmc2V0ID0gb2Zmc2V0O1xyXG5cdHRoaXMucG9zID0gcG9zO1xyXG5cdHRoaXMuc2l6ZSA9IHNpemU7XHJcblx0dGhpcy5yb3dIZWlnaHQgPSByb3dIZWlnaHQgfHwgNDA7XHJcblx0dGhpcy5yb3dPZmZzZXQgPSAwO1xyXG59O1xyXG5cclxuR1MuVUlDb21wb25lbnRzLk1lbnVQYW5lbC5wcm90b3R5cGUgPSB7XHJcblx0Y29uc3RydWN0b3I6IEdTLlVJQ29tcG9uZW50cy5NZW51UGFuZWwsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdGFkZEJ1dHRvbjogZnVuY3Rpb24odGV4dCwgb25DbGljaykge1xyXG5cdFx0dmFyIG9mZnNldCA9IHRoaXMuZ2V0Um93T2Zmc2V0KCk7XHJcblx0XHR2YXIgc2l6ZSA9IG5ldyBUSFJFRS5WZWN0b3IyKHRoaXMuc2l6ZS54LCB0aGlzLnJvd0hlaWdodCk7XHJcblxyXG5cdFx0dmFyIGJ1dHRvbiA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUJ1dHRvbih0aGlzLmN2cywgdGV4dCwgb2Zmc2V0LCB0aGlzLnBvcywgc2l6ZSwgb25DbGljayk7XHJcblx0XHRidXR0b24uZm9udFNpemUgPSB0aGlzLmZvbnRTaXplO1xyXG5cclxuXHRcdHRoaXMuY2hpbGRyZW4ucHVzaChidXR0b24pO1xyXG5cclxuXHRcdHRoaXMucm93T2Zmc2V0ICs9IHRoaXMucm93SGVpZ2h0O1xyXG5cclxuXHRcdHJldHVybiBidXR0b247XHJcblx0fSxcclxuXHJcblx0YWRkVGV4dEZpZWxkOiBmdW5jdGlvbihsYWJlbCwgdGV4dCwgc3RhdGVzLCBidXR0b25TaXplKSB7XHJcblx0XHRidXR0b25TaXplID0gYnV0dG9uU2l6ZSB8fCAwLjI7XHJcblxyXG5cdFx0dmFyIG9mZnNldCA9IHRoaXMuZ2V0Um93T2Zmc2V0KCk7XHJcblx0XHR2YXIgbGFiZWxPZmZzZXQgPSBvZmZzZXQuY2xvbmUoKTtcclxuXHRcdGxhYmVsT2Zmc2V0LnggKz0gdGhpcy5zaXplLnggKiAwLjUgLSAxMDtcclxuXHRcdGxhYmVsT2Zmc2V0LnkgKz0gdGhpcy5yb3dIZWlnaHQgKiAwLjU7XHJcblxyXG5cdFx0dmFyIGxhYmVsID0gbmV3IEdTLlVJQ29tcG9uZW50cy5NZW51TGFiZWwodGhpcy5jdnMsIGxhYmVsLCBsYWJlbE9mZnNldCwgdGhpcy5wb3MpO1xyXG5cdFx0bGFiZWwuZm9udFNpemUgPSB0aGlzLmZvbnRTaXplO1xyXG5cdFx0bGFiZWwudGV4dEFsaWduID0gXCJyaWdodFwiO1xyXG5cclxuXHRcdHRoaXMuY2hpbGRyZW4ucHVzaChsYWJlbCk7XHJcblxyXG5cdFx0dmFyIGJ1dHRvbk9mZnNldCA9IG9mZnNldC5jbG9uZSgpO1xyXG5cdFx0dmFyIGJ1dHRvblNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnNpemUueCAqIGJ1dHRvblNpemUsIHRoaXMucm93SGVpZ2h0KTtcclxuXHRcdGJ1dHRvbk9mZnNldC54ICs9IHRoaXMuc2l6ZS54ICogMC41ICsgMTA7XHJcblxyXG5cdFx0c3RhdGVzID0gc3RhdGVzIHx8IFtcIm9uXCIsIFwib2ZmXCJdO1xyXG5cdFx0dmFyIGJ1dHRvbiA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUJ1dHRvbih0aGlzLmN2cywgWydlbnRlciddLCBidXR0b25PZmZzZXQsIHRoaXMucG9zLCBidXR0b25TaXplLCAoKSA9PiB7fSwgc3RhdGVzKTtcclxuICAgIGJ1dHRvbi5vbkNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgIEdTLktleWJpbmRTZXR0aW5ncy50ZXh0aW5wdXQubW9kaWZ5VGV4dChidXR0b24pO1xyXG4gICAgfTtcclxuXHRcdGJ1dHRvbi5mb250U2l6ZSA9IHRoaXMuZm9udFNpemU7XHJcblxyXG5cdFx0dGhpcy5jaGlsZHJlbi5wdXNoKGJ1dHRvbik7XHJcblxyXG5cdFx0dGhpcy5yb3dPZmZzZXQgKz0gdGhpcy5yb3dIZWlnaHQ7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0bGFiZWw6IGxhYmVsLFxyXG5cdFx0XHRidXR0b246IGJ1dHRvbixcclxuXHRcdH07XHJcblx0fSxcclxuXHRhZGRUb2dnbGVCdXR0b246IGZ1bmN0aW9uKHRleHQsIHN0YXRlcywgYnV0dG9uU2l6ZSwgb25DbGljaykge1xyXG5cdFx0YnV0dG9uU2l6ZSA9IGJ1dHRvblNpemUgfHwgMC4yO1xyXG5cclxuXHRcdHZhciBvZmZzZXQgPSB0aGlzLmdldFJvd09mZnNldCgpO1xyXG5cdFx0dmFyIGxhYmVsT2Zmc2V0ID0gb2Zmc2V0LmNsb25lKCk7XHJcblx0XHRsYWJlbE9mZnNldC54ICs9IHRoaXMuc2l6ZS54ICogMC41IC0gMTA7XHJcblx0XHRsYWJlbE9mZnNldC55ICs9IHRoaXMucm93SGVpZ2h0ICogMC41O1xyXG5cclxuXHRcdHZhciBsYWJlbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUxhYmVsKHRoaXMuY3ZzLCB0ZXh0LCBsYWJlbE9mZnNldCwgdGhpcy5wb3MpO1xyXG5cdFx0bGFiZWwuZm9udFNpemUgPSB0aGlzLmZvbnRTaXplO1xyXG5cdFx0bGFiZWwudGV4dEFsaWduID0gXCJyaWdodFwiO1xyXG5cclxuXHRcdHRoaXMuY2hpbGRyZW4ucHVzaChsYWJlbCk7XHJcblxyXG5cdFx0dmFyIGJ1dHRvbk9mZnNldCA9IG9mZnNldC5jbG9uZSgpO1xyXG5cdFx0dmFyIGJ1dHRvblNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnNpemUueCAqIGJ1dHRvblNpemUsIHRoaXMucm93SGVpZ2h0KTtcclxuXHRcdGJ1dHRvbk9mZnNldC54ICs9IHRoaXMuc2l6ZS54ICogMC41ICsgMTA7XHJcblxyXG5cdFx0c3RhdGVzID0gc3RhdGVzIHx8IFtcIm9uXCIsIFwib2ZmXCJdO1xyXG5cdFx0dmFyIGJ1dHRvbiA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUJ1dHRvbih0aGlzLmN2cywgc3RhdGVzWzBdLCBidXR0b25PZmZzZXQsIHRoaXMucG9zLCBidXR0b25TaXplLCBvbkNsaWNrLCBzdGF0ZXMpO1xyXG5cdFx0YnV0dG9uLmZvbnRTaXplID0gdGhpcy5mb250U2l6ZTtcclxuXHJcblx0XHR0aGlzLmNoaWxkcmVuLnB1c2goYnV0dG9uKTtcclxuXHJcblx0XHR0aGlzLnJvd09mZnNldCArPSB0aGlzLnJvd0hlaWdodDtcclxuXHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRsYWJlbDogbGFiZWwsXHJcblx0XHRcdGJ1dHRvbjogYnV0dG9uLFxyXG5cdFx0fTtcclxuXHR9LFxyXG5cclxuXHRhZGREb3VibGVMYWJlbDogZnVuY3Rpb24odGV4dDEsIHRleHQyKSB7XHJcblx0XHR2YXIgb2Zmc2V0ID0gdGhpcy5nZXRSb3dPZmZzZXQoKTtcclxuXHJcblx0XHR2YXIgbGFiZWwxT2Zmc2V0ID0gb2Zmc2V0LmNsb25lKCk7XHJcblx0XHRsYWJlbDFPZmZzZXQueCArPSB0aGlzLnNpemUueCAqIDAuNSAtIDMwO1xyXG5cdFx0bGFiZWwxT2Zmc2V0LnkgKz0gdGhpcy5yb3dIZWlnaHQgKiAwLjU7XHJcblxyXG5cdFx0dmFyIGxhYmVsMSA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUxhYmVsKHRoaXMuY3ZzLCB0ZXh0MSwgbGFiZWwxT2Zmc2V0LCB0aGlzLnBvcyk7XHJcblx0XHRsYWJlbDEuZm9udFNpemUgPSB0aGlzLmZvbnRTaXplO1xyXG5cdFx0bGFiZWwxLnRleHRBbGlnbiA9IFwicmlnaHRcIjtcclxuXHJcblx0XHR0aGlzLmNoaWxkcmVuLnB1c2gobGFiZWwxKTtcclxuXHJcblx0XHR2YXIgbGFiZWwyT2Zmc2V0ID0gb2Zmc2V0LmNsb25lKCk7XHJcblx0XHRsYWJlbDJPZmZzZXQueCArPSB0aGlzLnNpemUueCAqIDAuNSArIDMwO1xyXG5cdFx0bGFiZWwyT2Zmc2V0LnkgKz0gdGhpcy5yb3dIZWlnaHQgKiAwLjU7XHJcblxyXG5cdFx0dmFyIGxhYmVsMiA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUxhYmVsKHRoaXMuY3ZzLCB0ZXh0MiwgbGFiZWwyT2Zmc2V0LCB0aGlzLnBvcyk7XHJcblx0XHRsYWJlbDIuZm9udFNpemUgPSB0aGlzLmZvbnRTaXplO1xyXG5cdFx0bGFiZWwyLnRleHRBbGlnbiA9IFwibGVmdFwiO1xyXG5cclxuXHRcdHRoaXMuY2hpbGRyZW4ucHVzaChsYWJlbDIpO1xyXG5cclxuXHRcdHRoaXMucm93T2Zmc2V0ICs9IHRoaXMucm93SGVpZ2h0O1xyXG5cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGxhYmVsMTogbGFiZWwxLFxyXG5cdFx0XHRsYWJlbDI6IGxhYmVsMixcclxuXHRcdH07XHJcblx0fSxcclxuXHRhZGROdW1iZXJQaWNrZXI6IGZ1bmN0aW9uKHRleHQsIHZhbHVlLCBtaW4sIG1heCwgc3RlcCwgb25DaGFuZ2UpIHtcclxuXHRcdHZhciBvZmZzZXQgPSB0aGlzLmdldFJvd09mZnNldCgpO1xyXG5cdFx0dmFyIGxhYmVsT2Zmc2V0ID0gb2Zmc2V0LmNsb25lKCk7XHJcblx0XHRsYWJlbE9mZnNldC54ICs9IHRoaXMuc2l6ZS54ICogMC41IC0gMTA7XHJcblx0XHRsYWJlbE9mZnNldC55ICs9IHRoaXMucm93SGVpZ2h0ICogMC41O1xyXG5cclxuXHRcdHZhciBsYWJlbCA9IG5ldyBHUy5VSUNvbXBvbmVudHMuTWVudUxhYmVsKHRoaXMuY3ZzLCB0ZXh0LCBsYWJlbE9mZnNldCwgdGhpcy5wb3MpO1xyXG5cdFx0bGFiZWwuZm9udFNpemUgPSB0aGlzLmZvbnRTaXplO1xyXG5cdFx0bGFiZWwudGV4dEFsaWduID0gXCJyaWdodFwiO1xyXG5cclxuXHRcdHRoaXMuY2hpbGRyZW4ucHVzaChsYWJlbCk7XHJcblxyXG5cdFx0dmFyIG51bWJlclBpY2tlck9mZnNldCA9IG9mZnNldC5jbG9uZSgpO1xyXG5cdFx0dmFyIG51bWJlclBpY2tlclNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnNpemUueCAqIDAuMiwgdGhpcy5yb3dIZWlnaHQpO1xyXG5cdFx0bnVtYmVyUGlja2VyT2Zmc2V0LnggKz0gdGhpcy5zaXplLnggKiAwLjUgKyAxMDtcclxuXHRcdHZhciBudW1iZXJQaWNrZXIgPSBuZXcgR1MuVUlDb21wb25lbnRzLk1lbnVOdW1iZXJQaWNrZXIodGhpcy5jdnMsIG51bWJlclBpY2tlck9mZnNldCwgdGhpcy5wb3MsIG51bWJlclBpY2tlclNpemUsXHJcblx0XHRcdHRoaXMuZm9udFNpemUsIHZhbHVlLCBtaW4sIG1heCwgc3RlcCwgb25DaGFuZ2UpO1xyXG5cclxuXHRcdHRoaXMuY2hpbGRyZW4ucHVzaChudW1iZXJQaWNrZXIpO1xyXG5cclxuXHRcdHRoaXMucm93T2Zmc2V0ICs9IHRoaXMucm93SGVpZ2h0O1xyXG5cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGxhYmVsOiBsYWJlbCxcclxuXHRcdFx0bnVtYmVyUGlja2VyOiBudW1iZXJQaWNrZXIsXHJcblx0XHR9O1xyXG5cdH0sXHJcblxyXG5cdGFkZEltYWdlQnV0dG9uOiBmdW5jdGlvbih0ZXh0LCBpbWFnZSwgb25DbGljaykge1xyXG5cdFx0dmFyIG9mZnNldCA9IHRoaXMuZ2V0Um93T2Zmc2V0KCk7XHJcblx0XHR2YXIgaW1hZ2VCdXR0b25PZmZzZXQgPSBvZmZzZXQuY2xvbmUoKTtcclxuXHRcdHZhciBpbWFnZUJ1dHRvblNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnNpemUueCwgdGhpcy5yb3dIZWlnaHQpO1xyXG5cdFx0dmFyIGltYWdlQnV0dG9uID0gbmV3IEdTLlVJQ29tcG9uZW50cy5NZW51SW1hZ2VCdXR0b24odGhpcy5jdnMsIGltYWdlQnV0dG9uT2Zmc2V0LCB0aGlzLnBvcyxcclxuXHRcdFx0aW1hZ2VCdXR0b25TaXplLCB0aGlzLmZvbnRTaXplLCB0ZXh0LCBpbWFnZSwgb25DbGljayk7XHJcblxyXG5cdFx0dGhpcy5jaGlsZHJlbi5wdXNoKGltYWdlQnV0dG9uKTtcclxuXHRcdHRoaXMucm93T2Zmc2V0ICs9IHRoaXMucm93SGVpZ2h0O1xyXG5cclxuXHRcdHJldHVybiBpbWFnZUJ1dHRvbjtcclxuXHR9LFxyXG5cclxuXHRhZGRFbXB0eVJvdzogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnJvd09mZnNldCArPSB0aGlzLnJvd0hlaWdodDtcclxuXHR9LFxyXG5cclxuXHRnZXRSb3dPZmZzZXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG9mZnNldCA9IHRoaXMub2Zmc2V0LmNsb25lKCk7XHJcblx0XHRvZmZzZXQueSArPSB0aGlzLnJvd09mZnNldDtcclxuXHJcblx0XHRpZiAoTWF0aC5hYnMob2Zmc2V0LnkgLSB0aGlzLm9mZnNldC55KSA+IHRoaXMuc2l6ZS55KSB7XHJcblx0XHRcdEdBTUUuaGFuZGxlRmF0YWxFcnJvcihcIm1lbnUgcGFuZWwgZXhjZWVkcyBoZWlnaHRcIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gb2Zmc2V0O1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dGhpcy5jaGlsZHJlbltpXS51cGRhdGUoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdC8vIHRoaXMuY3ZzLmJveEZpbGwodGhpcy5vZmZzZXQsIHRoaXMucG9zLCB0aGlzLnNpemUsIHRydWUsIFwicmdiYSgyNTUsIDAsIDAsIDEpXCIpO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR0aGlzLmNoaWxkcmVuW2ldLmRyYXcoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhZGQ6IGZ1bmN0aW9uKG1lbnVDb21wb25lbnQpIHtcclxuXHRcdHRoaXMuY2hpbGRyZW4ucHVzaChtZW51Q29tcG9uZW50KTtcclxuXHR9LFxyXG59O1xyXG4iLCJHUy5VSUNvbXBvbmVudHMuTm90aWZpY2F0aW9ucyA9IGZ1bmN0aW9uKHZlY3RvckNhbnZhcywgYXNzZXRzLCBwbGF5ZXIpIHtcclxuXHR0aGlzLmN2cyA9IHZlY3RvckNhbnZhcztcclxuXHR0aGlzLmFzc2V0cyA9IGFzc2V0cztcclxuXHR0aGlzLnBsYXllciA9IHBsYXllcjtcclxuXHJcblx0dGhpcy5mb250U2l6ZSA9IDQwO1xyXG5cdHRoaXMuYm94Q29ybmVyUmFkaXVzID0gMTA7XHJcblxyXG5cdHRoaXMudXNlVGV4dCA9IFwiW1wiICsgR1MuS2V5YmluZHMudXNlLmNvbnRyb2xOYW1lICsgXCJdIHRvIHVzZVwiO1xyXG5cdHRoaXMucG9pbnRlckxvY2tUZXh0ID0gXCJyaWdodC1jbGljayB0byBlbmFibGUgcG9pbnRlciBsb2NrXCI7XHJcblx0dGhpcy5yZXN0YXJ0VGV4dCA9IFwiW0VOVEVSXSB0byByZXN0YXJ0IGxldmVsXCI7XHJcblxyXG5cdHRoaXMudXNlUG9wdXAgPSB7XHJcblx0XHRvcmlnaW5hbE9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoMCwgMTAwKSxcclxuXHRcdG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoKSxcclxuXHRcdHBvczogbmV3IFRIUkVFLlZlY3RvcjIoMC41LCAwLjUpLFxyXG5cdFx0c2l6ZTogbmV3IFRIUkVFLlZlY3RvcjIoMCwgNjApLFxyXG5cdFx0dGV4dE9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoMCwgMCksXHJcblx0fTtcclxuXHJcblx0dGhpcy5wb2ludGVyTG9ja1BvcHVwID0ge1xyXG5cdFx0b3JpZ2luYWxPZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDEwMCksXHJcblx0XHRvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKCksXHJcblx0XHRwb3M6IG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSxcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDYwKSxcclxuXHRcdHRleHRPZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApLFxyXG5cdH07XHJcblxyXG5cdHRoaXMucmVzdGFydFBvcHVwID0ge1xyXG5cdFx0b3JpZ2luYWxPZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDEwMCksXHJcblx0XHRvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKCksXHJcblx0XHRwb3M6IG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSxcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDYwKSxcclxuXHRcdHRleHRPZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApLFxyXG5cdH07XHJcblxyXG5cdHRoaXMuY2FsY3VsYXRlU2l6ZXMoKTtcclxuXHJcblx0dGhpcy52aXNpYmxlID0gdHJ1ZTtcclxuXHJcblx0dGhpcy5vbGRTaG93VXNlUG9wdXAgPSBmYWxzZTtcclxuXHR0aGlzLnNob3dVc2VQb3B1cCA9IGZhbHNlO1xyXG5cclxuXHR0aGlzLm9sZFNob3dQb2ludGVyTG9ja1BvcHVwID0gZmFsc2U7XHJcblx0dGhpcy5zaG93UG9pbnRlckxvY2tQb3B1cCA9IGZhbHNlO1xyXG5cclxuXHR0aGlzLm9sZFNob3dSZXN0YXJ0UG9wdXAgPSBmYWxzZTtcclxuXHR0aGlzLnNob3dSZXN0YXJ0UG9wdXAgPSBmYWxzZTtcclxufTtcclxuXHJcbkdTLlVJQ29tcG9uZW50cy5Ob3RpZmljYXRpb25zLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlDb21wb25lbnRzLk5vdGlmaWNhdGlvbnMsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnNob3dVc2VQb3B1cCA9IHRoaXMucGxheWVyLmNhblVzZTtcclxuXHRcdGlmICh0aGlzLnNob3dVc2VQb3B1cCAhPSB0aGlzLm9sZFNob3dVc2VQb3B1cCkge1xyXG5cdFx0XHR0aGlzLm5lZWRzUmVkcmF3ID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5vbGRTaG93VXNlUG9wdXAgPSB0aGlzLnNob3dVc2VQb3B1cDtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnNob3dQb2ludGVyTG9ja1BvcHVwID0gIXRoaXMucGxheWVyLmNvbnRyb2xzLnBvaW50ZXJMb2NrRW5hYmxlZDtcclxuXHRcdGlmICh0aGlzLnNob3dQb2ludGVyTG9ja1BvcHVwICE9IHRoaXMub2xkU2hvd1BvaW50ZXJMb2NrUG9wdXApIHtcclxuXHRcdFx0dGhpcy5uZWVkc1JlZHJhdyA9IHRydWU7XHJcblx0XHRcdHRoaXMub2xkU2hvd1BvaW50ZXJMb2NrUG9wdXAgPSB0aGlzLnNob3dQb2ludGVyTG9ja1BvcHVwO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuc2hvd1Jlc3RhcnRQb3B1cCA9IHRoaXMucGxheWVyLmRlYWQ7XHJcblx0XHRpZiAodGhpcy5zaG93UmVzdGFydFBvcHVwICE9IHRoaXMub2xkU2hvd1Jlc3RhcnRQb3B1cCkge1xyXG5cdFx0XHR0aGlzLm5lZWRzUmVkcmF3ID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5vbGRTaG93UmVzdGFydFBvcHVwID0gdGhpcy5zaG93UmVzdGFydFBvcHVwO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGRyYXc6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKHRoaXMuc2hvd1Jlc3RhcnRQb3B1cCkge1xyXG5cdFx0XHR0aGlzLmRyYXdQb3B1cCh0aGlzLnJlc3RhcnRUZXh0LCB0aGlzLnJlc3RhcnRQb3B1cCk7XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICh0aGlzLnNob3dQb2ludGVyTG9ja1BvcHVwKSB7XHJcblx0XHRcdHRoaXMuZHJhd1BvcHVwKHRoaXMucG9pbnRlckxvY2tUZXh0LCB0aGlzLnBvaW50ZXJMb2NrUG9wdXApO1xyXG5cdFx0fSBlbHNlXHJcblx0XHRpZiAodGhpcy5zaG93VXNlUG9wdXApIHtcclxuXHRcdFx0dGhpcy5kcmF3UG9wdXAodGhpcy51c2VUZXh0LCB0aGlzLnVzZVBvcHVwKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRkcmF3UG9wdXA6IGZ1bmN0aW9uKHRleHQsIHBvcHVwKSB7XHJcblx0XHR0aGlzLmN2cy5yb3VuZGVkQm94RmlsbChwb3B1cC5vZmZzZXQsIHBvcHVwLnBvcywgcG9wdXAuc2l6ZSwgdHJ1ZSxcclxuXHRcdFx0dGhpcy5ib3hDb3JuZXJSYWRpdXMsIEdTLlVJQ29sb3JzLmJhY2tncm91bmQpO1xyXG5cdFx0dGhpcy5jdnMudGV4dChwb3B1cC50ZXh0T2Zmc2V0LCBwb3B1cC5wb3MsIHRleHQsXHJcblx0XHRcdEdTLlVJQ29sb3JzLmZvcmVncm91bmQsIHRoaXMuZm9udFNpemUsIFwibWlkZGxlXCIsIFwiY2VudGVyXCIsIEdTLlVJRm9udCk7XHJcblx0fSxcclxuXHJcblx0Y2FsY3VsYXRlU2l6ZXM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jYWxjdWxhdGVQb3B1cFNpemUodGhpcy51c2VUZXh0LCB0aGlzLnVzZVBvcHVwKTtcclxuXHRcdHRoaXMuY2FsY3VsYXRlUG9wdXBTaXplKHRoaXMucG9pbnRlckxvY2tUZXh0LCB0aGlzLnBvaW50ZXJMb2NrUG9wdXApO1xyXG5cdFx0dGhpcy5jYWxjdWxhdGVQb3B1cFNpemUodGhpcy5yZXN0YXJ0VGV4dCwgdGhpcy5yZXN0YXJ0UG9wdXApO1xyXG5cdH0sXHJcblxyXG5cdGNhbGN1bGF0ZVBvcHVwU2l6ZTogZnVuY3Rpb24odGV4dCwgcG9wdXAsIHRleHRXaWR0aCkge1xyXG5cdFx0aWYgKHRleHRXaWR0aCA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRleHRXaWR0aCA9IHRoaXMuY3ZzLmdldFRleHRXaWR0aCh0ZXh0LCB0aGlzLmZvbnRTaXplLCBHUy5VSUZvbnQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBwYWRkaW5nID0gMTU7XHJcblx0XHR2YXIgd2lkdGggPSB0ZXh0V2lkdGggKyBwYWRkaW5nICogMjtcclxuXHJcblx0XHRwb3B1cC5zaXplLnggPSB3aWR0aDtcclxuXHRcdHBvcHVwLm9mZnNldC54ID0gLXdpZHRoIC8gMjtcclxuXHRcdHBvcHVwLm9mZnNldC55ID0gcG9wdXAub3JpZ2luYWxPZmZzZXQueSAtIHBvcHVwLnNpemUueTtcclxuXHRcdHBvcHVwLnRleHRPZmZzZXQuY29weShwb3B1cC5vZmZzZXQpLmFkZChwb3B1cC5zaXplLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC41KSk7XHJcblx0fSxcclxufTsiLCJHUy5VSUNvbXBvbmVudHMuUG93ZXJCYXJzID0gZnVuY3Rpb24odmVjdG9yQ2FudmFzLCBhc3NldHMsIHBsYXllcikge1xyXG5cdHRoaXMuY3ZzID0gdmVjdG9yQ2FudmFzO1xyXG5cdHRoaXMuYXNzZXRzID0gYXNzZXRzO1xyXG5cdHRoaXMucGxheWVyID0gcGxheWVyO1xyXG5cclxuXHR0aGlzLmZvbnRTaXplID0gNjA7XHJcblx0dGhpcy5ib3hDb3JuZXJSYWRpdXMgPSAxMDtcclxuXHJcblx0dGhpcy5oZWFsdGhCYXIgPSB7XHJcblx0XHRvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDIwLCAtMjApLFxyXG5cdFx0cG9zOiBuZXcgVEhSRUUuVmVjdG9yMigwLCAxKSxcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IyKDIyMCwgOTApLFxyXG5cdFx0dGV4dE9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoOTUsIDQpLFxyXG5cdFx0aW1hZ2VPZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDIwLCAyMCksXHJcblx0XHRpbWFnZUF0bGFzT2Zmc2V0OiBuZXcgVEhSRUUuVmVjdG9yMigwLCAwKSxcclxuXHRcdGltYWdlQXRsYXNTaXplOiBuZXcgVEhSRUUuVmVjdG9yMig2NCwgNjQpLFxyXG5cdH07XHJcblxyXG5cdHRoaXMuaGVhbHRoQmFyLm9mZnNldC55IC09IHRoaXMuaGVhbHRoQmFyLnNpemUueTtcclxuXHR0aGlzLmhlYWx0aEJhci5pbWFnZU9mZnNldC5hZGQodGhpcy5oZWFsdGhCYXIub2Zmc2V0KTtcclxuXHR0aGlzLmhlYWx0aEJhci50ZXh0T2Zmc2V0LmFkZCh0aGlzLmhlYWx0aEJhci5vZmZzZXQpLmFkZCh0aGlzLmhlYWx0aEJhci5zaXplLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoMC41KSk7XHRcclxuXHJcblx0dGhpcy5hbW1vQmFyID0ge1xyXG5cdFx0b2Zmc2V0OiBuZXcgVEhSRUUuVmVjdG9yMigtMjAsIC0yMCksXHJcblx0XHRwb3M6IG5ldyBUSFJFRS5WZWN0b3IyKDEsIDEpLFxyXG5cdFx0c2l6ZTogbmV3IFRIUkVFLlZlY3RvcjIoMjIwLCA5MCksXHJcblx0XHR0ZXh0T2Zmc2V0OiBuZXcgVEhSRUUuVmVjdG9yMig5NSwgNCksXHJcblx0XHRpbWFnZU9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoMjAsIDIwKSxcclxuXHRcdGltYWdlQXRsYXNPZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDY0LCAwKSxcclxuXHRcdGltYWdlQXRsYXNTaXplOiBuZXcgVEhSRUUuVmVjdG9yMig2NCwgNjQpLFxyXG5cdH07XHJcblxyXG5cdHRoaXMuYW1tb0Jhci5vZmZzZXQuc3ViKHRoaXMuYW1tb0Jhci5zaXplKTtcclxuXHR0aGlzLmFtbW9CYXIuaW1hZ2VPZmZzZXQuYWRkKHRoaXMuYW1tb0Jhci5vZmZzZXQpO1xyXG5cdHRoaXMuYW1tb0Jhci50ZXh0T2Zmc2V0LmFkZCh0aGlzLmFtbW9CYXIub2Zmc2V0KS5hZGQodGhpcy5hbW1vQmFyLnNpemUuY2xvbmUoKS5tdWx0aXBseVNjYWxhcigwLjUpKTtcclxuXHJcblx0dGhpcy50ZXggPSB0aGlzLmFzc2V0cy5pbWFnZXMuaHVkO1xyXG5cclxuXHR0aGlzLnZpc2libGUgPSB0cnVlO1xyXG5cclxuXHR0aGlzLmFtbW8gPSB1bmRlZmluZWQ7XHJcblx0dGhpcy5oZWFsdGggPSBcIlwiO1xyXG5cdHRoaXMub2xkSGVhbHRoID0gLTE7XHJcblx0dGhpcy5vbGRBbW1vID0gLTE7XHJcbn07XHJcblxyXG5HUy5VSUNvbXBvbmVudHMuUG93ZXJCYXJzLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlDb21wb25lbnRzLlBvd2VyQmFycyxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuaGVhbHRoID0gTWF0aC5mbG9vcih0aGlzLnBsYXllci5oZWFsdGgpO1xyXG5cdFx0aWYgKHRoaXMucGxheWVyLndlYXBvbiAhPT0gdW5kZWZpbmVkICYmICF0aGlzLnBsYXllci53ZWFwb24uaW5maW5pdGVBbW1vKSB7XHJcblx0XHRcdHRoaXMuYW1tbyA9IHRoaXMucGxheWVyLndlYXBvbi5hbW1vO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5hbW1vID0gdW5kZWZpbmVkO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLmhlYWx0aCAhPSB0aGlzLm9sZEhlYWx0aCB8fCB0aGlzLmFtbW8gIT0gdGhpcy5vbGRBbW1vKSB7XHJcblx0XHRcdHRoaXMubmVlZHNSZWRyYXcgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLm9sZEhlYWx0aCA9IHRoaXMuaGVhbHRoO1xyXG5cdFx0XHR0aGlzLm9sZEFtbW8gPSB0aGlzLmFtbW87XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZHJhdzogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmN2cy5yb3VuZGVkQm94RmlsbCh0aGlzLmhlYWx0aEJhci5vZmZzZXQsIHRoaXMuaGVhbHRoQmFyLnBvcywgdGhpcy5oZWFsdGhCYXIuc2l6ZSwgdHJ1ZSwgXHJcblx0XHRcdFx0dGhpcy5ib3hDb3JuZXJSYWRpdXMsIEdTLlVJQ29sb3JzLmJhY2tncm91bmQpO1xyXG5cdFx0dGhpcy5jdnMudGV4dCh0aGlzLmhlYWx0aEJhci50ZXh0T2Zmc2V0LCB0aGlzLmhlYWx0aEJhci5wb3MsIHRoaXMuaGVhbHRoLCBcclxuXHRcdFx0R1MuVUlDb2xvcnMuZm9yZWdyb3VuZCwgdGhpcy5mb250U2l6ZSwgXCJtaWRkbGVcIiwgXCJyaWdodFwiLCBHUy5VSUZvbnQpO1xyXG5cclxuXHRcdHRoaXMuY3ZzLmRyYXdJbWFnZUZyb21BdGxhcyh0aGlzLmhlYWx0aEJhci5pbWFnZU9mZnNldCwgdGhpcy5oZWFsdGhCYXIucG9zLCB0aGlzLnRleCxcclxuXHRcdFx0dGhpcy5oZWFsdGhCYXIuaW1hZ2VBdGxhc09mZnNldCwgdGhpcy5oZWFsdGhCYXIuaW1hZ2VBdGxhc1NpemUpO1xyXG5cclxuXHRcdGlmICh0aGlzLmFtbW8gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmN2cy5yb3VuZGVkQm94RmlsbCh0aGlzLmFtbW9CYXIub2Zmc2V0LCB0aGlzLmFtbW9CYXIucG9zLCB0aGlzLmFtbW9CYXIuc2l6ZSwgdHJ1ZSwgXHJcblx0XHRcdFx0XHR0aGlzLmJveENvcm5lclJhZGl1cywgR1MuVUlDb2xvcnMuYmFja2dyb3VuZCk7XHJcblx0XHRcdHRoaXMuY3ZzLnRleHQodGhpcy5hbW1vQmFyLnRleHRPZmZzZXQsIHRoaXMuYW1tb0Jhci5wb3MsIHRoaXMuYW1tbywgR1MuVUlDb2xvcnMuZm9yZWdyb3VuZCwgXHJcblx0XHRcdFx0dGhpcy5mb250U2l6ZSwgXCJtaWRkbGVcIiwgXCJyaWdodFwiLCBHUy5VSUZvbnQpO1xyXG5cdFx0XHR0aGlzLmN2cy5kcmF3SW1hZ2VGcm9tQXRsYXModGhpcy5hbW1vQmFyLmltYWdlT2Zmc2V0LCB0aGlzLmFtbW9CYXIucG9zLCB0aGlzLnRleCxcclxuXHRcdFx0XHR0aGlzLmFtbW9CYXIuaW1hZ2VBdGxhc09mZnNldCwgdGhpcy5hbW1vQmFyLmltYWdlQXRsYXNTaXplKTtcclxuXHRcdH1cclxuXHR9LFxyXG59OyIsIkdTLlVJQ29tcG9uZW50cy5XaW5TY3JlZW4gPSBmdW5jdGlvbih2ZWN0b3JDYW52YXMsIGFzc2V0cywgcGxheWVyKSB7XHJcblx0dGhpcy5jdnMgPSB2ZWN0b3JDYW52YXM7XHJcblx0dGhpcy5hc3NldHMgPSBhc3NldHM7XHJcblx0dGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XHJcblxyXG5cdHRoaXMuZm9udFNpemUgPSA0MDtcclxuXHR0aGlzLnJvd0hlaWdodCA9IDQ1O1xyXG5cdHRoaXMuYm94Q29ybmVyUmFkaXVzID0gMTA7XHJcblxyXG5cdHRoaXMuYWlNYW5hZ2VyID0gcGxheWVyLmdyaWQuYWlNYW5hZ2VyO1xyXG5cclxuXHR0aGlzLm1hcE5hbWUgPSBcIm1hcCBuYW1lXCI7XHJcblx0dGhpcy5oYXNOZXh0TWFwID0gZmFsc2U7XHJcblxyXG5cdHRoaXMubW9uc3RlcnNLaWxsZWQgPSAwO1xyXG5cdHRoaXMubWF4TW9uc3RlcnMgPSAwO1xyXG5cdHRoaXMuaXRlbXNQaWNrZWRVcCA9IDA7XHJcblx0dGhpcy5tYXhJdGVtcyA9IDA7XHJcblx0dGhpcy5zZWNyZXRzRm91bmQgPSAwO1xyXG5cdHRoaXMubWF4U2VjcmV0cyA9IDA7XHJcblx0dGhpcy5taW51dGVzID0gXCIwMFwiO1xyXG5cdHRoaXMuc2Vjb25kcyA9IFwiMDBcIjtcclxuXHJcblx0dGhpcy5wb3B1cCA9IHtcclxuXHRcdG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjIoLTQ4MCwgLTMxNSksXHJcblx0XHRwb3M6IG5ldyBUSFJFRS5WZWN0b3IyKDAuNSwgMC41KSxcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IyKDk2MCwgNjMwKSxcclxuXHR9O1xyXG5cclxuXHR0aGlzLnRleHRPZmZzZXRMZWZ0ID0gbmV3IFRIUkVFLlZlY3RvcjIoLTMwLCAtMjQ3KTtcclxuXHR0aGlzLnRleHRPZmZzZXRSaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IyKDMwLCAtMjQ3KTtcclxuXHR0aGlzLnRleHRPZmZzZXRDZW50ZXIgPSBuZXcgVEhSRUUuVmVjdG9yMigwLCAtMjQ3KTtcclxuXHJcblx0dGhpcy52aXNpYmxlID0gZmFsc2U7XHJcbn07XHJcblxyXG5HUy5VSUNvbXBvbmVudHMuV2luU2NyZWVuLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuVUlDb21wb25lbnRzLldpblNjcmVlbixcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICghdGhpcy52aXNpYmxlICYmIHRoaXMuYWlNYW5hZ2VyLnNjcmlwdCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuYWlNYW5hZ2VyLnNjcmlwdC5tYXBXb24pIHtcclxuXHRcdFx0dGhpcy5jb2xsZWN0RGF0YSgpO1xyXG5cdFx0XHR0aGlzLnZpc2libGUgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGNvbGxlY3REYXRhOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBzY3JpcHQgPSB0aGlzLmFpTWFuYWdlci5zY3JpcHQ7XHJcblxyXG5cdFx0dGhpcy5tYXBOYW1lID0gc2NyaXB0Lm1hcE5hbWU7XHJcblx0XHR0aGlzLmhhc05leHRNYXAgPSBzY3JpcHQubmV4dE1hcCAhPT0gdW5kZWZpbmVkO1xyXG5cdFx0dGhpcy5tb25zdGVyc0tpbGxlZCA9IHRoaXMuYWlNYW5hZ2VyLm1vbnN0ZXJzS2lsbGVkO1xyXG5cdFx0dGhpcy5tYXhNb25zdGVycyA9IHRoaXMuYWlNYW5hZ2VyLm1heE1vbnN0ZXJzO1xyXG5cdFx0dGhpcy5pdGVtc1BpY2tlZFVwID0gdGhpcy5haU1hbmFnZXIuaXRlbXNQaWNrZWRVcDtcclxuXHRcdHRoaXMubWF4SXRlbXMgPSB0aGlzLmFpTWFuYWdlci5tYXhJdGVtcztcclxuXHRcdHRoaXMuc2VjcmV0c0ZvdW5kID0gc2NyaXB0LnNlY3JldHNGb3VuZDtcclxuXHRcdHRoaXMubWF4U2VjcmV0cyA9IHNjcmlwdC5tYXhTZWNyZXRzO1xyXG5cclxuXHRcdHRoaXMubWludXRlcyA9IEdTLnBhZCh0aGlzLmFpTWFuYWdlci5taW51dGVzLCAyKTtcclxuXHRcdHRoaXMuc2Vjb25kcyA9IEdTLnBhZCh0aGlzLmFpTWFuYWdlci5zZWNvbmRzLCAyKTtcclxuXHR9LFxyXG5cclxuXHRkcmF3OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuY3ZzLnJvdW5kZWRCb3hGaWxsKHRoaXMucG9wdXAub2Zmc2V0LCB0aGlzLnBvcHVwLnBvcywgdGhpcy5wb3B1cC5zaXplLCB0cnVlLCBcclxuXHRcdFx0dGhpcy5ib3hDb3JuZXJSYWRpdXMsIEdTLlVJQ29sb3JzLm1lbnVCYWNrZ3JvdW5kKTtcclxuXHJcblx0XHR0aGlzLmRyYXdNZXNzYWdlKFwiXFxcIlwiICsgdGhpcy5tYXBOYW1lICsgXCJcXFwiIGNvbXBsZXRlXCIsIDApO1xyXG5cclxuXHRcdHRoaXMuZHJhd0ZpZWxkKFwibW9uc3RlcnMga2lsbGVkXCIsIHRoaXMubW9uc3RlcnNLaWxsZWQgKyBcIiAvIFwiICsgdGhpcy5tYXhNb25zdGVycywgMik7XHJcblx0XHR0aGlzLmRyYXdGaWVsZChcIml0ZW1zIHBpY2tlZCB1cFwiLCB0aGlzLml0ZW1zUGlja2VkVXAgKyBcIiAvIFwiICsgdGhpcy5tYXhJdGVtcywgMyk7XHJcblx0XHR0aGlzLmRyYXdGaWVsZChcInNlY3JldHMgZm91bmRcIiwgdGhpcy5zZWNyZXRzRm91bmQgKyBcIiAvIFwiICsgdGhpcy5tYXhTZWNyZXRzLCA0KTtcclxuXHJcblx0XHR0aGlzLmRyYXdGaWVsZChcInRpbWUgc3BlbnRcIiwgdGhpcy5taW51dGVzICsgXCI6XCIgKyB0aGlzLnNlY29uZHMsIDYpO1xyXG5cclxuXHRcdGlmICh0aGlzLmhhc05leHRNYXApIHtcclxuXHRcdFx0dGhpcy5kcmF3TWVzc2FnZShcIltFTlRFUl0gdG8gY29udGludWUgdG8gdGhlIG5leHQgbGV2ZWxcIiwgMTEpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5kcmF3TWVzc2FnZShcImNvbmdyYXRzIVwiLCAxMCk7XHJcblx0XHRcdHRoaXMuZHJhd01lc3NhZ2UoXCJ0aGlzIGNvbmNsdWRlcyB0aGUgY3VycmVudCByZWxlYXNlXCIsIDExKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRkcmF3RmllbGQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGxlZnQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIHJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24obmFtZSwgdmFsdWUsIHJvdykge1xyXG5cdFx0XHRsZWZ0LmNvcHkodGhpcy50ZXh0T2Zmc2V0TGVmdCk7XHJcblx0XHRcdGxlZnQueSArPSByb3cgKiB0aGlzLnJvd0hlaWdodDtcclxuXHRcdFx0cmlnaHQuY29weSh0aGlzLnRleHRPZmZzZXRSaWdodCk7XHJcblx0XHRcdHJpZ2h0LnkgKz0gcm93ICogdGhpcy5yb3dIZWlnaHQ7XHJcblxyXG5cdFx0XHR0aGlzLmN2cy50ZXh0KGxlZnQsIHRoaXMucG9wdXAucG9zLCBuYW1lLCBcclxuXHRcdFx0XHRHUy5VSUNvbG9ycy5mb3JlZ3JvdW5kLCB0aGlzLmZvbnRTaXplLCBcIm1pZGRsZVwiLCBcInJpZ2h0XCIsIEdTLlVJRm9udCk7XHJcblx0XHRcdHRoaXMuY3ZzLnRleHQocmlnaHQsIHRoaXMucG9wdXAucG9zLCB2YWx1ZSwgXHJcblx0XHRcdFx0R1MuVUlDb2xvcnMuZm9yZWdyb3VuZCwgdGhpcy5mb250U2l6ZSwgXCJtaWRkbGVcIiwgXCJsZWZ0XCIsIEdTLlVJRm9udCk7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRkcmF3TWVzc2FnZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgY2VudGVyID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24obWVzc2FnZSwgcm93KSB7XHJcblx0XHRcdGNlbnRlci5jb3B5KHRoaXMudGV4dE9mZnNldENlbnRlcik7XHJcblx0XHRcdGNlbnRlci55ICs9IHJvdyAqIHRoaXMucm93SGVpZ2h0O1xyXG5cclxuXHRcdFx0dGhpcy5jdnMudGV4dChjZW50ZXIsIHRoaXMucG9wdXAucG9zLCBtZXNzYWdlLCBcclxuXHRcdFx0XHRHUy5VSUNvbG9ycy5mb3JlZ3JvdW5kLCB0aGlzLmZvbnRTaXplLCBcIm1pZGRsZVwiLCBcImNlbnRlclwiLCBHUy5VSUZvbnQpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxufTsiLCIvLyBTbGlkaW5nIENhbWVyYSBDb2xsaXNpb24gRGV0ZWN0aW9uXHJcbi8vIGh0dHA6Ly93d3cuYnJheW56YXJzb2Z0Lm5ldC9pbmRleC5waHA/cD1EM0QxMVNsaWRpbmdDYW1lcmFcclxuXHJcbkdTLkNvbGxpc2lvbkhlbHBlciA9IHtcclxuXHRncmF2aXR5OiBuZXcgVEhSRUUuVmVjdG9yMygwLCAtMS41LCAwKSxcclxuXHR1bml0c1Blck1ldGVyOiAxMDAsXHJcblxyXG5cdGhhbmRsZUNvbGxpc2lvbnNTbGlkaW5nOiBmdW5jdGlvbihvbGRQb3MsIG5ld1BvcywgZ3Jhdml0eUZhY3RvciwgZWxsaXBzb2lkLCB0cmlhbmdsZUl0ZXJhdG9yKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5oYW5kbGVDb2xsaXNpb25zKG9sZFBvcywgbmV3UG9zLCBncmF2aXR5RmFjdG9yLCBlbGxpcHNvaWQsIHRyaWFuZ2xlSXRlcmF0b3IsIGZhbHNlLCBmYWxzZSk7XHJcblx0fSxcclxuXHJcblx0aGFuZGxlQ29sbGlzaW9uc0ZpcnN0SGl0OiBmdW5jdGlvbihvbGRQb3MsIG5ld1BvcywgZ3Jhdml0eUZhY3RvciwgZWxsaXBzb2lkLCB0cmlhbmdsZUl0ZXJhdG9yKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5oYW5kbGVDb2xsaXNpb25zKG9sZFBvcywgbmV3UG9zLCBncmF2aXR5RmFjdG9yLCBlbGxpcHNvaWQsIHRyaWFuZ2xlSXRlcmF0b3IsIHRydWUsIGZhbHNlKTtcclxuXHR9LFxyXG5cclxuXHRoYW5kbGVDb2xsaXNpb25zOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwID0ge1xyXG5cdFx0XHRlbGxpcHNvaWRTcGFjZTogbmV3IFRIUkVFLlZlY3RvcjMoKSxcclxuXHRcdFx0d29ybGRQb3NpdGlvbjogbmV3IFRIUkVFLlZlY3RvcjMoKSxcclxuXHRcdFx0d29ybGRWZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoKSxcclxuXHJcblx0XHRcdGxzcFBvc2l0aW9uOiBuZXcgVEhSRUUuVmVjdG9yMygpLFxyXG5cdFx0XHRsc3BWZWxvY2l0eTogbmV3IFRIUkVFLlZlY3RvcjMoKSxcclxuXHRcdFx0bHNwTm9ybWFsaXplZFZlbG9jaXR5OiBuZXcgVEhSRUUuVmVjdG9yMygpLFxyXG5cdFx0XHRub3JtYWw6IG5ldyBUSFJFRS5WZWN0b3IzKCksXHJcblxyXG5cdFx0XHRmb3VuZENvbGxpc2lvbjogZmFsc2UsXHJcblx0XHRcdG5lYXJlc3REaXN0YW5jZTogMCxcclxuXHRcdFx0aW50ZXJzZWN0aW9uUG9pbnQ6IG5ldyBUSFJFRS5WZWN0b3IzKCksXHJcblx0XHRcdGNvbGxpc2lvblJlY3Vyc2lvbkRlcHRoOiAwLFxyXG5cdFx0XHRzdG9wT25GaXJzdEhpdDogZmFsc2UsXHJcblxyXG5cdFx0XHRncmF2aXR5RmFjdG9yOiAwLFxyXG5cdFx0fTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ob2xkUG9zLCBuZXdQb3MsIGdyYXZpdHlGYWN0b3IsIGVsbGlwc29pZCwgdHJpYW5nbGVJdGVyYXRvciwgc3RvcE9uRmlyc3RIaXQsIGhvcml6b250YWxPbmx5KSB7XHJcblx0XHRcdHAuZWxsaXBzb2lkU3BhY2UuY29weShlbGxpcHNvaWQpO1xyXG5cdFx0XHRwLndvcmxkUG9zaXRpb24uY29weShvbGRQb3MpO1xyXG5cdFx0XHRwLndvcmxkVmVsb2NpdHkuc3ViVmVjdG9ycyhuZXdQb3MsIG9sZFBvcyk7XHJcblxyXG5cdFx0XHRwLmZvdW5kQ29sbGlzaW9uID0gZmFsc2U7XHJcblx0XHRcdHAubmVhcmVzdERpc3RhbmNlID0gMDtcclxuXHRcdFx0cC5jb2xsaXNpb25SZWN1cnNpb25EZXB0aCA9IDA7XHJcblx0XHRcdHAuc3RvcE9uRmlyc3RIaXQgPSBzdG9wT25GaXJzdEhpdDtcclxuXHRcdFx0cC5ncmF2aXR5RmFjdG9yID0gZ3Jhdml0eUZhY3RvcjtcclxuXHJcblx0XHRcdHZhciByZXN1bHQgPSB0aGlzLmNvbGxpc2lvblNsaWRlKHAsIHRyaWFuZ2xlSXRlcmF0b3IpO1xyXG5cdFx0XHRuZXdQb3MuY29weShyZXN1bHQucG9zKTtcclxuXHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRjb2xsaXNpb25TbGlkZTogZnVuY3Rpb24ocCwgdHJpYW5nbGVJdGVyYXRvcikge1xyXG5cdFx0cC5sc3BWZWxvY2l0eS5jb3B5KHAud29ybGRWZWxvY2l0eSkuZGl2aWRlKHAuZWxsaXBzb2lkU3BhY2UpO1xyXG5cdFx0cC5sc3BQb3NpdGlvbi5jb3B5KHAud29ybGRQb3NpdGlvbikuZGl2aWRlKHAuZWxsaXBzb2lkU3BhY2UpO1xyXG5cdFx0dmFyIG9sZFkgPSBwLmxzcFBvc2l0aW9uLnk7XHJcblxyXG5cdFx0cC5jb2xsaXNpb25SZWN1cnNpb25EZXB0aCA9IDA7XHJcblx0XHR2YXIgZmluYWxQb3NpdGlvbiA9IHRoaXMuY29sbGlkZVdpdGhXb3JsZChwLCB0cmlhbmdsZUl0ZXJhdG9yKTtcclxuXHRcdHZhciBjbGltYmluZyA9IChvbGRZIDwgZmluYWxQb3NpdGlvbi55KTtcclxuXHJcblx0XHRpZiAocC5ncmF2aXR5RmFjdG9yICE9PSAwICYmICFjbGltYmluZyAmJiAhcC5ob3Jpem9udGFsT25seSkge1xyXG5cdFx0XHRwLmxzcFZlbG9jaXR5LmNvcHkodGhpcy5ncmF2aXR5KTtcclxuXHRcdFx0cC5sc3BWZWxvY2l0eS55ICo9IHAuZ3Jhdml0eUZhY3RvcjtcclxuXHRcdFx0cC5sc3BWZWxvY2l0eS5kaXZpZGUocC5lbGxpcHNvaWRTcGFjZSk7XHJcblx0XHRcdHAubHNwUG9zaXRpb24uY29weShmaW5hbFBvc2l0aW9uKTtcclxuXHRcdFx0cC5jb2xsaXNpb25SZWN1cnNpb25EZXB0aCA9IDA7XHJcblx0XHRcdGZpbmFsUG9zaXRpb24gPSB0aGlzLmNvbGxpZGVXaXRoV29ybGQocCwgdHJpYW5nbGVJdGVyYXRvcik7XHJcblx0XHR9XHJcblxyXG5cdFx0ZmluYWxQb3NpdGlvbi5tdWx0aXBseShwLmVsbGlwc29pZFNwYWNlKTtcclxuXHJcblx0XHRpZiAocC5ob3Jpem9udGFsT25seSkge1xyXG5cdFx0XHRmaW5hbFBvc2l0aW9uLnkgPSBwLm9yaWdpbmFsSGVpZ2h0O1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciByZXN1bHQgPSB7IFxyXG5cdFx0XHRwb3M6IGZpbmFsUG9zaXRpb24sXHJcblx0XHRcdGNsaW1iaW5nOiBjbGltYmluZyxcclxuXHRcdFx0Zm91bmRDb2xsaXNpb246IHAuZm91bmRDb2xsaXNpb24sXHJcblx0XHRcdGdyaWRPYmplY3Q6IHAuZ3JpZE9iamVjdCxcclxuXHRcdFx0bm9ybWFsOiBwLm5vcm1hbCxcclxuXHRcdH07XHJcblxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9LFxyXG5cclxuXHRjb2xsaWRlV2l0aFdvcmxkOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBub3JtYWwgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIGF1eCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgcmVzdWx0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBkZXN0aW5hdGlvblBvaW50ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBuZXdQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgc2xpZGVQbGFuZU9yaWdpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgc2xpZGVQbGFuZU5vcm1hbCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgbmV3RGVzdGluYXRpb25Qb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgbmV3VmVsb2NpdHlWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHYwID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciB2MSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgdjIgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwLCB0cmlhbmdsZUl0ZXJhdG9yKSB7XHJcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHRcdHZhciB1bml0U2NhbGUgPSB0aGlzLnVuaXRzUGVyTWV0ZXIgLyAxMDA7XHJcblx0XHRcdHZhciB2ZXJ5Q2xvc2VEaXN0YW5jZSA9IDAuMDA1ICogdW5pdFNjYWxlO1xyXG5cclxuXHRcdFx0aWYgKHAuY29sbGlzaW9uUmVjdXJzaW9uRGVwdGggPiA1KSB7XHJcblx0XHRcdFx0cmV0dXJuIHAubHNwUG9zaXRpb247XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHAubHNwTm9ybWFsaXplZFZlbG9jaXR5LmNvcHkocC5sc3BWZWxvY2l0eSkubm9ybWFsaXplKCk7XHJcblxyXG5cdFx0XHRwLmZvdW5kQ29sbGlzaW9uID0gZmFsc2U7XHJcblx0XHRcdHAubmVhcmVzdERpc3RhbmNlID0gMDtcclxuXHJcblx0XHRcdHRyaWFuZ2xlSXRlcmF0b3IoZnVuY3Rpb24oZ3JpZE9iamVjdCwgdDAsIHQxLCB0MiwgdHJpYW5nbGVPZmZzZXQpIHtcclxuXHRcdFx0XHRHQU1FLmdyaWQudG90YWxTcGhlcmVUcmlhbmdsZUNoZWNrcysrO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHYwLmNvcHkodDApLmRpdmlkZShwLmVsbGlwc29pZFNwYWNlKTtcclxuXHRcdFx0XHR2MS5jb3B5KHQxKS5kaXZpZGUocC5lbGxpcHNvaWRTcGFjZSk7XHJcblx0XHRcdFx0djIuY29weSh0MikuZGl2aWRlKHAuZWxsaXBzb2lkU3BhY2UpO1xyXG5cclxuXHRcdFx0XHRhdXguc3ViVmVjdG9ycyh2MiwgdjApO1xyXG5cdFx0XHRcdG5vcm1hbC5jb3B5KHYxKS5zdWIodjApLmNyb3NzKGF1eCkubm9ybWFsaXplKCk7XHJcblxyXG5cdFx0XHRcdHRoYXQuc3BoZXJlQ29sbGlkaW5nV2l0aFRyaWFuZ2xlKGdyaWRPYmplY3QsIHAsIHYwLCB2MSwgdjIsIG5vcm1hbCk7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0aWYgKCFwLmZvdW5kQ29sbGlzaW9uKSB7XHJcblx0XHRcdFx0cmVzdWx0LmNvcHkocC5sc3BQb3NpdGlvbikuYWRkKHAubHNwVmVsb2NpdHkpO1xyXG5cdFx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGRlc3RpbmF0aW9uUG9pbnQuY29weShwLmxzcFBvc2l0aW9uKS5hZGQocC5sc3BWZWxvY2l0eSk7XHJcblx0XHRcdG5ld1Bvc2l0aW9uLmNvcHkocC5sc3BQb3NpdGlvbik7XHJcblxyXG5cdFx0XHRpZiAocC5uZWFyZXN0RGlzdGFuY2UgPj0gdmVyeUNsb3NlRGlzdGFuY2UpIHtcclxuXHRcdFx0XHRhdXguY29weShwLmxzcFZlbG9jaXR5KS5ub3JtYWxpemUoKTtcclxuXHRcdFx0XHRhdXgubXVsdGlwbHlTY2FsYXIocC5uZWFyZXN0RGlzdGFuY2UgLSB2ZXJ5Q2xvc2VEaXN0YW5jZSk7XHJcblx0XHRcdFx0bmV3UG9zaXRpb24uY29weShwLmxzcFBvc2l0aW9uKS5hZGQoYXV4KTtcclxuXHJcblx0XHRcdFx0YXV4Lm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKHZlcnlDbG9zZURpc3RhbmNlKTtcclxuXHRcdFx0XHRwLmludGVyc2VjdGlvblBvaW50LnN1YihhdXgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXAuc3RvcE9uRmlyc3RIaXQpIHtcclxuXHRcdFx0XHRzbGlkZVBsYW5lT3JpZ2luLmNvcHkocC5pbnRlcnNlY3Rpb25Qb2ludCk7XHJcblx0XHRcdFx0c2xpZGVQbGFuZU5vcm1hbC5jb3B5KG5ld1Bvc2l0aW9uKS5zdWIocC5pbnRlcnNlY3Rpb25Qb2ludCkubm9ybWFsaXplKCk7XHJcblxyXG5cdFx0XHRcdHZhciB4ID0gc2xpZGVQbGFuZU9yaWdpbi54O1xyXG5cdFx0XHRcdHZhciB5ID0gc2xpZGVQbGFuZU9yaWdpbi55O1xyXG5cdFx0XHRcdHZhciB6ID0gc2xpZGVQbGFuZU9yaWdpbi56O1xyXG5cclxuXHRcdFx0XHR2YXIgQSA9IHNsaWRlUGxhbmVOb3JtYWwueDtcclxuXHRcdFx0XHR2YXIgQiA9IHNsaWRlUGxhbmVOb3JtYWwueTtcclxuXHRcdFx0XHR2YXIgQyA9IHNsaWRlUGxhbmVOb3JtYWwuejtcclxuXHRcdFx0XHR2YXIgRCA9IC0oKEEgKiB4KSArIChCICogeSkgKyAoQyAqIHopKTtcclxuXHJcblx0XHRcdFx0dmFyIHBsYW5lQ29uc3RhbnQgPSBEO1xyXG5cclxuXHRcdFx0XHR2YXIgc2lnbmVkRGlzdEZyb21EZXN0UG9pbnRUb1NsaWRpbmdQbGFuZSA9IHNsaWRlUGxhbmVOb3JtYWwuZG90KGRlc3RpbmF0aW9uUG9pbnQpICsgcGxhbmVDb25zdGFudDtcclxuXHJcblx0XHRcdFx0YXV4LmNvcHkoc2xpZGVQbGFuZU5vcm1hbCkubXVsdGlwbHlTY2FsYXIoc2lnbmVkRGlzdEZyb21EZXN0UG9pbnRUb1NsaWRpbmdQbGFuZSk7XHJcblx0XHRcdFx0bmV3RGVzdGluYXRpb25Qb2ludC5jb3B5KGRlc3RpbmF0aW9uUG9pbnQpLnN1YihhdXgpO1xyXG5cdFx0XHRcdG5ld1ZlbG9jaXR5VmVjdG9yLmNvcHkobmV3RGVzdGluYXRpb25Qb2ludCkuc3ViKHAuaW50ZXJzZWN0aW9uUG9pbnQpO1xyXG5cclxuXHRcdFx0XHRpZiAobmV3VmVsb2NpdHlWZWN0b3IubGVuZ3RoKCkgPCB2ZXJ5Q2xvc2VEaXN0YW5jZSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIG5ld1Bvc2l0aW9uO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0cC5jb2xsaXNpb25SZWN1cnNpb25EZXB0aCsrO1xyXG5cdFx0XHRcdHAubHNwUG9zaXRpb24uY29weShuZXdQb3NpdGlvbik7XHJcblx0XHRcdFx0cC5sc3BWZWxvY2l0eS5jb3B5KG5ld1ZlbG9jaXR5VmVjdG9yKTtcclxuXHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuY29sbGlkZVdpdGhXb3JsZChwLCB0cmlhbmdsZUl0ZXJhdG9yKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRwLmxzcFBvc2l0aW9uLmNvcHkobmV3UG9zaXRpb24pO1xyXG5cdFx0XHRcdHJldHVybiBwLmxzcFBvc2l0aW9uO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRzcGhlcmVDb2xsaWRpbmdXaXRoVHJpYW5nbGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHZlbG9jaXR5ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBwb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgYXV4ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBwbGFuZUludGVyc2VjdGlvblBvaW50ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBjb2xsaXNpb25Qb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgZWRnZSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgc3BoZXJlUG9zaXRpb25Ub1ZlcnRleCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGdyaWRPYmplY3QsIHAsIHYwLCB2MSwgdjIsIG5vcm1hbCkge1xyXG5cdFx0XHR2YXIgZmFjaW5nID0gbm9ybWFsLmRvdChwLmxzcE5vcm1hbGl6ZWRWZWxvY2l0eSk7XHRcdFx0XHJcblx0XHRcdGlmIChmYWNpbmcgPD0gMCkge1xyXG5cdFx0XHRcdHZlbG9jaXR5LmNvcHkocC5sc3BWZWxvY2l0eSk7XHJcblx0XHRcdFx0cG9zaXRpb24uY29weShwLmxzcFBvc2l0aW9uKTtcclxuXHJcblx0XHRcdFx0dmFyIHQwLCB0MTtcclxuXHRcdFx0XHR2YXIgc3BoZXJlSW5QbGFuZSA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHR2YXIgQSA9IG5vcm1hbC54O1xyXG5cdFx0XHRcdHZhciBCID0gbm9ybWFsLnk7XHJcblx0XHRcdFx0dmFyIEMgPSBub3JtYWwuejtcclxuXHRcdFx0XHR2YXIgRCA9IC0oKEEgKiB2MC54KSArIChCICogdjAueSkgKyAoQyAqIHYwLnopKTtcclxuXHJcblx0XHRcdFx0dmFyIHBsYW5lQ29uc3RhbnQgPSBEO1xyXG5cclxuXHRcdFx0XHR2YXIgc2lnbmVkRGlzdEZyb21Qb3NpdGlvblRvVHJpUGxhbmUgPSBwb3NpdGlvbi5kb3Qobm9ybWFsKSArIHBsYW5lQ29uc3RhbnQ7XHJcblx0XHRcdFx0dmFyIHBsYW5lTm9ybWFsRG90VmVsb2NpdHkgPSBub3JtYWwuZG90KHZlbG9jaXR5KTtcclxuXHJcblx0XHRcdFx0aWYgKHBsYW5lTm9ybWFsRG90VmVsb2NpdHkgPT09IDApIHtcclxuXHRcdFx0XHRcdGlmIChNYXRoLmFicyhzaWduZWREaXN0RnJvbVBvc2l0aW9uVG9UcmlQbGFuZSkgPj0gMSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRzcGhlcmVJblBsYW5lID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0dDAgPSAoMSAtIHNpZ25lZERpc3RGcm9tUG9zaXRpb25Ub1RyaVBsYW5lKSAvIHBsYW5lTm9ybWFsRG90VmVsb2NpdHk7XHJcblx0XHRcdFx0XHR0MSA9ICgtMSAtIHNpZ25lZERpc3RGcm9tUG9zaXRpb25Ub1RyaVBsYW5lKSAvIHBsYW5lTm9ybWFsRG90VmVsb2NpdHk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHQwID4gdDEpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHRlbXAgPSB0MDtcclxuXHRcdFx0XHRcdFx0dDAgPSB0MTtcclxuXHRcdFx0XHRcdFx0dDEgPSB0ZW1wO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICh0MCA+IDEgfHwgdDEgPCAwKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAodDAgPCAwKSB7XHJcblx0XHRcdFx0XHRcdHQwID0gMDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmICh0MSA+IDEpIHtcclxuXHRcdFx0XHRcdFx0dDEgPSAxO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIGNvbGxpZGluZ1dpdGhUcmkgPSBmYWxzZTtcclxuXHRcdFx0XHR2YXIgdCA9IDE7XHJcblxyXG5cdFx0XHRcdGlmICghc3BoZXJlSW5QbGFuZSkge1xyXG5cdFx0XHRcdFx0YXV4LmNvcHkodmVsb2NpdHkpLm11bHRpcGx5U2NhbGFyKHQwKTtcclxuXHRcdFx0XHRcdHBsYW5lSW50ZXJzZWN0aW9uUG9pbnQuY29weShwb3NpdGlvbikuYWRkKGF1eCkuc3ViKG5vcm1hbCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHRoaXMuY2hlY2tQb2ludEluVHJpYW5nbGUocGxhbmVJbnRlcnNlY3Rpb25Qb2ludCwgdjAsIHYxLCB2MikpIHtcclxuXHRcdFx0XHRcdFx0Y29sbGlkaW5nV2l0aFRyaSA9IHRydWU7XHJcblx0XHRcdFx0XHRcdHQgPSB0MDtcclxuXHRcdFx0XHRcdFx0Y29sbGlzaW9uUG9pbnQuY29weShwbGFuZUludGVyc2VjdGlvblBvaW50KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmICghY29sbGlkaW5nV2l0aFRyaSkge1xyXG5cdFx0XHRcdFx0dmFyIGEsIGIsIGM7XHJcblx0XHRcdFx0XHR2YXIgdmVsb2NpdHlMZW5ndGhTcXVhcmVkID0gdmVsb2NpdHkubGVuZ3RoU3EoKTtcclxuXHRcdFx0XHRcdGEgPSB2ZWxvY2l0eUxlbmd0aFNxdWFyZWQ7XHJcblx0XHRcdFx0XHR2YXIgcmVzdWx0ID0ge307XHJcblxyXG5cdFx0XHRcdFx0YXV4LmNvcHkocG9zaXRpb24pLnN1Yih2MCk7XHJcblx0XHRcdFx0XHRiID0gMiAqIHZlbG9jaXR5LmRvdChhdXgpO1xyXG5cdFx0XHRcdFx0YXV4LmNvcHkodjApLnN1Yihwb3NpdGlvbik7XHJcblx0XHRcdFx0XHRjID0gYXV4Lmxlbmd0aCgpO1xyXG5cdFx0XHRcdFx0YyA9IGMgKiBjIC0gMTtcclxuXHRcdFx0XHRcdGlmICh0aGlzLmdldExvd2VzdFJvb3QoYSwgYiwgYywgdCwgcmVzdWx0KSkge1xyXG5cdFx0XHRcdFx0XHR0ID0gcmVzdWx0LnJvb3Q7XHJcblx0XHRcdFx0XHRcdGNvbGxpZGluZ1dpdGhUcmkgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRjb2xsaXNpb25Qb2ludC5jb3B5KHYwKTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRhdXguY29weShwb3NpdGlvbikuc3ViKHYxKTtcclxuXHRcdFx0XHRcdGIgPSAyICogdmVsb2NpdHkuZG90KGF1eCk7XHJcblx0XHRcdFx0XHRhdXguY29weSh2MSkuc3ViKHBvc2l0aW9uKTtcclxuXHRcdFx0XHRcdGMgPSBhdXgubGVuZ3RoKCk7XHJcblx0XHRcdFx0XHRjID0gYyAqIGMgLSAxO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuZ2V0TG93ZXN0Um9vdChhLCBiLCBjLCB0LCByZXN1bHQpKSB7XHJcblx0XHRcdFx0XHRcdHQgPSByZXN1bHQucm9vdDtcclxuXHRcdFx0XHRcdFx0Y29sbGlkaW5nV2l0aFRyaSA9IHRydWU7XHJcblx0XHRcdFx0XHRcdGNvbGxpc2lvblBvaW50LmNvcHkodjEpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGF1eC5jb3B5KHBvc2l0aW9uKS5zdWIodjIpO1xyXG5cdFx0XHRcdFx0YiA9IDIgKiB2ZWxvY2l0eS5kb3QoYXV4KTtcclxuXHRcdFx0XHRcdGF1eC5jb3B5KHYyKS5zdWIocG9zaXRpb24pO1xyXG5cdFx0XHRcdFx0YyA9IGF1eC5sZW5ndGgoKTtcclxuXHRcdFx0XHRcdGMgPSBjICogYyAtIDE7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5nZXRMb3dlc3RSb290KGEsIGIsIGMsIHQsIHJlc3VsdCkpIHtcclxuXHRcdFx0XHRcdFx0dCA9IHJlc3VsdC5yb290O1xyXG5cdFx0XHRcdFx0XHRjb2xsaWRpbmdXaXRoVHJpID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0Y29sbGlzaW9uUG9pbnQuY29weSh2Mik7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0ZWRnZS5jb3B5KHYxKS5zdWIodjApO1xyXG5cdFx0XHRcdFx0c3BoZXJlUG9zaXRpb25Ub1ZlcnRleC5jb3B5KHYwKS5zdWIocG9zaXRpb24pO1xyXG5cdFx0XHRcdFx0dmFyIGVkZ2VMZW5ndGhTcXVhcmVkID0gZWRnZS5sZW5ndGhTcSgpO1xyXG5cdFx0XHRcdFx0dmFyIGVkZ2VEb3RWZWxvY2l0eSA9IGVkZ2UuZG90KHZlbG9jaXR5KTtcclxuXHRcdFx0XHRcdHZhciBlZGdlRG90U3BoZXJlUG9zaXRpb25Ub1ZlcnRleCA9IGVkZ2UuZG90KHNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXgpO1xyXG5cdFx0XHRcdFx0dmFyIHNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXhMZW5ndGhTcXVhcmVkID0gc3BoZXJlUG9zaXRpb25Ub1ZlcnRleC5sZW5ndGhTcSgpO1xyXG5cclxuXHRcdFx0XHRcdGEgPSBlZGdlTGVuZ3RoU3F1YXJlZCAqIC12ZWxvY2l0eUxlbmd0aFNxdWFyZWQgKyAoZWRnZURvdFZlbG9jaXR5ICogZWRnZURvdFZlbG9jaXR5KTtcclxuXHRcdFx0XHRcdGIgPSBlZGdlTGVuZ3RoU3F1YXJlZCAqIDIgKiB2ZWxvY2l0eS5kb3Qoc3BoZXJlUG9zaXRpb25Ub1ZlcnRleCkgLSAyICogZWRnZURvdFZlbG9jaXR5ICogZWRnZURvdFNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXg7XHJcblx0XHRcdFx0XHRjID0gZWRnZUxlbmd0aFNxdWFyZWQgKiAoMSAtIHNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXhMZW5ndGhTcXVhcmVkKSArIFxyXG5cdFx0XHRcdFx0XHQoZWRnZURvdFNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXggKiBlZGdlRG90U3BoZXJlUG9zaXRpb25Ub1ZlcnRleCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHRoaXMuZ2V0TG93ZXN0Um9vdChhLCBiLCBjLCB0LCByZXN1bHQpKSB7XHJcblx0XHRcdFx0XHRcdHZhciBmID0gKGVkZ2VEb3RWZWxvY2l0eSAqIHJlc3VsdC5yb290IC0gZWRnZURvdFNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXgpIC8gZWRnZUxlbmd0aFNxdWFyZWQ7XHJcblx0XHRcdFx0XHRcdGlmIChmID49IDAgJiYgZiA8PSAxKSB7XHJcblx0XHRcdFx0XHRcdFx0dCA9IHJlc3VsdC5yb290O1xyXG5cdFx0XHRcdFx0XHRcdGNvbGxpZGluZ1dpdGhUcmkgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdGVkZ2UubXVsdGlwbHlTY2FsYXIoZik7XHJcblx0XHRcdFx0XHRcdFx0Y29sbGlzaW9uUG9pbnQuY29weSh2MCkuYWRkKGVkZ2UpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0ZWRnZS5jb3B5KHYyKS5zdWIodjEpO1xyXG5cdFx0XHRcdFx0c3BoZXJlUG9zaXRpb25Ub1ZlcnRleC5jb3B5KHYxKS5zdWIocG9zaXRpb24pO1xyXG5cdFx0XHRcdFx0ZWRnZUxlbmd0aFNxdWFyZWQgPSBlZGdlLmxlbmd0aFNxKCk7XHJcblx0XHRcdFx0XHRlZGdlRG90VmVsb2NpdHkgPSBlZGdlLmRvdCh2ZWxvY2l0eSk7XHJcblx0XHRcdFx0XHRlZGdlRG90U3BoZXJlUG9zaXRpb25Ub1ZlcnRleCA9IGVkZ2UuZG90KHNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXgpO1xyXG5cdFx0XHRcdFx0c3BoZXJlUG9zaXRpb25Ub1ZlcnRleExlbmd0aFNxdWFyZWQgPSBzcGhlcmVQb3NpdGlvblRvVmVydGV4Lmxlbmd0aFNxKCk7XHJcblxyXG5cdFx0XHRcdFx0YSA9IGVkZ2VMZW5ndGhTcXVhcmVkICogLXZlbG9jaXR5TGVuZ3RoU3F1YXJlZCArIChlZGdlRG90VmVsb2NpdHkgKiBlZGdlRG90VmVsb2NpdHkpO1xyXG5cdFx0XHRcdFx0YiA9IGVkZ2VMZW5ndGhTcXVhcmVkICogMiAqIHZlbG9jaXR5LmRvdChzcGhlcmVQb3NpdGlvblRvVmVydGV4KSAtIDIgKiBlZGdlRG90VmVsb2NpdHkgKiBlZGdlRG90U3BoZXJlUG9zaXRpb25Ub1ZlcnRleDtcclxuXHRcdFx0XHRcdGMgPSBlZGdlTGVuZ3RoU3F1YXJlZCAqICgxIC0gc3BoZXJlUG9zaXRpb25Ub1ZlcnRleExlbmd0aFNxdWFyZWQpICsgXHJcblx0XHRcdFx0XHRcdChlZGdlRG90U3BoZXJlUG9zaXRpb25Ub1ZlcnRleCAqIGVkZ2VEb3RTcGhlcmVQb3NpdGlvblRvVmVydGV4KTtcclxuXHJcblx0XHRcdFx0XHRpZiAodGhpcy5nZXRMb3dlc3RSb290KGEsIGIsIGMsIHQsIHJlc3VsdCkpIHtcclxuXHRcdFx0XHRcdFx0dmFyIGYgPSAoZWRnZURvdFZlbG9jaXR5ICogcmVzdWx0LnJvb3QgLSBlZGdlRG90U3BoZXJlUG9zaXRpb25Ub1ZlcnRleCkgLyBlZGdlTGVuZ3RoU3F1YXJlZDtcclxuXHRcdFx0XHRcdFx0aWYgKGYgPj0gMCAmJiBmIDw9IDEpIHtcclxuXHRcdFx0XHRcdFx0XHR0ID0gcmVzdWx0LnJvb3Q7XHJcblx0XHRcdFx0XHRcdFx0Y29sbGlkaW5nV2l0aFRyaSA9IHRydWU7XHJcblx0XHRcdFx0XHRcdFx0ZWRnZS5tdWx0aXBseVNjYWxhcihmKTtcclxuXHRcdFx0XHRcdFx0XHRjb2xsaXNpb25Qb2ludC5jb3B5KHYxKS5hZGQoZWRnZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRlZGdlLmNvcHkodjApLnN1Yih2Mik7XHJcblx0XHRcdFx0XHRzcGhlcmVQb3NpdGlvblRvVmVydGV4LmNvcHkodjIpLnN1Yihwb3NpdGlvbik7XHJcblx0XHRcdFx0XHRlZGdlTGVuZ3RoU3F1YXJlZCA9IGVkZ2UubGVuZ3RoU3EoKTtcclxuXHRcdFx0XHRcdGVkZ2VEb3RWZWxvY2l0eSA9IGVkZ2UuZG90KHZlbG9jaXR5KTtcclxuXHRcdFx0XHRcdGVkZ2VEb3RTcGhlcmVQb3NpdGlvblRvVmVydGV4ID0gZWRnZS5kb3Qoc3BoZXJlUG9zaXRpb25Ub1ZlcnRleCk7XHJcblx0XHRcdFx0XHRzcGhlcmVQb3NpdGlvblRvVmVydGV4TGVuZ3RoU3F1YXJlZCA9IHNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXgubGVuZ3RoU3EoKTtcclxuXHJcblx0XHRcdFx0XHRhID0gZWRnZUxlbmd0aFNxdWFyZWQgKiAtdmVsb2NpdHlMZW5ndGhTcXVhcmVkICsgKGVkZ2VEb3RWZWxvY2l0eSAqIGVkZ2VEb3RWZWxvY2l0eSk7XHJcblx0XHRcdFx0XHRiID0gZWRnZUxlbmd0aFNxdWFyZWQgKiAyICogdmVsb2NpdHkuZG90KHNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXgpIC0gMiAqIGVkZ2VEb3RWZWxvY2l0eSAqIGVkZ2VEb3RTcGhlcmVQb3NpdGlvblRvVmVydGV4O1xyXG5cdFx0XHRcdFx0YyA9IGVkZ2VMZW5ndGhTcXVhcmVkICogKDEgLSBzcGhlcmVQb3NpdGlvblRvVmVydGV4TGVuZ3RoU3F1YXJlZCkgKyBcclxuXHRcdFx0XHRcdFx0KGVkZ2VEb3RTcGhlcmVQb3NpdGlvblRvVmVydGV4ICogZWRnZURvdFNwaGVyZVBvc2l0aW9uVG9WZXJ0ZXgpO1xyXG5cclxuXHRcdFx0XHRcdGlmICh0aGlzLmdldExvd2VzdFJvb3QoYSwgYiwgYywgdCwgcmVzdWx0KSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgZiA9IChlZGdlRG90VmVsb2NpdHkgKiByZXN1bHQucm9vdCAtIGVkZ2VEb3RTcGhlcmVQb3NpdGlvblRvVmVydGV4KSAvIGVkZ2VMZW5ndGhTcXVhcmVkO1xyXG5cdFx0XHRcdFx0XHRpZiAoZiA+PSAwICYmIGYgPD0gMSkge1xyXG5cdFx0XHRcdFx0XHRcdHQgPSByZXN1bHQucm9vdDtcclxuXHRcdFx0XHRcdFx0XHRjb2xsaWRpbmdXaXRoVHJpID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRlZGdlLm11bHRpcGx5U2NhbGFyKGYpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbGxpc2lvblBvaW50LmNvcHkodjIpLmFkZChlZGdlKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKGNvbGxpZGluZ1dpdGhUcmkpIHtcclxuXHRcdFx0XHRcdHZhciBkaXN0VG9Db2xsaXNpb24gPSB0ICogdmVsb2NpdHkubGVuZ3RoKCk7XHJcblx0XHRcdFx0XHRpZiAoIXAuZm91bmRDb2xsaXNpb24gfHwgZGlzdFRvQ29sbGlzaW9uIDwgcC5uZWFyZXN0RGlzdGFuY2UpIHtcclxuXHRcdFx0XHRcdFx0cC5uZWFyZXN0RGlzdGFuY2UgPSBkaXN0VG9Db2xsaXNpb247XHJcblx0XHRcdFx0XHRcdHAuaW50ZXJzZWN0aW9uUG9pbnQuY29weShjb2xsaXNpb25Qb2ludCk7XHJcblx0XHRcdFx0XHRcdHAuZm91bmRDb2xsaXNpb24gPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRwLm5vcm1hbC5jb3B5KG5vcm1hbCk7XHJcblx0XHRcdFx0XHRcdHAuZ3JpZE9iamVjdCA9IGdyaWRPYmplY3Q7XHJcblxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGNoZWNrUG9pbnRJblRyaWFuZ2xlOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBjcDEgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIGNwMiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgYXV4ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBhdXgyID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ocG9pbnQsIHYxLCB2MiwgdjMpIHtcclxuXHRcdFx0YXV4LmNvcHkodjMpLnN1Yih2Mik7XHJcblx0XHRcdGF1eDIuY29weShwb2ludCkuc3ViKHYyKTtcclxuXHRcdFx0Y3AxLmNyb3NzVmVjdG9ycyhhdXgsIGF1eDIpO1xyXG5cclxuXHRcdFx0YXV4LmNvcHkodjMpLnN1Yih2Mik7XHJcblx0XHRcdGF1eDIuY29weSh2MSkuc3ViKHYyKTtcclxuXHRcdFx0Y3AyLmNyb3NzVmVjdG9ycyhhdXgsIGF1eDIpO1xyXG5cclxuXHRcdFx0aWYgKGNwMS5kb3QoY3AyKSA+PSAwKSB7XHJcblx0XHRcdFx0YXV4LmNvcHkodjMpLnN1Yih2MSk7XHJcblx0XHRcdFx0YXV4Mi5jb3B5KHBvaW50KS5zdWIodjEpO1xyXG5cdFx0XHRcdGNwMS5jcm9zc1ZlY3RvcnMoYXV4LCBhdXgyKTtcclxuXHJcblx0XHRcdFx0YXV4LmNvcHkodjMpLnN1Yih2MSk7XHJcblx0XHRcdFx0YXV4Mi5jb3B5KHYyKS5zdWIodjEpO1xyXG5cdFx0XHRcdGNwMi5jcm9zc1ZlY3RvcnMoYXV4LCBhdXgyKTtcclxuXHJcblx0XHRcdFx0aWYgKGNwMS5kb3QoY3AyKSA+PSAwKSB7XHJcblx0XHRcdFx0XHRhdXguY29weSh2Mikuc3ViKHYxKTtcclxuXHRcdFx0XHRcdGF1eDIuY29weShwb2ludCkuc3ViKHYxKTtcclxuXHRcdFx0XHRcdGNwMS5jcm9zc1ZlY3RvcnMoYXV4LCBhdXgyKTtcclxuXHJcblx0XHRcdFx0XHRhdXguY29weSh2Mikuc3ViKHYxKTtcclxuXHRcdFx0XHRcdGF1eDIuY29weSh2Mykuc3ViKHYxKTtcclxuXHRcdFx0XHRcdGNwMi5jcm9zc1ZlY3RvcnMoYXV4LCBhdXgyKTtcclxuXHJcblx0XHRcdFx0XHRpZiAoY3AxLmRvdChjcDIpID49IDApIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRnZXRMb3dlc3RSb290OiBmdW5jdGlvbihhLCBiLCBjLCBtYXhSLCByZXN1bHQpIHtcclxuXHRcdHZhciBkZXRlcm1pbmFudCA9IGIgKiBiIC0gNCAqIGEgKiBjO1xyXG5cdFx0aWYgKGRldGVybWluYW50IDwgMCkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHNxcnREID0gTWF0aC5zcXJ0KGRldGVybWluYW50KTtcclxuXHRcdHZhciByMSA9ICgtYiAtIHNxcnREKSAvICgyICogYSk7XHJcblx0XHR2YXIgcjIgPSAoLWIgKyBzcXJ0RCkgLyAoMiAqIGEpO1xyXG5cclxuXHRcdGlmIChyMSA+IHIyKSB7XHJcblx0XHRcdHZhciB0ZW1wID0gcjI7XHJcblx0XHRcdHIyID0gcjE7XHJcblx0XHRcdHIxID0gdGVtcDtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAocjEgPiAwICYmIHIxIDwgbWF4Uikge1xyXG5cdFx0XHRyZXN1bHQucm9vdCA9IHIxO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAocjIgPiAwICYmIHIyIDwgbWF4Uikge1xyXG5cdFx0XHRyZXN1bHQucm9vdCA9IHIyO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fSxcclxufTsiLCJHUy5IaXRzY2FuSGVscGVyID0ge1xyXG5cdHVuaXRMZW5ndGg6IDY0LFxyXG5cdHN0ZXBzOiA1LFxyXG5cclxuXHRzcHJlYWQ6IGZ1bmN0aW9uKHdlYXBvbiwgeEFuZ2xlLCB5QW5nbGUsIGNhbGxiYWNrKSB7XHJcblx0XHR2YXIgYW5nbGVGb3JYID0gd2VhcG9uLnNwcmVhZC5hbmdsZU9mZnNldCArIDIwICogKE1hdGguYWJzKHlBbmdsZSAtIDkwKSAvIDkwKSAqIChNYXRoLmFicyh5QW5nbGUgLSA5MCkgLyA5MCk7XHJcblx0XHR2YXIgYW5nbGVGb3JZID0gd2VhcG9uLnNwcmVhZC5hbmdsZU9mZnNldDtcclxuXHRcdFxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB3ZWFwb24uc3ByZWFkLnNob3RzOyBpKyspIHtcclxuXHRcdFx0dmFyIHhBbmdsZU9mZnNldCA9IHhBbmdsZSArIE1hdGgucmFuZG9tKCkgKiBhbmdsZUZvclggKiAyIC0gYW5nbGVGb3JYO1xyXG5cdFx0XHR2YXIgeUFuZ2xlT2Zmc2V0ID0geUFuZ2xlICsgTWF0aC5yYW5kb20oKSAqIGFuZ2xlRm9yWSAqIDIgLSBhbmdsZUZvclk7XHJcblxyXG5cdFx0XHR2YXIgeCA9IE1hdGguc2luKE1hdGguUEkgLyAxODAgKiB5QW5nbGVPZmZzZXQpICogTWF0aC5jb3MoTWF0aC5QSSAvIDE4MCAqIHhBbmdsZU9mZnNldCk7XHJcblx0XHRcdHZhciB5ID0gTWF0aC5jb3MoTWF0aC5QSSAvIDE4MCAqIHlBbmdsZU9mZnNldCk7XHJcblx0XHRcdHZhciB6ID0gTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqIHlBbmdsZU9mZnNldCkgKiBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogeEFuZ2xlT2Zmc2V0KTtcclxuXHJcblx0XHRcdHZhciBkaXIgPSBuZXcgVEhSRUUuVmVjdG9yMyh4LCB5LCB6KTtcclxuXHRcdFx0ZGlyLm5vcm1hbGl6ZSgpO1xyXG5cclxuXHRcdFx0Y2FsbGJhY2soZGlyKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRJbnRlcnNlY3Rpb246IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG5ld1BvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgc3RlcCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgZW5kUG9pbnQgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHBvaW50cyA9IFsgbmV3IFRIUkVFLlZlY3RvcjIoKSwgbmV3IFRIUkVFLlZlY3RvcjIoKSBdO1xyXG5cdFx0dmFyIHJheSA9IG5ldyBUSFJFRS5SYXkoKTtcclxuXHRcdHZhciBwb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHBvcywgZGlyLCBncmlkLCB0eXBlc0Vudmlyb25tZW50LCB0eXBlc0VudGl0eSwgc3RlcHMsIGV4Y2VwdCkge1xyXG5cdFx0XHRzdGVwcyA9IHN0ZXBzIHx8IHRoaXMuc3RlcHM7XHJcblx0XHRcdG5ld1Bvcy5jb3B5KHBvcyk7XHJcblx0XHRcdHN0ZXAuY29weShkaXIpLm11bHRpcGx5U2NhbGFyKHRoaXMudW5pdExlbmd0aCk7XHJcblxyXG5cdFx0XHR2YXIgcmVzdWx0ID0ge1xyXG5cdFx0XHRcdHR5cGU6IEdTLkNvbGxpc2lvblR5cGVzLk5vbmUsXHJcblx0XHRcdFx0cG9zOiBuZXcgVEhSRUUuVmVjdG9yMygpLFxyXG5cdFx0XHRcdGdyaWRPYmplY3Q6IG51bGwsXHJcblx0XHRcdFx0ZGlzdGFuY2U6IEluZmluaXR5LFxyXG5cdFx0XHRcdG5vcm1hbDogbmV3IFRIUkVFLlZlY3RvcjMoKSxcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHJheS5zZXQocG9zLCBkaXIpO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzdGVwczsgaSsrKSB7XHJcblx0XHRcdFx0ZW5kUG9pbnQuY29weShuZXdQb3MpLmFkZChzdGVwKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRuZXdQb3MudG9WZWN0b3IyKHBvaW50c1swXSk7XHJcblx0XHRcdFx0ZW5kUG9pbnQudG9WZWN0b3IyKHBvaW50c1sxXSk7XHJcblxyXG5cdFx0XHRcdHZhciBncmlkTG9jYXRpb24gPSBncmlkLmdldEdyaWRMb2NhdGlvbkZyb21Qb2ludHMocG9pbnRzKTtcclxuXHRcdFx0XHRpZiAoZ3JpZExvY2F0aW9uID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dGhpcy5jaGVja0Vudmlyb25tZW50SW50ZXJzZWN0aW9uKHJheSwgZ3JpZCwgZ3JpZExvY2F0aW9uLCB0eXBlc0Vudmlyb25tZW50LCByZXN1bHQsIGV4Y2VwdCk7XHJcblx0XHRcdFx0dGhpcy5jaGVja0VudGl0eUludGVyc2VjdGlvbihyYXksIGdyaWQsIGdyaWRMb2NhdGlvbiwgdHlwZXNFbnRpdHksIHJlc3VsdCwgZXhjZXB0KTtcclxuXHJcblx0XHRcdFx0aWYgKHJlc3VsdC50eXBlICE9PSBHUy5Db2xsaXNpb25UeXBlcy5Ob25lKSB7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0bmV3UG9zLmFkZChzdGVwKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRjaGVja0Vudmlyb25tZW50SW50ZXJzZWN0aW9uOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBhdXggPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHBvaW50ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ocmF5LCBncmlkLCBncmlkTG9jYXRpb24sIHR5cGVzLCByZXN1bHQsIGV4Y2VwdCkge1xyXG5cdFx0XHR2YXIgdHJpYW5nbGVJdGVyYXRvciA9IGdyaWQuZ2V0VHJpYW5nbGVJdGVyYXRvcihncmlkTG9jYXRpb24sIHR5cGVzKTtcclxuXHJcblx0XHRcdHRyaWFuZ2xlSXRlcmF0b3IoZnVuY3Rpb24oZ3JpZE9iamVjdCwgdjAsIHYxLCB2Mikge1xyXG5cdFx0XHRcdGlmIChncmlkT2JqZWN0ID09PSBleGNlcHQpIHtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChyYXkuaW50ZXJzZWN0VHJpYW5nbGUodjAsIHYxLCB2MiwgdHJ1ZSwgcG9pbnQpICE9PSBudWxsKSB7XHJcblx0XHRcdFx0XHR2YXIgZGlzdCA9IHBvaW50LmRpc3RhbmNlVG9TcXVhcmVkKHJheS5vcmlnaW4pO1xyXG5cclxuXHRcdFx0XHRcdGlmIChkaXN0IDwgcmVzdWx0LmRpc3RhbmNlKSB7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC50eXBlID0gR1MuQ29sbGlzaW9uVHlwZXMuRW52aXJvbm1lbnQ7XHJcblxyXG5cdFx0XHRcdFx0XHRhdXguc3ViVmVjdG9ycyh2MiwgdjApO1xyXG5cdFx0XHRcdFx0XHRyZXN1bHQubm9ybWFsLmNvcHkodjEpLnN1Yih2MCkuY3Jvc3MoYXV4KS5ub3JtYWxpemUoKTtcclxuXHJcblx0XHRcdFx0XHRcdHJlc3VsdC5wb3MuY29weShwb2ludCkuYWRkKHJlc3VsdC5ub3JtYWwpO1xyXG5cdFx0XHRcdFx0XHRyZXN1bHQuZGlzdGFuY2UgPSBkaXN0O1xyXG5cdFx0XHRcdFx0XHRyZXN1bHQuZ3JpZE9iamVjdCA9IGdyaWRPYmplY3Q7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGNoZWNrRW50aXR5SW50ZXJzZWN0aW9uOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHJheSwgZ3JpZCwgZ3JpZExvY2F0aW9uLCB0eXBlcywgcmVzdWx0LCBleGNlcHQpIHtcclxuXHRcdFx0dmFyIGNlbGxzID0gZ3JpZC5nZXRDZWxsc0Zyb21HcmlkTG9jYXRpb24oZ3JpZExvY2F0aW9uKTtcclxuXHRcdFxyXG5cdFx0XHRncmlkLmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxscyhjZWxscywgdHlwZXMsIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0XHRpZiAoZ3JpZE9iamVjdC5kZWFkIHx8IGdyaWRPYmplY3QgPT09IGV4Y2VwdCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKHJheS5pbnRlcnNlY3RCb3goZ3JpZE9iamVjdC52aWV3LmNvbGxpc2lvbkRhdGEuYm91bmRpbmdCb3gsIHBvaW50KSAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0dmFyIGRpc3QgPSBwb2ludC5kaXN0YW5jZVRvU3F1YXJlZChyYXkub3JpZ2luKTtcclxuXHJcblx0XHRcdFx0XHRpZiAoZGlzdCA8IHJlc3VsdC5kaXN0YW5jZSkge1xyXG5cdFx0XHRcdFx0XHRyZXN1bHQudHlwZSA9IEdTLkNvbGxpc2lvblR5cGVzLkVudGl0eTtcclxuXHJcblx0XHRcdFx0XHRcdHJlc3VsdC5wb3MuY29weShwb2ludCk7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC5kaXN0YW5jZSA9IGRpc3Q7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC5ncmlkT2JqZWN0ID0gZ3JpZE9iamVjdDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxufTsiLCJHUy5SZWdpb25IZWxwZXIgPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLm1hdGVyaWFsID0gbmV3IEdTLk1lc2hWZXJ0ZXhDb2xvck1hdGVyaWFsKCk7XHJcbn07XHJcblxyXG5HUy5SZWdpb25IZWxwZXIucHJvdG90eXBlID0ge1xyXG5cdGNvbnN0cnVjdG9yOiBHUy5SZWdpb25IZWxwZXIsXHJcblxyXG5cdGdldFJlZ2lvbnM6IGZ1bmN0aW9uKHNlY3RvcnMsIHNlY3RvckxpbmtzKSB7XHJcblx0XHR2YXIgcmVzdWx0ID0gdGhpcy5nZXRTZWN0b3JHcmFwaChzZWN0b3JzLCBzZWN0b3JMaW5rcyk7XHJcblx0XHRyZXN1bHQucmVnaW9ucyA9IHRoaXMuY29uc3RydWN0UmVnaW9ucyhyZXN1bHQuc2VjdG9yRGljdCwgcmVzdWx0LnNlY3RvckdyYXBoKTtcclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fSxcclxuXHJcblx0Z2V0U2VjdG9yR3JhcGg6IGZ1bmN0aW9uKHNlY3RvcnMsIHNlY3RvckxpbmtzKSB7XHJcblx0XHR2YXIgc2VjdG9yR3JhcGggPSBuZXcgR1MuR3JhcGgoZnVuY3Rpb24oYSwgYikgeyByZXR1cm4gYS5pZCA9PSBiLmlkIH0pO1xyXG5cdFx0dmFyIHNlY3RvckRpY3QgPSB7fTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNlY3RvckxpbmtzLmxlbmd0aDsgaSArPSAyKSB7XHJcblx0XHRcdHZhciBzMSA9IHRoaXMuZ2V0U2VjdG9yQnlJZChzZWN0b3JzLCBzZWN0b3JMaW5rc1tpXSk7XHJcblx0XHRcdHZhciBzMiA9IHRoaXMuZ2V0U2VjdG9yQnlJZChzZWN0b3JzLCBzZWN0b3JMaW5rc1tpICsgMV0pO1xyXG5cclxuXHRcdFx0c2VjdG9yRGljdFtzMS5pZF0gPSB7IGluZGV4OiAtMSwgc2VjdG9yOiBzMSwgY2VudGVyOiBHUy5Qb2x5Z29uSGVscGVyLmdldFNlY3RvckNlbnRyb2lkKHMxKSB9O1xyXG5cdFx0XHRzZWN0b3JEaWN0W3MyLmlkXSA9IHsgaW5kZXg6IC0xLCBzZWN0b3I6IHMyLCBjZW50ZXI6IEdTLlBvbHlnb25IZWxwZXIuZ2V0U2VjdG9yQ2VudHJvaWQoczIpIH07XHJcblxyXG5cdFx0XHRzZWN0b3JHcmFwaC5hZGRFZGdlKHMxLCBzMik7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGtleXMgPSBPYmplY3Qua2V5cyhzZWN0b3JEaWN0KTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgb2JqID0gc2VjdG9yRGljdFtrZXlzW2ldXTtcclxuXHRcdFx0b2JqLmluZGV4ID0gc2VjdG9yR3JhcGguZ2V0VmVydGV4SW5kZXgob2JqLnNlY3Rvcik7XHJcblx0XHR9XHJcblxyXG5cdFx0c2VjdG9yR3JhcGguY29tcHV0ZVZlcnRleE5laWdoYm9yU2V0cygpO1xyXG5cclxuXHRcdHJldHVybiB7XHJcblx0XHRcdHNlY3RvckdyYXBoOiBzZWN0b3JHcmFwaCxcclxuXHRcdFx0c2VjdG9yRGljdDogc2VjdG9yRGljdCxcclxuXHRcdH07XHJcblx0fSxcclxuXHJcblx0Y29uc3RydWN0UmVnaW9uczogZnVuY3Rpb24oc2VjdG9yRGljdCwgc2VjdG9yR3JhcGgpIHtcclxuXHRcdHRoaXMucmVnaW9uSWRDb3VudCA9IDA7XHJcblxyXG5cdFx0dmFyIHRvVmlzaXQgPSBbXTtcclxuXHRcdHZhciBkb29yQ291bnQgPSAwO1xyXG5cdFx0dmFyIHNlZWRzID0ge307XHJcblxyXG5cdFx0Zm9yICh2YXIgaSBpbiBzZWN0b3JEaWN0KSB7XHJcblx0XHRcdGlmIChzZWN0b3JEaWN0W2ldLnNlY3Rvci5kb29yKSB7XHJcblx0XHRcdFx0dmFyIG5laWdoYm9ycyA9IHNlY3RvckdyYXBoLm5laWdoYm9yU2V0c1tzZWN0b3JEaWN0W2ldLmluZGV4XS5lbGVtZW50cztcclxuXHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IG5laWdoYm9ycy5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdFx0dmFyIGlkID0gbmVpZ2hib3JzW2pdLmlkO1xyXG5cdFx0XHRcdFx0dG9WaXNpdC5wdXNoKHsgaWQ6IGlkLCBzZWVkOiBpZCB9KTtcclxuXHRcdFx0XHRcdHNlZWRzW2lkXSA9IHsgZG9vcklkczoge30sIHNlY3Rvcklkczoge30gfTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZG9vckNvdW50Kys7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgcmVnaW9ucyA9IFtdO1xyXG5cdFx0aWYgKGRvb3JDb3VudCA+IDApIHtcclxuXHRcdFx0dmFyIHZpc2l0ZWQgPSB7fTtcclxuXHJcblx0XHRcdHdoaWxlICh0b1Zpc2l0Lmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHR2YXIgY3VycmVudCA9IHRvVmlzaXQucG9wKCk7XHJcblx0XHRcdFx0dmFyIGlkID0gY3VycmVudC5pZDtcclxuXHRcdFx0XHR2YXIgc2VlZElkID0gY3VycmVudC5zZWVkO1xyXG5cclxuXHRcdFx0XHRpZiAoc2VjdG9yRGljdFtpZF0uc2VjdG9yLmRvb3IpIHtcclxuXHRcdFx0XHRcdHNlZWRzW3NlZWRJZF0uZG9vcklkc1tpZF0gPSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodmlzaXRlZFtpZF0pIHtcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmlzaXRlZFtpZF0gPSB0cnVlO1xyXG5cdFx0XHRcdHNlZWRzW3NlZWRJZF0uc2VjdG9ySWRzW2lkXSA9IHRydWU7XHJcblxyXG5cdFx0XHRcdGlmIChzZWN0b3JEaWN0W2lkXS5zZWN0b3IuZG9vcikge1xyXG5cdFx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR2YXIgbmVpZ2hib3JzID0gc2VjdG9yR3JhcGgubmVpZ2hib3JTZXRzW3NlY3RvckRpY3RbaWRdLmluZGV4XS5lbGVtZW50cztcclxuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG5laWdoYm9ycy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0dmFyIGluZm8gPSBzZWN0b3JEaWN0W25laWdoYm9yc1tpXS5pZF07XHJcblx0XHRcdFx0XHR2YXIgaWQgPSBpbmZvLnNlY3Rvci5pZDtcclxuXHRcdFx0XHRcdHRvVmlzaXQucHVzaCh7IGlkOiBpZCwgc2VlZDogc2VlZElkIH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSBpbiBzZWVkcykge1xyXG5cdFx0XHRcdHZhciBzZWN0b3JJZHMgPSBzZWVkc1tpXS5zZWN0b3JJZHM7XHJcblx0XHRcdFx0aWYgKE9iamVjdC5rZXlzKHNlY3RvcklkcykubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdFx0cmVnaW9ucy5wdXNoKHRoaXMuZ2V0TmV3UmVnaW9uKHNlZWRzW2ldLmRvb3JJZHMsIHNlY3RvcklkcykpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCByZWdpb25zLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIHJlZ2lvbiA9IHJlZ2lvbnNbaV07XHJcblx0XHRcdFx0cmVnaW9uLmxpbmtlZFJlZ2lvbnMgPSBbXTtcclxuXHJcblx0XHRcdFx0Zm9yICh2YXIgaiBpbiByZWdpb24uZG9vcklkcykge1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgayA9IDA7IGsgPCByZWdpb25zLmxlbmd0aDsgaysrKSB7XHJcblx0XHRcdFx0XHRcdGlmIChrICE9PSBpKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIHJlZ2lvbjIgPSByZWdpb25zW2tdO1xyXG5cdFx0XHRcdFx0XHRcdGZvciAodmFyIGUgaW4gcmVnaW9uMi5kb29ySWRzKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoZSA9PT0gaikge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRyZWdpb24ubGlua2VkUmVnaW9ucy5wdXNoKHsgZG9vcklkOiBlLCByZWdpb246IHJlZ2lvbjIgfSk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dmFyIHJlZ2lvbiA9IHRoaXMuZ2V0TmV3UmVnaW9uKCk7XHJcblx0XHRcdGZvciAodmFyIGkgaW4gdGhpcy5zZWN0b3JEaWN0KSB7XHJcblx0XHRcdFx0cmVnaW9uLnNlY3Rvcklkc1tpXSA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdFx0cmVnaW9ucy5wdXNoKHJlZ2lvbik7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHJlZ2lvbnM7XHJcblx0fSxcclxuXHJcblx0Z2V0TmV3UmVnaW9uOiBmdW5jdGlvbihkb29ySWRzLCBzZWN0b3JJZHMpIHtcclxuXHRcdHZhciByZWdpb24gPSB7XHJcblx0XHRcdGlkOiB0aGlzLnJlZ2lvbklkQ291bnQsXHJcblx0XHRcdGRvb3JJZHM6IGRvb3JJZHMgfHwge30sXHJcblx0XHRcdHNlY3Rvcklkczogc2VjdG9ySWRzIHx8IHt9LFxyXG5cdFx0XHRtb25zdGVyczogW11cclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIG1lc2ggPSBuZXcgVEhSRUUuTWVzaChuZXcgVEhSRUUuR2VvbWV0cnkoKSwgdGhpcy5tYXRlcmlhbCk7XHJcblx0XHRtZXNoLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTtcclxuXHRcdHJlZ2lvbi5tZXNoID0gbWVzaDtcclxuXHJcblx0XHR0aGlzLnJlZ2lvbklkQ291bnQrKztcclxuXHRcdHJldHVybiByZWdpb247XHJcblx0fSxcclxuXHJcblx0Z2V0U2VjdG9yQnlJZDogZnVuY3Rpb24oc2VjdG9ycywgaWQpIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2VjdG9ycy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRpZiAoc2VjdG9yc1tpXS5pZCA9PSBpZCkge1xyXG5cdFx0XHRcdHJldHVybiBzZWN0b3JzW2ldO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0R0FNRS5oYW5kbGVGYXRhbEVycm9yKFwic2VjdG9yIFwiICsgaWQgKyBcIiBub3QgZm91bmRcIik7XHJcblx0XHRyZXR1cm47XHJcblx0fSxcclxufTsiLCJHUy5CcmlnaHRuZXNzRmlsdGVyU2hhZGVyID0ge1xyXG5cdHVuaWZvcm1zOiB7XHJcblx0XHRcInREaWZmdXNlXCI6IHsgdHlwZTogXCJ0XCIsIHZhbHVlOiBudWxsIH0sXHJcblx0fSxcclxuXHJcblx0dmVydGV4U2hhZGVyOiBbXHJcblxyXG5cdFx0XCJ2YXJ5aW5nIHZlYzIgdlV2O1wiLFxyXG5cclxuXHRcdFwidm9pZCBtYWluKCkge1wiLFxyXG5cclxuXHRcdFx0XCJ2VXYgPSB1djtcIixcclxuXHRcdFx0XCJnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KHBvc2l0aW9uLCAxLjApO1wiLFxyXG5cclxuXHRcdFwifVwiXHJcblxyXG5cdF0uam9pbihcIlxcblwiKSxcclxuXHJcblx0ZnJhZ21lbnRTaGFkZXI6IFtcclxuXHJcblx0XHRcInVuaWZvcm0gc2FtcGxlcjJEIHREaWZmdXNlO1wiLFxyXG5cclxuXHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcclxuXHJcblx0XHRcInZvaWQgbWFpbigpIHtcIixcclxuXHJcblx0XHRcdFwidmVjNCB0ZXhlbCA9IHRleHR1cmUyRCh0RGlmZnVzZSwgdlV2KTtcIixcclxuXHJcblx0XHRcdFwiZmxvYXQgbHVtID0gZG90KHRleGVsLCB2ZWM0KDAuMjk5LCAwLjU4NywgMC4xMTQsIDAuMCkpO1wiLFxyXG5cdFx0XHRcImx1bSA9IHN0ZXAoMC45OTk5LCBsdW0pO1wiLFxyXG5cclxuXHRcdFx0XCJnbF9GcmFnQ29sb3IgPSB2ZWM0KHRleGVsLnh5eiAqIGx1bSwgMS4wKTtcIixcclxuXHJcblx0XHRcIn1cIlxyXG5cclxuXHRdLmpvaW4oXCJcXG5cIilcclxufTtcclxuIiwiLy8gaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy9ibG9iL21hc3Rlci9leGFtcGxlcy9qcy9zaGFkZXJzL0NvbG9yaWZ5U2hhZGVyLmpzXHJcblxyXG5HUy5Db2xvclNoYWRlciA9IHtcclxuXHR1bmlmb3Jtczoge1xyXG5cdFx0XCJ0RGlmZnVzZVwiOiB7IHR5cGU6IFwidFwiLCB2YWx1ZTogbnVsbCB9LFxyXG5cdFx0XCJjb2xvclwiOiAgICB7IHR5cGU6IFwiY1wiLCB2YWx1ZTogbmV3IFRIUkVFLkNvbG9yKDB4ZmZmZmZmKSB9XHJcblx0fSxcclxuXHJcblx0dmVydGV4U2hhZGVyOiBbXHJcblxyXG5cdFx0XCJ2YXJ5aW5nIHZlYzIgdlV2O1wiLFxyXG5cclxuXHRcdFwidm9pZCBtYWluKCkge1wiLFxyXG5cclxuXHRcdFx0XCJ2VXYgPSB1djtcIixcclxuXHRcdFx0XCJnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KHBvc2l0aW9uLCAxLjApO1wiLFxyXG5cclxuXHRcdFwifVwiXHJcblxyXG5cdF0uam9pbihcIlxcblwiKSxcclxuXHJcblx0ZnJhZ21lbnRTaGFkZXI6IFtcclxuXHJcblx0XHRcInVuaWZvcm0gdmVjMyBjb2xvcjtcIixcclxuXHRcdFwidW5pZm9ybSBzYW1wbGVyMkQgdERpZmZ1c2U7XCIsXHJcblxyXG5cdFx0XCJ2YXJ5aW5nIHZlYzIgdlV2O1wiLFxyXG5cclxuXHRcdFwidm9pZCBtYWluKCkge1wiLFxyXG5cclxuXHRcdFx0XCJ2ZWM0IHRleGVsID0gdGV4dHVyZTJEKHREaWZmdXNlLCB2VXYpO1wiLFxyXG5cclxuXHRcdFx0XCJnbF9GcmFnQ29sb3IgPSB2ZWM0KHRleGVsLnh5eiArIGNvbG9yLnh5eiAqIDAuNzUsIDEuMCk7XCIsXHJcblxyXG5cdFx0XCJ9XCJcclxuXHJcblx0XS5qb2luKFwiXFxuXCIpXHJcbn07XHJcbiIsIkdTLkdsb3dTaGFkZXIgPSB7XHJcblx0dW5pZm9ybXM6IHtcclxuXHRcdFwidERpZmZ1c2VcIjogeyB0eXBlOiBcInRcIiwgdmFsdWU6IG51bGwgfSxcclxuXHRcdFwidEdsb3dcIjogeyB0eXBlOiBcInRcIiwgdmFsdWU6IG51bGwgfSxcclxuXHRcdFwiaW50ZW5zaXR5XCI6ICB7IHR5cGU6IFwiZlwiLCB2YWx1ZTogMS4wIH1cclxuXHR9LFxyXG5cclxuXHR2ZXJ0ZXhTaGFkZXI6IFtcclxuXHJcblx0XHRcInZhcnlpbmcgdmVjMiB2VXY7XCIsXHJcblxyXG5cdFx0XCJ2b2lkIG1haW4oKSB7XCIsXHJcblxyXG5cdFx0XHRcInZVdiA9IHV2O1wiLFxyXG5cdFx0XHRcImdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQocG9zaXRpb24sIDEuMCk7XCIsXHJcblxyXG5cdFx0XCJ9XCJcclxuXHJcblx0XS5qb2luKFwiXFxuXCIpLFxyXG5cclxuXHRmcmFnbWVudFNoYWRlcjogW1xyXG5cclxuXHRcdFwidW5pZm9ybSBmbG9hdCBpbnRlbnNpdHk7XCIsXHJcblx0XHRcInVuaWZvcm0gc2FtcGxlcjJEIHREaWZmdXNlO1wiLFxyXG5cdFx0XCJ1bmlmb3JtIHNhbXBsZXIyRCB0R2xvdztcIixcclxuXHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcclxuXHJcblx0XHRcInZvaWQgbWFpbigpIHtcIixcclxuXHJcblx0XHRcdFwidmVjNCB0ZXhlbCA9IHRleHR1cmUyRCh0RGlmZnVzZSwgdlV2KTtcIixcclxuXHRcdFx0XCJ2ZWM0IGdsb3cgPSB0ZXh0dXJlMkQodEdsb3csIHZVdik7XCIsXHJcblxyXG5cdFx0XHRcImdsX0ZyYWdDb2xvciA9IHZlYzQodGV4ZWwueHl6ICsgZ2xvdy54eXogKiBpbnRlbnNpdHksIDEuMCk7XCIsXHJcblxyXG5cdFx0XCJ9XCJcclxuXHJcblx0XS5qb2luKFwiXFxuXCIpXHJcbn07XHJcbiIsIkdTLk1lc2hQaG9uZ0dsb3dNYXRlcmlhbCA9IGZ1bmN0aW9uKG1hcCwgZ2xvdywgbm9ybWFsLCBlbWlzc2l2ZSwgZ2xvd0ludGVuc2l0eSkge1xyXG5cdHRoaXMuc2hhZGVyID0gR1MuUGhvbmdHbG93U2hhZGVyO1xyXG5cclxuXHR0aGlzLnVuaWZvcm1zID0gVEhSRUUuVW5pZm9ybXNVdGlscy5jbG9uZSh0aGlzLnNoYWRlci51bmlmb3Jtcyk7XHJcblxyXG5cdHRoaXMudW5pZm9ybXNbXCJtYXBcIl0udmFsdWUgPSBtYXA7XHJcblx0dGhpcy51bmlmb3Jtc1tcImdsb3dNYXBcIl0udmFsdWUgPSBnbG93O1xyXG5cdHRoaXMudW5pZm9ybXNbXCJub3JtYWxNYXBcIl0udmFsdWUgPSBub3JtYWw7XHJcblx0dGhpcy51bmlmb3Jtc1tcImVtaXNzaXZlXCJdLnZhbHVlID0gbmV3IFRIUkVFLkNvbG9yKGVtaXNzaXZlIHx8IDApO1xyXG5cdHRoaXMudW5pZm9ybXNbXCJnbG93SW50ZW5zaXR5XCJdLnZhbHVlID0gKGdsb3dJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCkgPyBnbG93SW50ZW5zaXR5IDogMTtcclxuXHJcblx0VEhSRUUuU2hhZGVyTWF0ZXJpYWwuY2FsbCh0aGlzLCB7XHJcblx0XHR1bmlmb3JtczogdGhpcy51bmlmb3JtcyxcclxuXHRcdGZyYWdtZW50U2hhZGVyOiB0aGlzLnNoYWRlci5mcmFnbWVudFNoYWRlcixcclxuXHRcdHZlcnRleFNoYWRlcjogdGhpcy5zaGFkZXIudmVydGV4U2hhZGVyLFxyXG5cdFx0bGlnaHRzOiB0cnVlLFxyXG5cdH0pO1xyXG5cclxuXHR0aGlzLm1hcCA9IHRydWU7XHJcblx0dGhpcy5ub3JtYWxNYXAgPSAobm9ybWFsICE9PSB1bmRlZmluZWQgJiYgbm9ybWFsICE9PSBudWxsKTtcclxufTtcclxuXHJcbkdTLk1lc2hQaG9uZ0dsb3dNYXRlcmlhbC5wcm90b3R5cGUgPSBHUy5pbmhlcml0KFRIUkVFLlNoYWRlck1hdGVyaWFsLCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLk1lc2hQaG9uZ0dsb3dNYXRlcmlhbCxcclxuXHJcblx0Y2xvbmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG1hdGVyaWFsID0gbmV3IEdTLk1lc2hQaG9uZ0dsb3dNYXRlcmlhbChcclxuXHRcdFx0dGhpcy51bmlmb3Jtc1tcIm1hcFwiXS52YWx1ZSxcclxuXHRcdFx0dGhpcy51bmlmb3Jtc1tcImdsb3dNYXBcIl0udmFsdWUsXHJcblx0XHRcdHRoaXMudW5pZm9ybXNbXCJub3JtYWxNYXBcIl0udmFsdWUsXHRcdFx0XHJcblx0XHRcdHRoaXMudW5pZm9ybXNbXCJlbWlzc2l2ZVwiXS52YWx1ZSxcclxuXHRcdFx0dGhpcy51bmlmb3Jtc1tcImdsb3dJbnRlbnNpdHlcIl0udmFsdWVcclxuXHRcdCk7XHJcblxyXG5cdFx0cmV0dXJuIG1hdGVyaWFsO1xyXG5cdH0sXHJcblxyXG5cdGdldCBlbWlzc2l2ZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLnVuaWZvcm1zW1wiZW1pc3NpdmVcIl0udmFsdWU7XHJcblx0fSxcclxuXHJcblx0c2V0IGdsb3dJbnRlbnNpdHkodmFsdWUpIHtcclxuXHRcdHRoaXMudW5pZm9ybXNbXCJnbG93SW50ZW5zaXR5XCJdLnZhbHVlID0gdmFsdWU7XHJcblx0fSxcclxuXHJcblx0Z2V0IGdsb3dJbnRlbnNpdHkoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy51bmlmb3Jtc1tcImdsb3dJbnRlbnNpdHlcIl0udmFsdWVcclxuXHR9LFxyXG59KTsiLCJHUy5NZXNoVmVydGV4Q29sb3JNYXRlcmlhbCA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMuc2hhZGVyID0gR1MuVmVydGV4Q29sb3JTaGFkZXI7XHJcblxyXG5cdHRoaXMudW5pZm9ybXMgPSBUSFJFRS5Vbmlmb3Jtc1V0aWxzLmNsb25lKHRoaXMuc2hhZGVyLnVuaWZvcm1zKTtcclxuXHJcblx0VEhSRUUuU2hhZGVyTWF0ZXJpYWwuY2FsbCh0aGlzLCB7XHJcblx0XHR1bmlmb3JtczogdGhpcy51bmlmb3JtcyxcclxuXHRcdGF0dHJpYnV0ZXM6IHtcclxuXHRcdFx0ZW1pc3NpdmU6IHsgdHlwZTogXCJjXCIsIHZhbHVlOiBbXSB9XHJcblx0XHR9LFxyXG5cdFx0ZnJhZ21lbnRTaGFkZXI6IHRoaXMuc2hhZGVyLmZyYWdtZW50U2hhZGVyLFxyXG5cdFx0dmVydGV4U2hhZGVyOiB0aGlzLnNoYWRlci52ZXJ0ZXhTaGFkZXIsXHJcblx0XHR2ZXJ0ZXhDb2xvcnM6IFRIUkVFLkZhY2VDb2xvcnMsXHJcblx0XHRsaWdodHM6IHRydWUsXHJcblx0fSk7XHJcbn07XHJcblxyXG5HUy5NZXNoVmVydGV4Q29sb3JNYXRlcmlhbC5wcm90b3R5cGUgPSBHUy5pbmhlcml0KFRIUkVFLlNoYWRlck1hdGVyaWFsLCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLk1lc2hWZXJ0ZXhDb2xvck1hdGVyaWFsLFxyXG5cclxuXHRjbG9uZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgbWF0ZXJpYWwgPSBuZXcgR1MuTWVzaFZlcnRleENvbG9yTWF0ZXJpYWwoKTtcclxuXHJcblx0XHRyZXR1cm4gbWF0ZXJpYWw7XHJcblx0fSxcclxufSk7IiwiR1MuTm9pc2VTaGFkZXIgPSB7XHJcblx0dW5pZm9ybXM6IHtcclxuXHRcdFwidERpZmZ1c2VcIjogeyB0eXBlOiBcInRcIiwgdmFsdWU6IG51bGwgfSxcclxuXHRcdFwidE5vaXNlXCI6IHsgdHlwZTogXCJ0XCIsIHZhbHVlOiBudWxsIH0sXHJcblx0XHRcInJhdGlvXCI6IHsgdHlwZTogXCJ2MlwiLCB2YWx1ZTogbmV3IFRIUkVFLlZlY3RvcjIoMSwgMSkgfSxcclxuXHRcdFwiaW50ZW5zaXR5XCIgOiB7IHR5cGU6IFwiZlwiLCB2YWx1ZTogMC4wNSB9LFxyXG5cdH0sXHJcblxyXG5cdHZlcnRleFNoYWRlcjogW1xyXG5cclxuXHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcclxuXHJcblx0XHRcInZvaWQgbWFpbigpIHtcIixcclxuXHJcblx0XHRcdFwidlV2ID0gdXY7XCIsXHJcblx0XHRcdFwiZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTtcIixcclxuXHJcblx0XHRcIn1cIlxyXG5cclxuXHRdLmpvaW4oXCJcXG5cIiksXHJcblxyXG5cdGZyYWdtZW50U2hhZGVyOiBbXHJcblxyXG5cdFx0XCJ1bmlmb3JtIHNhbXBsZXIyRCB0RGlmZnVzZTtcIixcclxuXHRcdFwidW5pZm9ybSBzYW1wbGVyMkQgdE5vaXNlO1wiLFxyXG5cdFx0XCJ1bmlmb3JtIHZlYzIgcmF0aW87XCIsXHJcblx0XHRcInVuaWZvcm0gZmxvYXQgaW50ZW5zaXR5O1wiLFxyXG5cclxuXHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcclxuXHJcblx0XHRcInZvaWQgbWFpbigpIHtcIixcclxuXHJcblx0XHRcdFwidmVjNCBjRGlmZnVzZSA9IHRleHR1cmUyRCh0RGlmZnVzZSwgdlV2KTtcIixcclxuXHRcdFx0XCJ2ZWM0IGNOb2lzZSA9IHRleHR1cmUyRCh0Tm9pc2UsIHZVdiAqIHJhdGlvKTtcIixcclxuXHJcblx0XHRcdFwiZ2xfRnJhZ0NvbG9yID0gdmVjNChjRGlmZnVzZS54eXogKyBjTm9pc2UueHl6ICogaW50ZW5zaXR5IC0gaW50ZW5zaXR5ICogMC41LCAxLjApO1wiLFxyXG5cclxuXHRcdFwifVwiXHJcblxyXG5cdF0uam9pbihcIlxcblwiKVxyXG59O1xyXG4iLCJHUy5QaG9uZ0dsb3dTaGFkZXIgPSB7XHJcblxyXG5cdHVuaWZvcm1zOiBUSFJFRS5Vbmlmb3Jtc1V0aWxzLm1lcmdlKCBbXHJcblxyXG5cdFx0VEhSRUUuVW5pZm9ybXNMaWJbIFwiY29tbW9uXCIgXSxcclxuXHRcdFRIUkVFLlVuaWZvcm1zTGliWyBcIm5vcm1hbG1hcFwiIF0sXHJcblx0XHRUSFJFRS5Vbmlmb3Jtc0xpYlsgXCJmb2dcIiBdLFxyXG5cdFx0VEhSRUUuVW5pZm9ybXNMaWJbIFwibGlnaHRzXCIgXSxcclxuXHJcblx0XHR7XHJcblx0XHRcdFwiYW1iaWVudFwiICA6IHsgdHlwZTogXCJjXCIsIHZhbHVlOiBuZXcgVEhSRUUuQ29sb3IoIDB4ZmZmZmZmICkgfSxcclxuXHRcdFx0XCJlbWlzc2l2ZVwiIDogeyB0eXBlOiBcImNcIiwgdmFsdWU6IG5ldyBUSFJFRS5Db2xvciggMHgwMDAwMDAgKSB9LFxyXG5cdFx0XHRcInNwZWN1bGFyXCIgOiB7IHR5cGU6IFwiY1wiLCB2YWx1ZTogbmV3IFRIUkVFLkNvbG9yKCAweDExMTExMSApIH0sXHJcblx0XHRcdFwic2hpbmluZXNzXCI6IHsgdHlwZTogXCJmXCIsIHZhbHVlOiAzMCB9LFxyXG5cdFx0XHRcIndyYXBSR0JcIiAgOiB7IHR5cGU6IFwidjNcIiwgdmFsdWU6IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAxLCAxICkgfSxcclxuXHJcblx0XHRcdFwiZ2xvd01hcFwiICBcdCAgIDogeyB0eXBlOiBcInRcIiwgdmFsdWU6IG51bGwgfSxcclxuXHRcdFx0XCJnbG93SW50ZW5zaXR5XCI6IHsgdHlwZTogXCJmXCIsIHZhbHVlOiAxIH0sXHJcblx0XHR9XHJcblxyXG5cdF0gKSxcclxuXHJcblx0dmVydGV4U2hhZGVyOiBbXHJcblxyXG5cdFx0XCIjZGVmaW5lIFBIT05HXCIsXHJcblxyXG5cdFx0XCJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcIixcclxuXHRcdFwidmFyeWluZyB2ZWMzIHZOb3JtYWw7XCIsXHJcblxyXG5cdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwibWFwX3BhcnNfdmVydGV4XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpZ2h0bWFwX3BhcnNfdmVydGV4XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImVudm1hcF9wYXJzX3ZlcnRleFwiIF0sXHJcblx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJsaWdodHNfcGhvbmdfcGFyc192ZXJ0ZXhcIiBdLFxyXG5cdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwiY29sb3JfcGFyc192ZXJ0ZXhcIiBdLFxyXG5cdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwibG9nZGVwdGhidWZfcGFyc192ZXJ0ZXhcIiBdLFxyXG5cclxuXHRcdFwidm9pZCBtYWluKCkge1wiLFxyXG5cclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwibWFwX3ZlcnRleFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpZ2h0bWFwX3ZlcnRleFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImNvbG9yX3ZlcnRleFwiIF0sXHJcblxyXG5cdFx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJkZWZhdWx0bm9ybWFsX3ZlcnRleFwiIF0sXHJcblxyXG5cdFx0XCJcdHZOb3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XCIsXHJcblx0XHRcdFxyXG5cdFx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJkZWZhdWx0X3ZlcnRleFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxvZ2RlcHRoYnVmX3ZlcnRleFwiIF0sXHJcblxyXG5cdFx0XCJcdHZWaWV3UG9zaXRpb24gPSAtbXZQb3NpdGlvbi54eXo7XCIsXHJcblxyXG5cdFx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJ3b3JsZHBvc192ZXJ0ZXhcIiBdLFxyXG5cdFx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJlbnZtYXBfdmVydGV4XCIgXSxcclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwibGlnaHRzX3Bob25nX3ZlcnRleFwiIF0sXHJcblxyXG5cdFx0XCJ9XCJcclxuXHJcblx0XS5qb2luKFwiXFxuXCIpLFxyXG5cclxuXHRmcmFnbWVudFNoYWRlcjogW1xyXG5cclxuXHRcdFwidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XCIsXHJcblx0XHRcInVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcIixcclxuXHJcblx0XHRcInVuaWZvcm0gdmVjMyBhbWJpZW50O1wiLFxyXG5cdFx0XCJ1bmlmb3JtIHZlYzMgZW1pc3NpdmU7XCIsXHJcblx0XHRcInVuaWZvcm0gdmVjMyBzcGVjdWxhcjtcIixcclxuXHRcdFwidW5pZm9ybSBmbG9hdCBzaGluaW5lc3M7XCIsXHJcblxyXG5cdFx0XCJ1bmlmb3JtIHNhbXBsZXIyRCBnbG93TWFwO1wiLFxyXG5cdFx0XCJ1bmlmb3JtIGZsb2F0IGdsb3dJbnRlbnNpdHk7XCIsXHJcblxyXG5cdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwiY29sb3JfcGFyc19mcmFnbWVudFwiIF0sXHJcblx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJtYXBfcGFyc19mcmFnbWVudFwiIF0sXHJcblx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJsaWdodG1hcF9wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImVudm1hcF9wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImZvZ19wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcIm5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcInNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnRcIiBdLFxyXG5cdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwibG9nZGVwdGhidWZfcGFyc19mcmFnbWVudFwiIF0sXHJcblxyXG5cdFx0XCJ2b2lkIG1haW4oKSB7XCIsXHJcblxyXG5cdFx0XCJcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHZlYzMoIDEuMCApLCBvcGFjaXR5ICk7XCIsXHJcblxyXG5cdFx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJsb2dkZXB0aGJ1Zl9mcmFnbWVudFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcIm1hcF9mcmFnbWVudFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImFscGhhdGVzdF9mcmFnbWVudFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcInNwZWN1bGFybWFwX2ZyYWdtZW50XCIgXSxcclxuXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpZ2h0c19waG9uZ19mcmFnbWVudFwiIF0sXHJcblxyXG5cdFx0XCJcdGZsb2F0IGdsb3cgPSB0ZXh0dXJlMkQoZ2xvd01hcCwgdlV2KS54ICogZ2xvd0ludGVuc2l0eSAqIDIuMDtcIixcclxuXHRcdFwiXHRnbF9GcmFnQ29sb3IueHl6ID0gdGV4ZWxDb2xvci54eXogKiBjbGFtcChlbWlzc2l2ZSArIHRvdGFsRGlmZnVzZSArIGFtYmllbnRMaWdodENvbG9yICogYW1iaWVudCArIGdsb3csIDAuMCwgMi4wKSArIHRvdGFsU3BlY3VsYXI7XCIsXHJcblxyXG5cdFx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJsaWdodG1hcF9mcmFnbWVudFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImNvbG9yX2ZyYWdtZW50XCIgXSxcclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwiZW52bWFwX2ZyYWdtZW50XCIgXSxcclxuXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpbmVhcl90b19nYW1tYV9mcmFnbWVudFwiIF0sXHJcblxyXG5cdFx0XHRUSFJFRS5TaGFkZXJDaHVua1sgXCJmb2dfZnJhZ21lbnRcIiBdLFxyXG5cclxuXHRcdFwifVwiXHJcblxyXG5cdF0uam9pbihcIlxcblwiKVxyXG5cclxufTsiLCJHUy5SYW5kb21Ob2lzZVNoYWRlciA9IHtcclxuXHR1bmlmb3Jtczoge1xyXG5cdFx0XCJ0RGlmZnVzZVwiOiB7IHR5cGU6IFwidFwiLCB2YWx1ZTogbnVsbCB9LFxyXG5cdFx0XCJpbnRlbnNpdHlcIiA6IHsgdHlwZTogXCJmXCIsIHZhbHVlOiAwLjA1IH0sXHJcblx0XHRcInNlZWRcIjogeyB0eXBlOiBcInYyXCIsIHZhbHVlOiBuZXcgVEhSRUUuVmVjdG9yMihNYXRoLnJhbmRvbSgpLCBNYXRoLnJhbmRvbSgpKSB9LFxyXG5cdH0sXHJcblxyXG5cdHZlcnRleFNoYWRlcjogW1xyXG5cclxuXHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcclxuXHJcblx0XHRcInZvaWQgbWFpbigpIHtcIixcclxuXHJcblx0XHRcdFwidlV2ID0gdXY7XCIsXHJcblx0XHRcdFwiZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTtcIixcclxuXHJcblx0XHRcIn1cIlxyXG5cclxuXHRdLmpvaW4oXCJcXG5cIiksXHJcblxyXG5cdGZyYWdtZW50U2hhZGVyOiBbXHJcblxyXG5cdFx0XCJ1bmlmb3JtIHNhbXBsZXIyRCB0RGlmZnVzZTtcIixcclxuXHRcdFwidW5pZm9ybSBmbG9hdCBpbnRlbnNpdHk7XCIsXHJcblx0XHRcInVuaWZvcm0gdmVjMiBzZWVkO1wiLFxyXG5cclxuXHRcdFwidmFyeWluZyB2ZWMyIHZVdjtcIixcclxuXHJcblx0XHQvLyBodHRwOi8vYnl0ZWJsYWNrc21pdGguY29tL2ltcHJvdmVtZW50cy10by10aGUtY2Fub25pY2FsLW9uZS1saW5lci1nbHNsLXJhbmQtZm9yLW9wZW5nbC1lcy0yLTAvXHJcblxyXG5cdFx0XCJoaWdocCBmbG9hdCByYW5kKHZlYzIgY28pXCIsXHJcblx0XHRcIntcIixcclxuXHRcdFx0XCJoaWdocCBmbG9hdCBhID0gMTIuOTg5ODtcIixcclxuXHRcdFx0XCJoaWdocCBmbG9hdCBiID0gNzguMjMzO1wiLFxyXG5cdFx0XHRcImhpZ2hwIGZsb2F0IGMgPSA0Mzc1OC41NDUzO1wiLFxyXG5cdFx0XHRcImhpZ2hwIGZsb2F0IGR0ID0gZG90KGNvLnh5LCB2ZWMyKGEsYikpO1wiLFxyXG5cdFx0XHRcImhpZ2hwIGZsb2F0IHNuID0gbW9kKGR0LCAzLjE0KTtcIixcclxuXHRcdFx0XCJyZXR1cm4gZnJhY3Qoc2luKHNuKSAqIGMpO1wiLFxyXG5cdFx0XCJ9XCIsXHJcblxyXG5cdFx0XCJ2b2lkIG1haW4oKSB7XCIsXHJcblxyXG5cdFx0XHRcInZlYzQgY0RpZmZ1c2UgPSB0ZXh0dXJlMkQodERpZmZ1c2UsIHZVdik7XCIsXHJcblx0XHRcdFwiZ2xfRnJhZ0NvbG9yID0gdmVjNChjRGlmZnVzZS54eXogLSByYW5kKHZVdiArIHNlZWQpICogaW50ZW5zaXR5LCAxLjApO1wiLFxyXG5cclxuXHRcdFwifVwiXHJcblxyXG5cdF0uam9pbihcIlxcblwiKVxyXG59O1xyXG4iLCJHUy5WZXJ0ZXhDb2xvclNoYWRlciA9IHtcclxuXHJcblx0dW5pZm9ybXM6IFRIUkVFLlVuaWZvcm1zVXRpbHMubWVyZ2UoIFtcclxuXHJcblx0XHRUSFJFRS5Vbmlmb3Jtc0xpYlsgXCJjb21tb25cIiBdLFxyXG5cdFx0VEhSRUUuVW5pZm9ybXNMaWJbIFwibm9ybWFsbWFwXCIgXSxcclxuXHRcdFRIUkVFLlVuaWZvcm1zTGliWyBcImZvZ1wiIF0sXHJcblx0XHRUSFJFRS5Vbmlmb3Jtc0xpYlsgXCJsaWdodHNcIiBdLFxyXG5cclxuXHRcdHtcclxuXHRcdFx0XCJhbWJpZW50XCIgIDogeyB0eXBlOiBcImNcIiwgdmFsdWU6IG5ldyBUSFJFRS5Db2xvciggMHhmZmZmZmYgKSB9LFxyXG5cdFx0XHRcInNwZWN1bGFyXCIgOiB7IHR5cGU6IFwiY1wiLCB2YWx1ZTogbmV3IFRIUkVFLkNvbG9yKCAweDExMTExMSApIH0sXHJcblx0XHRcdFwic2hpbmluZXNzXCI6IHsgdHlwZTogXCJmXCIsIHZhbHVlOiAzMCB9LFxyXG5cdFx0XHRcIndyYXBSR0JcIiAgOiB7IHR5cGU6IFwidjNcIiwgdmFsdWU6IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAxLCAxICkgfVxyXG5cdFx0fVxyXG5cclxuXHRdICksXHJcblxyXG5cdHZlcnRleFNoYWRlcjogW1xyXG5cclxuXHRcdFwiI2RlZmluZSBQSE9OR1wiLFxyXG5cclxuXHRcdFwidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XCIsXHJcblx0XHRcInZhcnlpbmcgdmVjMyB2Tm9ybWFsO1wiLFxyXG5cclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpZ2h0c19waG9uZ19wYXJzX3ZlcnRleFwiIF0sXHJcblxyXG5cdFx0XCIjaWZkZWYgVVNFX0NPTE9SXCIsXHJcblx0XHRcdFwiYXR0cmlidXRlIHZlYzMgZW1pc3NpdmU7XCIsXHJcblxyXG5cdFx0XHRcInZhcnlpbmcgdmVjMyB2Q29sb3I7XCIsXHJcblx0XHRcdFwidmFyeWluZyB2ZWMzIHZFbWlzc2l2ZTtcIixcclxuXHRcdFwiI2VuZGlmXCIsXHJcblxyXG5cdFx0XCJ2b2lkIG1haW4oKSB7XCIsXHJcblxyXG5cdFx0XHRcIiNpZmRlZiBVU0VfQ09MT1JcIixcclxuXHRcdFx0XHRcIiNpZmRlZiBHQU1NQV9JTlBVVFwiLFxyXG5cdFx0XHRcdFx0XCJ2Q29sb3IgPSBjb2xvciAqIGNvbG9yO1wiLFxyXG5cdFx0XHRcdFwiI2Vsc2VcIixcclxuXHRcdFx0XHRcdFwidkNvbG9yID0gY29sb3I7XCIsXHJcblx0XHRcdFx0XCIjZW5kaWZcIixcclxuXHJcblx0XHRcdFx0XCJ2RW1pc3NpdmUgPSBlbWlzc2l2ZTtcIixcclxuXHRcdFx0XCIjZW5kaWZcIixcclxuXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImRlZmF1bHRub3JtYWxfdmVydGV4XCIgXSxcclxuXHJcblx0XHRcdFwidk5vcm1hbCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWROb3JtYWwgKTtcIixcclxuXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImRlZmF1bHRfdmVydGV4XCIgXSxcclxuXHJcblx0XHRcdFwidlZpZXdQb3NpdGlvbiA9IC1tdlBvc2l0aW9uLnh5ejtcIixcclxuXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcIndvcmxkcG9zX3ZlcnRleFwiIF0sXHJcblx0XHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpZ2h0c19waG9uZ192ZXJ0ZXhcIiBdLFxyXG5cclxuXHRcdFwifVwiXHJcblxyXG5cdF0uam9pbihcIlxcblwiKSxcclxuXHJcblx0ZnJhZ21lbnRTaGFkZXI6IFtcclxuXHJcblx0XHRcIiNkZWZpbmUgUEhPTkdcIixcclxuXHJcblx0XHRcInVuaWZvcm0gdmVjMyBkaWZmdXNlO1wiLFxyXG5cdFx0XCJ1bmlmb3JtIGZsb2F0IG9wYWNpdHk7XCIsXHJcblxyXG5cdFx0XCJ1bmlmb3JtIHZlYzMgYW1iaWVudDtcIixcclxuXHRcdFwidW5pZm9ybSB2ZWMzIHNwZWN1bGFyO1wiLFxyXG5cdFx0XCJ1bmlmb3JtIGZsb2F0IHNoaW5pbmVzcztcIixcclxuXHJcblx0XHRcIiNpZmRlZiBVU0VfQ09MT1JcIixcclxuXHRcdFx0XCJ2YXJ5aW5nIHZlYzMgdkNvbG9yO1wiLFxyXG5cdFx0XHRcInZhcnlpbmcgdmVjMyB2RW1pc3NpdmU7XCIsXHJcblx0XHRcIiNlbmRpZlwiLFxyXG5cclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImZvZ19wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcImxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcIm5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50XCIgXSxcclxuXHRcdFRIUkVFLlNoYWRlckNodW5rWyBcInNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnRcIiBdLFxyXG5cclxuXHRcdFwidm9pZCBtYWluKCkge1wiLFxyXG5cclxuXHRcdFx0XCJnbF9GcmFnQ29sb3IgPSB2ZWM0KCB2ZWMzKCAxLjAgKSwgb3BhY2l0eSApO1wiLFxyXG5cclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwic3BlY3VsYXJtYXBfZnJhZ21lbnRcIiBdLFxyXG5cclxuXHRcdFx0XCJ2ZWMzIGVtaXNzaXZlID0gdkVtaXNzaXZlO1wiLFxyXG5cclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwibGlnaHRzX3Bob25nX2ZyYWdtZW50XCIgXSxcclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwiY29sb3JfZnJhZ21lbnRcIiBdLFxyXG5cclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwibGluZWFyX3RvX2dhbW1hX2ZyYWdtZW50XCIgXSxcclxuXHRcdFx0VEhSRUUuU2hhZGVyQ2h1bmtbIFwiZm9nX2ZyYWdtZW50XCIgXSxcclxuXHJcblx0XHRcIn1cIlxyXG5cclxuXHRdLmpvaW4oXCJcXG5cIilcclxuXHJcbn07IiwiR1MuQXNzZXRUeXBlcyA9IHtcclxuXHRUZXh0dXJlOiAwLFxyXG5cdE1lc2g6IDEsXHJcblx0U291bmQ6IDIsXHJcblx0Q3ViZVRleHR1cmU6IDMsXHJcblx0VUlXaWRnZXQ6IDQsXHJcblx0TWFwOiA1LFxyXG5cdFNjcmlwdDogNixcclxuXHRNdXNpY1RyYWNrOiA3LFxyXG59O1xyXG5cclxuR1MuVGV4dHVyZVR5cGVzID0ge1xyXG5cdE1hcDogMCxcclxuXHRUVlNjcmVlbjogMSxcclxuXHRFbnRpdHk6IDIsXHJcbn1cclxuXHJcbkdTLkN1YmVUZXh0dXJlRXh0ZW5zaW9uID0gXCIuanBnXCI7XHJcbkdTLkN1YmVUZXh0dXJlTmFtZXMgPSBbIFwibGVmdFwiLCBcInJpZ2h0XCIsIFwidG9wXCIsIFwiYm90dG9tXCIsIFwiZnJvbnRcIiwgXCJiYWNrXCIgXTtcclxuR1MuQ3VzdG9tRm9udEZpbGUgPSBcImNhcHN1dWxhLndvZmZcIjtcclxuXHJcbkdTLkFzc2V0cyA9IHt9O1xyXG5cclxuR1MuQXNzZXRzW0dTLkFzc2V0VHlwZXMuVGV4dHVyZV0gPSB7XHJcblx0XCJjeWFuX3dhbGxcIjpcdFx0XHR7IGZpbGVuYW1lOiBcImN5YW5fd2FsbC5wbmdcIixcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5NYXAgfSxcclxuXHRcInJlZF93YWxsXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwicmVkX3dhbGwucG5nXCIsIFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLk1hcCB9LFxyXG5cdFwiYmx1ZV9tZXRhbFwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcImJsdWVfbWV0YWwucG5nXCIsIFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLk1hcCB9LFxyXG5cdFwid2hpdGVcIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcIndoaXRlLnBuZ1wiLFx0IFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLk1hcCB9LFxyXG5cdFwid2FsbFwiOiBcdFx0XHRcdHsgZmlsZW5hbWU6IFwid2FsbC5wbmdcIiwgXHRcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5NYXAgfSxcclxuXHRcIm1ldGFsXCI6IFx0XHRcdFx0eyBmaWxlbmFtZTogXCJtZXRhbC5wbmdcIiwgXHRcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5NYXAgfSxcclxuXHRcImxpZ2h0XCI6IFx0XHRcdFx0eyBmaWxlbmFtZTogXCJsaWdodC5wbmdcIiwgXHRcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5NYXAgfSxcclxuXHRcInJlZFwiOiBcdFx0XHRcdFx0eyBmaWxlbmFtZTogXCJyZWQucG5nXCIsIFx0XHRcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5NYXAgfSxcclxuXHRcImJsdWVcIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcImJsdWUucG5nXCIsIFx0XHRcdFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuTWFwIH0sXHJcblx0XCJjeWFuXCI6IFx0XHRcdFx0eyBmaWxlbmFtZTogXCJjeWFuLnBuZ1wiLCBcdFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLk1hcCB9LFxyXG5cdFwiYnJvd25cIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcImJyb3duLnBuZ1wiLCBcdFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLk1hcCB9LFxyXG5cclxuXHRcImV4aXRcIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcImV4aXQucG5nXCIsXHRcdFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLlRWU2NyZWVuLCBzaG93SW5NYXBFZGl0b3I6IHRydWUgfSxcclxuXHRcInN3aXRjaF9vZmZcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJzd2l0Y2hfb2ZmLnBuZ1wiLFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLlRWU2NyZWVuIH0sXHJcblx0XCJzd2l0Y2hfb25cIjogXHRcdFx0eyBmaWxlbmFtZTogXCJzd2l0Y2hfb24ucG5nXCIsXHRcdFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuVFZTY3JlZW4gfSxcclxuXHJcblx0XCJhbW1vXCI6IFx0XHRcdFx0eyBmaWxlbmFtZTogXCJhbW1vLnBuZ1wiLCBcdFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLkVudGl0eSB9LFxyXG5cdFwiYW1tb19nbG93XCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwiYW1tb19nbG93LnBuZ1wiLCBcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5FbnRpdHkgfSxcclxuXHRcIm1lZGtpdFwiOiBcdFx0XHRcdHsgZmlsZW5hbWU6IFwibWVka2l0LnBuZ1wiLCBcdFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLkVudGl0eSB9LFxyXG5cdFwibWVka2l0X2dsb3dcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJtZWRraXRfZ2xvdy5wbmdcIiwgXHRcdFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuRW50aXR5IH0sXHJcblx0XCJwaXN0b2xcIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcInBpc3RvbC5wbmdcIiwgXHRcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5FbnRpdHkgfSxcclxuXHRcInBpc3RvbF9nbG93XCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwicGlzdG9sX2dsb3cucG5nXCIsIFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLkVudGl0eSB9LFxyXG5cdFwiZG91YmxlX3Nob3RndW5cIjogXHRcdHsgZmlsZW5hbWU6IFwiZG91YmxlX3Nob3RndW4ucG5nXCIsIFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5FbnRpdHkgfSxcclxuXHRcImRvdWJsZV9zaG90Z3VuX2dsb3dcIjogXHR7IGZpbGVuYW1lOiBcImRvdWJsZV9zaG90Z3VuX2dsb3cucG5nXCIsIFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuRW50aXR5IH0sXHJcblx0XCJoeXBlcl9ibGFzdGVyXCI6IFx0XHR7IGZpbGVuYW1lOiBcImh5cGVyX2JsYXN0ZXIucG5nXCIsIFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5FbnRpdHkgfSxcclxuXHRcImh5cGVyX2JsYXN0ZXJfZ2xvd1wiOiBcdHsgZmlsZW5hbWU6IFwiaHlwZXJfYmxhc3Rlcl9nbG93LnBuZ1wiLCBcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLkVudGl0eSB9LFxyXG5cdFwibm9tXCI6IFx0XHRcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbS5wbmdcIiwgXHRcdFx0XHRcdFx0dHlwZTogR1MuVGV4dHVyZVR5cGVzLkVudGl0eSB9LFxyXG5cdFwibm9tX2dsb3dcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJub21fZ2xvdy5wbmdcIiwgXHRcdFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuRW50aXR5IH0sXHJcblx0XCJleWVcIjogXHRcdFx0XHRcdHsgZmlsZW5hbWU6IFwiZXllLnBuZ1wiLCBcdFx0XHRcdFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuRW50aXR5IH0sXHJcblx0XCJleWVfZ2xvd1wiOiBcdFx0XHR7IGZpbGVuYW1lOiBcImV5ZV9nbG93LnBuZ1wiLCBcdFx0XHRcdHR5cGU6IEdTLlRleHR1cmVUeXBlcy5FbnRpdHkgfSxcclxuXHRcIm9ubGluZV9wbGF5ZXJcIjogXHRcdFx0XHRcdHsgZmlsZW5hbWU6IFwibm9tLnBuZ1wiLCBcdFx0XHRcdFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuRW50aXR5IH0sXHJcblx0XCJvbmxpbmVfcGxheWVyX2dsb3dcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJub21fZ2xvdy5wbmdcIiwgXHRcdFx0XHR0eXBlOiBHUy5UZXh0dXJlVHlwZXMuRW50aXR5IH0sXHJcbn07XHJcblxyXG5HUy5Bc3NldHNbR1MuQXNzZXRUeXBlcy5DdWJlVGV4dHVyZV0gPSB7XHJcblx0XCJza3lib3gxXCI6IFx0XHRcdFx0eyBmaWxlbmFtZTogXCJza3lib3gxXCIgfSxcclxufTtcclxuXHJcbkdTLkFzc2V0c1tHUy5Bc3NldFR5cGVzLlVJV2lkZ2V0XSA9IHtcclxuXHRcImh1ZFwiOiBcdFx0XHRcdFx0eyBmaWxlbmFtZTogXCJodWQucG5nXCIgfSxcclxuXHRcImxvZ29cIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcImxvZ28ucG5nXCIgfSxcclxuXHRcIm1lbnVfYmFja1wiOlx0XHRcdHsgZmlsZW5hbWU6IFwibWVudV9iYWNrLnBuZ1wiIH0sXHJcblx0XCJ0aHVtYl9haXJzdHJpcDFcIjpcdFx0eyBmaWxlbmFtZTogXCJ0aHVtYl9haXJzdHJpcDEucG5nXCIgfSxcclxuXHRcInRodW1iX2RyZW5jcm9tXCI6XHRcdHsgZmlsZW5hbWU6IFwidGh1bWJfZHJlbmNyb20ucG5nXCIgfSxcclxuXHRcInRodW1iX3NhY3Jvc2FuY3RcIjpcdFx0eyBmaWxlbmFtZTogXCJ0aHVtYl9zYWNyb3NhbmN0LnBuZ1wiIH0sXHJcbn07XHJcblxyXG5HUy5Bc3NldHNbR1MuQXNzZXRUeXBlcy5NZXNoXSA9IHtcclxuXHRcImFtbW9cIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcImFtbW8uanNcIiB9LFxyXG5cdFwibWVka2l0XCI6IFx0XHRcdFx0eyBmaWxlbmFtZTogXCJtZWRraXQuanNcIiB9LFxyXG5cclxuXHRcInBpc3RvbFwiOiBcdFx0XHRcdHsgZmlsZW5hbWU6IFwicGlzdG9sLmpzXCIgfSxcclxuXHRcImRvdWJsZV9zaG90Z3VuXCI6IFx0XHR7IGZpbGVuYW1lOiBcImRvdWJsZV9zaG90Z3VuLmpzXCIgfSxcclxuXHRcImh5cGVyX2JsYXN0ZXJcIjogXHRcdHsgZmlsZW5hbWU6IFwiaHlwZXJfYmxhc3Rlci5qc1wiIH0sXHJcblxyXG5cdFwibm9tX3dhbGswXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwibm9tX3dhbGswLmpzXCIgfSxcclxuXHRcIm5vbV93YWxrMVwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV93YWxrMS5qc1wiIH0sXHJcblx0XCJub21fd2FsazJcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJub21fd2FsazIuanNcIiB9LFxyXG5cdFwibm9tX3dhbGszXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwibm9tX3dhbGszLmpzXCIgfSxcclxuXHRcIm5vbV93YWxrNFwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV93YWxrNC5qc1wiIH0sXHJcblx0XCJub21fd2FsazVcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJub21fd2FsazUuanNcIiB9LFxyXG5cdFwibm9tX2RlYXRoMFwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV9kZWF0aDAuanNcIiB9LFxyXG5cdFwibm9tX2RlYXRoMVwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV9kZWF0aDEuanNcIiB9LFxyXG5cdFwibm9tX2RlYXRoMlwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV9kZWF0aDIuanNcIiB9LFxyXG5cdFwibm9tX2RlYXRoM1wiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV9kZWF0aDMuanNcIiB9LFxyXG5cclxuXHRcIm9ubGluZV9wbGF5ZXJfd2FsazBcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJub21fd2FsazAuanNcIiB9LFxyXG5cdFwib25saW5lX3BsYXllcl93YWxrMVwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV93YWxrMS5qc1wiIH0sXHJcblx0XCJvbmxpbmVfcGxheWVyX3dhbGsyXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwibm9tX3dhbGsyLmpzXCIgfSxcclxuXHRcIm9ubGluZV9wbGF5ZXJfd2FsazNcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJub21fd2FsazMuanNcIiB9LFxyXG5cdFwib25saW5lX3BsYXllcl93YWxrNFwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV93YWxrNC5qc1wiIH0sXHJcblx0XCJvbmxpbmVfcGxheWVyX3dhbGs1XCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwibm9tX3dhbGs1LmpzXCIgfSxcclxuXHRcIm9ubGluZV9wbGF5ZXJfZGVhdGgwXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwibm9tX2RlYXRoMC5qc1wiIH0sXHJcblx0XCJvbmxpbmVfcGxheWVyX2RlYXRoMVwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcIm5vbV9kZWF0aDEuanNcIiB9LFxyXG5cdFwib25saW5lX3BsYXllcl9kZWF0aDJcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJub21fZGVhdGgyLmpzXCIgfSxcclxuXHRcIm9ubGluZV9wbGF5ZXJfZGVhdGgzXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwibm9tX2RlYXRoMy5qc1wiIH0sXHJcblxyXG5cdFwiZXllX3dhbGswXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwiZXllX3dhbGswLmpzXCIgfSxcclxuXHRcImV5ZV93YWxrMVwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcImV5ZV93YWxrMS5qc1wiIH0sXHJcblx0XCJleWVfd2FsazJcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJleWVfd2FsazIuanNcIiB9LFxyXG5cdFwiZXllX3dhbGszXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwiZXllX3dhbGszLmpzXCIgfSxcclxuXHRcImV5ZV9kZWF0aDBcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJleWVfZGVhdGgwLmpzXCIgfSxcclxuXHRcImV5ZV9kZWF0aDFcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJleWVfZGVhdGgxLmpzXCIgfSxcclxuXHRcImV5ZV9kZWF0aDJcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJleWVfZGVhdGgyLmpzXCIgfSxcclxuXHRcImV5ZV9kZWF0aDNcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJleWVfZGVhdGgzLmpzXCIgfSxcclxuXHRcImV5ZV9hdHRhY2swXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwiZXllX2F0dGFjazAuanNcIiB9LFxyXG5cdFwiZXllX2F0dGFjazFcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJleWVfYXR0YWNrMS5qc1wiIH0sXHJcbn07XHJcblxyXG5HUy5Bc3NldHNbR1MuQXNzZXRUeXBlcy5Tb3VuZF0gPSB7XHJcblx0XCJkb29yX2Nsb3NlXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwiZG9vcl9jbG9zZS5vZ2dcIixcdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IHRydWUgfSxcclxuXHRcImRvb3Jfb3BlblwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcImRvb3Jfb3Blbi5vZ2dcIixcdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IHRydWUgfSxcclxuXHRcImVsZXZhdG9yX21vdmVcIjogXHRcdHsgZmlsZW5hbWU6IFwiZWxldmF0b3JfbW92ZS5vZ2dcIixcdFx0XHRhbGxvd011bHRpcGxlQXRPbmNlOiB0cnVlIH0sXHJcblx0XCJlbGV2YXRvcl9zdG9wXCI6IFx0XHR7IGZpbGVuYW1lOiBcImVsZXZhdG9yX3N0b3Aub2dnXCIsXHRcdFx0YWxsb3dNdWx0aXBsZUF0T25jZTogdHJ1ZSB9LFxyXG5cdFwiaHlwZXJfYmxhc3Rlcl9maXJlXCI6IFx0eyBmaWxlbmFtZTogXCJoeXBlcl9ibGFzdGVyX2ZpcmUub2dnXCIsXHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IHRydWUgfSxcclxuXHRcImh5cGVyX2JsYXN0ZXJfaGl0XCI6IFx0eyBmaWxlbmFtZTogXCJoeXBlcl9ibGFzdGVyX2hpdC5vZ2dcIixcdFx0YWxsb3dNdWx0aXBsZUF0T25jZTogdHJ1ZSB9LFxyXG5cdFwibW9uc3Rlcl9wYWluXCI6IFx0XHR7IGZpbGVuYW1lOiBcIm1vbnN0ZXJfcGFpbi5vZ2dcIixcdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IGZhbHNlIH0sXHJcblx0XCJtb25zdGVyX3JvYXJcIjogXHRcdHsgZmlsZW5hbWU6IFwibW9uc3Rlcl9yb2FyLm9nZ1wiLFx0XHRcdFx0YWxsb3dNdWx0aXBsZUF0T25jZTogdHJ1ZSB9LFxyXG5cdFwibW9uc3Rlcl9iaXRlXCI6IFx0XHR7IGZpbGVuYW1lOiBcIm1vbnN0ZXJfYml0ZS5vZ2dcIixcdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IHRydWUgfSxcclxuXHRcIm1vbnN0ZXJfZGVhdGhcIjogXHRcdHsgZmlsZW5hbWU6IFwibW9uc3Rlcl9kZWF0aC5vZ2dcIixcdFx0XHRhbGxvd011bHRpcGxlQXRPbmNlOiB0cnVlIH0sXHJcblx0XCJleWVfY2hhcmdpbmdcIjogXHRcdHsgZmlsZW5hbWU6IFwiZXllX2NoYXJnaW5nLm9nZ1wiLFx0XHRcdFx0YWxsb3dNdWx0aXBsZUF0T25jZTogdHJ1ZSB9LFxyXG5cdFwicGlja3VwX2FtbW9cIjogXHRcdFx0eyBmaWxlbmFtZTogXCJwaWNrdXBfYW1tby5vZ2dcIixcdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IHRydWUgfSxcclxuXHRcInBpY2t1cF9pdGVtXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwicGlja3VwX2l0ZW0ub2dnXCIsXHRcdFx0XHRhbGxvd011bHRpcGxlQXRPbmNlOiB0cnVlIH0sXHJcblx0XCJwaWNrdXBfd2VhcG9uXCI6IFx0XHR7IGZpbGVuYW1lOiBcInBpY2t1cF93ZWFwb24ub2dnXCIsXHRcdFx0YWxsb3dNdWx0aXBsZUF0T25jZTogdHJ1ZSB9LFxyXG5cdFwic2hvdGd1bl9maXJlXCI6IFx0XHR7IGZpbGVuYW1lOiBcInNob3RndW5fZmlyZS5vZ2dcIixcdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IHRydWUgfSxcclxuXHRcInBsYXllcl9kZWF0aFwiOiBcdFx0eyBmaWxlbmFtZTogXCJwbGF5ZXJfZGVhdGgub2dnXCIsXHRcdFx0XHRhbGxvd011bHRpcGxlQXRPbmNlOiB0cnVlIH0sXHJcblx0XCJzd2l0Y2hfb25cIjogXHRcdFx0eyBmaWxlbmFtZTogXCJzd2l0Y2hfb24ub2dnXCIsXHRcdFx0XHRhbGxvd011bHRpcGxlQXRPbmNlOiB0cnVlIH0sXHJcblx0XCJub25lXCI6IFx0XHRcdFx0eyBmaWxlbmFtZTogXCJub25lLm9nZ1wiLFx0XHRcdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IHRydWUgfSxcclxufTtcclxuXHJcbkdTLkFzc2V0c1tHUy5Bc3NldFR5cGVzLk11c2ljVHJhY2tdID0ge1xyXG5cdFwic2ltcGxlX2FjdGlvbl9iZWF0XCI6IFx0eyBmaWxlbmFtZTogXCJzaW1wbGVfYWN0aW9uX2JlYXQub2dnXCIgfSxcclxuXHRcInRvd2VyX2RlZmVuc2VfdGhlbWVcIjogXHR7IGZpbGVuYW1lOiBcInRvd2VyX2RlZmVuc2VfdGhlbWUub2dnXCIgfSxcclxuXHRcImFuZ3J5X3JvYm90XzNcIjogXHRcdHsgZmlsZW5hbWU6IFwiYW5ncnlfcm9ib3RfMy5vZ2dcIiB9LFxyXG59O1xyXG5cclxuR1MuQXNzZXRzW0dTLkFzc2V0VHlwZXMuTWFwXSA9IHtcclxuXHRcInRlc3RNYXBcIjogXHRcdFx0XHR7IGZpbGVuYW1lOiBcIlwiIH0sXHJcblx0XCJhaXJzdHJpcDFcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJhaXJzdHJpcDEuanNcIiB9LFxyXG5cdFwiYWlyc3RyaXAxb25saW5lXCI6IFx0XHRcdHsgZmlsZW5hbWU6IFwiYWlyc3RyaXAxb25saW5lLmpzXCIgfSxcclxuXHRcImRyZW5jcm9tXCI6XHRcdFx0XHR7IGZpbGVuYW1lOiBcImRyZW5jcm9tLmpzXCIgfSxcclxuXHRcInNhY3Jvc2FuY3RcIjpcdFx0XHR7IGZpbGVuYW1lOiBcInNhY3Jvc2FuY3QuanNcIiB9LFxyXG59O1xyXG5cclxuR1MuQXNzZXRzW0dTLkFzc2V0VHlwZXMuU2NyaXB0XSA9IHtcclxuXHRcImFpcnN0cmlwMVwiOiBcdFx0XHR7IGZpbGVuYW1lOiBcImFpcnN0cmlwMW9ubGluZS5qc1wiIH0sXHJcblx0XCJhaXJzdHJpcDFcIjogXHRcdFx0eyBmaWxlbmFtZTogXCJhaXJzdHJpcDEuanNcIiB9LFxyXG5cdFwiZHJlbmNyb21cIjpcdFx0XHRcdHsgZmlsZW5hbWU6IFwiZHJlbmNyb20uanNcIiB9LFxyXG5cdFwic2Fjcm9zYW5jdFwiOlx0XHRcdHsgZmlsZW5hbWU6IFwic2Fjcm9zYW5jdC5qc1wiIH0sXHJcbn07XHJcbiIsIkdTLk1vbnN0ZXJBdHRhY2tUeXBlcyA9IHtcclxuXHRNZWxlZTogMCxcclxuXHRSYW5nZWQ6IDEsXHJcbn07XHJcblxyXG5HUy5Nb25zdGVycyA9IHtcclxuXHRub206IHtcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IzKDE2ICogMC40NSwgMTYgKiAwLjUsICAxNiAqIDAuNDUpLFxyXG5cdFx0c2NhbGU6IG5ldyBUSFJFRS5WZWN0b3IzKDAuOSwgMC45LCAwLjkpLFxyXG5cdFx0b2Zmc2V0OiBuZXcgVEhSRUUuVmVjdG9yMygxNiAqIDAuNDUgKiAwLjUsIDE2ICogMC41ICsgMC4wMywgMTYgKiAwLjQ1ICogMC41KSxcclxuXHRcdHNwZWVkOiAwLjc1LFxyXG5cdFx0cm90YXRpb25PZmZzZXQ6IE1hdGguUEksXHJcblxyXG5cdFx0cGFpbkNoYW5jZTogMC4yNSxcclxuXHRcdGF0dGFja1R5cGU6IEdTLk1vbnN0ZXJBdHRhY2tUeXBlcy5NZWxlZSxcclxuXHRcdG1heEhlYWx0aDogMTYwLFxyXG5cdFx0bWVsZWVEYW1hZ2U6IDEwLFxyXG5cdFx0bWVsZWVBdHRhY2tNYXhDb29sZG93bjogR1MubXNUb0ZyYW1lcyg1MDApLFxyXG5cdFx0bWVsZWVSYW5nZTogMTUsXHJcblx0XHR3YWxrRGVsYXk6IDUsXHJcblx0XHRibG9vZENvbG9yOiBuZXcgVEhSRUUuQ29sb3IoKS5zZXRSR0IoMSwgMCwgMCkuZ2V0SGV4KCksXHJcblxyXG5cdFx0cm9hclNvdW5kOiBcIm1vbnN0ZXJfcm9hclwiLFxyXG5cdFx0bWVsZWVBdHRhY2tTb3VuZDogXCJtb25zdGVyX2JpdGVcIixcclxuXHRcdHBhaW5Tb3VuZDogXCJtb25zdGVyX3BhaW5cIixcclxuXHRcdGRlYXRoU291bmQ6IFwibW9uc3Rlcl9kZWF0aFwiLFxyXG5cdH0sXHJcblx0ZXllOiB7XHJcblx0XHRzaXplOiBuZXcgVEhSRUUuVmVjdG9yMygxNiAqIDAuMzUsIDE2ICogMC41LCAgMTYgKiAwLjM1KSxcclxuXHRcdHNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMygwLjUsIDAuNSwgMC41KSxcclxuXHRcdG9mZnNldDogbmV3IFRIUkVFLlZlY3RvcjMoMTYgKiAwLjM1ICogMC41LCAxNiAqIDAuNSArIDAuMDMsIDE2ICogMC4zNSAqIDAuNSksXHJcblx0XHRzcGVlZDogMC4yNSxcclxuXHRcdHJvdGF0aW9uT2Zmc2V0OiBNYXRoLlBJLFxyXG5cclxuXHRcdHBhaW5DaGFuY2U6IDAuNzUsXHJcblx0XHRhdHRhY2tUeXBlOiBHUy5Nb25zdGVyQXR0YWNrVHlwZXMuUmFuZ2VkLFxyXG5cdFx0bWF4SGVhbHRoOiA1MCxcclxuXHRcdG1lbGVlUmFuZ2U6IDE1LFxyXG5cdFx0cmFuZ2VkQXR0YWNrTWF4Q29vbGRvd246IEdTLm1zVG9GcmFtZXMoMTUwMCksXHJcblx0XHRyYW5nZWRBdHRhY2tDb29sZG93blJhbmRvbU1vZGlmaWVyOiBHUy5tc1RvRnJhbWVzKDEwMDApLFxyXG5cdFx0cmFuZ2VkQXR0YWNrUmFuZ2U6IDIwMCxcclxuXHRcdHJhbmdlZEF0dGFja1Byb2plY3RpbGU6IFwiZXllX2JvbHRcIixcclxuXHRcdHJhbmdlZEF0dGFja0NoYXJnZU1heENvb2xkb3duOiBHUy5tc1RvRnJhbWVzKDUwMCksXHJcblx0XHRwcmVmZXJyZWRNYXhEaXN0YW5jZTogMTAwLFxyXG5cdFx0d2Fsa0RlbGF5OiAxNSxcclxuXHRcdGJsb29kQ29sb3I6IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQigwLCAxLCAxKS5nZXRIZXgoKSxcclxuXHJcblx0XHRyb2FyU291bmQ6IFwibW9uc3Rlcl9yb2FyXCIsXHJcblx0XHRyYW5nZWRBdHRhY2tDaGFyZ2VVcFNvdW5kOiBcImV5ZV9jaGFyZ2luZ1wiLFxyXG5cdFx0cGFpblNvdW5kOiBcIm1vbnN0ZXJfcGFpblwiLFxyXG5cdFx0ZGVhdGhTb3VuZDogXCJtb25zdGVyX2RlYXRoXCIsXHJcblx0fSxcclxufTsiLCJHUy5Qcm9qZWN0aWxlcyA9IHtcclxuXHRwaXN0b2xfYm9sdDoge1xyXG5cdFx0aGl0U291bmQ6IFwiaHlwZXJfYmxhc3Rlcl9oaXRcIixcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IzKDEsIDEsIDEpLFxyXG5cdFx0dmlzdWFsU2l6ZTogbmV3IFRIUkVFLlZlY3RvcjMoMSwgMSwgMyksXHJcblx0XHRyb3RhdGluZzogZmFsc2UsXHJcblx0XHRzcGVlZDogNSxcclxuXHRcdG1heERpc3RhbmNlOiA1MDAsXHJcblx0XHRjb2xvcjogbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKDEsIDEsIDEpLmdldEhleCgpLFxyXG5cdFx0ZGFtYWdlOiAxMCxcclxuXHR9LFxyXG5cdGh5cGVyX2JsYXN0ZXJfYm9sdDoge1xyXG5cdFx0aGl0U291bmQ6IFwiaHlwZXJfYmxhc3Rlcl9oaXRcIixcclxuXHRcdHNpemU6IG5ldyBUSFJFRS5WZWN0b3IzKDEsIDEsIDEpLFxyXG5cdFx0dmlzdWFsU2l6ZTogbmV3IFRIUkVFLlZlY3RvcjMoMSwgMSwgMyksXHJcblx0XHRyb3RhdGluZzogZmFsc2UsXHJcblx0XHRzcGVlZDogNSxcclxuXHRcdG1heERpc3RhbmNlOiA1MDAsXHJcblx0XHRjb2xvcjogbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKDEsIDEsIDEpLmdldEhleCgpLFxyXG5cdFx0ZGFtYWdlOiAxMCxcclxuXHR9LFxyXG5cdGV5ZV9ib2x0OiB7XHJcblx0XHRoaXRTb3VuZDogXCJoeXBlcl9ibGFzdGVyX2hpdFwiLFxyXG5cdFx0c2l6ZTogbmV3IFRIUkVFLlZlY3RvcjMoMiwgMiwgMiksXHJcblx0XHR2aXN1YWxTaXplOiBuZXcgVEhSRUUuVmVjdG9yMygzLCAzLCAzKSxcclxuXHRcdHJvdGF0aW5nOiB0cnVlLFxyXG5cdFx0c3BlZWQ6IDIsXHJcblx0XHRtYXhEaXN0YW5jZTogNTAwLFxyXG5cdFx0Y29sb3I6IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQigxLCAxLCAxKS5nZXRIZXgoKSxcclxuXHRcdGRhbWFnZTogMjAsXHJcblx0fSxcclxufTsiLCJHUy5XZWFwb25zID0ge1xyXG5cdHBpc3RvbDoge1xyXG5cdFx0bmFtZTogXCJwaXN0b2xcIixcclxuXHRcdHBvd2VyTGV2ZWw6IDIsXHJcblx0XHRhbW1vOiAwLFxyXG5cdFx0aW5maW5pdGVBbW1vOiB0cnVlLFxyXG5cdFx0Y29vbGRvd246IDQwMCxcclxuXHRcdGhpdHNjYW46IGZhbHNlLFxyXG5cdH0sXHJcblx0ZG91YmxlX3Nob3RndW46IHtcclxuXHRcdG5hbWU6IFwic2hvdGd1blwiLFxyXG5cdFx0cG93ZXJMZXZlbDogMyxcclxuXHRcdGFtbW86IDAsXHJcblx0XHRhbW1vTWF4OiA1MCxcclxuXHRcdGFtbW9DbGlwOiA4LFxyXG5cdFx0YnVsbGV0c1BlclNob3Q6IDIsXHJcblx0XHRjb29sZG93bjogMTAwMCxcclxuXHRcdGhpdHNjYW46IHRydWUsXHJcblx0XHRzcHJlYWQ6IHtcclxuXHRcdFx0c2hvdHM6IDgsXHJcblx0XHRcdGFuZ2xlT2Zmc2V0OiA1LFxyXG5cdFx0fSxcclxuXHRcdGRhbWFnZTogMTAsXHJcblx0XHRpbXBhY3RQYXJ0aWNsZUNvbG9yOiBuZXcgVEhSRUUuQ29sb3IoKS5zZXRSR0IoMSwgMSwgMSkuZ2V0SGV4KCksXHJcblx0XHRpbXBhY3RQYXJ0aWNsZUNvdW50OiAxLFxyXG5cdH0sXHJcblx0aHlwZXJfYmxhc3Rlcjoge1xyXG5cdFx0bmFtZTogXCJoeXBlcmJsYXN0ZXJcIixcclxuXHRcdHBvd2VyTGV2ZWw6IDQsXHJcblx0XHRhbW1vOiAwLFxyXG5cdFx0YW1tb01heDogMjAwLFxyXG5cdFx0YW1tb0NsaXA6IDIwLFxyXG5cdFx0YnVsbGV0c1BlclNob3Q6IDEsXHJcblx0XHRjb29sZG93bjogODAsXHJcblx0XHRoaXRzY2FuOiBmYWxzZSxcclxuXHR9LFxyXG59OyIsIkdTLkdyaWRPYmplY3QgPSBmdW5jdGlvbihncmlkLCBsYXllciwgc291cmNlT2JqKSB7XHJcblx0dGhpcy5pZCA9IEdTLmdyaWRPYmplY3RJZENvdW50O1xyXG5cdHRoaXMuZ3JpZCA9IGdyaWQ7XHJcblx0dGhpcy50eXBlID0gbGF5ZXI7XHJcblx0dGhpcy5zb3VyY2VPYmogPSBzb3VyY2VPYmo7XHJcblx0dGhpcy5saW5rZWRHcmlkQ2VsbHMgPSBbXTtcclxuXHR0aGlzLnZpZXcgPSBudWxsO1xyXG5cclxuXHR0aGlzLnJlbW92ZWQgPSBmYWxzZTtcclxuXHR0aGlzLnVzYWJsZSA9IGZhbHNlO1xyXG5cclxuXHR0aGlzLmxpZ2h0TGV2ZWxGYWN0b3IgPSAwLjE7XHJcblx0dGhpcy5taW5MaWdodExldmVsID0gMC4xO1xyXG5cdHRoaXMubWF4TGlnaHRMZXZlbCA9IDAuNzU7XHJcblxyXG5cdEdTLmdyaWRPYmplY3RJZENvdW50Kys7XHJcbn07XHJcblxyXG5HUy5HcmlkT2JqZWN0LnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuR3JpZE9iamVjdCxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVDb2xsaXNpb25EYXRhOiBmdW5jdGlvbihuZXdQb3MpIHtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVCb3VuZGluZ0JveDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgbWluID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBtYXggPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHBvaW50cyA9IFsgbmV3IFRIUkVFLlZlY3RvcjIoKSwgbmV3IFRIUkVFLlZlY3RvcjIoKSBdO1xyXG5cdFx0dmFyIGF1eCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR2YXIgZGF0YSA9IHRoaXMudmlldy5jb2xsaXNpb25EYXRhO1xyXG5cdFx0XHRtaW4uY29weSh0aGlzLnBvc2l0aW9uKS5zdWIodGhpcy5zaXplKTtcclxuXHRcdFx0bWF4LmNvcHkodGhpcy5wb3NpdGlvbikuYWRkKHRoaXMuc2l6ZSk7XHJcblx0XHRcdGRhdGEuYm91bmRpbmdCb3guc2V0KG1pbiwgbWF4KTtcclxuXHJcblx0XHRcdHZhciBkZWJ1Z01lc2ggPSB0aGlzLnZpZXcuZGVidWdNZXNoO1xyXG5cdFx0XHRpZiAoZGVidWdNZXNoICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRpZiAoZGVidWdNZXNoLnVzZXJEYXRhLmlzVHJpYW5nbGVNZXNoICE9PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRkZWJ1Z01lc2guc2NhbGUuc3ViVmVjdG9ycyhtYXgsIG1pbik7XHJcblx0XHRcdFx0XHRkZWJ1Z01lc2gucG9zaXRpb24uY29weSh0aGlzLnBvc2l0aW9uKTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0ZGVidWdNZXNoLmdlb21ldHJ5LnZlcnRpY2VzLmxlbmd0aCA9IDA7XHJcblx0XHRcdFx0XHRHUy5wdXNoQXJyYXkoZGVidWdNZXNoLmdlb21ldHJ5LnZlcnRpY2VzLCBkYXRhLnRyaWFuZ2xlcyk7XHJcblx0XHRcdFx0XHRkZWJ1Z01lc2guZ2VvbWV0cnkudmVydGljZXNOZWVkVXBkYXRlID0gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChkYXRhLmJvdW5kaW5nU3F1YXJlICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHR0aGlzLnNpemUudG9WZWN0b3IyKGF1eCk7XHJcblx0XHRcdFx0dGhpcy5wb3NpdGlvbi50b1ZlY3RvcjIocG9pbnRzWzBdKTtcclxuXHRcdFx0XHRwb2ludHNbMF0uc3ViKGF1eCk7XHJcblx0XHRcdFx0dGhpcy5zaXplLnRvVmVjdG9yMihhdXgpO1xyXG5cdFx0XHRcdHRoaXMucG9zaXRpb24udG9WZWN0b3IyKHBvaW50c1sxXSk7XHJcblx0XHRcdFx0cG9pbnRzWzFdLmFkZChhdXgpO1xyXG5cclxuXHRcdFx0XHRkYXRhLmJvdW5kaW5nU3F1YXJlLnNldEZyb21Qb2ludHMocG9pbnRzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0dXBkYXRlVHJpYW5nbGVzOiBmdW5jdGlvbih2ZWxvY2l0eSkge1xyXG5cdFx0dmFyIHRyaWFuZ2xlcyA9IHRoaXMudmlldy5jb2xsaXNpb25EYXRhLnRyaWFuZ2xlcztcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHRyaWFuZ2xlc1tpXS5hZGQodmVsb2NpdHkpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVNlZ21lbnRzOiBmdW5jdGlvbih5VmVsb2NpdHkpIHtcclxuXHRcdHZhciBzZWdzID0gdGhpcy52aWV3LmNvbGxpc2lvbkRhdGEuc2VnbWVudHM7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNlZ3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0c2Vnc1tpXS5ib3R0b21ZICs9IHlWZWxvY2l0eTtcclxuXHRcdFx0c2Vnc1tpXS50b3BZICs9IHlWZWxvY2l0eTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhc3NpZ25Ub0NlbGxzOiBmdW5jdGlvbihncmlkTG9jYXRpb24pIHtcclxuXHRcdGlmIChncmlkTG9jYXRpb24gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRpZiAodGhpcy5ncmlkTG9jYXRpb24gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdGlmICghZ3JpZExvY2F0aW9uLmdyaWRNaW4uZXF1YWxzKHRoaXMuZ3JpZExvY2F0aW9uLmdyaWRNaW4pIHx8XHJcblx0XHRcdFx0XHQhZ3JpZExvY2F0aW9uLmdyaWRNYXguZXF1YWxzKHRoaXMuZ3JpZExvY2F0aW9uLmdyaWRNYXgpKSB7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy51bmxpbmtGcm9tQ2VsbHMoKTtcclxuXHRcdFx0XHRcdHRoaXMubGlua1RvQ2VsbHMoZ3JpZExvY2F0aW9uKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5saW5rVG9DZWxscyhncmlkTG9jYXRpb24pO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnVubGlua0Zyb21DZWxscygpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGxpbmtUb0NlbGxzOiBmdW5jdGlvbihncmlkTG9jYXRpb24pIHtcclxuXHRcdHZhciBtaW4gPSBncmlkTG9jYXRpb24uZ3JpZE1pbjtcclxuXHRcdHZhciBtYXggPSBncmlkTG9jYXRpb24uZ3JpZE1heDtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gbWluLnk7IGkgPD0gbWF4Lnk7IGkrKykge1xyXG5cdFx0XHRmb3IgKHZhciBqID0gbWluLng7IGogPD0gbWF4Lng7IGorKykge1xyXG5cdFx0XHRcdHRoaXMuZ3JpZC5jZWxsc1tpXVtqXS5jaGlsZHJlbi5wdXNoKHRoaXMpO1xyXG5cdFx0XHRcdHRoaXMubGlua2VkR3JpZENlbGxzLnB1c2godGhpcy5ncmlkLmNlbGxzW2ldW2pdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZ3JpZExvY2F0aW9uID0gZ3JpZExvY2F0aW9uO1xyXG5cdH0sXHJcblxyXG5cdHVubGlua0Zyb21DZWxsczogZnVuY3Rpb24oKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGlua2VkR3JpZENlbGxzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBjZWxsID0gdGhpcy5saW5rZWRHcmlkQ2VsbHNbaV07XHJcblx0XHRcdHZhciBpZHggPSBjZWxsLmNoaWxkcmVuLmluZGV4T2YodGhpcyk7XHJcblx0XHRcdGlmIChpZHggIT0gLTEpIHtcclxuXHRcdFx0XHRjZWxsLmNoaWxkcmVuLnNwbGljZShpZHgsIDEpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLmxpbmtlZEdyaWRDZWxscy5sZW5ndGggPSAwO1xyXG5cdFx0dGhpcy5ncmlkTG9jYXRpb24gPSB1bmRlZmluZWQ7XHJcblx0fSxcclxuXHJcblx0Z2V0TGlnaHRDb2xvckZyb21TZWN0b3I6IGZ1bmN0aW9uKG9wdGlvbmFsVGFyZ2V0LCBvcHRpb25hbFNlY3Rvcikge1xyXG5cdFx0dmFyIHNlY3RvciA9IG9wdGlvbmFsU2VjdG9yIHx8IHRoaXMuZ2V0U2VjdG9yKCk7XHJcblx0XHRpZiAoc2VjdG9yICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dmFyIGNvbG9yID0gb3B0aW9uYWxUYXJnZXQgfHwgbmV3IFRIUkVFLkNvbG9yKCk7XHJcblx0XHRcdHZhciB4ID0gKHNlY3Rvci5saWdodExldmVsICogdGhpcy5saWdodExldmVsRmFjdG9yKTtcclxuXHRcdFx0eCAqPSB4O1xyXG5cdFx0XHR4ID0gR1MuTWF0aEhlbHBlci5jbGFtcCh4LCB0aGlzLm1pbkxpZ2h0TGV2ZWwsIHRoaXMubWF4TGlnaHRMZXZlbCk7XHJcblx0XHRcdGNvbG9yLnNldEhleCgweGZmZmZmZikubXVsdGlwbHlTY2FsYXIoeCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Y29tcHV0ZVlGcm9tU2VjdG9yOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBzZWN0b3IgPSB0aGlzLmdldFNlY3RvcigpO1xyXG5cdFx0aWYgKHNlY3RvciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMucG9zaXRpb24ueSA9IHNlY3Rvci5mbG9vclRvcFkgKyB0aGlzLnNpemUueSArIDAuMDM7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0U2VjdG9yOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwb3NpdGlvbjJkID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHRcdHZhciBzZWN0b3I7XHJcblx0XHRcdHZhciBjdXJyZW50U2VjdG9yO1xyXG5cdFx0XHR0aGlzLnBvc2l0aW9uLnRvVmVjdG9yMihwb3NpdGlvbjJkKTtcclxuXHJcblx0XHRcdHRoaXMuZ3JpZC5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdEluQ2VsbHModGhpcy5saW5rZWRHcmlkQ2VsbHMsIFtHUy5Db25jcmV0ZSwgR1MuRWxldmF0b3JdLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHRcdFx0aWYgKHNlY3RvciA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRpZiAoZ3JpZE9iamVjdCBpbnN0YW5jZW9mIEdTLkNvbmNyZXRlKSB7XHJcblx0XHRcdFx0XHRcdGlmIChncmlkT2JqZWN0LnR5cGUgPT09IEdTLk1hcExheWVycy5TZWN0b3IpIHtcclxuXHRcdFx0XHRcdFx0XHRjdXJyZW50U2VjdG9yID0gZ3JpZE9iamVjdC5zb3VyY2VPYmo7XHJcblx0XHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRjdXJyZW50U2VjdG9yID0gZ3JpZE9iamVjdC5zZWN0b3I7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKEdTLlBvbHlnb25IZWxwZXIuc2VjdG9yQ29udGFpbnNQb2ludChjdXJyZW50U2VjdG9yLCBwb3NpdGlvbjJkLCB0cnVlKSkge1xyXG5cdFx0XHRcdFx0XHRzZWN0b3IgPSBjdXJyZW50U2VjdG9yO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gc2VjdG9yO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0b25IaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdHJlbW92ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnJlbW92ZWQgPSB0cnVlO1xyXG5cdFx0dGhpcy51bmxpbmtGcm9tQ2VsbHMoKTtcclxuXHR9LFxyXG59O1xyXG5cclxuR1MuZ3JpZE9iamVjdElkQ291bnQgPSAwOyIsIkdTLkNvbmNyZXRlID0gZnVuY3Rpb24oZ3JpZCwgbGF5ZXIsIHNvdXJjZU9iaikge1xyXG5cdEdTLkdyaWRPYmplY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcblx0aWYgKGxheWVyID09PSBHUy5NYXBMYXllcnMuU2VjdG9yKSB7XHJcblx0XHR0aGlzLnNlY3RvciA9IHRoaXMuc291cmNlT2JqO1xyXG5cdH1cclxuXHJcblx0dGhpcy52aWV3ID0ge1xyXG5cdFx0Y29sbGlzaW9uRGF0YToge1xyXG5cdFx0XHR0cmlhbmdsZXM6IG51bGwsXHJcblx0XHR9LFxyXG5cdH07XHJcbn07XHJcblxyXG5HUy5Db25jcmV0ZS5wcm90b3R5cGUgPSBHUy5pbmhlcml0KEdTLkdyaWRPYmplY3QsIHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuQ29uY3JldGUsXHJcbn0pOyIsIkdTLkRvb3JTdGF0ZXMgPSB7XHJcblx0T3BlbjogMCxcclxuXHRDbG9zZWQ6IDEsXHJcblx0T3BlbmluZzogMixcclxuXHRDbG9zaW5nOiAzLFxyXG59O1xyXG5cclxuR1MuRG9vciA9IGZ1bmN0aW9uKGdyaWQsIHNlY3Rvcikge1xyXG5cdEdTLkdyaWRPYmplY3QuY2FsbCh0aGlzLCBncmlkKTtcclxuXHJcblx0dGhpcy5zZWN0b3IgPSBzZWN0b3I7XHJcblx0dGhpcy5zZWN0b3IuZG9vckdyaWRPYmplY3QgPSB0aGlzO1xyXG5cdHRoaXMubGlnaHRDb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpO1xyXG5cclxuXHR0aGlzLnNwZWVkID0gMC41O1xyXG5cdHRoaXMuc3RhdGUgPSBHUy5Eb29yU3RhdGVzLkNsb3NlZDtcclxuXHR0aGlzLmF1dG9tYXRpYyA9IHRydWU7XHJcblxyXG5cdHRoaXMudmlldyA9IHtcclxuXHRcdGNvbGxpc2lvbkRhdGE6IHtcclxuXHRcdFx0Ym91bmRpbmdCb3g6IG5ldyBUSFJFRS5Cb3gzKCksXHJcblx0XHRcdHRyaWFuZ2xlczogbnVsbCxcclxuXHRcdFx0c2VnbWVudHM6IG51bGwsXHJcblx0XHR9LFxyXG5cdH07XHJcblxyXG5cdHRoaXMubWF4Q29vbGRvd24gPSBHUy5tc1RvRnJhbWVzKDUwMDApO1xyXG5cdHRoaXMuY29vbGRvd24gPSB0aGlzLm1heENvb2xkb3duO1xyXG59O1xyXG5cclxuR1MuRG9vci5wcm90b3R5cGUgPSBHUy5pbmhlcml0KEdTLkdyaWRPYmplY3QsIHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuRG9vcixcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmNsb3NlZFkgPSB0aGlzLnBvc2l0aW9uLnk7XHJcblx0XHR0aGlzLm9wZW5ZID0gdGhpcy5jbG9zZWRZICsgdGhpcy5zZWN0b3IuZG9vck1heEhlaWdodDtcclxuXHRcdHRoaXMudXNhYmxlID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB2ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0c3dpdGNoICh0aGlzLnN0YXRlKSB7XHJcblx0XHRcdGNhc2UgR1MuRG9vclN0YXRlcy5PcGVuOlxyXG5cdFx0XHRcdGlmICh0aGlzLmF1dG9tYXRpYykge1xyXG5cdFx0XHRcdFx0dGhpcy5jb29sZG93bi0tO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuY29vbGRvd24gPD0gMCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmNvb2xkb3duID0gdGhpcy5tYXhDb29sZG93bjtcclxuXHRcdFx0XHRcdFx0dGhpcy5zdGF0ZSA9IEdTLkRvb3JTdGF0ZXMuQ2xvc2luZztcclxuXHRcdFx0XHRcdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQoXCJkb29yX2Nsb3NlXCIpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLmNvb2xkb3duID0gdGhpcy5tYXhDb29sZG93bjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRjYXNlIEdTLkRvb3JTdGF0ZXMuQ2xvc2VkOlxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBHUy5Eb29yU3RhdGVzLk9wZW5pbmc6XHJcblx0XHRcdFx0dGhpcy5wb3NpdGlvbi55ICs9IHRoaXMuc3BlZWQ7XHJcblx0XHRcdFx0dmVsb2NpdHkueSA9IHRoaXMuc3BlZWQ7XHJcblx0XHRcdFx0aWYgKHRoaXMucG9zaXRpb24ueSA+PSB0aGlzLm9wZW5ZKSB7XHJcblx0XHRcdFx0XHR0aGlzLnBvc2l0aW9uLnkgPSB0aGlzLm9wZW5ZO1xyXG5cdFx0XHRcdFx0dGhpcy5zdGF0ZSA9IEdTLkRvb3JTdGF0ZXMuT3BlbjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRjYXNlIEdTLkRvb3JTdGF0ZXMuQ2xvc2luZzpcclxuXHRcdFx0XHRpZiAoIXRoaXMuZ3JpZC5jb2xsaXNpb25NYW5hZ2VyLmlzRW50aXR5TmVhckRvb3IodGhpcykpIHtcclxuXHRcdFx0XHRcdHRoaXMucG9zaXRpb24ueSAtPSB0aGlzLnNwZWVkO1xyXG5cdFx0XHRcdFx0dmVsb2NpdHkueSA9IC10aGlzLnNwZWVkO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMucG9zaXRpb24ueSA8PSB0aGlzLmNsb3NlZFkpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5wb3NpdGlvbi55ID0gdGhpcy5jbG9zZWRZO1xyXG5cdFx0XHRcdFx0XHR0aGlzLnN0YXRlID0gR1MuRG9vclN0YXRlcy5DbG9zZWQ7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuc2VjdG9yLmRvb3JPcGVuZWRFdmVyID0gdHJ1ZTtcclxuXHRcdFx0XHRcdHRoaXMuc3RhdGUgPSBHUy5Eb29yU3RhdGVzLk9wZW5pbmc7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMudXNhYmxlID0gKHRoaXMuc3RhdGUgPT09IEdTLkRvb3JTdGF0ZXMuQ2xvc2VkICYmIHRoaXMuX2F1dG9tYXRpYyA9PT0gdHJ1ZSk7XHJcblxyXG5cdFx0aWYgKHZlbG9jaXR5LnkgIT09IDApIHtcclxuXHRcdFx0dGhpcy51cGRhdGVCb3VuZGluZ0JveCgpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZVRyaWFuZ2xlcyh2ZWxvY2l0eSk7XHJcblx0XHRcdHRoaXMudXBkYXRlU2VnbWVudHModmVsb2NpdHkueSk7XHJcblx0XHRcdHRoaXMudXBkYXRlTWVzaCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghdGhpcy5zZWN0b3IudXNlVmVydGV4Q29sb3JzKSB7XHJcblx0XHRcdHRoaXMuZ2V0TGlnaHRDb2xvckZyb21TZWN0b3IodGhpcy5saWdodENvbG9yLCB0aGlzLnNlY3Rvcik7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52aWV3Lm1lc2guY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgbWF0ZXJpYWwgPSB0aGlzLnZpZXcubWVzaC5jaGlsZHJlbltpXS5tYXRlcmlhbDtcclxuXHRcdFx0XHRpZiAobWF0ZXJpYWwuZW1pc3NpdmUgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0bWF0ZXJpYWwuZW1pc3NpdmUuY29weSh0aGlzLmxpZ2h0Q29sb3IpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZU1lc2g6IGZ1bmN0aW9uKCkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZpZXcubWVzaC5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR0aGlzLnZpZXcubWVzaC5jaGlsZHJlbltpXS5wb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdG9uVXNlOiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLnN0YXRlID09IEdTLkRvb3JTdGF0ZXMuQ2xvc2VkKSB7XHJcblx0XHRcdHRoaXMuc2VjdG9yLmRvb3JPcGVuZWRFdmVyID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5zdGF0ZSA9IEdTLkRvb3JTdGF0ZXMuT3BlbmluZztcclxuXHRcdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQoXCJkb29yX29wZW5cIik7XHJcblx0XHRcdHRoaXMuZ3JpZC5haU1hbmFnZXIub25QbGF5ZXJPcGVuRG9vcih0aGlzKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRvcGVuOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuc2VjdG9yLmRvb3JPcGVuZWRFdmVyID0gdHJ1ZTtcclxuXHRcdHRoaXMuc3RhdGUgPSBHUy5Eb29yU3RhdGVzLk9wZW5pbmc7XHJcblx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZChcImRvb3Jfb3BlblwiKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9LFxyXG5cclxuXHRvcGVuU2lsZW50OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuc2VjdG9yLmRvb3JPcGVuZWRFdmVyID0gdHJ1ZTtcclxuXHRcdHRoaXMuc3RhdGUgPSBHUy5Eb29yU3RhdGVzLk9wZW5pbmc7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fSxcclxuXHJcblx0Y2xvc2U6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5zdGF0ZSA9IEdTLkRvb3JTdGF0ZXMuQ2xvc2luZztcclxuXHRcdHRoaXMuZ3JpZC5zb3VuZE1hbmFnZXIucGxheVNvdW5kKFwiZG9vcl9jbG9zZVwiKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9LFxyXG5cclxuXHRzZXQgYXV0b21hdGljKHZhbHVlKSB7XHJcblx0XHR0aGlzLl9hdXRvbWF0aWMgPSB2YWx1ZTtcclxuXHRcdHRoaXMudXNhYmxlID0gKHRoaXMuX2F1dG9tYXRpYyA9PT0gdHJ1ZSk7XHJcblx0fSxcclxuXHJcblx0Z2V0IGF1dG9tYXRpYygpIHtcclxuXHRcdHJldHVybiB0aGlzLl9hdXRvbWF0aWM7XHJcblx0fSxcclxufSk7XHJcbiIsIkdTLkVsZXZhdG9yU3RhdGVzID0ge1xyXG5cdERvd246IDAsXHJcblx0VXA6IDEsXHJcblx0R29pbmREb3duOiAyLFxyXG5cdEdvaW5nVXA6IDMsXHJcbn07XHJcblxyXG5HUy5FbGV2YXRvciA9IGZ1bmN0aW9uKGdyaWQsIHNlY3Rvcikge1xyXG5cdEdTLkdyaWRPYmplY3QuY2FsbCh0aGlzLCBncmlkKTtcclxuXHJcblx0dGhpcy5zZWN0b3IgPSBzZWN0b3I7XHJcblx0dGhpcy5zcGVlZCA9IDAuMjU7XHJcblx0dGhpcy5zdGF0ZSA9IEdTLkVsZXZhdG9yU3RhdGVzLkRvd247XHJcblx0dGhpcy5hdXRvbWF0aWMgPSB0cnVlO1xyXG5cdHRoaXMubGlnaHRDb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpO1xyXG5cclxuXHR0aGlzLnZpZXcgPSB7XHJcblx0XHRjb2xsaXNpb25EYXRhOiB7XHJcblx0XHRcdGJvdW5kaW5nQm94OiBuZXcgVEhSRUUuQm94MygpLFxyXG5cdFx0XHR0cmlhbmdsZXM6IG51bGwsXHJcblx0XHRcdHNlZ21lbnRzOiBudWxsLFxyXG5cdFx0fSxcclxuXHR9O1xyXG5cclxuXHR0aGlzLm1heENvb2xkb3duID0gR1MubXNUb0ZyYW1lcygwKTtcclxuXHR0aGlzLmNvb2xkb3duID0gdGhpcy5tYXhDb29sZG93bjtcclxuXHJcblx0dGhpcy52ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcbn07XHJcblxyXG5HUy5FbGV2YXRvci5wcm90b3R5cGUgPSBHUy5pbmhlcml0KEdTLkdyaWRPYmplY3QsIHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuRWxldmF0b3IsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5kb3duWSA9IHRoaXMucG9zaXRpb24ueTtcclxuXHRcdHRoaXMudXBZID0gdGhpcy5kb3duWSArIHRoaXMuc2VjdG9yLmVsZXZhdG9yTWF4SGVpZ2h0O1xyXG5cclxuXHRcdHRoaXMudXBkYXRlQm91bmRpbmdCb3goKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7XHJcblx0XHR2YXIgb2xkWSA9IDA7XHJcblxyXG5cdFx0c3dpdGNoICh0aGlzLnN0YXRlKSB7XHJcblx0XHRcdGNhc2UgR1MuRWxldmF0b3JTdGF0ZXMuRG93bjpcclxuXHRcdFx0XHRpZiAodGhpcy5hdXRvbWF0aWMpIHtcclxuXHRcdFx0XHRcdHRoaXMuY29vbGRvd24tLTtcclxuXHRcdFx0XHRcdGlmICh0aGlzLmNvb2xkb3duIDw9IDApIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5jb29sZG93biA9IHRoaXMubWF4Q29vbGRvd247XHJcblx0XHRcdFx0XHRcdHRoaXMuc3RhdGUgPSBHUy5FbGV2YXRvclN0YXRlcy5Hb2luZ1VwO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgR1MuRWxldmF0b3JTdGF0ZXMuVXA6XHJcblx0XHRcdFx0aWYgKHRoaXMuYXV0b21hdGljKSB7XHJcblx0XHRcdFx0XHR0aGlzLmNvb2xkb3duLS07XHJcblx0XHRcdFx0XHRpZiAodGhpcy5jb29sZG93biA8PSAwKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuY29vbGRvd24gPSB0aGlzLm1heENvb2xkb3duO1xyXG5cdFx0XHRcdFx0XHR0aGlzLnN0YXRlID0gR1MuRWxldmF0b3JTdGF0ZXMuR29pbmdEb3duO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgR1MuRWxldmF0b3JTdGF0ZXMuR29pbmdEb3duOlxyXG5cdFx0XHRcdG9sZFkgPSB0aGlzLnBvc2l0aW9uLnk7XHJcblx0XHRcdFx0dGhpcy5wb3NpdGlvbi55IC09IHRoaXMuc3BlZWQ7XHJcblx0XHRcdFx0aWYgKHRoaXMucG9zaXRpb24ueSA8PSB0aGlzLmRvd25ZKSB7XHJcblx0XHRcdFx0XHR0aGlzLnBvc2l0aW9uLnkgPSB0aGlzLmRvd25ZO1xyXG5cdFx0XHRcdFx0dGhpcy52ZWxvY2l0eS55ID0gdGhpcy5kb3duWSAtIG9sZFk7XHJcblx0XHRcdFx0XHR0aGlzLnN0YXRlID0gR1MuRWxldmF0b3JTdGF0ZXMuRG93bjtcclxuXHRcdFx0XHRcdHRoaXMuZ3JpZC5zb3VuZE1hbmFnZXIucGxheVNvdW5kKFwiZWxldmF0b3Jfc3RvcFwiKTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy52ZWxvY2l0eS55ID0gLXRoaXMuc3BlZWQ7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBHUy5FbGV2YXRvclN0YXRlcy5Hb2luZ1VwOlxyXG5cdFx0XHRcdG9sZFkgPSB0aGlzLnBvc2l0aW9uLnk7XHJcblx0XHRcdFx0dGhpcy5wb3NpdGlvbi55ICs9IHRoaXMuc3BlZWQ7XHJcblx0XHRcdFx0aWYgKHRoaXMucG9zaXRpb24ueSA+PSB0aGlzLnVwWSkge1xyXG5cdFx0XHRcdFx0dGhpcy5wb3NpdGlvbi55ID0gdGhpcy51cFk7XHJcblx0XHRcdFx0XHR0aGlzLnZlbG9jaXR5LnkgPSB0aGlzLnVwWSAtIG9sZFk7XHJcblx0XHRcdFx0XHR0aGlzLnN0YXRlID0gR1MuRWxldmF0b3JTdGF0ZXMuVXA7XHJcblx0XHRcdFx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZChcImVsZXZhdG9yX3N0b3BcIik7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMudmVsb2NpdHkueSA9IHRoaXMuc3BlZWQ7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMudXBkYXRlQ2hhbmdlKCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlQ2hhbmdlOiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLnZlbG9jaXR5LnkgIT09IDApIHtcclxuXHRcdFx0dGhpcy51cGRhdGVCb3VuZGluZ0JveCgpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZVRyaWFuZ2xlcyh0aGlzLnZlbG9jaXR5KTtcclxuXHRcdFx0dGhpcy51cGRhdGVTZWdtZW50cyh0aGlzLnZlbG9jaXR5LnkpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZVNlY3Rvcih0aGlzLnZlbG9jaXR5LnkpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZU1lc2goKTtcclxuXHJcblx0XHRcdHRoaXMuZ3JpZC5jb2xsaXNpb25NYW5hZ2VyLmVsZXZhdG9yTW92ZSh0aGlzLCB0aGlzLnZlbG9jaXR5LnkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICghdGhpcy5zZWN0b3IudXNlVmVydGV4Q29sb3JzKSB7XHJcblx0XHRcdHRoaXMuZ2V0TGlnaHRDb2xvckZyb21TZWN0b3IodGhpcy5saWdodENvbG9yLCB0aGlzLnNlY3Rvcik7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy52aWV3Lm1lc2guY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgbWF0ZXJpYWwgPSB0aGlzLnZpZXcubWVzaC5jaGlsZHJlbltpXS5tYXRlcmlhbDtcclxuXHRcdFx0XHRpZiAobWF0ZXJpYWwuZW1pc3NpdmUgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0bWF0ZXJpYWwuZW1pc3NpdmUuY29weSh0aGlzLmxpZ2h0Q29sb3IpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVNlY3RvcjogZnVuY3Rpb24oeVZlbG9jaXR5KSB7XHJcblx0XHR0aGlzLnNlY3Rvci5mbG9vclRvcFkgKz0geVZlbG9jaXR5O1xyXG5cdFx0dGhpcy5zZWN0b3IuY2VpbEJvdHRvbVkgKz0geVZlbG9jaXR5O1xyXG5cdH0sXHJcblxyXG5cdHNldFBvc2l0aW9uVXA6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy52ZWxvY2l0eS55ID0gdGhpcy51cFkgLSB0aGlzLnBvc2l0aW9uLnk7XHJcblx0XHR0aGlzLnBvc2l0aW9uLnkgPSB0aGlzLnVwWTtcclxuXHRcdHRoaXMuc3RhdGUgPSBHUy5FbGV2YXRvclN0YXRlcy5VcDtcclxuXHJcblx0XHR0aGlzLnVwZGF0ZUNoYW5nZSgpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH0sXHJcblxyXG5cdHNldFBvc2l0aW9uRG93bjogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnZlbG9jaXR5LnkgPSB0aGlzLmRvd25ZIC0gdGhpcy5wb3NpdGlvbi55O1xyXG5cdFx0dGhpcy5wb3NpdGlvbi55ID0gdGhpcy5kb3duWTtcclxuXHRcdHRoaXMuc3RhdGUgPSBHUy5FbGV2YXRvclN0YXRlcy5Eb3duO1xyXG5cclxuXHRcdHRoaXMudXBkYXRlQ2hhbmdlKCk7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fSxcclxuXHJcblx0Z29Eb3duOiBmdW5jdGlvbihlbWl0ID0gdHJ1ZSkge1xyXG5cdFx0dGhpcy5zdGF0ZSA9IEdTLkVsZXZhdG9yU3RhdGVzLkdvaW5nRG93bjtcclxuXHRcdHRoaXMuZ3JpZC5zb3VuZE1hbmFnZXIucGxheVNvdW5kKFwiZWxldmF0b3JfbW92ZVwiKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9LFxyXG5cclxuXHRnb1VwOiBmdW5jdGlvbihlbWl0ID0gdHJ1ZSkge1xyXG5cdFx0dGhpcy5zdGF0ZSA9IEdTLkVsZXZhdG9yU3RhdGVzLkdvaW5nVXA7XHJcblx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZChcImVsZXZhdG9yX21vdmVcIik7XHJcblxyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlTWVzaDogZnVuY3Rpb24oKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmlldy5tZXNoLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHRoaXMudmlldy5tZXNoLmNoaWxkcmVuW2ldLnBvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0b25Vc2U6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT0gR1MuRWxldmF0b3JTdGF0ZXMuQ2xvc2VkKSB7XHJcblx0XHRcdHRoaXMuc3RhdGUgPSBHUy5FbGV2YXRvclN0YXRlcy5PcGVuaW5nO1xyXG5cdFx0fVxyXG5cdH0sXHJcbn0pO1xyXG4iLCJHUy5JdGVtID0gZnVuY3Rpb24oZ3JpZCwgbGF5ZXIsIHNvdXJjZU9iaikge1xyXG5cdEdTLkdyaWRPYmplY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcblx0dGhpcy5zaXplID0gbmV3IFRIUkVFLlZlY3RvcjMoNSwgNSwgNSk7XHJcblx0dGhpcy5zY2FsZSA9IG5ldyBUSFJFRS5WZWN0b3IzKDAuNCwgMC40LCAwLjQpO1xyXG5cdHRoaXMub2Zmc2V0ID0gbmV3IFRIUkVFLlZlY3RvcjMoNCwgMywgNCk7XHJcblxyXG5cdHRoaXMuYW5pbWF0aW9uID0ge1xyXG5cdFx0cm90YXRpb25TcGVlZDogMC4wMSxcclxuXHRcdGZsb2F0WURlbHRhOiAwLjI1LFxyXG5cdFx0ZmxvYXRBbmdsZTogMCxcclxuXHRcdGZsb2F0U3BlZWQ6IDIsXHJcblx0fTtcclxuXHJcblx0dGhpcy52aWV3ID0ge1xyXG5cdFx0Y29sbGlzaW9uRGF0YToge1xyXG5cdFx0XHRib3VuZGluZ0JveDogbmV3IFRIUkVFLkJveDMoKSxcclxuXHRcdH1cclxuXHR9O1xyXG59O1xyXG5cclxuR1MuSXRlbS5wcm90b3R5cGUgPSBHUy5pbmhlcml0KEdTLkdyaWRPYmplY3QsIHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuSXRlbSxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KCk7XHJcblx0XHR0aGlzLnNlY3RvciA9IHRoaXMuZ2V0U2VjdG9yKCk7XHJcblx0XHR0aGlzLmdldExpZ2h0Q29sb3JGcm9tU2VjdG9yKHRoaXMudmlldy5tZXNoLm1hdGVyaWFsLmVtaXNzaXZlLCB0aGlzLnNlY3Rvcik7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMudXBkYXRlTGlnaHRMZXZlbCgpO1xyXG5cclxuXHRcdHRoaXMudmlldy5tZXNoLnJvdGF0aW9uLnkgKz0gdGhpcy5hbmltYXRpb24ucm90YXRpb25TcGVlZDtcdFx0XHJcblx0XHR0aGlzLmFuaW1hdGlvbi5mbG9hdEFuZ2xlICs9IHRoaXMuYW5pbWF0aW9uLmZsb2F0U3BlZWQ7XHJcblxyXG5cdFx0dmFyIHBvcyA9IHRoaXMudmlldy5tZXNoLnBvc2l0aW9uO1xyXG5cdFx0cG9zLnkgPSB0aGlzLnBvc2l0aW9uLnkgKyB0aGlzLmFuaW1hdGlvbi5mbG9hdFlEZWx0YSAqIE1hdGguc2luKE1hdGguUEkgLyAxODAgKiB0aGlzLmFuaW1hdGlvbi5mbG9hdEFuZ2xlKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVMaWdodExldmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuZ2V0TGlnaHRDb2xvckZyb21TZWN0b3IodGhpcy52aWV3Lm1lc2gubWF0ZXJpYWwuZW1pc3NpdmUsIHRoaXMuc2VjdG9yKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVDb2xsaXNpb25EYXRhOiBmdW5jdGlvbihuZXdQb3MpIHtcclxuXHRcdHRoaXMucG9zaXRpb24uY29weShuZXdQb3MpO1xyXG5cdFx0dGhpcy52aWV3Lm1lc2gucG9zaXRpb24uY29weSh0aGlzLnBvc2l0aW9uKTtcclxuXHRcdHRoaXMudXBkYXRlQm91bmRpbmdCb3goKTtcclxuXHR9LFxyXG5cclxuXHRyZW1vdmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5ncmlkLnJlbW92ZUVudGl0eU1lc2godGhpcy52aWV3Lm1lc2gpO1xyXG5cdFx0R1MuR3JpZE9iamVjdC5wcm90b3R5cGUucmVtb3ZlLmNhbGwodGhpcyk7XHJcblx0fSxcclxufSk7IiwiR1MuTW9uc3RlclN0YXRlcyA9IHtcclxuXHRTY3JpcHRlZDogMCxcclxuXHRJbmFjdGl2ZTogMSxcclxuXHRBd2FrZTogMixcclxuXHRBY3RpdmU6IDMsXHJcbn07XHJcblxyXG5HUy5Nb25zdGVyID0gZnVuY3Rpb24oZ3JpZCwgbGF5ZXIsIHNvdXJjZU9iaikge1xyXG5cdEdTLkdyaWRPYmplY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcblx0dGhpcy5tb25zdGVyVHlwZSA9IEdTLk1hcEVudGl0aWVzW3NvdXJjZU9iai50eXBlXS5uYW1lO1xyXG5cdCQuZXh0ZW5kKHRydWUsIHRoaXMsIEdTLk1vbnN0ZXJzW3RoaXMubW9uc3RlclR5cGVdKTtcclxuXHJcblx0dGhpcy54QW5nbGUgPSBUSFJFRS5NYXRoLmRlZ1RvUmFkKDM2MCAtIHNvdXJjZU9iai5yb3RhdGlvbik7XHJcblx0dGhpcy5kaXJlY3Rpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHR0aGlzLnZpZXcgPSB7XHJcblx0XHRjb2xsaXNpb25EYXRhOiB7XHJcblx0XHRcdGJvdW5kaW5nQm94OiBuZXcgVEhSRUUuQm94MygpLFxyXG5cdFx0XHRib3VuZGluZ1NxdWFyZTogbmV3IFRIUkVFLkJveDIoKSxcclxuXHRcdFx0ZWxsaXBzb2lkOiB0aGlzLnNpemUsXHJcblx0XHRcdHRyaWFuZ2xlczogbnVsbCxcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHR0aGlzLmRlYWQgPSBmYWxzZTtcclxuXHR0aGlzLmhlYWx0aCA9IHRoaXMubWF4SGVhbHRoO1xyXG5cdHRoaXMuc2NhdHRlckNvb2xkb3duID0gMDtcclxuXHR0aGlzLnN0YXRlID0gR1MuTW9uc3RlclN0YXRlcy5JbmFjdGl2ZTtcclxuXHR0aGlzLm1vdmluZyA9IGZhbHNlO1xyXG5cdHRoaXMuaW5QYWluID0gZmFsc2U7XHJcblxyXG5cdHRoaXMuY2hhbmdlVGFyZ2V0TWF4Q29vbGRvd24gPSBHUy5tc1RvRnJhbWVzKDUwMCk7XHJcblx0dGhpcy5jaGFuZ2VUYXJnZXRDb29sZG93biA9IDE7XHJcblx0dGhpcy5tZWxlZUF0dGFja0Nvb2xkb3duID0gMDtcclxuXHR0aGlzLnJhbmdlZEF0dGFja0Nvb2xkb3duID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5yYW5nZWRBdHRhY2tDb29sZG93blJhbmRvbU1vZGlmaWVyKTtcclxuXHR0aGlzLnJhbmdlZEF0dGFja0NoYXJnZUNvb2xkb3duID0gMDtcclxuXHR0aGlzLmNoYXJnaW5nVXBSYW5nZWRBdHRhY2sgPSBmYWxzZTtcclxufTtcclxuXHJcbkdTLk1vbnN0ZXIucHJvdG90eXBlID0gR1MuaW5oZXJpdChHUy5HcmlkT2JqZWN0LCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLk1vbnN0ZXIsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5hbmltYXRpb25WaWV3ID0gbmV3IEdTLkFuaW1hdGlvblZpZXcodGhpcyk7XHJcblx0XHR0aGlzLmFuaW1hdGlvblZpZXcuaW5pdCgpO1xyXG5cdFx0dGhpcy5hbmltYXRpb25WaWV3LnNldExvb3AoXCJpbmFjdGl2ZVwiKTtcclxuXHJcblx0XHR0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KCk7XHJcblx0XHR0aGlzLnVwZGF0ZU1lc2goKTtcclxuXHJcblx0XHR0aGlzLnNlY3RvciA9IHRoaXMuZ2V0U2VjdG9yKCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuYW5pbWF0aW9uVmlldy51cGRhdGUoKTtcclxuXHJcblx0XHRpZiAoIXRoaXMuZGVhZCkge1xyXG5cdFx0XHRpZiAodGhpcy5zdGF0ZSA9PT0gR1MuTW9uc3RlclN0YXRlcy5Bd2FrZSkge1xyXG5cdFx0XHRcdHRoaXMudXBkYXRlU2NhbigpO1xyXG5cdFx0XHR9IGVsc2VcclxuXHRcdFx0aWYgKHRoaXMuc3RhdGUgPT09IEdTLk1vbnN0ZXJTdGF0ZXMuQWN0aXZlKSB7XHJcblx0XHRcdFx0dGhpcy51cGRhdGVNb3ZlKCk7XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLmF0dGFja1R5cGUgPT09IEdTLk1vbnN0ZXJBdHRhY2tUeXBlcy5NZWxlZSkge1xyXG5cdFx0XHRcdFx0dGhpcy51cGRhdGVBdHRhY2tNZWxlZSgpO1xyXG5cdFx0XHRcdH0gZWxzZVxyXG5cdFx0XHRcdGlmICh0aGlzLmF0dGFja1R5cGUgPT09IEdTLk1vbnN0ZXJBdHRhY2tUeXBlcy5SYW5nZWQpIHtcclxuXHRcdFx0XHRcdHRoaXMudXBkYXRlQXR0YWNrUmFuZ2VkKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy51cGRhdGVMaWdodExldmVsKCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlTGlnaHRMZXZlbDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmdldExpZ2h0Q29sb3JGcm9tU2VjdG9yKHRoaXMuYW5pbWF0aW9uVmlldy5jdXJyZW50TWVzaC5tYXRlcmlhbC5lbWlzc2l2ZSwgdGhpcy5zZWN0b3IpO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZU1lc2g6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy52aWV3Lm1lc2gucG9zaXRpb24uY29weSh0aGlzLnBvc2l0aW9uKTtcclxuXHRcdHRoaXMudmlldy5tZXNoLnBvc2l0aW9uLnkgKz0gdGhpcy5hbmltYXRpb25WaWV3LnBvc2l0aW9uWU9mZnNldDtcclxuXHRcdHRoaXMudmlldy5tZXNoLnJvdGF0aW9uLnkgPSB0aGlzLnhBbmdsZSArIHRoaXMucm90YXRpb25PZmZzZXQgKyB0aGlzLmFuaW1hdGlvblZpZXcucm90YXRpb25ZT2Zmc2V0O1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVNjYW46IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRhcmdldCA9IHRoaXMuZ3JpZC5wbGF5ZXI7XHJcblxyXG5cdFx0aWYgKHRoaXMuaW5NZWxlZVJhbmdlKHRhcmdldC5wb3NpdGlvbikpIHtcclxuXHRcdFx0dGhpcy5hY3RpdmF0ZSgpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuaXNGYWNpbmcodGFyZ2V0LnBvc2l0aW9uKSkge1xyXG5cdFx0XHR0aGlzLmFjdGl2YXRlKCk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnVwZGF0ZU1lc2goKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVNb3ZlOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0YXJnZXQgPSB0aGlzLmdyaWQucGxheWVyO1xyXG5cclxuXHRcdGlmICghdGhpcy5jaGFyZ2luZ1VwUmFuZ2VkQXR0YWNrKSB7XHJcblx0XHRcdGlmICh0aGlzLnNjYXR0ZXJDb29sZG93biA+IDApIHtcclxuXHRcdFx0XHR0aGlzLnNjYXR0ZXJDb29sZG93bi0tO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGlmICh0YXJnZXQuZGVhZCkge1xyXG5cdFx0XHRcdFx0dGhpcy5zY2F0dGVyKCk7XHJcblx0XHRcdFx0fSBlbHNlXHJcblx0XHRcdFx0aWYgKHRoaXMuYXR0YWNrVHlwZSA9PT0gR1MuTW9uc3RlckF0dGFja1R5cGVzLk1lbGVlKSB7XHJcblx0XHRcdFx0XHR0aGlzLnVwZGF0ZU1vdmVNZWxlZSgpO1xyXG5cdFx0XHRcdH0gZWxzZVxyXG5cdFx0XHRcdGlmICh0aGlzLmF0dGFja1R5cGUgPT09IEdTLk1vbnN0ZXJBdHRhY2tUeXBlcy5SYW5nZWQpIHtcclxuXHRcdFx0XHRcdHRoaXMudXBkYXRlTW92ZVJhbmdlZCgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCF0aGlzLmluUGFpbikge1xyXG5cdFx0XHRcdHRoaXMubW92ZSgpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMudXBkYXRlTWVzaCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmNhbGN1bGF0ZURpcmVjdGlvbih0YXJnZXQucG9zaXRpb24pO1xyXG5cdFx0XHR0aGlzLmNhbGN1bGF0ZVJvdGF0aW9uKCk7XHJcblx0XHRcdHRoaXMudXBkYXRlTWVzaCgpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZU1vdmVNZWxlZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgYXV4ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciB0YXJnZXRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIHRhcmdldCA9IHRoaXMuZ3JpZC5wbGF5ZXI7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5jaGFuZ2VUYXJnZXRDb29sZG93biA+IDApIHtcclxuXHRcdFx0XHR0aGlzLmNoYW5nZVRhcmdldENvb2xkb3duLS07XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLmNoYW5nZVRhcmdldENvb2xkb3duID09PSAwKSB7XHJcblx0XHRcdFx0XHR0aGlzLmNoYW5nZVRhcmdldENvb2xkb3duID0gdGhpcy5jaGFuZ2VUYXJnZXRNYXhDb29sZG93bjtcclxuXHRcdFx0XHRcdHRhcmdldFBvcy5jb3B5KHRhcmdldC5wb3NpdGlvbik7XHJcblxyXG5cdFx0XHRcdFx0dmFyIGRpc3RhbmNlVG9UYXJnZXQgPSB0aGlzLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTtcclxuXHRcdFx0XHRcdGlmIChkaXN0YW5jZVRvVGFyZ2V0ID4gMjApIHtcclxuXHRcdFx0XHRcdFx0YXV4LnNldChNYXRoLnJhbmRvbSgpIC0gMC41LCAwLCBNYXRoLnJhbmRvbSgpIC0gMC41KS5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhcigyMCk7XHJcblx0XHRcdFx0XHRcdHRhcmdldFBvcy5hZGQoYXV4KTtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHR0aGlzLmNhbGN1bGF0ZURpcmVjdGlvbih0YXJnZXRQb3MpO1xyXG5cdFx0XHRcdFx0dGhpcy5jYWxjdWxhdGVSb3RhdGlvbigpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0dXBkYXRlTW92ZVJhbmdlZDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgYXV4ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciB0YXJnZXRQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIHRhcmdldCA9IHRoaXMuZ3JpZC5wbGF5ZXI7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5jaGFuZ2VUYXJnZXRDb29sZG93biA+IDApIHtcclxuXHRcdFx0XHR0aGlzLmNoYW5nZVRhcmdldENvb2xkb3duLS07XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLmNoYW5nZVRhcmdldENvb2xkb3duID09PSAwKSB7XHJcblx0XHRcdFx0XHR0aGlzLmNoYW5nZVRhcmdldENvb2xkb3duID0gdGhpcy5jaGFuZ2VUYXJnZXRNYXhDb29sZG93bjtcclxuXHJcblx0XHRcdFx0XHR0YXJnZXRQb3MuY29weSh0YXJnZXQucG9zaXRpb24pO1xyXG5cdFx0XHRcdFx0dmFyIGRpc3RhbmNlVG9UYXJnZXQgPSB0aGlzLnBvc2l0aW9uLmRpc3RhbmNlVG8odGFyZ2V0UG9zKTtcclxuXHRcdFx0XHRcdGlmIChkaXN0YW5jZVRvVGFyZ2V0ID4gMzAgJiYgZGlzdGFuY2VUb1RhcmdldCA8IHRoaXMucHJlZmVycmVkTWF4RGlzdGFuY2UpIHtcclxuXHRcdFx0XHRcdFx0dGFyZ2V0UG9zLmNvcHkodGhpcy5wb3NpdGlvbik7XHJcblx0XHRcdFx0XHRcdGF1eC5zZXQoTWF0aC5yYW5kb20oKSAtIDAuNSwgMCwgTWF0aC5yYW5kb20oKSAtIDAuNSkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoMjApO1xyXG5cdFx0XHRcdFx0XHR0YXJnZXRQb3MuYWRkKGF1eCk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5jYWxjdWxhdGVEaXJlY3Rpb24odGFyZ2V0UG9zKTtcclxuXHRcdFx0XHRcdHRoaXMuY2FsY3VsYXRlUm90YXRpb24oKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdG1vdmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG5ld1BvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR0aGlzLm1vdmluZyA9IHRydWU7XHJcblx0XHRcdG5ld1Bvcy5jb3B5KHRoaXMuZGlyZWN0aW9uKS5tdWx0aXBseVNjYWxhcih0aGlzLnNwZWVkKS5hZGQodGhpcy5wb3NpdGlvbik7XHJcblx0XHRcdHRoaXMuZ3JpZC5jb2xsaXNpb25NYW5hZ2VyLmNvbGxpZGVNb25zdGVyKHRoaXMsIHRoaXMucG9zaXRpb24sIG5ld1Bvcyk7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHR1cGRhdGVBdHRhY2tNZWxlZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGFyZ2V0ID0gdGhpcy5ncmlkLnBsYXllcjtcclxuXHJcblx0XHRpZiAodGhpcy5tZWxlZUF0dGFja0Nvb2xkb3duID4gMCkge1xyXG5cdFx0XHR0aGlzLm1lbGVlQXR0YWNrQ29vbGRvd24tLTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGlmICghdGFyZ2V0LmRlYWQgJiYgIXRoaXMuaW5QYWluKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuaW5NZWxlZVJhbmdlKHRhcmdldC5wb3NpdGlvbikgJiYgdGhpcy5pc0ZhY2luZyh0YXJnZXQucG9zaXRpb24pICYmXHJcblx0XHRcdFx0XHR0aGlzLmdyaWQuY29sbGlzaW9uTWFuYWdlci5jaGVja01vbnN0ZXJMaW5lT2ZTaWdodCh0aGlzLCB0YXJnZXQsIHRoaXMubWVsZWVSYW5nZSkpIHtcclxuXHJcblx0XHRcdFx0XHR0aGlzLm1lbGVlQXR0YWNrKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0bWVsZWVBdHRhY2s6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRhcmdldCA9IHRoaXMuZ3JpZC5wbGF5ZXI7XHJcblxyXG5cdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQoXCJtb25zdGVyX2JpdGVcIik7XHJcblx0XHR0aGlzLm1lbGVlQXR0YWNrQ29vbGRvd24gPSB0aGlzLm1lbGVlQXR0YWNrTWF4Q29vbGRvd247XHJcblx0XHR0YXJnZXQub25IaXQoeyBkYW1hZ2U6IHRoaXMubWVsZWVEYW1hZ2UgfSk7XHJcblx0XHR0aGlzLmdyaWQuYWRkRW50aXR5SW1wYWN0UGFydGljbGVzKHRhcmdldC5wb3NpdGlvbiwgdGFyZ2V0LmJsb29kQ29sb3IpO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZUF0dGFja1JhbmdlZDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGFyZ2V0ID0gdGhpcy5ncmlkLnBsYXllcjtcclxuXHJcblx0XHRpZiAodGhpcy5yYW5nZWRBdHRhY2tDb29sZG93biA+IDApIHtcclxuXHRcdFx0dGhpcy5yYW5nZWRBdHRhY2tDb29sZG93bi0tO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0aWYgKCF0YXJnZXQuZGVhZCAmJiAhdGhpcy5pblBhaW4pIHtcclxuXHRcdFx0XHRpZiAodGhpcy5yYW5nZWRBdHRhY2tDaGFyZ2VDb29sZG93biA+IDApIHtcclxuXHRcdFx0XHRcdHRoaXMucmFuZ2VkQXR0YWNrQ2hhcmdlQ29vbGRvd24tLTtcclxuXHJcblx0XHRcdFx0XHRpZiAodGhpcy5yYW5nZWRBdHRhY2tDaGFyZ2VDb29sZG93biA9PT0gMCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLnJhbmdlZEF0dGFjaygpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gZWxzZVxyXG5cdFx0XHRcdGlmICh0aGlzLmlzRmFjaW5nKHRhcmdldC5wb3NpdGlvbikgJiZcclxuXHRcdFx0XHRcdHRoaXMuZ3JpZC5jb2xsaXNpb25NYW5hZ2VyLmNoZWNrTW9uc3RlckxpbmVPZlNpZ2h0KHRoaXMsIHRhcmdldCwgdGhpcy5yYW5nZWRBdHRhY2tSYW5nZSkpIHtcclxuXHJcblx0XHRcdFx0XHR0aGlzLmNoYXJnZVVwUmFuZ2VkQXR0YWNrKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Y2hhcmdlVXBSYW5nZWRBdHRhY2s6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQodGhpcy5yYW5nZWRBdHRhY2tDaGFyZ2VVcFNvdW5kKTtcclxuXHRcdHRoaXMubW92aW5nID0gZmFsc2U7XHJcblx0XHR0aGlzLmNoYXJnaW5nVXBSYW5nZWRBdHRhY2sgPSB0cnVlO1xyXG5cdFx0dGhpcy5yYW5nZWRBdHRhY2tDaGFyZ2VDb29sZG93biA9IHRoaXMucmFuZ2VkQXR0YWNrQ2hhcmdlTWF4Q29vbGRvd247XHJcblx0XHR0aGlzLmFuaW1hdGlvblZpZXcuc2V0TG9vcChcImF0dGFja1wiKTtcclxuXHR9LFxyXG5cclxuXHRjYW5jZWxSYW5nZWRBdHRhY2s6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jaGFyZ2luZ1VwUmFuZ2VkQXR0YWNrID0gZmFsc2U7XHJcblx0XHR0aGlzLnJhbmdlZEF0dGFja0NoYXJnZUNvb2xkb3duID0gMDtcclxuXHRcdHRoaXMuYW5pbWF0aW9uVmlldy5zZXRMb29wKFwid2Fsa1wiKTtcclxuXHR9LFxyXG5cclxuXHRyYW5nZWRBdHRhY2s6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGRpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR0aGlzLm1vdmluZyA9IGZhbHNlO1xyXG5cdFx0XHR2YXIgdGFyZ2V0ID0gdGhpcy5ncmlkLnBsYXllcjtcclxuXHJcblx0XHRcdHRoaXMuY2hhcmdpbmdVcFJhbmdlZEF0dGFjayA9IGZhbHNlO1xyXG5cdFx0XHR0aGlzLmFuaW1hdGlvblZpZXcuc2V0TG9vcChcIndhbGtcIik7XHJcblxyXG5cdFx0XHR0aGlzLnJhbmdlZEF0dGFja0Nvb2xkb3duID0gdGhpcy5yYW5nZWRBdHRhY2tNYXhDb29sZG93biArXHJcblx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5yYW5nZWRBdHRhY2tDb29sZG93blJhbmRvbU1vZGlmaWVyKTtcclxuXHJcblx0XHRcdGRpcmVjdGlvbi5jb3B5KHRhcmdldC5wb3NpdGlvbikuc3ViKHRoaXMucG9zaXRpb24pLm5vcm1hbGl6ZSgpO1xyXG5cdFx0XHR0aGlzLmdyaWQuYWRkUHJvamVjdGlsZSh0aGlzLCB0aGlzLnJhbmdlZEF0dGFja1Byb2plY3RpbGUsIHRoaXMucG9zaXRpb24uY2xvbmUoKSwgZGlyZWN0aW9uLmNsb25lKCkpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0aW5NZWxlZVJhbmdlOiBmdW5jdGlvbihwb3MpIHtcclxuXHRcdHJldHVybiB0aGlzLnBvc2l0aW9uLmRpc3RhbmNlVG8ocG9zKSA8IHRoaXMubWVsZWVSYW5nZTtcclxuXHR9LFxyXG5cclxuXHRpblJhbmdlZEF0dGFja1JhbmdlOiBmdW5jdGlvbihwb3MpIHtcclxuXHRcdHJldHVybiB0aGlzLnBvc2l0aW9uLmRpc3RhbmNlVG8ocG9zKSA8IHRoaXMucmFuZ2VkQXR0YWNrUmFuZ2U7XHJcblx0fSxcclxuXHJcblx0aXNGYWNpbmc6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHAgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIHQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGEgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGIgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwb3MpIHtcclxuXHRcdFx0dGhpcy5wb3NpdGlvbi50b1ZlY3RvcjIocCk7XHJcblx0XHRcdHBvcy50b1ZlY3RvcjIodCk7XHJcblx0XHRcdHZhciB4ID0gdGhpcy54QW5nbGUgKyB0aGlzLnJvdGF0aW9uT2Zmc2V0O1xyXG5cdFx0XHRhLnNldChNYXRoLnNpbih4IC0gTWF0aC5QSSAvIDIpLCBNYXRoLmNvcyh4IC0gTWF0aC5QSSAvIDIpKS5hZGQocCk7XHJcblx0XHRcdGIuc2V0KE1hdGguc2luKHggKyBNYXRoLlBJIC8gMiksIE1hdGguY29zKHggKyBNYXRoLlBJIC8gMikpLmFkZChwKTtcclxuXHJcblx0XHRcdHJldHVybiBHUy5NYXRoSGVscGVyLnZlYzJQb2ludFNpZGUoYSwgYiwgdCk7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRzY2F0dGVyOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0YXJnZXQgPSB0aGlzLmdyaWQucGxheWVyO1xyXG5cclxuXHRcdGlmICh0aGlzLnNjYXR0ZXJDb29sZG93biA+IDIwKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgZGlzdGFuY2UgPSB0YXJnZXQucG9zaXRpb24uZGlzdGFuY2VUbyh0aGlzLnBvc2l0aW9uKTtcclxuXHRcdGlmICh0YXJnZXQuZGVhZCB8fCBkaXN0YW5jZSA+IDEwICogKDEgKyB0aGlzLnNjYWxlLngpKSB7XHJcblx0XHRcdHRoaXMuZGlyZWN0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoTWF0aC5yYW5kb20oKSAqIDIgLSAxLCAwLCBNYXRoLnJhbmRvbSgpICogMiAtIDEpO1xyXG5cdFx0XHR0aGlzLmRpcmVjdGlvbi5ub3JtYWxpemUoKTtcclxuXHRcdFx0dGhpcy5jYWxjdWxhdGVSb3RhdGlvbigpO1xyXG5cclxuXHRcdFx0dGhpcy5zY2F0dGVyQ29vbGRvd24gPSAzMDtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRjYWxjdWxhdGVEaXJlY3Rpb246IGZ1bmN0aW9uKHRhcmdldFBvcykge1xyXG5cdFx0dGhpcy5kaXJlY3Rpb24uY29weSh0YXJnZXRQb3MpLnN1Yih0aGlzLnBvc2l0aW9uKTtcclxuXHRcdHRoaXMuZGlyZWN0aW9uLnkgPSAwO1xyXG5cdFx0dGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7XHJcblx0fSxcclxuXHJcblx0Y2FsY3VsYXRlUm90YXRpb246IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy54QW5nbGUgPSBNYXRoLmF0YW4yKHRoaXMuZGlyZWN0aW9uLngsIHRoaXMuZGlyZWN0aW9uLnopICsgTWF0aC5QSTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVDb2xsaXNpb25EYXRhOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB2ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKG5ld1Bvcykge1xyXG5cdFx0XHR2ZWxvY2l0eS5jb3B5KG5ld1Bvcykuc3ViKHRoaXMucG9zaXRpb24pO1xyXG5cdFx0XHR2YXIgY3VycmVudFNwZWVkID0gbmV3UG9zLmRpc3RhbmNlVG8odGhpcy5wb3NpdGlvbik7XHJcblxyXG5cdFx0XHR0aGlzLnBvc2l0aW9uLmNvcHkobmV3UG9zKTtcclxuXHRcdFx0dGhpcy51cGRhdGVUcmlhbmdsZXModmVsb2NpdHkpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KCk7XHJcblx0XHRcdHRoaXMudXBkYXRlTWVzaCgpO1xyXG5cclxuXHRcdFx0aWYgKGN1cnJlbnRTcGVlZCAvIHRoaXMuc3BlZWQgPCAwLjEpIHtcclxuXHRcdFx0XHR0aGlzLnNjYXR0ZXIoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5zZWN0b3IgPSB0aGlzLmdldFNlY3RvcigpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0d2FrZVVwOiBmdW5jdGlvbihzY3JpcHQpIHtcclxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBHUy5Nb25zdGVyU3RhdGVzLkF3YWtlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoc2NyaXB0ICE9PSB0cnVlICYmIHRoaXMuc3RhdGUgPT09IEdTLk1vbnN0ZXJTdGF0ZXMuU2NyaXB0ZWQpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuc3RhdGUgPSBHUy5Nb25zdGVyU3RhdGVzLkF3YWtlO1xyXG5cdFx0dGhpcy5hbmltYXRpb25WaWV3LnNldExvb3AoXCJpbmFjdGl2ZVwiKTtcclxuXHR9LFxyXG5cclxuXHRhY3RpdmF0ZTogZnVuY3Rpb24oc2NyaXB0KSB7XHJcblx0XHRpZiAodGhpcy5zdGF0ZSA9PT0gR1MuTW9uc3RlclN0YXRlcy5BY3RpdmUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChzY3JpcHQgIT09IHRydWUgJiYgdGhpcy5zdGF0ZSA9PT0gR1MuTW9uc3RlclN0YXRlcy5TY3JpcHRlZCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5zdGF0ZSA9IEdTLk1vbnN0ZXJTdGF0ZXMuQWN0aXZlO1xyXG5cdFx0dGhpcy5hbmltYXRpb25WaWV3LnNldExvb3AoXCJ3YWxrXCIpO1xyXG5cdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQodGhpcy5yb2FyU291bmQpO1xyXG5cdH0sXHJcblxyXG5cdG9uSGl0OiBmdW5jdGlvbihwcm9qZWN0aWxlKSB7XHJcblx0XHRpZiAodGhpcy5zdGF0ZSAhPT0gR1MuTW9uc3RlclN0YXRlcy5BY3RpdmUpIHtcclxuXHRcdFx0dGhpcy5hY3RpdmF0ZSh0cnVlKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoTWF0aC5yYW5kb20oKSA8PSB0aGlzLnBhaW5DaGFuY2UpIHtcclxuXHRcdFx0dGhpcy5pblBhaW4gPSB0cnVlO1xyXG5cdFx0XHR0aGlzLm1vdmluZyA9IGZhbHNlO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuYXR0YWNrVHlwZSA9PT0gR1MuTW9uc3RlckF0dGFja1R5cGVzLlJhbmdlZCkge1xyXG5cdFx0XHRcdHRoaXMuY2FuY2VsUmFuZ2VkQXR0YWNrKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuYW5pbWF0aW9uVmlldy5wYWluKCk7XHJcblx0XHRcdHRoaXMuZ3JpZC5zb3VuZE1hbmFnZXIucGxheVNvdW5kKHRoaXMucGFpblNvdW5kKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmhlYWx0aCAtPSBwcm9qZWN0aWxlLmRhbWFnZTtcclxuXHRcdGlmICh0aGlzLmhlYWx0aCA8IDApIHtcclxuXHRcdFx0dGhpcy5oZWFsdGggPSAwO1xyXG5cdFx0XHR0aGlzLm9uRGVhdGgoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRvbkRlYXRoOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMubW92aW5nID0gZmFsc2U7XHJcblxyXG5cdFx0dmFyIHRhcmdldCA9IHRoaXMuZ3JpZC5wbGF5ZXI7XHJcblx0XHR0aGlzLmNhbGN1bGF0ZURpcmVjdGlvbih0YXJnZXQucG9zaXRpb24pO1xyXG5cdFx0dGhpcy5jYWxjdWxhdGVSb3RhdGlvbigpO1xyXG5cclxuXHRcdHRoaXMuZGVhZCA9IHRydWU7XHJcblx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZCh0aGlzLmRlYXRoU291bmQpO1xyXG5cdFx0dGhpcy5ncmlkLmFpTWFuYWdlci5vbk1vbnN0ZXJEZWF0aCgpO1xyXG5cdFx0dGhpcy5hbmltYXRpb25WaWV3LnNldExvb3AoXCJkZWF0aFwiKTtcclxuXHRcdHRoaXMudXBkYXRlTWVzaCgpO1xyXG5cdH0sXHJcbn0pO1xyXG4iLCJHUy5PbmxpbmVQbGF5ZXJTdGF0ZXMgPSB7XHJcblx0U2NyaXB0ZWQ6IDAsXHJcblx0SW5hY3RpdmU6IDEsXHJcblx0QXdha2U6IDIsXHJcblx0QWN0aXZlOiAzLFxyXG59O1xyXG5cclxuR1MuT25saW5lUGxheWVyID0gZnVuY3Rpb24oZ3JpZCwgbGF5ZXIsIHNvdXJjZU9iaikge1xyXG5cdEdTLkdyaWRPYmplY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcblx0dGhpcy5tb25zdGVyVHlwZSA9IFwibm9tXCI7XHJcblx0JC5leHRlbmQodHJ1ZSwgdGhpcywgR1MuTW9uc3RlcnNbdGhpcy5tb25zdGVyVHlwZV0pO1xyXG5cclxuICB0aGlzLmlkID0gc291cmNlT2JqLmlkO1xyXG5cdHRoaXMueEFuZ2xlID0gVEhSRUUuTWF0aC5kZWdUb1JhZCgzNjAgLSBzb3VyY2VPYmoucm90YXRpb24pO1xyXG5cdHRoaXMuZGlyZWN0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0dGhpcy52aWV3ID0ge1xyXG5cdFx0Y29sbGlzaW9uRGF0YToge1xyXG5cdFx0XHRib3VuZGluZ0JveDogbmV3IFRIUkVFLkJveDMoKSxcclxuXHRcdFx0Ym91bmRpbmdTcXVhcmU6IG5ldyBUSFJFRS5Cb3gyKCksXHJcblx0XHRcdGVsbGlwc29pZDogdGhpcy5zaXplLFxyXG5cdFx0XHR0cmlhbmdsZXM6IG51bGwsXHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0dGhpcy5kZWFkID0gZmFsc2U7XHJcblx0dGhpcy5oZWFsdGggPSB0aGlzLm1heEhlYWx0aDtcclxuXHR0aGlzLnNjYXR0ZXJDb29sZG93biA9IDA7XHJcblx0dGhpcy5zdGF0ZSA9IEdTLk9ubGluZVBsYXllclN0YXRlcy5BY3RpdmU7XHJcblx0dGhpcy5tb3ZpbmcgPSBmYWxzZTtcclxuXHR0aGlzLmluUGFpbiA9IGZhbHNlO1xyXG5cclxuXHR0aGlzLmNoYW5nZVRhcmdldE1heENvb2xkb3duID0gR1MubXNUb0ZyYW1lcyg1MDApO1xyXG5cdHRoaXMuY2hhbmdlVGFyZ2V0Q29vbGRvd24gPSAxO1xyXG5cdHRoaXMubWVsZWVBdHRhY2tDb29sZG93biA9IDA7XHJcblx0dGhpcy5yYW5nZWRBdHRhY2tDb29sZG93biA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMucmFuZ2VkQXR0YWNrQ29vbGRvd25SYW5kb21Nb2RpZmllcik7XHJcblx0dGhpcy5yYW5nZWRBdHRhY2tDaGFyZ2VDb29sZG93biA9IDA7XHJcblx0dGhpcy5jaGFyZ2luZ1VwUmFuZ2VkQXR0YWNrID0gZmFsc2U7XHJcbn07XHJcblxyXG5HUy5PbmxpbmVQbGF5ZXIucHJvdG90eXBlID0gR1MuaW5oZXJpdChHUy5HcmlkT2JqZWN0LCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLk9ubGluZVBsYXllcixcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmFuaW1hdGlvblZpZXcgPSBuZXcgR1MuQW5pbWF0aW9uVmlldyh0aGlzKTtcclxuXHRcdHRoaXMuYW5pbWF0aW9uVmlldy5pbml0KCk7XHJcblx0XHR0aGlzLmFuaW1hdGlvblZpZXcuc2V0TG9vcChcIndhbGtcIik7XHJcblxyXG5cdFx0dGhpcy51cGRhdGVCb3VuZGluZ0JveCgpO1xyXG5cdFx0dGhpcy51cGRhdGVNZXNoKCk7XHJcblxyXG5cdFx0dGhpcy5zZWN0b3IgPSB0aGlzLmdldFNlY3RvcigpO1xyXG5cclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5hbmltYXRpb25WaWV3LnVwZGF0ZSgpO1xyXG5cclxuXHRcdGlmICghdGhpcy5kZWFkKSB7XHJcbiAgICAgIHRoaXMudXBkYXRlTW92ZSgpO1xyXG4gICAgfVxyXG5cclxuXHRcdFx0Ly8gaWYgKHRoaXMuc3RhdGUgPT09IEdTLk9ubGluZVBsYXllclN0YXRlcy5Bd2FrZSkge1xyXG5cdFx0XHRcdC8vIHRoaXMudXBkYXRlU2NhbigpO1xyXG5cdFx0XHQvLyB9IGVsc2UgaWYgKHRoaXMuc3RhdGUgPT09IEdTLk9ubGluZVBsYXllclN0YXRlcy5BY3RpdmUpIHtcclxuXHRcdC8vIFx0XHRpZiAodGhpcy5hdHRhY2tUeXBlID09PSBHUy5PbmxpbmVQbGF5ZXJBdHRhY2tUeXBlcy5NZWxlZSkge1xyXG5cdFx0Ly8gXHRcdFx0dGhpcy51cGRhdGVBdHRhY2tNZWxlZSgpO1xyXG5cdFx0Ly8gXHRcdH0gZWxzZVxyXG5cdFx0Ly8gXHRcdGlmICh0aGlzLmF0dGFja1R5cGUgPT09IEdTLk9ubGluZVBsYXllckF0dGFja1R5cGVzLlJhbmdlZCkge1xyXG5cdFx0Ly8gXHRcdFx0dGhpcy51cGRhdGVBdHRhY2tSYW5nZWQoKTtcclxuXHRcdC8vIFx0XHR9XHJcblx0XHRcdC8vIH1cclxuXHRcdC8vIH1cclxuXHJcblx0XHR0aGlzLnVwZGF0ZUxpZ2h0TGV2ZWwoKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVMaWdodExldmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuZ2V0TGlnaHRDb2xvckZyb21TZWN0b3IodGhpcy5hbmltYXRpb25WaWV3LmN1cnJlbnRNZXNoLm1hdGVyaWFsLmVtaXNzaXZlLCB0aGlzLnNlY3Rvcik7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlTWVzaDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnZpZXcubWVzaC5wb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pO1xyXG5cdFx0dGhpcy52aWV3Lm1lc2gucG9zaXRpb24ueSArPSB0aGlzLmFuaW1hdGlvblZpZXcucG9zaXRpb25ZT2Zmc2V0O1xyXG5cdFx0dGhpcy52aWV3Lm1lc2gucm90YXRpb24ueSA9IHRoaXMueEFuZ2xlICsgdGhpcy5yb3RhdGlvbk9mZnNldCArIHRoaXMuYW5pbWF0aW9uVmlldy5yb3RhdGlvbllPZmZzZXQ7XHJcblx0fSxcclxuXHJcblx0Ly8gdXBkYXRlU2NhbjogZnVuY3Rpb24oKSB7XHJcblx0Ly8gXHR2YXIgdGFyZ2V0ID0gdGhpcy5ncmlkLnBsYXllcjtcclxuXHJcblx0Ly8gXHRpZiAodGhpcy5pbk1lbGVlUmFuZ2UodGFyZ2V0LnBvc2l0aW9uKSkge1xyXG5cdC8vIFx0XHR0aGlzLmFjdGl2YXRlKCk7XHJcblx0Ly8gXHRcdHJldHVybjtcclxuXHQvLyBcdH1cclxuXHJcblx0Ly8gXHRpZiAodGhpcy5pc0ZhY2luZyh0YXJnZXQucG9zaXRpb24pKSB7XHJcblx0Ly8gXHRcdHRoaXMuYWN0aXZhdGUoKTtcclxuXHQvLyBcdFx0cmV0dXJuO1xyXG5cdC8vIFx0fVxyXG5cclxuXHQvLyBcdHRoaXMudXBkYXRlTWVzaCgpO1xyXG5cdC8vIH0sXHJcblxyXG4gIHVwZGF0ZU1vdmU6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKHRoaXMuaW5QYWluKSB7XHJcblx0XHRcdFx0dGhpcy51cGRhdGVNZXNoKCk7XHJcblx0XHRcdH1cclxuICAgICAgLy8gdGhpcy5tb3ZlKCk7XHJcblx0XHRcdC8vIHRoaXMuY2FsY3VsYXRlRGlyZWN0aW9uKHRhcmdldC5wb3NpdGlvbik7XHJcblx0XHRcdHRoaXMuY2FsY3VsYXRlUm90YXRpb24oKTtcclxuICB9LFxyXG5cdG9uVXBkYXRlTW92ZTogZnVuY3Rpb24odXBkYXRlQ2xpZW50KSB7XHJcbiAgICBpZiAoIXRoaXMuZGVhZCkge1xyXG4gICAgICBsZXQgb2xkUG9zID0gdGhpcy5wb3NpdGlvbi5jbG9uZSgpO1xyXG4gICAgICB0aGlzLnBvc2l0aW9uLnNldCh1cGRhdGVkQ2xpZW50LngsIHVwZGF0ZWRDbGllbnQueSwgdXBkYXRlZENsaWVudC56KTtcclxuICAgICAgbGV0IG5ld1BvcyA9IHRoaXMucG9zaXRpb24uY2xvbmUoKTtcclxuICAgICAgR0FNRS5vbmxpbmVNYW5hZ2VyLmNoZWNrWm9uZXModGhpcywgb2xkUG9zLCBuZXdQb3MpO1xyXG4gICAgICBsZXQgZGlyZWN0aW9uID0gdXBkYXRlZENsaWVudC5kaXJlY3Rpb247XHJcbiAgICAgIHRoaXMuZGlyZWN0aW9uLnNldChkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnksIGRpcmVjdGlvbi56KTtcclxuICAgICAgdGhpcy5tb3ZlKCk7XHJcbiAgICB9XHJcbiAgICAvLyB0aGlzLmNhbGN1bGF0ZURpcmVjdGlvbih0YXJnZXQucG9zaXRpb24pO1xyXG4gICAgLy8gdGhpcy5jYWxjdWxhdGVSb3RhdGlvbigpO1xyXG4gICAgLy8gdGhpcy51cGRhdGVNZXNoKCk7XHJcblx0fSxcclxuXHJcblx0b25QbGF5ZXJTaG9vdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgZGlyZWN0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XHJcblx0XHRcdC8vIHRoaXMubW92aW5nID0gZmFsc2U7XHJcblx0XHRcdC8vIHZhciB0YXJnZXQgPSB0aGlzLmdyaWQucGxheWVyO1xyXG5cclxuXHRcdFx0Ly8gdGhpcy5jaGFyZ2luZ1VwUmFuZ2VkQXR0YWNrID0gZmFsc2U7XHJcblx0XHRcdC8vIHRoaXMuYW5pbWF0aW9uVmlldy5zZXRMb29wKFwid2Fsa1wiKTtcclxuXHJcblx0XHRcdC8vIHRoaXMucmFuZ2VkQXR0YWNrQ29vbGRvd24gPSB0aGlzLnJhbmdlZEF0dGFja01heENvb2xkb3duICtcclxuXHRcdFx0XHQvLyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLnJhbmdlZEF0dGFja0Nvb2xkb3duUmFuZG9tTW9kaWZpZXIpO1xyXG5cclxuXHRcdFx0Ly8gZGlyZWN0aW9uLmNvcHkodGhpcy5wb3NpdGlvbikuc3ViKHRoaXMucG9zaXRpb24pLm5vcm1hbGl6ZSgpO1xyXG5cdFx0XHR0aGlzLmdyaWQuYWRkUHJvamVjdGlsZSh0aGlzLCBcInBpc3RvbF9ib2x0XCIsIHRoaXMucG9zaXRpb24uY2xvbmUoKSwgdGhpcy5kaXJlY3Rpb24uY2xvbmUoKSk7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRtb3ZlOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBuZXdQb3MgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dGhpcy5tb3ZpbmcgPSB0cnVlO1xyXG5cdFx0XHRuZXdQb3MuY29weSh0aGlzLmRpcmVjdGlvbikubXVsdGlwbHlTY2FsYXIodGhpcy5zcGVlZCkuYWRkKHRoaXMucG9zaXRpb24pO1xyXG5cdFx0XHR0aGlzLmdyaWQuY29sbGlzaW9uTWFuYWdlci5jb2xsaWRlT25saW5lUGxheWVyKHRoaXMsIHRoaXMucG9zaXRpb24sIG5ld1Bvcyk7XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRjaGFyZ2VVcFJhbmdlZEF0dGFjazogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZCh0aGlzLnJhbmdlZEF0dGFja0NoYXJnZVVwU291bmQpO1xyXG5cdFx0dGhpcy5tb3ZpbmcgPSBmYWxzZTtcclxuXHRcdHRoaXMuY2hhcmdpbmdVcFJhbmdlZEF0dGFjayA9IHRydWU7XHJcblx0XHR0aGlzLnJhbmdlZEF0dGFja0NoYXJnZUNvb2xkb3duID0gdGhpcy5yYW5nZWRBdHRhY2tDaGFyZ2VNYXhDb29sZG93bjtcclxuXHRcdHRoaXMuYW5pbWF0aW9uVmlldy5zZXRMb29wKFwiYXR0YWNrXCIpO1xyXG5cdH0sXHJcblxyXG5cdGNhbmNlbFJhbmdlZEF0dGFjazogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmNoYXJnaW5nVXBSYW5nZWRBdHRhY2sgPSBmYWxzZTtcclxuXHRcdHRoaXMucmFuZ2VkQXR0YWNrQ2hhcmdlQ29vbGRvd24gPSAwO1xyXG5cdFx0dGhpcy5hbmltYXRpb25WaWV3LnNldExvb3AoXCJ3YWxrXCIpO1xyXG5cdH0sXHJcblxyXG5cdGluTWVsZWVSYW5nZTogZnVuY3Rpb24ocG9zKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5wb3NpdGlvbi5kaXN0YW5jZVRvKHBvcykgPCB0aGlzLm1lbGVlUmFuZ2U7XHJcblx0fSxcclxuXHJcblx0aW5SYW5nZWRBdHRhY2tSYW5nZTogZnVuY3Rpb24ocG9zKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5wb3NpdGlvbi5kaXN0YW5jZVRvKHBvcykgPCB0aGlzLnJhbmdlZEF0dGFja1JhbmdlO1xyXG5cdH0sXHJcblxyXG5cdGlzRmFjaW5nOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciB0ID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBhID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHRcdHZhciBiID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ocG9zKSB7XHJcblx0XHRcdHRoaXMucG9zaXRpb24udG9WZWN0b3IyKHApO1xyXG5cdFx0XHRwb3MudG9WZWN0b3IyKHQpO1xyXG5cdFx0XHR2YXIgeCA9IHRoaXMueEFuZ2xlICsgdGhpcy5yb3RhdGlvbk9mZnNldDtcclxuXHRcdFx0YS5zZXQoTWF0aC5zaW4oeCAtIE1hdGguUEkgLyAyKSwgTWF0aC5jb3MoeCAtIE1hdGguUEkgLyAyKSkuYWRkKHApO1xyXG5cdFx0XHRiLnNldChNYXRoLnNpbih4ICsgTWF0aC5QSSAvIDIpLCBNYXRoLmNvcyh4ICsgTWF0aC5QSSAvIDIpKS5hZGQocCk7XHJcblxyXG5cdFx0XHRyZXR1cm4gR1MuTWF0aEhlbHBlci52ZWMyUG9pbnRTaWRlKGEsIGIsIHQpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Y2FsY3VsYXRlRGlyZWN0aW9uOiBmdW5jdGlvbih0YXJnZXRQb3MpIHtcclxuXHRcdHRoaXMuZGlyZWN0aW9uLmNvcHkodGFyZ2V0UG9zKS5zdWIodGhpcy5wb3NpdGlvbik7XHJcblx0XHR0aGlzLmRpcmVjdGlvbi55ID0gMDtcclxuXHRcdHRoaXMuZGlyZWN0aW9uLm5vcm1hbGl6ZSgpO1xyXG5cdH0sXHJcblxyXG5cdGNhbGN1bGF0ZVJvdGF0aW9uOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMueEFuZ2xlID0gTWF0aC5hdGFuMih0aGlzLmRpcmVjdGlvbi54LCB0aGlzLmRpcmVjdGlvbi56KSArIE1hdGguUEk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlQ29sbGlzaW9uRGF0YTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdmVsb2NpdHkgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihuZXdQb3MpIHtcclxuXHRcdFx0dmVsb2NpdHkuY29weShuZXdQb3MpLnN1Yih0aGlzLnBvc2l0aW9uKTtcclxuXHRcdFx0dmFyIGN1cnJlbnRTcGVlZCA9IG5ld1Bvcy5kaXN0YW5jZVRvKHRoaXMucG9zaXRpb24pO1xyXG5cclxuXHRcdFx0dGhpcy5wb3NpdGlvbi5jb3B5KG5ld1Bvcyk7XHJcblx0XHRcdHRoaXMudXBkYXRlVHJpYW5nbGVzKHZlbG9jaXR5KTtcclxuXHRcdFx0dGhpcy51cGRhdGVCb3VuZGluZ0JveCgpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZU1lc2goKTtcclxuXHJcblx0XHRcdGlmIChjdXJyZW50U3BlZWQgLyB0aGlzLnNwZWVkIDwgMC4xKSB7XHJcblx0XHRcdFx0Ly8gdGhpcy5zY2F0dGVyKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuc2VjdG9yID0gdGhpcy5nZXRTZWN0b3IoKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGFjdGl2YXRlOiBmdW5jdGlvbihzY3JpcHQpIHtcclxuXHRcdGlmICh0aGlzLnN0YXRlID09PSBHUy5PbmxpbmVQbGF5ZXJTdGF0ZXMuQWN0aXZlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoc2NyaXB0ICE9PSB0cnVlICYmIHRoaXMuc3RhdGUgPT09IEdTLk9ubGluZVBsYXllclN0YXRlcy5TY3JpcHRlZCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5zdGF0ZSA9IEdTLk9ubGluZVBsYXllclN0YXRlcy5BY3RpdmU7XHJcblx0XHR0aGlzLmFuaW1hdGlvblZpZXcuc2V0TG9vcChcIndhbGtcIik7XHJcblx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZCh0aGlzLnJvYXJTb3VuZCk7XHJcblx0fSxcclxuXHJcblx0b25IaXQ6IGZ1bmN0aW9uKHByb2plY3RpbGUpIHtcclxuXHRcdGlmICh0aGlzLnN0YXRlICE9PSBHUy5PbmxpbmVQbGF5ZXJTdGF0ZXMuQWN0aXZlKSB7XHJcblx0XHRcdHRoaXMuYWN0aXZhdGUodHJ1ZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKE1hdGgucmFuZG9tKCkgPD0gdGhpcy5wYWluQ2hhbmNlKSB7XHJcblx0XHRcdHRoaXMuaW5QYWluID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5tb3ZpbmcgPSBmYWxzZTtcclxuXHJcblx0XHRcdGlmICh0aGlzLmF0dGFja1R5cGUgPT09IEdTLk9ubGluZVBsYXllckF0dGFja1R5cGVzLlJhbmdlZCkge1xyXG5cdFx0XHRcdHRoaXMuY2FuY2VsUmFuZ2VkQXR0YWNrKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuYW5pbWF0aW9uVmlldy5wYWluKCk7XHJcblx0XHRcdHRoaXMuZ3JpZC5zb3VuZE1hbmFnZXIucGxheVNvdW5kKHRoaXMucGFpblNvdW5kKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmhlYWx0aCAtPSBwcm9qZWN0aWxlLmRhbWFnZTtcclxuXHRcdGlmICh0aGlzLmhlYWx0aCA8IDApIHtcclxuXHRcdFx0dGhpcy5oZWFsdGggPSAwO1xyXG5cdFx0XHR0aGlzLm9uRGVhdGgoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRvblJlc3Bhd246IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKCF0aGlzLmRlYWQpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cdFx0dGhpcy5tb3ZpbmcgPSB0cnVlO1xyXG5cclxuXHRcdC8vIHZhciB0YXJnZXQgPSB0aGlzLmdyaWQucGxheWVyO1xyXG5cdFx0Ly8gdGhpcy5jYWxjdWxhdGVEaXJlY3Rpb24odGFyZ2V0LnBvc2l0aW9uKTtcclxuXHRcdHRoaXMuY2FsY3VsYXRlUm90YXRpb24oKTtcclxuXHJcblx0XHR0aGlzLmRlYWQgPSBmYWxzZTtcclxuICAgIC8vIFRPRE8gcmVzcGF3biBzb3VuZFxyXG5cdFx0Ly8gdGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQodGhpcy5kZWF0aFNvdW5kKTtcclxuXHRcdHRoaXMuYW5pbWF0aW9uVmlldy5zZXRMb29wKFwid2Fsa1wiKTtcclxuXHRcdHRoaXMudXBkYXRlTWVzaCgpO1xyXG5cdH0sXHJcblxyXG5cdG9uRGVhdGg6IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKHRoaXMuZGVhZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblx0XHR0aGlzLm1vdmluZyA9IGZhbHNlO1xyXG5cclxuXHRcdC8vIHZhciB0YXJnZXQgPSB0aGlzLmdyaWQucGxheWVyO1xyXG5cdFx0Ly8gdGhpcy5jYWxjdWxhdGVEaXJlY3Rpb24odGFyZ2V0LnBvc2l0aW9uKTtcclxuXHRcdHRoaXMuY2FsY3VsYXRlUm90YXRpb24oKTtcclxuXHJcblx0XHR0aGlzLmRlYWQgPSB0cnVlO1xyXG5cdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQodGhpcy5kZWF0aFNvdW5kKTtcclxuXHRcdEdBTUUub25saW5lTWFuYWdlci5vbk9ubGluZVBsYXllckRlYXRoKHRoaXMucGxheWVySW5mbyk7XHJcblx0XHR0aGlzLmFuaW1hdGlvblZpZXcuc2V0TG9vcChcImRlYXRoXCIpO1xyXG5cdFx0dGhpcy51cGRhdGVNZXNoKCk7XHJcblx0fSxcclxuXHJcbiAgcGxheWVySW5mbzogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaWQ6IHRoaXMuaWQsXHJcbiAgICAgIHg6IHRoaXMucG9zaXRpb24ueCxcclxuICAgICAgeTogdGhpcy5wb3NpdGlvbi55LFxyXG4gICAgICB6OiB0aGlzLnBvc2l0aW9uLnosXHJcbiAgICAgIGRpcmVjdGlvbjogdGhpcy5kaXJlY3Rpb24sXHJcbiAgICB9O1xyXG4gIH0sXHJcblxyXG4gIHNldFBvc2l0aW9uOiBmdW5jdGlvbiAoeCwgeSwgeiwgZGlyZWN0aW9uKSB7XHJcbiAgICB0aGlzLnBvc2l0aW9uLnggPSB4LFxyXG4gICAgdGhpcy5wb3NpdGlvbi55ID0geVxyXG4gICAgdGhpcy5wb3NpdGlvbi56ID0gelxyXG4gICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb25cclxuICB9XHJcbn0pO1xyXG4iLCJHUy5QbGF5ZXIgPSBmdW5jdGlvbihncmlkLCBjYW1lcmEsIHBsYXllclZpZXcpIHtcclxuXHRHUy5HcmlkT2JqZWN0LmNhbGwodGhpcywgZ3JpZCk7XHJcblxyXG5cdHRoaXMuY2FtZXJhID0gY2FtZXJhO1xyXG5cdHRoaXMucGxheWVyVmlldyA9IHBsYXllclZpZXc7XHJcblx0dGhpcy5wbGF5ZXJWaWV3LnBsYXllciA9IHRoaXM7XHJcblxyXG5cdHRoaXMubW92ZVNwZWVkID0gMS41O1xyXG5cdHRoaXMuZ29kRW5hYmxlZCA9IGZhbHNlO1xyXG5cdHRoaXMuZmx5RW5hYmxlZCA9IGZhbHNlO1xyXG5cdHRoaXMubm9DbGlwRW5hYmxlZCA9IGZhbHNlO1xyXG5cdHRoaXMuaW5NZW51ID0gZmFsc2U7XHJcblxyXG5cdHRoaXMuaGVhbHRoID0gMTAwO1xyXG5cdHRoaXMuZGVhZCA9IGZhbHNlO1xyXG5cclxuXHR0aGlzLnNpemUgPSBuZXcgVEhSRUUuVmVjdG9yMygzLCA3LCAzKTtcclxuXHR0aGlzLnVzZVJhbmdlID0gdGhpcy5zaXplLnggKyAxNTtcclxuXHR0aGlzLmJsb29kQ29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoKS5zZXRSR0IoMSwgMCwgMCkuZ2V0SGV4KCk7XHJcblx0dGhpcy5kaXJlY3Rpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHR0aGlzLnZpZXcgPSB7XHJcblx0XHRjb2xsaXNpb25EYXRhOiB7XHJcblx0XHRcdGJvdW5kaW5nQm94OiBuZXcgVEhSRUUuQm94MygpLFxyXG5cdFx0XHRib3VuZGluZ1NxdWFyZTogbmV3IFRIUkVFLkJveDIoKSxcclxuXHRcdFx0ZWxsaXBzb2lkOiB0aGlzLnNpemUsXHJcblx0XHRcdHRyaWFuZ2xlczogbnVsbCxcclxuXHRcdH0sXHJcblx0fTtcclxuXHJcblx0dGhpcy5tb3ZpbmcgPSBmYWxzZTtcclxuXHR0aGlzLnNob290aW5nID0gZmFsc2U7XHJcblx0dGhpcy5jYW5Vc2UgPSB0cnVlO1xyXG5cclxuXHR0aGlzLnlTbW9vdGhpbmdNYXhDb29sZG93biA9IEdTLm1zVG9GcmFtZXMoNTAwKTtcclxuXHR0aGlzLnlTbW9vdGhpbmdDb29sZG93biA9IDA7XHJcblxyXG5cdHRoaXMuc3dhcFdlYXBvbnNPblBpY2t1cCA9IHRydWU7XHJcbn07XHJcblxyXG5HUy5QbGF5ZXIucHJvdG90eXBlID0gR1MuaW5oZXJpdChHUy5HcmlkT2JqZWN0LCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLlBsYXllcixcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5hdmFpbGFibGVXZWFwb25zID0gJC5leHRlbmQodHJ1ZSwge30sIEdTLldlYXBvbnMpO1xyXG5cdFx0T2JqZWN0LmtleXModGhpcy5hdmFpbGFibGVXZWFwb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHR0aGF0LmF2YWlsYWJsZVdlYXBvbnNba2V5XS5waWNrZWRVcCA9IGZhbHNlO1xyXG5cdFx0XHR0aGF0LmF2YWlsYWJsZVdlYXBvbnNba2V5XS5jb29sZG93blJlbWFpbmluZyA9IDA7XHJcblx0XHR9KTtcclxuXHJcblx0XHR0aGlzLmNvbXB1dGVZRnJvbVNlY3RvcigpO1xyXG5cdFx0dGhpcy5pbml0VHJpYW5nbGVzKCk7XHJcblx0XHR0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KCk7XHJcblxyXG5cdFx0dGhpcy5jb250cm9scyA9IG5ldyBHUy5GUFNDb250cm9scyh0aGlzLmNhbWVyYSk7XHJcblxyXG5cclxuXHRcdHRoaXMuY29udHJvbHMuZXllLmNvcHkodGhpcy5wb3NpdGlvbik7XHJcblx0XHR0aGlzLmNvbnRyb2xzLmZvbGxvd2luZ0V5ZS5jb3B5KHRoaXMucG9zaXRpb24pO1xyXG5cdFx0dGhpcy5jb250cm9scy5tb3ZlU3BlZWQgPSB0aGlzLm1vdmVTcGVlZDtcclxuXHRcdHRoaXMuY29udHJvbHMuaW5pdCgpO1xyXG5cclxuXHRcdHRoaXMuY29udHJvbHMub25IYW5kbGVDb2xsaXNpb25zID0gZnVuY3Rpb24ob2xkUG9zLCBuZXdQb3MpIHtcclxuXHRcdFx0aWYgKCF0aGF0Lm5vQ2xpcEVuYWJsZWQpIHtcclxuXHRcdFx0XHR0aGF0LmdyaWQuY29sbGlzaW9uTWFuYWdlci5jb2xsaWRlUGxheWVyKHRoYXQsIG9sZFBvcywgbmV3UG9zKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR0aGF0LnVwZGF0ZUNvbGxpc2lvbkRhdGEobmV3UG9zKTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHR0aGF0LmF2YWlsYWJsZVdlYXBvbnMucGlzdG9sLnBpY2tlZFVwID0gdHJ1ZTtcclxuXHRcdHRoYXQuYXZhaWxhYmxlV2VhcG9ucy5waXN0b2wuY29vbGRvd25SZW1haW5pbmcgPSAwO1xyXG5cclxuXHRcdHRoaXMud2VhcG9uID0gdGhpcy5hdmFpbGFibGVXZWFwb25zLnBpc3RvbDtcclxuXHRcdHRoaXMud2VhcG9uTmFtZSA9IFwicGlzdG9sXCI7XHJcblx0XHR0aGlzLnBsYXllclZpZXcuY2hhbmdlVG9XZWFwb25JbnN0YW50KFwicGlzdG9sXCIpO1xyXG5cdH0sXHJcblxyXG5cdGdldFBlcnNpc3RlbmNlUGFja2FnZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgcGtnID0ge1xyXG5cdFx0XHRoZWFsdGg6IHRoaXMuaGVhbHRoLFxyXG5cdFx0XHR3ZWFwb25zOiB7fSxcclxuXHRcdFx0Y3VycmVudFdlYXBvbjogdGhpcy53ZWFwb25OYW1lLFxyXG5cdFx0fTtcclxuXHJcblx0XHRmb3IgKHZhciBpIGluIHRoaXMuYXZhaWxhYmxlV2VhcG9ucykge1xyXG5cdFx0XHRwa2cud2VhcG9uc1tpXSA9IHt9O1xyXG5cdFx0XHRwa2cud2VhcG9uc1tpXS5waWNrZWRVcCA9IHRoaXMuYXZhaWxhYmxlV2VhcG9uc1tpXS5waWNrZWRVcDtcclxuXHRcdFx0cGtnLndlYXBvbnNbaV0uYW1tbyA9IHRoaXMuYXZhaWxhYmxlV2VhcG9uc1tpXS5hbW1vO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBwa2c7XHJcblx0fSxcclxuXHJcblx0YXBwbHlQZXJzaXN0ZW5jZVBhY2thZ2U6IGZ1bmN0aW9uKHBrZykge1xyXG5cdFx0dGhpcy5oZWFsdGggPSBwa2cuaGVhbHRoO1xyXG5cclxuXHRcdGZvciAodmFyIGkgaW4gdGhpcy5hdmFpbGFibGVXZWFwb25zKSB7XHJcblx0XHRcdHRoaXMuYXZhaWxhYmxlV2VhcG9uc1tpXS5waWNrZWRVcCA9IHBrZy53ZWFwb25zW2ldLnBpY2tlZFVwO1xyXG5cdFx0XHR0aGlzLmF2YWlsYWJsZVdlYXBvbnNbaV0uYW1tbyA9IHBrZy53ZWFwb25zW2ldLmFtbW87XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy53ZWFwb24gPSB0aGlzLmF2YWlsYWJsZVdlYXBvbnNbcGtnLmN1cnJlbnRXZWFwb25dO1xyXG5cdFx0dGhpcy53ZWFwb25OYW1lID0gcGtnLmN1cnJlbnRXZWFwb247XHJcblx0XHR0aGlzLnBsYXllclZpZXcuY2hhbmdlVG9XZWFwb25JbnN0YW50KHBrZy5jdXJyZW50V2VhcG9uKTtcclxuXHR9LFxyXG5cclxuXHRnaXZlQWxsOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdE9iamVjdC5rZXlzKHRoaXMuYXZhaWxhYmxlV2VhcG9ucykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcclxuXHRcdFx0dmFyIHdlYXBvbiA9IHRoYXQuYXZhaWxhYmxlV2VhcG9uc1trZXldO1xyXG5cclxuXHRcdFx0d2VhcG9uLnBpY2tlZFVwID0gdHJ1ZTtcclxuXHRcdFx0d2VhcG9uLmNvb2xkb3duUmVtYWluaW5nID0gMDtcclxuXHJcblx0XHRcdGlmICghd2VhcG9uLmluZmluaXRlQW1tbykge1xyXG5cdFx0XHRcdHdlYXBvbi5hbW1vID0gd2VhcG9uLmFtbW9NYXg7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdGZseTogZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZmx5RW5hYmxlZCA9ICF0aGlzLmZseUVuYWJsZWQ7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmZseUVuYWJsZWQgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmNvbnRyb2xzLmZseSA9IHRoaXMuZmx5RW5hYmxlZDtcclxuXHRcdGlmICh0aGlzLmZseUVuYWJsZWQpIHtcclxuXHRcdFx0dGhpcy5wbGF5ZXJWaWV3LnZpZXdCb2IuZW5hYmxlZCA9IGZhbHNlO1xyXG5cdFx0XHR0aGlzLnBsYXllclZpZXcud2VhcG9uQm9iLmVuYWJsZWQgPSBmYWxzZTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMucGxheWVyVmlldy52aWV3Qm9iLmVuYWJsZWQgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLnBsYXllclZpZXcud2VhcG9uQm9iLmVuYWJsZWQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdG5vQ2xpcDogZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMubm9DbGlwRW5hYmxlZCA9ICF0aGlzLm5vQ2xpcEVuYWJsZWQ7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLm5vQ2xpcEVuYWJsZWQgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnb2Q6IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmdvZEVuYWJsZWQgPSAhdGhpcy5nb2RFbmFibGVkO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5nb2RFbmFibGVkID0gdmFsdWU7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0aW5pdFRyaWFuZ2xlczogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdHJpYW5nbGVzID0gR1MuQ3ViZS5nZXRWZXJ0aWNlcygpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dHJpYW5nbGVzW2ldLm11bHRpcGx5KHRoaXMuc2l6ZSkuYWRkKHRoaXMucG9zaXRpb24pO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy52aWV3LmNvbGxpc2lvbkRhdGEudHJpYW5nbGVzID0gdHJpYW5nbGVzO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAoIXRoaXMuZGVhZCkge1xyXG5cdFx0XHR0aGlzLnVwZGF0ZUNvbnRyb2xzKCk7XHJcblx0XHRcdHRoaXMudXBkYXRlVXNlKCk7XHJcblx0XHRcdHRoaXMudXBkYXRlU2hvb3QoKTtcclxuXHRcdFx0dGhpcy51cGRhdGVDaGFuZ2VXZWFwb24oKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhZnRlckNvbGxpc2lvbjogZnVuY3Rpb24ocmVzdWx0KSB7XHJcblx0XHRpZiAocmVzdWx0LmNsaW1iaW5nICYmICEocmVzdWx0LmdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5FbGV2YXRvcikpIHtcclxuXHRcdFx0dGhpcy55U21vb3RoaW5nQ29vbGRvd24gPSB0aGlzLnlTbW9vdGhpbmdNYXhDb29sZG93bjtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRvbkhpdDogZnVuY3Rpb24ocHJvamVjdGlsZSkge1xyXG5cdFx0aWYgKCF0aGlzLmdvZEVuYWJsZWQpIHtcclxuXHRcdFx0dGhpcy5oZWFsdGggLT0gcHJvamVjdGlsZS5kYW1hZ2U7XHJcblx0XHRcdGlmICh0aGlzLmhlYWx0aCA8PSAwKSB7XHJcblx0XHRcdFx0dGhpcy5oZWFsdGggPSAwO1xyXG5cdFx0XHRcdHRoaXMub25EZWF0aCh7IGtpbGxJZDogcHJvamVjdGlsZS5zb3VyY2VHcmlkT2JqZWN0LmlkIH0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMucGxheWVyVmlldy5vbkRhbWFnZSgpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdG9uRGVhdGg6IGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdHRoaXMuZGVhZCA9IHRydWU7XHJcblx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZChcInBsYXllcl9kZWF0aFwiKTtcclxuXHJcblx0XHRpZiAodGhpcy53ZWFwb24gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLnBsYXllclZpZXcub25EZWF0aCgpO1xyXG5cdFx0fVxyXG5cclxuICAgIGlmIChHQU1FLm9ubGluZVBsYXkpIHtcclxuICAgICAgR0FNRS5vbmxpbmVNYW5hZ2VyLnBsYXllckRpZShkYXRhKTtcclxuICAgIH1cclxuXHR9LFxyXG5cclxuXHRvbkl0ZW1Db2xsaXNpb246IGZ1bmN0aW9uKGl0ZW0pIHtcclxuXHRcdHZhciBuYW1lID0gR1MuTWFwRW50aXRpZXNbaXRlbS5zb3VyY2VPYmoudHlwZV0ubmFtZTtcclxuXHJcblx0XHRpZiAodGhpcy5waWNrdXBXZWFwb24obmFtZSkgfHwgdGhpcy5waWNrdXBBbW1vKG5hbWUpIHx8IHRoaXMucGlja3VwTWVka2l0KG5hbWUpKSB7XHJcblx0XHRcdHRoaXMuZ3JpZC5haU1hbmFnZXIub25QbGF5ZXJJdGVtUGlja3VwKHRoaXMsIGl0ZW0pO1xyXG4gICAgICBpZiAoR0FNRS5vbmxpbmVQbGF5KSB7XHJcbiAgICAgICAgR0FNRS5vbmxpbmVNYW5hZ2VyLnBsYXllclBpY2t1cChpdGVtKTtcclxuICAgICAgfVxyXG5cdFx0XHRpdGVtLnJlbW92ZSgpO1xyXG5cdFx0XHR0aGlzLnBsYXllclZpZXcub25JdGVtUGlja3VwKCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0cGlja3VwV2VhcG9uOiBmdW5jdGlvbihuYW1lKSB7XHJcblx0XHRpZiAodGhpcy5hdmFpbGFibGVXZWFwb25zW25hbWVdICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dmFyIHdlYXBvbiA9IHRoaXMuYXZhaWxhYmxlV2VhcG9uc1tuYW1lXTtcclxuXHJcblx0XHRcdGlmICghd2VhcG9uLnBpY2tlZFVwKSB7XHJcblx0XHRcdFx0d2VhcG9uLnBpY2tlZFVwID0gdHJ1ZTtcclxuXHJcblx0XHRcdFx0R1MuRGVidWdVSS5hZGRUZW1wTGluZShcInBpY2tlZCB1cCBcIiArIHdlYXBvbi5uYW1lKTtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMud2VhcG9uID09PSB1bmRlZmluZWQgfHxcclxuXHRcdFx0XHRcdHRoaXMuc3dhcFdlYXBvbnNPblBpY2t1cCAmJiB3ZWFwb24ucG93ZXJMZXZlbCA+IHRoaXMud2VhcG9uLnBvd2VyTGV2ZWwpIHtcclxuXHRcdFx0XHRcdHRoaXMud2VhcG9uID0gd2VhcG9uO1xyXG5cdFx0XHRcdFx0dGhpcy53ZWFwb25OYW1lID0gbmFtZTtcclxuXHRcdFx0XHRcdHRoaXMucGxheWVyVmlldy5jaGFuZ2VUb1dlYXBvbihuYW1lKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHdlYXBvbi5hbW1vICs9IHdlYXBvbi5hbW1vQ2xpcDtcclxuXHRcdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQoXCJwaWNrdXBfd2VhcG9uXCIpO1xyXG5cdFx0XHRpZiAod2VhcG9uLmFtbW8gPiB3ZWFwb24uYW1tb01heCkge1xyXG5cdFx0XHRcdHdlYXBvbi5hbW1vID0gd2VhcG9uLmFtbW9NYXg7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdEdTLkRlYnVnVUkuYWRkVGVtcExpbmUoXCJwaWNrZWQgdXAgXCIgKyB3ZWFwb24uYW1tb0NsaXAgKyBcIiBcIiArIHdlYXBvbi5uYW1lICsgXCIgYW1tb1wiKTtcclxuXHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdHBpY2t1cEFtbW86IGZ1bmN0aW9uKG5hbWUpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdHZhciBvbmNlID0gZmFsc2U7XHJcblxyXG5cdFx0aWYgKG5hbWUgPT0gXCJhbW1vXCIpIHtcclxuXHRcdFx0T2JqZWN0LmtleXModGhpcy5hdmFpbGFibGVXZWFwb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHRcdHZhciB3ZWFwb24gPSB0aGF0LmF2YWlsYWJsZVdlYXBvbnNba2V5XTtcclxuXHJcblx0XHRcdFx0aWYgKCF3ZWFwb24uaW5maW5pdGVBbW1vICYmIHdlYXBvbi5hbW1vIDwgd2VhcG9uLmFtbW9NYXgpIHtcclxuXHRcdFx0XHRcdHdlYXBvbi5hbW1vICs9IHdlYXBvbi5hbW1vQ2xpcDtcclxuXHRcdFx0XHRcdGlmICh3ZWFwb24uYW1tbyA+IHdlYXBvbi5hbW1vTWF4KSB7XHJcblx0XHRcdFx0XHRcdHdlYXBvbi5hbW1vID0gd2VhcG9uLmFtbW9NYXg7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0R1MuRGVidWdVSS5hZGRUZW1wTGluZShcInBpY2tlZCB1cCBcIiArIHdlYXBvbi5hbW1vQ2xpcCArIFwiIFwiICsgd2VhcG9uLm5hbWUgKyBcIiBhbW1vXCIpO1xyXG5cdFx0XHRcdFx0b25jZSA9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdGlmIChvbmNlKSB7XHJcblx0XHRcdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQoXCJwaWNrdXBfYW1tb1wiKTtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9LFxyXG5cclxuXHRwaWNrdXBNZWRraXQ6IGZ1bmN0aW9uKG5hbWUpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdGlmIChuYW1lID09IFwibWVka2l0XCIgJiYgdGhpcy5oZWFsdGggPCAxMDApIHtcclxuXHRcdFx0R1MuRGVidWdVSS5hZGRUZW1wTGluZShcInBpY2tlZCB1cCBtZWRraXRcIik7XHJcblxyXG5cdFx0XHR0aGlzLmhlYWx0aCArPSAyNTtcclxuXHRcdFx0aWYgKHRoaXMuaGVhbHRoID4gMTAwKSB7XHJcblx0XHRcdFx0dGhpcy5oZWFsdGggPSAxMDA7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuZ3JpZC5zb3VuZE1hbmFnZXIucGxheVNvdW5kKFwicGlja3VwX2l0ZW1cIik7XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVVzZTogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5jYW5Vc2UgJiYgR1MuS2V5YmluZHMudXNlLmluVXNlKSB7XHJcbiAgICAgIEdBTUUub25saW5lTWFuYWdlci51c2VUYXJnZXQodGhpcy51c2VUYXJnZXQpO1xyXG5cdFx0XHR0aGlzLnVzZVRhcmdldC5vblVzZSgpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVNob290OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdGlmICh0aGlzLndlYXBvbiAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdGlmICh0aGlzLndlYXBvbi5jb29sZG93blJlbWFpbmluZyA+IDApIHtcclxuXHRcdFx0XHR0aGlzLndlYXBvbi5jb29sZG93blJlbWFpbmluZyAtPSAxO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIG9sZFNob290aW5nID0gdGhpcy5zaG9vdGluZztcclxuXHRcdFx0aWYgKEdTLktleWJpbmRzLnNob290LmluVXNlICYmIHRoaXMucGxheWVyVmlldy53ZWFwb25SZWFkeSkge1xyXG5cdFx0XHRcdGlmICh0aGlzLndlYXBvbi5pbmZpbml0ZUFtbW8gfHwgdGhpcy53ZWFwb24uYW1tbyA+IDApIHtcclxuXHRcdFx0XHRcdHRoaXMuc2hvb3RpbmcgPSB0cnVlO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuc2hvb3RpbmcgJiYgIW9sZFNob290aW5nKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuc2hvb3RTdGFydCgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICghdGhpcy53ZWFwb24uaW5maW5pdGVBbW1vKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMud2VhcG9uLmFtbW8gLT0gdGhpcy53ZWFwb24uYnVsbGV0c1BlclNob3Q7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5wbGF5ZXJWaWV3LnNob290KCk7XHJcblx0XHRcdFx0XHR0aGlzLnBsYXlTaG9vdFNvdW5kKCk7XHJcblx0XHRcdFx0XHR0aGlzLndlYXBvbi5jb29sZG93blJlbWFpbmluZyA9IEdTLm1zVG9GcmFtZXModGhpcy53ZWFwb24uY29vbGRvd24pO1xyXG5cclxuXHRcdFx0XHRcdHZhciBwcm9qZWN0aWxlU3RhcnQgPSB0aGlzLmdldFByb2plY3RpbGVTdGFydCgpO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMud2VhcG9uLmhpdHNjYW4pIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5ncmlkLmNvbGxpc2lvbk1hbmFnZXIuaGl0c2Nhbih0aGlzLCBwcm9qZWN0aWxlU3RhcnQsIHRoaXMud2VhcG9uLCB0aGlzLnhBbmdsZSwgdGhpcy55QW5nbGUpO1xyXG5cdFx0XHRcdFx0fSBlbHNlXHJcblx0XHRcdFx0XHRpZiAodGhpcy53ZWFwb25OYW1lID09IFwiaHlwZXJfYmxhc3RlclwiKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuZ3JpZC5hZGRQcm9qZWN0aWxlKHRoaXMsIFwiaHlwZXJfYmxhc3Rlcl9ib2x0XCIsIHByb2plY3RpbGVTdGFydCwgdGhpcy5kaXJlY3Rpb24uY2xvbmUoKSk7XHJcblx0XHRcdFx0XHR9IGVsc2VcclxuXHRcdFx0XHRcdGlmICh0aGlzLndlYXBvbk5hbWUgPT0gXCJwaXN0b2xcIikge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmdyaWQuYWRkUHJvamVjdGlsZSh0aGlzLCBcInBpc3RvbF9ib2x0XCIsIHByb2plY3RpbGVTdGFydCwgdGhpcy5kaXJlY3Rpb24uY2xvbmUoKSk7XHJcblx0XHRcdFx0XHR9XHJcbiAgICAgICAgICAvLyBIQUNLIEkgZG9uJ3QgbGlrZSB0aGlzIGhlcmVcclxuICAgICAgICAgIGlmIChHQU1FLm9ubGluZVBsYXkpIHtcclxuICAgICAgICAgICAgR0FNRS5vbmxpbmVNYW5hZ2VyLnBsYXllclNob290KCk7XHJcbiAgICAgICAgICB9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAoIXRoaXMud2VhcG9uLmluZmluaXRlQW1tbyAmJiB0aGlzLndlYXBvbi5hbW1vID09PSAwKSB7XHJcblx0XHRcdFx0XHR0aGlzLnRyeVN3YXBUb1dlYXBvbldpdGhBbW1vKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuc2hvb3RpbmcgPSBmYWxzZTtcclxuXHRcdFx0XHRpZiAoIXRoaXMuc2hvb3RpbmcgJiYgb2xkU2hvb3RpbmcpIHtcclxuXHRcdFx0XHRcdHRoaXMuc2hvb3RFbmQoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRwbGF5U2hvb3RTb3VuZDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgbmFtZTtcclxuXHRcdGlmICh0aGlzLndlYXBvbk5hbWUgPT0gXCJkb3VibGVfc2hvdGd1blwiKSB7XHJcblx0XHRcdG5hbWUgPSBcInNob3RndW5fZmlyZVwiO1xyXG5cdFx0fSBlbHNlXHJcblx0XHRpZiAodGhpcy53ZWFwb25OYW1lID09IFwiaHlwZXJfYmxhc3RlclwiKSB7XHJcblx0XHRcdG5hbWUgPSBcImh5cGVyX2JsYXN0ZXJfZmlyZVwiO1xyXG5cdFx0fSBlbHNlXHJcblx0XHRpZiAodGhpcy53ZWFwb25OYW1lID09IFwicGlzdG9sXCIpIHtcclxuXHRcdFx0bmFtZSA9IFwiaHlwZXJfYmxhc3Rlcl9maXJlXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQobmFtZSk7XHJcblx0fSxcclxuXHJcblx0c2hvb3RTdGFydDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmdyaWQuYWlNYW5hZ2VyLm9uUGxheWVyU2hvb3QodGhpcyk7XHJcblx0fSxcclxuXHJcblx0c2hvb3RFbmQ6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdHRyeVN3YXBUb1dlYXBvbldpdGhBbW1vOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBrZXlzID0gT2JqZWN0LmtleXModGhpcy5hdmFpbGFibGVXZWFwb25zKTtcclxuXHRcdGZvciAodmFyIGkgPSBrZXlzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcblx0XHRcdHZhciBuYW1lID0ga2V5c1tpXTtcclxuXHRcdFx0dmFyIHdlYXBvbiA9IHRoaXMuYXZhaWxhYmxlV2VhcG9uc1tuYW1lXTtcclxuXHRcdFx0aWYgKHdlYXBvbi5waWNrZWRVcCAmJiAod2VhcG9uLmluZmluaXRlQW1tbyB8fCB3ZWFwb24uYW1tbyA+IDApKSB7XHJcblx0XHRcdFx0dGhpcy5jaGFuZ2VUb1dlYXBvbihuYW1lKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGdldFByb2plY3RpbGVTdGFydDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgcHJvamVjdGlsZVN0YXJ0ID0gdGhpcy5wb3NpdGlvbi5jbG9uZSgpO1xyXG5cdFx0cHJvamVjdGlsZVN0YXJ0LnkgKz0gdGhpcy5jb250cm9scy5leWVPZmZzZXRZO1xyXG5cdFx0cmV0dXJuIHByb2plY3RpbGVTdGFydDtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVDaGFuZ2VXZWFwb246IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0T2JqZWN0LmtleXModGhpcy5hdmFpbGFibGVXZWFwb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHR2YXIgd2VhcG9uID0gdGhhdC5hdmFpbGFibGVXZWFwb25zW2tleV07XHJcblx0XHRcdGlmICh3ZWFwb24ucGlja2VkVXAgJiYgd2VhcG9uICE9PSB0aGF0LndlYXBvbiAmJiB0aGF0LndlYXBvbiAhPT0gdW5kZWZpbmVkICYmIHRoYXQucGxheWVyVmlldy53ZWFwb25SZWFkeSkge1xyXG5cdFx0XHRcdGlmIChHUy5LZXliaW5kc1t3ZWFwb24ubmFtZV0uaW5Vc2UpIHtcclxuXHRcdFx0XHRcdHRoYXQuY2hhbmdlVG9XZWFwb24oa2V5KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdGNoYW5nZVRvV2VhcG9uOiBmdW5jdGlvbihuYW1lKSB7XHJcblx0XHR0aGlzLndlYXBvbiA9IHRoaXMuYXZhaWxhYmxlV2VhcG9uc1tuYW1lXTtcclxuXHRcdHRoaXMud2VhcG9uTmFtZSA9IG5hbWU7XHJcblx0XHR0aGlzLnBsYXllclZpZXcuY2hhbmdlVG9XZWFwb24obmFtZSk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlQ29udHJvbHM6IGZ1bmN0aW9uKGUpIHtcclxuXHRcdGlmICh0aGlzLnlTbW9vdGhpbmdDb29sZG93biA+IDApIHtcclxuXHRcdFx0dGhpcy55U21vb3RoaW5nQ29vbGRvd24tLTtcclxuXHRcdFx0dGhpcy5jb250cm9scy55U21vb3RoaW5nID0gdHJ1ZTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuY29udHJvbHMueVNtb290aGluZyA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY29udHJvbHMudXBkYXRlKCk7XHJcblxyXG5cdFx0dGhpcy5kaXJlY3Rpb24uY29weSh0aGlzLmNvbnRyb2xzLmxvb2tOb09mZnNldCkuc3ViKHRoaXMuY29udHJvbHMuZm9sbG93aW5nRXllKS5ub3JtYWxpemUoKTtcclxuXHRcdHRoaXMueEFuZ2xlID0gdGhpcy5jb250cm9scy54QW5nbGU7XHJcblx0XHR0aGlzLnlBbmdsZSA9IHRoaXMuY29udHJvbHMueUFuZ2xlO1xyXG5cclxuXHRcdC8vIEdTLkRlYnVnVUkuc2V0U3RhdGljTGluZShcImRpcmVjdGlvblwiLCB0aGlzLmRpcmVjdGlvbi50b1N0cmluZygyKSk7XHJcblxyXG5cdFx0dGhpcy5wbGF5ZXJWaWV3LnVwZGF0ZSgpO1xyXG5cdH0sXHJcblxyXG5cdG1vdmVTdGFydDogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxuXHJcblx0bW92ZUVuZDogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlQ29sbGlzaW9uRGF0YTogZnVuY3Rpb24obmV3UG9zKSB7XHJcblx0XHR0aGlzLnBsYXllclZpZXcudXBkYXRlVGhyb3R0bGUodGhpcy5wb3NpdGlvbiwgbmV3UG9zKTtcclxuXHRcdHZhciB2ZWxvY2l0eSA9IG5ld1Bvcy5jbG9uZSgpLnN1Yih0aGlzLnBvc2l0aW9uKTtcclxuXHRcdHRoaXMudXBkYXRlVHJpYW5nbGVzKHZlbG9jaXR5KTtcclxuXHJcblx0XHR2YXIgb2xkTW92aW5nID0gdGhpcy5tb3Zpbmc7XHJcblx0XHR0aGlzLm1vdmluZyA9ICF0aGlzLnBvc2l0aW9uLmVxdWFscyhuZXdQb3MpO1xyXG5cdFx0dGhpcy5wb3NpdGlvbi5jb3B5KG5ld1Bvcyk7XHJcblx0XHR0aGlzLmNvbnRyb2xzLmV5ZS5jb3B5KG5ld1Bvcyk7XHJcblxyXG5cdFx0Ly8gR1MuRGVidWdVSS5zZXRTdGF0aWNMaW5lKFwicG9zaXRpb25cIiwgbmV3UG9zLnRvU3RyaW5nKCkpO1xyXG5cclxuXHRcdGlmICh0aGlzLm1vdmluZyAmJiAhb2xkTW92aW5nKSB7XHJcblx0XHRcdHRoaXMubW92ZVN0YXJ0KCk7XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICghdGhpcy5tb3ZpbmcgJiYgb2xkTW92aW5nKSB7XHJcblx0XHRcdHRoaXMubW92ZUVuZCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMudXBkYXRlQm91bmRpbmdCb3goKTtcclxuXHR9LFxyXG59KTtcclxuIiwiR1MuUHJvamVjdGlsZSA9IGZ1bmN0aW9uKGdyaWQsIHNvdXJjZUdyaWRPYmplY3QsIHR5cGUsIHBvc2l0aW9uLCBkaXJlY3Rpb24pIHtcclxuXHRHUy5HcmlkT2JqZWN0LmNhbGwodGhpcywgZ3JpZCk7XHJcblxyXG5cdCQuZXh0ZW5kKHRydWUsIHRoaXMsIEdTLlByb2plY3RpbGVzW3R5cGVdKTtcclxuXHJcblx0dGhpcy5zb3VyY2VHcmlkT2JqZWN0ID0gc291cmNlR3JpZE9iamVjdDtcclxuXHR0aGlzLnR5cGUgPSB0eXBlO1xyXG5cdHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcclxuXHR0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcclxuXHJcblx0dGhpcy5zdGVwcyA9IDA7XHJcblx0dGhpcy5tYXhTdGVwcyA9IE1hdGguZmxvb3IodGhpcy5tYXhEaXN0YW5jZSAvIHRoaXMuc3BlZWQpO1xyXG5cclxuXHR0aGlzLnZpZXcgPSB7XHJcblx0XHRjb2xsaXNpb25EYXRhOiB7XHJcblx0XHRcdGJvdW5kaW5nQm94OiBuZXcgVEhSRUUuQm94MygpLFxyXG5cdFx0XHRlbGxpcHNvaWQ6IHRoaXMuc2l6ZSxcclxuXHRcdH0sXHJcblx0fTtcclxufTtcclxuXHJcbkdTLlByb2plY3RpbGUucHJvdG90eXBlID0gR1MuaW5oZXJpdChHUy5HcmlkT2JqZWN0LCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLlByb2plY3RpbGUsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMudXBkYXRlQm91bmRpbmdCb3goKTtcclxuXHJcblx0XHR0aGlzLnBhcnRpY2xlID0gdGhpcy5ncmlkLnBhcnRpY2xlVmlldy5hZGRQYXJ0aWNsZSh0aGlzLnZpc3VhbFNpemUueCwgdGhpcy52aXN1YWxTaXplLnksIHRoaXMudmlzdWFsU2l6ZS56LCB0aGlzLmNvbG9yKTtcclxuXHJcblx0XHR0aGlzLnZpZXcubWVzaCA9IHRoaXMucGFydGljbGUubWVzaDtcclxuXHRcdHRoaXMudmlldy5tZXNoLmxvb2tBdCh0aGlzLmRpcmVjdGlvbik7XHJcblx0XHR0aGlzLnZpZXcubWVzaC52aXNpYmxlID0gZmFsc2U7XHJcblx0XHQvL3RoaXMudmlldy5tZXNoLnJvdGF0aW9uLnogPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSTtcclxuXHJcblx0XHR2YXIgcG9pbnRzID0gW1xyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnBvc2l0aW9uLnggLSB0aGlzLnNpemUueCwgdGhpcy5wb3NpdGlvbi56IC0gdGhpcy5zaXplLnopLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMih0aGlzLnBvc2l0aW9uLnggKyB0aGlzLnNpemUueCwgdGhpcy5wb3NpdGlvbi56ICsgdGhpcy5zaXplLnopLFxyXG5cdFx0XTtcclxuXHRcdHZhciBncmlkTG9jYXRpb24gPSB0aGlzLmdyaWQuZ2V0R3JpZExvY2F0aW9uRnJvbVBvaW50cyhwb2ludHMpO1xyXG5cdFx0dGhpcy5hc3NpZ25Ub0NlbGxzKGdyaWRMb2NhdGlvbik7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuc3RlcHMrKztcclxuXHJcblx0XHR2YXIgbmV3UG9zID0gdGhpcy5wb3NpdGlvbi5jbG9uZSgpLmFkZCh0aGlzLmRpcmVjdGlvbi5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKHRoaXMuc3BlZWQpKTtcclxuXHRcdHRoaXMuZ3JpZC5jb2xsaXNpb25NYW5hZ2VyLmNvbGxpZGVQcm9qZWN0aWxlKHRoaXMsIHRoaXMucG9zaXRpb24sIG5ld1Bvcyk7XHJcblxyXG5cdFx0dGhpcy52aWV3Lm1lc2gucG9zaXRpb24uY29weSh0aGlzLnBvc2l0aW9uKTtcclxuXHJcblx0XHRpZiAodGhpcy5yb3RhdGluZykge1xyXG5cdFx0XHR0aGlzLnZpZXcubWVzaC5yb3RhdGlvbi54ICs9IDAuMTtcclxuXHRcdFx0dGhpcy52aWV3Lm1lc2gucm90YXRpb24ueSArPSAwLjE7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuc3RlcHMgPiB0aGlzLm1heFN0ZXBzIHx8IHRoaXMubGlua2VkR3JpZENlbGxzLmxlbmd0aCA9PT0gMCkge1xyXG5cdFx0XHR0aGlzLnJlbW92ZSgpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZUNvbGxpc2lvbkRhdGE6IGZ1bmN0aW9uKG5ld1Bvcykge1xyXG5cdFx0dGhpcy5kaXN0YW5jZVRyYXZlbGxlZCArPSBuZXdQb3MuZGlzdGFuY2VUbyh0aGlzLnBvc2l0aW9uKTtcclxuXHJcblx0XHRpZiAodGhpcy5zdGVwcyA+IDEpIHtcclxuXHRcdFx0dGhpcy52aWV3Lm1lc2gudmlzaWJsZSA9IHRydWU7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5wb3NpdGlvbi5jb3B5KG5ld1Bvcyk7XHJcblx0XHR0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KCk7XHJcblx0fSxcclxuXHJcblx0b25IaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5ncmlkLnNvdW5kTWFuYWdlci5wbGF5U291bmQodGhpcy5oaXRTb3VuZCk7XHJcblx0XHR0aGlzLnJlbW92ZSgpO1xyXG5cdH0sXHJcblxyXG5cdHJlbW92ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnBhcnRpY2xlLnRvQmVSZW1vdmVkID0gdHJ1ZTtcclxuXHRcdEdTLkdyaWRPYmplY3QucHJvdG90eXBlLnJlbW92ZS5jYWxsKHRoaXMpO1xyXG5cdH0sXHJcbn0pOyIsIkdTLlNwYXduID0gZnVuY3Rpb24oZ3JpZCwgbGF5ZXIsIHNvdXJjZU9iaikge1xyXG5cdEdTLkdyaWRPYmplY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcblx0dGhpcy5zaXplID0gbmV3IFRIUkVFLlZlY3RvcjMoNSwgNSwgNSk7XHJcblx0dGhpcy5zY2FsZSA9IG5ldyBUSFJFRS5WZWN0b3IzKDAuNCwgMC40LCAwLjQpO1xyXG5cdHRoaXMub2Zmc2V0ID0gbmV3IFRIUkVFLlZlY3RvcjMoNCwgMywgNCk7XHJcblxyXG5cdHRoaXMuYW5pbWF0aW9uID0ge1xyXG5cdFx0cm90YXRpb25TcGVlZDogMC4wMSxcclxuXHRcdGZsb2F0WURlbHRhOiAwLjI1LFxyXG5cdFx0ZmxvYXRBbmdsZTogMCxcclxuXHRcdGZsb2F0U3BlZWQ6IDIsXHJcblx0fTtcclxuXHJcblx0dGhpcy52aWV3ID0ge1xyXG5cdFx0Y29sbGlzaW9uRGF0YToge1xyXG5cdFx0XHRib3VuZGluZ0JveDogbmV3IFRIUkVFLkJveDMoKSxcclxuXHRcdH1cclxuXHR9O1xyXG59O1xyXG5cclxuR1MuU3Bhd24ucHJvdG90eXBlID0gR1MuaW5oZXJpdChHUy5HcmlkT2JqZWN0LCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLlNwYXduLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMudXBkYXRlQm91bmRpbmdCb3goKTtcclxuXHRcdHRoaXMuc2VjdG9yID0gdGhpcy5nZXRTZWN0b3IoKTtcclxuXHRcdC8vIHRoaXMuZ2V0TGlnaHRDb2xvckZyb21TZWN0b3IodGhpcy52aWV3Lm1lc2gubWF0ZXJpYWwuZW1pc3NpdmUsIHRoaXMuc2VjdG9yKTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0Ly8gdGhpcy51cGRhdGVMaWdodExldmVsKCk7XHJcblxyXG5cdFx0Ly8gdGhpcy52aWV3Lm1lc2gucm90YXRpb24ueSArPSB0aGlzLmFuaW1hdGlvbi5yb3RhdGlvblNwZWVkO1xyXG5cdFx0Ly8gdGhpcy5hbmltYXRpb24uZmxvYXRBbmdsZSArPSB0aGlzLmFuaW1hdGlvbi5mbG9hdFNwZWVkO1xyXG5cclxuXHRcdHZhciBwb3MgPSB0aGlzLnZpZXcubWVzaC5wb3NpdGlvbjtcclxuXHRcdHBvcy55ID0gdGhpcy5wb3NpdGlvbi55ICsgdGhpcy5hbmltYXRpb24uZmxvYXRZRGVsdGEgKiBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogdGhpcy5hbmltYXRpb24uZmxvYXRBbmdsZSk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlTGlnaHRMZXZlbDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmdldExpZ2h0Q29sb3JGcm9tU2VjdG9yKHRoaXMudmlldy5tZXNoLm1hdGVyaWFsLmVtaXNzaXZlLCB0aGlzLnNlY3Rvcik7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlQ29sbGlzaW9uRGF0YTogZnVuY3Rpb24obmV3UG9zKSB7XHJcblx0XHR0aGlzLnBvc2l0aW9uLmNvcHkobmV3UG9zKTtcclxuXHRcdHRoaXMudmlldy5tZXNoLnBvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7XHJcblx0XHR0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KCk7XHJcblx0fSxcclxuXHJcblx0cmVtb3ZlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuZ3JpZC5yZW1vdmVFbnRpdHlNZXNoKHRoaXMudmlldy5tZXNoKTtcclxuXHRcdEdTLkdyaWRPYmplY3QucHJvdG90eXBlLnJlbW92ZS5jYWxsKHRoaXMpO1xyXG5cdH0sXHJcbn0pO1xyXG4iLCJHUy5Td2l0Y2ggPSBmdW5jdGlvbihncmlkLCBzZWcpIHtcclxuXHRHUy5HcmlkT2JqZWN0LmNhbGwodGhpcywgZ3JpZCk7XHJcblxyXG5cdHRoaXMuc2VnbWVudCA9IHNlZztcclxuXHR0aGlzLm9uID0gZmFsc2U7XHJcblx0dGhpcy51c2FibGUgPSB0cnVlO1xyXG5cclxuXHR0aGlzLnZpZXcgPSB7XHJcblx0XHRjb2xsaXNpb25EYXRhOiB7XHJcblx0XHRcdGJvdW5kaW5nQm94OiBuZXcgVEhSRUUuQm94MygpLFxyXG5cdFx0fSxcclxuXHR9O1xyXG59O1xyXG5cclxuR1MuU3dpdGNoLnByb3RvdHlwZSA9IEdTLmluaGVyaXQoR1MuR3JpZE9iamVjdCwge1xyXG5cdGNvbnN0cnVjdG9yOiBHUy5Td2l0Y2gsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdG9uVXNlOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMub24gPSB0cnVlO1xyXG5cdFx0dGhpcy52aWV3Lm1lc2gubWF0ZXJpYWwubWFwID0gdGhpcy52aWV3LnRleHR1cmVPbjtcclxuXHRcdHRoaXMudXNhYmxlID0gZmFsc2U7XHJcblx0XHR0aGlzLmdyaWQuYWlNYW5hZ2VyLm9uU3dpdGNoU3RhdGVDaGFuZ2UodGhpcyk7XHJcbiAgICBHQU1FLm9ubGluZU1hbmFnZXIuc3dpdGNoU3RhdGVDaGFuZ2UodGhpcyk7XHJcblx0XHR0aGlzLmdyaWQuc291bmRNYW5hZ2VyLnBsYXlTb3VuZChcInN3aXRjaF9vblwiKTtcclxuXHR9LFxyXG5cclxuXHRibG9jazogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLm9uID0gdHJ1ZTtcclxuXHRcdHRoaXMudmlldy5tZXNoLm1hdGVyaWFsLm1hcCA9IHRoaXMudmlldy50ZXh0dXJlT247XHJcblx0XHR0aGlzLnVzYWJsZSA9IGZhbHNlO1xyXG5cdH0sXHJcbn0pO1xyXG4iLCJHUy5UVlNjcmVlbiA9IGZ1bmN0aW9uKGdyaWQsIHNlZykge1xyXG5cdEdTLkdyaWRPYmplY3QuY2FsbCh0aGlzLCBncmlkKTtcclxuXHJcblx0dGhpcy5zZWdtZW50ID0gc2VnO1xyXG5cclxuXHR0aGlzLnZpZXcgPSB7XHJcblx0fTtcclxufTtcclxuXHJcbkdTLlRWU2NyZWVuLnByb3RvdHlwZSA9IEdTLmluaGVyaXQoR1MuR3JpZE9iamVjdCwge1xyXG5cdGNvbnN0cnVjdG9yOiBHUy5UVlNjcmVlbixcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxufSk7IiwiR1MuRm9udExvYWRlciA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMuZm9udFBhdGggPSBcIlwiO1xyXG59O1xyXG5cclxuR1MuRm9udExvYWRlci5wcm90b3R5cGUgPSB7XHJcblx0Y29uc3RydWN0b3I6IEdTLkZvbnRMb2FkZXIsXHJcblxyXG5cdGxvYWQ6IGZ1bmN0aW9uKG5hbWUsIGZpbGVuYW1lLCBjYWxsYmFjaykge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dmFyIHBhdGggPSB0aGlzLmZvbnRQYXRoICsgZmlsZW5hbWU7XHJcblxyXG5cdFx0JChcImhlYWRcIikucHJlcGVuZChbXHJcblx0XHRcdFx0XCI8c3R5bGUgdHlwZT0ndGV4dC9jc3MnPlwiLFxyXG5cdFx0XHRcdFx0XCJAZm9udC1mYWNlIHtcIixcclxuXHRcdFx0XHRcdFx0XCJmb250LWZhbWlseTogJ1wiICsgbmFtZSArIFwiJztcIixcclxuXHRcdFx0XHRcdFx0XCJzcmM6IHVybCgnXCIgKyBwYXRoICsgXCInKSBmb3JtYXQoJ3dvZmYnKTtcIixcclxuXHRcdFx0XHRcdFx0XCJmb250LXdlaWdodDogbm9ybWFsO1wiLFxyXG5cdFx0XHRcdFx0XHRcImZvbnQtc3R5bGU6IG5vcm1hbDtcIixcclxuXHRcdFx0XHRcdFwifVwiLFxyXG5cdFx0XHRcdFwiPC9zdHlsZT5cIixcclxuXHRcdFx0XS5qb2luKFwiXFxuXCIpKTtcclxuXHJcblx0XHQvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMTY4OTA2MC8zNjQwNDg5XHJcblx0XHR2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG5cdFx0bm9kZS5pbm5lckhUTUwgPSBcImdpSXRUMVdReUAhLS8jXCI7XHJcblx0XHRub2RlLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG5cdFx0bm9kZS5zdHlsZS5sZWZ0ID0gXCItMTAwMDBweFwiO1xyXG5cdFx0bm9kZS5zdHlsZS50b3AgPSBcIi0xMDAwMHB4XCI7XHJcblx0XHRub2RlLnN0eWxlLmZvbnRTaXplID0gXCIzMDBweFwiO1xyXG5cdFx0bm9kZS5zdHlsZS5mb250RmFtaWx5ID0gXCJzYW5zLXNlcmlmXCI7XHJcblx0XHRub2RlLnN0eWxlLmZvbnRWYXJpYW50ID0gXCJub3JtYWxcIjtcclxuXHRcdG5vZGUuc3R5bGUuZm9udFN0eWxlID0gXCJub3JtYWxcIjtcclxuXHRcdG5vZGUuc3R5bGUuZm9udFdlaWdodCA9IFwibm9ybWFsXCI7XHJcblx0XHRub2RlLnN0eWxlLmxldHRlclNwYWNpbmcgPSBcIjBcIjtcclxuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobm9kZSk7XHJcblxyXG5cdFx0dmFyIHdpZHRoID0gbm9kZS5vZmZzZXRXaWR0aDtcclxuXHRcdG5vZGUuc3R5bGUuZm9udEZhbWlseSA9IG5hbWU7XHJcblxyXG5cdFx0dmFyIGludGVydmFsSWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcclxuXHRcdFx0aWYgKG5vZGUub2Zmc2V0V2lkdGggIT0gd2lkdGgpIHtcclxuXHRcdFx0XHRub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7XHJcblx0XHRcdFx0Y2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcclxuXHRcdFx0XHRjYWxsYmFjaygpO1xyXG5cdFx0XHR9XHJcblx0XHR9LCA1MCk7XHJcblx0fSxcclxufTsiLCJHUy5NYXBTY3JpcHRzID0ge307XHJcblxyXG5HUy5NYXBMb2FkZXIgPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLm1hcFBhdGggPSBcImFzc2V0cy9tYXBzL1wiO1xyXG59O1xyXG5cclxuR1MuTWFwTG9hZGVyLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuTWFwTG9hZGVyLFxyXG5cclxuXHRsb2FkVGVzdE1hcDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGVzdE1hcCA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UudGVzdE1hcDtcclxuXHJcblx0XHRpZiAoIXRlc3RNYXApIHtcclxuXHRcdFx0YWxlcnQoXCJ0ZXN0TWFwIG5vdCBmb3VuZCBpbiBsb2NhbFN0b3JhZ2VcIik7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRlc3RNYXA7XHJcblx0fSxcclxuXHJcblx0bG9hZDogZnVuY3Rpb24obmFtZSwgZmlsZW5hbWUsIGNhbGxiYWNrKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR2YXIgcGF0aCA9IHRoaXMubWFwUGF0aCArIGZpbGVuYW1lO1xyXG5cclxuXHRcdCQuYWpheCh7XHJcblx0XHRcdHVybDogcGF0aCxcclxuXHRcdFx0ZGF0YVR5cGU6IFwidGV4dFwiLFxyXG5cdFx0XHRzdWNjZXNzOiBmdW5jdGlvbihqc29uU3RyKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soanNvblN0cik7XHJcblx0XHRcdH0sXHJcblx0XHRcdGVycm9yOiBmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcclxuXHRcdFx0XHR0aHJvdyBlcnJvclRocm93bjtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fSxcclxuXHJcblx0cGFyc2U6IGZ1bmN0aW9uKHRleHQpIHtcclxuXHRcdHZhciBtYXA7XHJcblxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0bWFwID0gSlNPTi5wYXJzZSh0ZXh0LCBmdW5jdGlvbihrLCB2KSB7XHJcblx0XHRcdFx0aWYgKHYgaW5zdGFuY2VvZiBPYmplY3QpIHtcclxuXHRcdFx0XHRcdGlmICh2LnggIT09IHVuZGVmaW5lZCAmJiB2LnkgIT09IHVuZGVmaW5lZCAmJiB2LnogIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjModi54LCB2LnksIHYueik7XHJcblx0XHRcdFx0XHR9IGVsc2VcclxuXHRcdFx0XHRcdGlmICh2LnggIT09IHVuZGVmaW5lZCAmJiB2LnkgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjIodi54LCB2LnkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm4gdjtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0R0FNRS5oYW5kbGVGYXRhbEVycm9yKFwiaW52YWxpZCBtYXAgLSBwYXJzZSBlcnJvclwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRtYXAuYm91bmRzID0gdGhpcy5nZXRNYXBCb3VuZHMobWFwKTtcclxuXHJcblx0XHRyZXR1cm4gbWFwO1xyXG5cdH0sXHJcblxyXG5cdGdldE1hcEJvdW5kczogZnVuY3Rpb24obWFwKSB7XHJcblx0XHR2YXIgcG9pbnRzID0gW107XHJcblxyXG5cdFx0aWYgKCFtYXAubGF5ZXJPYmplY3RzKSB7XHJcblx0XHRcdEdBTUUuaGFuZGxlRmF0YWxFcnJvcihcImludmFsaWQgbWFwIC0gbm8gbGF5ZXIgb2JqZWN0c1wiKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgc2VncyA9IG1hcC5sYXllck9iamVjdHNbR1MuTWFwTGF5ZXJzLlNlZ21lbnRdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBzZWcgPSBzZWdzW2ldO1xyXG5cdFx0XHRwb2ludHMucHVzaChuZXcgVEhSRUUuVmVjdG9yMigpLmNvcHkoc2VnLnN0YXJ0KSk7XHJcblx0XHRcdHBvaW50cy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IyKCkuY29weShzZWcuZW5kKSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHNlY3RvcnMgPSBtYXAubGF5ZXJPYmplY3RzW0dTLk1hcExheWVycy5TZWN0b3JdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWN0b3JzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBzZWN0b3IgPSBzZWN0b3JzW2ldO1xyXG5cclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBzZWN0b3IudmVydGljZXMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHR2YXIgdmVydGV4ID0gc2VjdG9yLnZlcnRpY2VzW2pdO1xyXG5cdFx0XHRcdHBvaW50cy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IyKCkuY29weSh2ZXJ0ZXgpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBib3VuZHMgPSBuZXcgVEhSRUUuQm94MigpO1xyXG5cdFx0Ym91bmRzLnNldEZyb21Qb2ludHMocG9pbnRzKTtcclxuXHRcdHJldHVybiBib3VuZHM7XHJcblx0fSxcclxufTsiLCJHUy5aaXBBc3NldExvYWRlciA9IGZ1bmN0aW9uKGF1ZGlvQ29udGV4dCkge1xyXG5cdHRoaXMuYXVkaW9Db250ZXh0ID0gYXVkaW9Db250ZXh0O1xyXG5cdHRoaXMub2JqTG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpO1xyXG5cdHRoaXMubWFwTG9hZGVyID0gbmV3IEdTLk1hcExvYWRlcigpO1xyXG5cclxuXHR0aGlzLmZvbnRMb2FkZXIgPSBuZXcgR1MuRm9udExvYWRlcigpO1xyXG5cdHRoaXMuZm9udExvYWRlci5mb250UGF0aCA9IFwiXCI7XHJcblxyXG5cdHRoaXMuemlwUGF0aCA9IFwiYXNzZXRzLnppcFwiO1xyXG5cclxuXHR0aGlzLnBhdGggPSB7fTtcclxuXHR0aGlzLnBhdGhbR1MuQXNzZXRUeXBlcy5UZXh0dXJlXSA9IFwidGV4dHVyZXMvXCI7XHJcblx0dGhpcy5wYXRoW0dTLkFzc2V0VHlwZXMuQ3ViZVRleHR1cmVdID0gXCJ0ZXh0dXJlcy9cIjtcclxuXHR0aGlzLnBhdGhbR1MuQXNzZXRUeXBlcy5VSVdpZGdldF0gPSBcInRleHR1cmVzL3dpZGdldHMvXCI7XHJcblx0dGhpcy5wYXRoW0dTLkFzc2V0VHlwZXMuTWVzaF0gPSBcIm1lc2hlcy9cIjtcclxuXHR0aGlzLnBhdGhbR1MuQXNzZXRUeXBlcy5Tb3VuZF0gPSBcInNvdW5kcy9cIjtcclxuXHR0aGlzLnBhdGhbR1MuQXNzZXRUeXBlcy5NYXBdID0gXCJtYXBzL1wiO1xyXG5cdHRoaXMucGF0aFtHUy5Bc3NldFR5cGVzLlNjcmlwdF0gPSBcInNjcmlwdHMvXCI7XHJcblx0dGhpcy5wYXRoW0dTLkFzc2V0VHlwZXMuTXVzaWNUcmFja10gPSBcIm11c2ljL1wiO1xyXG5cclxuXHR0aGlzLnJlc2V0KCk7XHJcbn07XHJcblxyXG5HUy5aaXBBc3NldExvYWRlci5wcm90b3R5cGUgPSB7XHJcblx0cmVzZXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5sb2FkZWQgPSBmYWxzZTtcclxuXHRcdHRoaXMuYXNzZXRzVG9Mb2FkID0gMDtcclxuXHRcdHRoaXMucXVldWUgPSBbXTtcclxuXHJcblx0XHR0aGlzLmFzc2V0cyA9IHt9O1xyXG5cdFx0dGhpcy5hc3NldHNbR1MuQXNzZXRUeXBlcy5UZXh0dXJlXSA9IHt9O1xyXG5cdFx0dGhpcy5hc3NldHNbR1MuQXNzZXRUeXBlcy5DdWJlVGV4dHVyZV0gPSB7fTtcclxuXHRcdHRoaXMuYXNzZXRzW0dTLkFzc2V0VHlwZXMuVUlXaWRnZXRdID0ge307XHJcblx0XHR0aGlzLmFzc2V0c1tHUy5Bc3NldFR5cGVzLk1lc2hdID0ge307XHJcblx0XHR0aGlzLmFzc2V0c1tHUy5Bc3NldFR5cGVzLlNvdW5kXSA9IHt9O1xyXG5cdFx0dGhpcy5hc3NldHNbR1MuQXNzZXRUeXBlcy5NYXBdID0ge307XHJcblx0XHR0aGlzLmFzc2V0c1tHUy5Bc3NldFR5cGVzLlNjcmlwdF0gPSB7fTtcclxuXHRcdHRoaXMuYXNzZXRzW0dTLkFzc2V0VHlwZXMuTXVzaWNUcmFja10gPSB7fTtcclxuXHR9LFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdGZvciAodmFyIGogaW4gR1MuQXNzZXRUeXBlcykge1xyXG5cdFx0XHR2YXIgYXNzZXREaWN0ID0gR1MuQXNzZXRzW0dTLkFzc2V0VHlwZXNbal1dO1xyXG5cdFx0XHRmb3IgKHZhciBpIGluIGFzc2V0RGljdCkge1xyXG5cdFx0XHRcdHRoaXMuYWRkKGksIGFzc2V0RGljdFtpXS5maWxlbmFtZSwgR1MuQXNzZXRUeXBlc1tqXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhZGQ6IGZ1bmN0aW9uKG5hbWUsIGZpbGVuYW1lLCB0eXBlKSB7XHJcblx0XHR0aGlzLnF1ZXVlLnB1c2goe1xyXG5cdFx0XHRuYW1lOiBuYW1lLFxyXG5cdFx0XHRmaWxlbmFtZTogZmlsZW5hbWUsXHJcblx0XHRcdHR5cGU6IHR5cGUsXHJcblx0XHR9KTtcclxuXHRcdHRoaXMuYXNzZXRzVG9Mb2FkKys7XHJcblx0fSxcclxuXHJcblx0bG9hZFppcDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG5cdFx0eGhyLm9wZW4oXCJHRVRcIiwgdGhpcy56aXBQYXRoLCB0cnVlKTtcclxuXHRcdHhoci5yZXNwb25zZVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XHJcblxyXG5cdFx0eGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0aWYgKHRoaXMucmVhZHlTdGF0ZSA9PSA0ICYmIHRoaXMuc3RhdHVzID09IDIwMCkge1xyXG5cdFx0XHRcdHRoYXQuemlwID0gbmV3IEpTWmlwKHRoaXMucmVzcG9uc2UpO1xyXG5cdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRoYXQuX2xvYWQoKSB9LCAwKTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHJcblx0XHR4aHIub25wcm9ncmVzcyA9IGZ1bmN0aW9uKGUpIHsgdGhhdC56aXBPblByb2dyZXNzKGUpOyB9O1xyXG5cclxuXHRcdHhoci5zZW5kKCk7XHJcblx0fSxcclxuXHJcblx0X2xvYWQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMudG90YWxBc3NldHMgPSB0aGlzLnF1ZXVlLmxlbmd0aCArIDE7XHJcblx0XHR0aGlzLmFzc2V0c1RvTG9hZCsrO1xyXG5cdFx0dGhpcy5mb250TG9hZGVyLmxvYWQoXCJodWRGb250XCIsIEdTLkN1c3RvbUZvbnRGaWxlLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0dGhhdC5jaGVja0lmRnVsbHlMb2FkZWQoKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHZhciBhc3NldDtcclxuXHRcdHdoaWxlICh0aGlzLnF1ZXVlLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0YXNzZXQgPSB0aGlzLnF1ZXVlLnBvcCgpO1xyXG5cclxuXHRcdFx0aWYgKGFzc2V0Lm5hbWUgaW4gdGhpcy5hc3NldHNbYXNzZXQudHlwZV0pIHtcclxuXHRcdFx0XHR0aGlzLmFzc2V0c1RvTG9hZC0tO1xyXG5cdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLmxvYWRBc3NldChhc3NldCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0bG9hZDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmxvYWRaaXAoKTtcclxuXHR9LFxyXG5cclxuXHRsb2FkQXNzZXQ6IGZ1bmN0aW9uKGFzc2V0KSB7XHJcblx0XHRzd2l0Y2ggKGFzc2V0LnR5cGUpIHtcclxuXHRcdFx0Y2FzZSBHUy5Bc3NldFR5cGVzLlRleHR1cmU6XHJcblx0XHRcdFx0dGhpcy5sb2FkVGV4dHVyZShhc3NldC5uYW1lLCBhc3NldC5maWxlbmFtZSk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgR1MuQXNzZXRUeXBlcy5DdWJlVGV4dHVyZTpcclxuXHRcdFx0XHR0aGlzLmxvYWRDdWJlVGV4dHVyZShhc3NldC5uYW1lLCBhc3NldC5maWxlbmFtZSk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgR1MuQXNzZXRUeXBlcy5VSVdpZGdldDpcclxuXHRcdFx0XHR0aGlzLmxvYWRVSVdpZGdldChhc3NldC5uYW1lLCBhc3NldC5maWxlbmFtZSk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgR1MuQXNzZXRUeXBlcy5NZXNoOlxyXG5cdFx0XHRcdHRoaXMubG9hZE1lc2goYXNzZXQubmFtZSwgYXNzZXQuZmlsZW5hbWUpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIEdTLkFzc2V0VHlwZXMuU291bmQ6XHJcblx0XHRcdFx0dGhpcy5sb2FkU291bmQoYXNzZXQubmFtZSwgYXNzZXQuZmlsZW5hbWUsIEdTLkFzc2V0VHlwZXMuU291bmQpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIEdTLkFzc2V0VHlwZXMuTWFwOlxyXG5cdFx0XHRcdHRoaXMubG9hZE1hcChhc3NldC5uYW1lLCBhc3NldC5maWxlbmFtZSk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgR1MuQXNzZXRUeXBlcy5TY3JpcHQ6XHJcblx0XHRcdFx0dGhpcy5sb2FkU2NyaXB0KGFzc2V0Lm5hbWUsIGFzc2V0LmZpbGVuYW1lKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSBHUy5Bc3NldFR5cGVzLk11c2ljVHJhY2s6XHJcblx0XHRcdFx0dGhpcy5sb2FkU291bmQoYXNzZXQubmFtZSwgYXNzZXQuZmlsZW5hbWUsIEdTLkFzc2V0VHlwZXMuTXVzaWNUcmFjayk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0SW1hZ2VGcm9tWmlwOiBmdW5jdGlvbihwYXRoKSB7XHJcblx0XHR2YXIgYnVmZmVyID0gdGhpcy56aXAuZmlsZShwYXRoKS5hc0FycmF5QnVmZmVyKCk7XHJcblx0XHR2YXIgYmxvYiA9IG5ldyBCbG9iKFtidWZmZXJdLCB7IHR5cGU6IFwiaW1hZ2UvcG5nXCIgfSk7XHJcblx0XHR2YXIgdXJsQ3JlYXRvciA9IHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTDtcclxuXHRcdHZhciBpbWFnZVVybCA9IHVybENyZWF0b3IuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG5cclxuXHRcdHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHRcdGltZy5zcmMgPSBpbWFnZVVybDtcclxuXHJcblx0XHRyZXR1cm4gaW1nO1xyXG5cdH0sXHJcblxyXG5cdGdldFRleHR1cmVGcm9tWmlwOiBmdW5jdGlvbihwYXRoKSB7XHJcblx0XHR2YXIgaW1nID0gdGhpcy5nZXRJbWFnZUZyb21aaXAocGF0aCk7XHJcblx0XHR2YXIgdGV4ID0gbmV3IFRIUkVFLlRleHR1cmUoaW1nKTtcclxuXHRcdHRleC5uZWVkc1VwZGF0ZSA9IHRydWU7XHJcblxyXG5cdFx0cmV0dXJuIHRleDtcclxuXHR9LFxyXG5cclxuXHRsb2FkVGV4dHVyZTogZnVuY3Rpb24obmFtZSwgZmlsZW5hbWUpIHtcclxuXHRcdHZhciBwYXRoID0gdGhpcy5wYXRoW0dTLkFzc2V0VHlwZXMuVGV4dHVyZV0gKyBmaWxlbmFtZTtcclxuXHJcblx0XHR0aGlzLmFzc2V0c1tHUy5Bc3NldFR5cGVzLlRleHR1cmVdW25hbWVdID0gdGhpcy5nZXRUZXh0dXJlRnJvbVppcChwYXRoKTtcclxuXHRcdHRoaXMuY2hlY2tJZkZ1bGx5TG9hZGVkKCk7XHJcblx0fSxcclxuXHJcblx0bG9hZEN1YmVUZXh0dXJlOiBmdW5jdGlvbihuYW1lLCBmb2xkZXIpIHtcclxuXHRcdHZhciBwYXRoID0gdGhpcy5wYXRoW0dTLkFzc2V0VHlwZXMuQ3ViZVRleHR1cmVdICsgZm9sZGVyICsgXCIvXCI7XHJcblxyXG5cdFx0dmFyIHRleCA9IG5ldyBUSFJFRS5UZXh0dXJlKCk7XHJcblx0XHR0ZXguaW1hZ2UgPSBbXTtcclxuXHRcdHRleC5mbGlwWSA9IGZhbHNlO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgR1MuQ3ViZVRleHR1cmVOYW1lcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR0ZXguaW1hZ2VbaV0gPSB0aGlzLmdldEltYWdlRnJvbVppcChwYXRoICsgR1MuQ3ViZVRleHR1cmVOYW1lc1tpXSArIEdTLkN1YmVUZXh0dXJlRXh0ZW5zaW9uKTtcclxuXHRcdH1cclxuXHJcblx0XHR0ZXgubmVlZHNVcGRhdGUgPSB0cnVlO1xyXG5cclxuXHRcdHRoaXMuYXNzZXRzW0dTLkFzc2V0VHlwZXMuQ3ViZVRleHR1cmVdW25hbWVdID0gdGV4O1xyXG5cdFx0dGhpcy5jaGVja0lmRnVsbHlMb2FkZWQoKTtcclxuXHR9LFxyXG5cclxuXHRsb2FkVUlXaWRnZXQ6IGZ1bmN0aW9uKG5hbWUsIGZpbGVuYW1lKSB7XHJcblx0XHR2YXIgcGF0aCA9IHRoaXMucGF0aFtHUy5Bc3NldFR5cGVzLlVJV2lkZ2V0XSArIGZpbGVuYW1lO1xyXG5cclxuXHRcdHRoaXMuYXNzZXRzW0dTLkFzc2V0VHlwZXMuVUlXaWRnZXRdW25hbWVdID0gdGhpcy5nZXRJbWFnZUZyb21aaXAocGF0aCk7XHJcblx0XHR0aGlzLmNoZWNrSWZGdWxseUxvYWRlZCgpO1xyXG5cdH0sXHJcblxyXG5cdGxvYWRNZXNoOiBmdW5jdGlvbihuYW1lLCBmaWxlbmFtZSkge1xyXG5cdFx0dmFyIHBhdGggPSB0aGlzLnBhdGhbR1MuQXNzZXRUeXBlcy5NZXNoXSArIGZpbGVuYW1lO1xyXG5cdFx0dmFyIHRleHQgPSB0aGlzLnppcC5maWxlKHBhdGgpLmFzVGV4dCgpO1xyXG5cclxuXHRcdHRoaXMuYXNzZXRzW0dTLkFzc2V0VHlwZXMuTWVzaF1bbmFtZV0gPSB0aGlzLm9iakxvYWRlci5wYXJzZSh0ZXh0KS5jaGlsZHJlblswXTtcclxuXHRcdHRoaXMuY2hlY2tJZkZ1bGx5TG9hZGVkKCk7XHJcblx0fSxcclxuXHJcblx0bG9hZFNvdW5kOiBmdW5jdGlvbihuYW1lLCBmaWxlbmFtZSwgYXNzZXRUeXBlKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR2YXIgcGF0aCA9IHRoaXMucGF0aFthc3NldFR5cGVdICsgZmlsZW5hbWU7XHJcblx0XHR2YXIgZW5jb2RlZEJ1ZmZlciA9IHRoaXMuemlwLmZpbGUocGF0aCkuYXNBcnJheUJ1ZmZlcigpO1xyXG5cclxuXHRcdHRoaXMuYXVkaW9Db250ZXh0LmRlY29kZUF1ZGlvRGF0YShlbmNvZGVkQnVmZmVyLCBmdW5jdGlvbihidWZmZXIpIHtcclxuXHRcdFx0dGhhdC5hc3NldHNbYXNzZXRUeXBlXVtuYW1lXSA9IGJ1ZmZlcjtcclxuXHRcdFx0dGhhdC5jaGVja0lmRnVsbHlMb2FkZWQoKTtcclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdGxvYWRNYXA6IGZ1bmN0aW9uKG5hbWUsIGZpbGVuYW1lKSB7XHJcblx0XHR2YXIgcGF0aCA9IHRoaXMucGF0aFtHUy5Bc3NldFR5cGVzLk1hcF0gKyBmaWxlbmFtZTtcclxuXHJcblx0XHRpZiAobmFtZSAhPT0gXCJ0ZXN0TWFwXCIpIHtcclxuXHRcdFx0dGhpcy5hc3NldHNbR1MuQXNzZXRUeXBlcy5NYXBdW25hbWVdID0gdGhpcy56aXAuZmlsZShwYXRoKS5hc1RleHQoKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGlmIChHQU1FLmlzVGVzdE1hcCgpKSB7XHJcblx0XHRcdFx0dGhpcy5hc3NldHNbR1MuQXNzZXRUeXBlcy5NYXBdW25hbWVdID0gdGhpcy5tYXBMb2FkZXIubG9hZFRlc3RNYXAoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY2hlY2tJZkZ1bGx5TG9hZGVkKCk7XHJcblx0fSxcclxuXHJcblx0bG9hZFNjcmlwdDogZnVuY3Rpb24obmFtZSwgZmlsZW5hbWUpIHtcclxuXHRcdHZhciBwYXRoID0gdGhpcy5wYXRoW0dTLkFzc2V0VHlwZXMuU2NyaXB0XSArIGZpbGVuYW1lO1xyXG5cclxuXHRcdHZhciBzY3JpcHRUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xyXG5cdFx0c2NyaXB0VGFnLnRleHQgPSB0aGlzLnppcC5maWxlKHBhdGgpLmFzVGV4dCgpO1xyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHRUYWcpO1xyXG5cclxuXHRcdHRoaXMuY2hlY2tJZkZ1bGx5TG9hZGVkKCk7XHJcblx0fSxcclxuXHJcblx0emlwT25Qcm9ncmVzczogZnVuY3Rpb24oZSkge1xyXG5cdFx0dmFyIHBlcmNlbnRMb2FkZWQgPSAoZS5sb2FkZWQgLyBlLnRvdGFsKSAqIDUwO1xyXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogXCJwcm9ncmVzc1wiLCBwZXJjZW50TG9hZGVkOiBwZXJjZW50TG9hZGVkLnRvRml4ZWQoMCkgfSk7XHJcblx0fSxcclxuXHJcblx0Y2hlY2tJZkZ1bGx5TG9hZGVkOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuYXNzZXRzVG9Mb2FkLS07XHJcblxyXG5cdFx0dmFyIHBlcmNlbnRMb2FkZWQgPSAoMC41ICsgKCh0aGlzLnRvdGFsQXNzZXRzIC0gdGhpcy5hc3NldHNUb0xvYWQpIC8gdGhpcy50b3RhbEFzc2V0cykgKiAwLjUpICogMTAwO1xyXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogXCJwcm9ncmVzc1wiLCBwZXJjZW50TG9hZGVkOiBwZXJjZW50TG9hZGVkLnRvRml4ZWQoMCkgfSk7XHJcblxyXG5cdFx0aWYgKHRoaXMuYXNzZXRzVG9Mb2FkID09PSAwKSB7XHJcblx0XHRcdHRoaXMubG9hZGVkID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogXCJsb2FkXCIsIHBlcmNlbnRMb2FkZWQ6IDEwMCwgYXNzZXRzOiB0aGlzLmFzc2V0cyB9KTtcclxuXHRcdH1cclxuXHR9LFxyXG59O1xyXG5cclxuVEhSRUUuRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZS5hcHBseShHUy5aaXBBc3NldExvYWRlci5wcm90b3R5cGUpOyIsIkdTLkdyaWRGYWN0b3J5ID0gZnVuY3Rpb24odmlld0ZhY3RvcnksIHNvdW5kTWFuYWdlciwgcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEpIHtcclxuXHR0aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcblx0dGhpcy5zb3VuZE1hbmFnZXIgPSBzb3VuZE1hbmFnZXI7XHJcblx0dGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG5cdHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuXHR0aGlzLmNhbWVyYSA9IGNhbWVyYTtcclxuXHJcblx0dGhpcy5ncmlkQ2VsbFNpemUgPSA4O1xyXG59O1xyXG5cclxuR1MuR3JpZEZhY3RvcnkucHJvdG90eXBlID0ge1xyXG5cdGNvbnN0cnVjdG9yOiBHUy5HcmlkRmFjdG9yeSxcclxuXHJcblx0Z2V0R3JpZDogZnVuY3Rpb24obWFwKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dmFyIGhDZWxscyA9IE1hdGguY2VpbCgobWFwLmJvdW5kcy5tYXgueCAtIG1hcC5ib3VuZHMubWluLngpIC8gdGhpcy5ncmlkQ2VsbFNpemUpO1xyXG5cdFx0dmFyIHZDZWxscyA9IE1hdGguY2VpbCgobWFwLmJvdW5kcy5tYXgueSAtIG1hcC5ib3VuZHMubWluLnkpIC8gdGhpcy5ncmlkQ2VsbFNpemUpO1xyXG5cclxuXHRcdHZhciBjZWxscyA9IFtdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB2Q2VsbHM7IGkrKykge1xyXG5cdFx0XHRjZWxsc1tpXSA9IFtdO1xyXG5cdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGhDZWxsczsgaisrKSB7XHJcblx0XHRcdFx0dmFyIG1pbiA9IG5ldyBUSFJFRS5WZWN0b3IyKGogKiB0aGlzLmdyaWRDZWxsU2l6ZSwgaSAqIHRoaXMuZ3JpZENlbGxTaXplKS5hZGQobWFwLmJvdW5kcy5taW4pO1xyXG5cdFx0XHRcdHZhciBtYXggPSBuZXcgVEhSRUUuVmVjdG9yMigoaiArIDEpICogdGhpcy5ncmlkQ2VsbFNpemUsIChpICsgMSkgKiB0aGlzLmdyaWRDZWxsU2l6ZSkuYWRkKG1hcC5ib3VuZHMubWluKTtcclxuXHRcdFx0XHR2YXIgYm94MiA9IG5ldyBUSFJFRS5Cb3gyKG1pbiwgbWF4KTtcclxuXHRcdFx0XHRjZWxsc1tpXVtqXSA9IHsgYm94MjogYm94MiwgY2hpbGRyZW46IFtdLCB4OiBqLCB5OiBpIH07XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgZ3JpZCA9IG5ldyBHUy5HcmlkKHRoaXMucmVuZGVyZXIsIHRoaXMuc2NlbmUpO1xyXG4gICAgLy8gSEFDSyB2aWV3RmFjdG9yeVxyXG4gICAgZ3JpZC52aWV3RmFjdG9yeSA9IHRoaXMudmlld0ZhY3Rvcnk7XHJcblx0XHRncmlkLmNsZWFyU2NlbmUoKTtcclxuXHRcdGdyaWQuY2VsbFNpemUgPSB0aGlzLmdyaWRDZWxsU2l6ZTtcclxuXHRcdGdyaWQuY2VsbHMgPSBjZWxscztcclxuXHRcdGdyaWQud2lkdGggPSBoQ2VsbHM7XHJcblx0XHRncmlkLmhlaWdodCA9IHZDZWxscztcclxuXHRcdGdyaWQubWFwID0gbWFwO1xyXG5cdFx0Z3JpZC5yZWdpb25JbmZvID0gdGhpcy5nZXRSZWdpb25zKG1hcCk7XHJcblx0XHRncmlkLnNvdW5kTWFuYWdlciA9IHRoaXMuc291bmRNYW5hZ2VyO1xyXG5cclxuXHRcdHRoaXMuYXNzaWduTWFwRW50aXRpZXNUb0dyaWQoZ3JpZCk7XHJcblx0XHR0aGlzLmFkZFBsYXllclRvR3JpZChncmlkKTtcclxuICAgIGdyaWQucmVzcGF3biA9ICgpID0+IHtcclxuICAgICAgbGV0IHBvc2l0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuICAgICAgdGhpcy5hc3NpZ25Qb3NpdGlvblRvUmFuZG9tU3Bhd24ocG9zaXRpb24sIGdyaWQpO1xyXG4gICAgICBncmlkLnBsYXllci5wb3NpdGlvbiA9IHBvc2l0aW9uO1xyXG4gICAgICBncmlkLnBsYXllci5oZWFsdGggPSAxMDA7XHJcbiAgICAgIGdyaWQucGxheWVyLnBsYXllclZpZXcuc2hvd1dlYXBvbihcInBpc3RvbFwiKTtcclxuICAgICAgbGV0IGdyaWRMb2MgPSB7fTtcclxuICAgICAgZ3JpZExvYy54ID0gcG9zaXRpb24ueDtcclxuICAgICAgZ3JpZExvYy55ID0gcG9zaXRpb24ueTtcclxuICAgICAgdmFyIGdyaWRMb2NhdGlvbiA9IGdyaWQuZ2V0R3JpZExvY2F0aW9uRnJvbVBvaW50cyhbZ3JpZExvY10pO1xyXG4gICAgICBncmlkLnBsYXllci5hc3NpZ25Ub0NlbGxzKGdyaWRMb2NhdGlvbik7XHJcbiAgICAgIGdyaWQucGxheWVyLmRlYWQgPSBmYWxzZTtcclxuICAgICAgLy8gdGhpcy5hZGRQbGF5ZXJUb0dyaWQoZ3JpZCk7XHJcbiAgICAgIC8vIGdyaWQucGxheWVyLmluaXQoKTtcclxuICAgICAgLy8gZ3JpZC5wbGF5ZXIucGxheWVyVmlldy5saWdodGluZ1ZpZXcgPSBncmlkLmxpZ2h0aW5nVmlldztcclxuICAgICAgLy8gR0FNRS51aU1hbmFnZXIucmVpbml0KCk7XHJcbiAgICAgIEdBTUUub25saW5lTWFuYWdlci5wbGF5ZXJSZXNwYXduKCk7XHJcbiAgICB9O1xyXG5cclxuXHRcdGdyaWQuaW5pdFNreWJveCh0aGlzLnZpZXdGYWN0b3J5LmdldFNreWJveE1lc2goKSk7XHJcblx0XHRncmlkLmluaXQoKTtcclxuXHJcblx0XHRyZXR1cm4gZ3JpZDtcclxuXHR9LFxyXG5cclxuXHRnZXRSZWdpb25zOiBmdW5jdGlvbihtYXApIHtcclxuXHRcdHZhciBzZWN0b3JzID0gbWFwLmxheWVyT2JqZWN0c1tHUy5NYXBMYXllcnMuU2VjdG9yXTtcclxuXHRcdHZhciBzZWN0b3JMaW5rcyA9IG1hcC5zZWN0b3JMaW5rcztcclxuXHRcdGlmIChzZWN0b3JMaW5rcyA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdEdBTUUuaGFuZGxlRmF0YWxFcnJvcihcImludmFsaWQgbWFwIC0gc2VjdG9yIGxpbmtzIG5vdCBmb3VuZFwiKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciByZWdpb25IZWxwZXIgPSBuZXcgR1MuUmVnaW9uSGVscGVyKCk7XHJcblx0XHRyZXR1cm4gcmVnaW9uSGVscGVyLmdldFJlZ2lvbnMoc2VjdG9ycywgc2VjdG9yTGlua3MpO1xyXG5cdH0sXHJcblxyXG4gIGdldFJhbmRvbVNwYXduUG9pbnQ6IGZ1bmN0aW9uIChncmlkKSB7XHJcbiAgICBsZXQgZW50aXRpZXMgPSBncmlkLm1hcC5sYXllck9iamVjdHNbR1MuTWFwTGF5ZXJzLkVudGl0eV0uZmlsdGVyKChlKSA9PiB7IHJldHVybiBlLnR5cGUgPT09IFwiU1wifSlcclxuICAgIGxldCByYW5kb21TcGF3biA9IGVudGl0aWVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGVudGl0aWVzLmxlbmd0aCldO1xyXG4gICAgcmV0dXJuIHJhbmRvbVNwYXduO1xyXG4gIH0sXHJcblxyXG4gIGFzc2lnblBvc2l0aW9uVG9SYW5kb21TcGF3bihwb3NpdGlvbiwgZ3JpZCkge1xyXG4gICAgbGV0IHJhbmRvbVNwYXduID0gdGhpcy5nZXRSYW5kb21TcGF3blBvaW50KGdyaWQpO1xyXG4gICAgcG9zaXRpb24ueCA9IHJhbmRvbVNwYXduLnBvcy54O1xyXG4gICAgLy8gcG9zaXRpb24ueSA9IDA7XHJcbiAgICBwb3NpdGlvbi55ID0gcmFuZG9tU3Bhd24ueSArIDMuNTtcclxuICAgIHBvc2l0aW9uLnogPSByYW5kb21TcGF3bi5wb3MueSAtIDAuMDAwMTtcclxuICB9LFxyXG5cclxuXHRhZGRQbGF5ZXJUb0dyaWQ6IGZ1bmN0aW9uKGdyaWQpIHtcclxuXHRcdHZhciBwbGF5ZXJWaWV3ID0gdGhpcy52aWV3RmFjdG9yeS5nZXRQbGF5ZXJWaWV3KCk7XHJcblx0XHRncmlkLnBsYXllciA9IG5ldyBHUy5QbGF5ZXIoZ3JpZCwgdGhpcy5jYW1lcmEsIHBsYXllclZpZXcpO1xyXG5cclxuXHRcdHZhciBwb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcbiAgICBsZXQgZ3JpZExvYyA9IHt9O1xyXG4gICAgaWYgKEdBTUUub25saW5lUGxheSkge1xyXG4gICAgICB0aGlzLmFzc2lnblBvc2l0aW9uVG9SYW5kb21TcGF3bihwb3NpdGlvbiwgZ3JpZCk7XHJcbiAgICAgIGdyaWRMb2MueCA9IHBvc2l0aW9uLng7XHJcbiAgICAgIGdyaWRMb2MueSA9IHBvc2l0aW9uLnk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBncmlkTG9jID0gZ3JpZC5tYXAucGxheWVyU3RhcnRQb3NpdGlvbjtcclxuICAgICAgcG9zaXRpb24ueCA9IGdyaWRMb2MueDtcclxuICAgICAgcG9zaXRpb24ueSA9IDA7XHJcbiAgICAgIHBvc2l0aW9uLnogPSBncmlkTG9jLnkgLSAwLjAwMDE7IC8vIGZpeCBmb3IgdmlzdWFsIGJ1Z1xyXG4gICAgfVxyXG5cclxuXHRcdGdyaWQucGxheWVyLnBvc2l0aW9uID0gcG9zaXRpb247XHJcblx0XHR2YXIgZ3JpZExvY2F0aW9uID0gZ3JpZC5nZXRHcmlkTG9jYXRpb25Gcm9tUG9pbnRzKFtncmlkTG9jXSk7XHJcblx0XHRncmlkLnBsYXllci5hc3NpZ25Ub0NlbGxzKGdyaWRMb2NhdGlvbik7XHJcblxyXG5cdFx0Z3JpZC5wbGF5ZXIudmlldy5kZWJ1Z01lc2ggPSB0aGlzLnZpZXdGYWN0b3J5LmdldERlYnVnTWVzaChwb3NpdGlvbiwgZ3JpZC5wbGF5ZXIuc2l6ZSk7XHJcblx0fSxcclxuXHJcblx0YXNzaWduTWFwRW50aXRpZXNUb0dyaWQ6IGZ1bmN0aW9uKGdyaWQpIHtcclxuXHRcdHZhciBzZWN0b3JEaWN0ID0ge307XHJcblxyXG5cdFx0dmFyIHNlY3RvcnMgPSBncmlkLm1hcC5sYXllck9iamVjdHNbR1MuTWFwTGF5ZXJzLlNlY3Rvcl07XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNlY3RvcnMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIHNlY3RvciA9IHNlY3RvcnNbaV07XHJcblx0XHRcdHNlY3RvckRpY3Rbc2VjdG9yLmlkXSA9IHNlY3RvcjtcclxuXHJcblx0XHRcdHZhciBoYXNGbG9vciA9IChzZWN0b3IuZWxldmF0b3IgIT09IHRydWUpO1xyXG5cdFx0XHR2YXIgaGFzQ2VpbGluZyA9IChzZWN0b3IuY2VpbGluZyA9PT0gdHJ1ZSAmJiBzZWN0b3IuZG9vciAhPT0gdHJ1ZSk7XHJcblx0XHRcdHZhciBncmlkTG9jYXRpb24gPSBncmlkLmdldEdyaWRMb2NhdGlvbkZyb21Qb2ludHMoc2VjdG9yLmNvbGxpc2lvblZlcnRpY2VzKTtcclxuXHJcblx0XHRcdGlmIChoYXNGbG9vciB8fCBoYXNDZWlsaW5nKSB7XHJcblx0XHRcdFx0aWYgKGhhc0Zsb29yKSB7XHJcblx0XHRcdFx0XHR2YXIgZmxvb3IgPSBuZXcgR1MuQ29uY3JldGUoZ3JpZCwgR1MuTWFwTGF5ZXJzLlNlY3Rvciwgc2VjdG9yKTtcclxuXHRcdFx0XHRcdGZsb29yLnJlZ2lvbiA9IHRoaXMuZ2V0UmVnaW9uQnlTZWN0b3JJZChncmlkLCBzZWN0b3IuaWQpO1xyXG5cdFx0XHRcdFx0dGhpcy52aWV3RmFjdG9yeS5hcHBseVNlY3RvclZpZXcoZmxvb3IsIGZhbHNlKTtcclxuXHRcdFx0XHRcdGZsb29yLmFzc2lnblRvQ2VsbHMoZ3JpZExvY2F0aW9uKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmIChoYXNDZWlsaW5nKSB7XHJcblx0XHRcdFx0XHR2YXIgY2VpbGluZyA9IG5ldyBHUy5Db25jcmV0ZShncmlkLCBHUy5NYXBMYXllcnMuU2VjdG9yLCBzZWN0b3IpO1xyXG5cdFx0XHRcdFx0Y2VpbGluZy5yZWdpb24gPSB0aGlzLmdldFJlZ2lvbkJ5U2VjdG9ySWQoZ3JpZCwgc2VjdG9yLmlkKTtcclxuXHRcdFx0XHRcdHRoaXMudmlld0ZhY3RvcnkuYXBwbHlTZWN0b3JWaWV3KGNlaWxpbmcsIHRydWUpO1xyXG5cdFx0XHRcdFx0Y2VpbGluZy5hc3NpZ25Ub0NlbGxzKGdyaWRMb2NhdGlvbik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoc2VjdG9yLmRvb3IgPT09IHRydWUpIHtcclxuXHRcdFx0XHR0aGlzLmFkZERvb3IoZ3JpZCwgZ3JpZExvY2F0aW9uLCBzZWN0b3IpO1xyXG5cdFx0XHR9IGVsc2VcclxuXHRcdFx0aWYgKHNlY3Rvci5lbGV2YXRvciA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdHRoaXMuYWRkRWxldmF0b3IoZ3JpZCwgZ3JpZExvY2F0aW9uLCBzZWN0b3IpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHNlZ3MgPSBncmlkLm1hcC5sYXllck9iamVjdHNbR1MuTWFwTGF5ZXJzLlNlZ21lbnRdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBzZWcgPSBzZWdzW2ldO1xyXG5cclxuXHRcdFx0dmFyIHBvaW50cyA9IFtdO1xyXG5cdFx0XHRwb2ludHMucHVzaChuZXcgVEhSRUUuVmVjdG9yMigpLmNvcHkoc2VnLnN0YXJ0KSk7XHJcblx0XHRcdHBvaW50cy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IyKCkuY29weShzZWcuZW5kKSk7XHJcblx0XHRcdHZhciBncmlkTG9jYXRpb24gPSBncmlkLmdldEdyaWRMb2NhdGlvbkZyb21Qb2ludHMocG9pbnRzKTtcclxuXHJcblx0XHRcdGlmIChzZWcudHlwZSAhPT0gR1MuU2VnbWVudFR5cGVzLlRWU2NyZWVuICYmIHNlZy50eXBlICE9PSBHUy5TZWdtZW50VHlwZXMuU3dpdGNoKSB7XHJcblx0XHRcdFx0dmFyIGdyaWRPYmplY3QgPSBuZXcgR1MuQ29uY3JldGUoZ3JpZCwgR1MuTWFwTGF5ZXJzLlNlZ21lbnQsIHNlZyk7XHJcblx0XHRcdFx0Z3JpZE9iamVjdC5zZWN0b3IgPSBzZWN0b3JEaWN0W3NlZy5zZWN0b3JJZF07XHJcblx0XHRcdFx0Z3JpZE9iamVjdC5yZWdpb24gPSB0aGlzLmdldFJlZ2lvbkJ5U2VjdG9ySWQoZ3JpZCwgc2VnLnNlY3RvcklkKTtcclxuXHRcdFx0XHR0aGlzLnZpZXdGYWN0b3J5LmFwcGx5U2VnbWVudFZpZXcoZ3JpZE9iamVjdCk7XHJcblx0XHRcdFx0Z3JpZE9iamVjdC5hc3NpZ25Ub0NlbGxzKGdyaWRMb2NhdGlvbik7XHJcblx0XHRcdH0gZWxzZVxyXG5cdFx0XHRpZiAoc2VnLnR5cGUgPT09IEdTLlNlZ21lbnRUeXBlcy5UVlNjcmVlbikge1xyXG5cdFx0XHRcdHRoaXMuYWRkVFZTY3JlZW4oZ3JpZCwgZ3JpZExvY2F0aW9uLCBzZWcpO1xyXG5cdFx0XHR9IGVsc2VcclxuXHRcdFx0aWYgKHNlZy50eXBlID09PSBHUy5TZWdtZW50VHlwZXMuU3dpdGNoKSB7XHJcblx0XHRcdFx0dGhpcy5hZGRTd2l0Y2goZ3JpZCwgZ3JpZExvY2F0aW9uLCBzZWcpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGVudGl0aWVzID0gZ3JpZC5tYXAubGF5ZXJPYmplY3RzW0dTLk1hcExheWVycy5FbnRpdHldO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBlbnRpdGllcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgbnR0ID0gZW50aXRpZXNbaV07XHJcbiAgICAgIGdyaWQuc3Bhd25FbnRpdHkobnR0LCBncmlkKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhZGREb29yOiBmdW5jdGlvbihncmlkLCBncmlkTG9jYXRpb24sIHNlY3Rvcikge1xyXG5cdFx0dmFyIGRvb3IgPSBuZXcgR1MuRG9vcihncmlkLCBzZWN0b3IpO1xyXG5cdFx0dGhpcy52aWV3RmFjdG9yeS5hcHBseURvb3JWaWV3KGRvb3IpO1xyXG5cdFx0ZG9vci5hc3NpZ25Ub0NlbGxzKGdyaWRMb2NhdGlvbik7XHJcblx0XHRzZWN0b3IuZG9vck9wZW5lZEV2ZXIgPSBmYWxzZTtcclxuXHR9LFxyXG5cclxuXHRhZGRFbGV2YXRvcjogZnVuY3Rpb24oZ3JpZCwgZ3JpZExvY2F0aW9uLCBzZWN0b3IpIHtcclxuXHRcdHZhciBlbGV2YXRvciA9IG5ldyBHUy5FbGV2YXRvcihncmlkLCBzZWN0b3IpO1xyXG5cdFx0dGhpcy52aWV3RmFjdG9yeS5hcHBseUVsZXZhdG9yVmlldyhlbGV2YXRvcik7XHJcblx0XHRlbGV2YXRvci5hc3NpZ25Ub0NlbGxzKGdyaWRMb2NhdGlvbik7XHJcblx0fSxcclxuXHJcblx0YWRkVFZTY3JlZW46IGZ1bmN0aW9uKGdyaWQsIGdyaWRMb2NhdGlvbiwgc2VnKSB7XHJcblx0XHR2YXIgdHZTY3JlZW4gPSBuZXcgR1MuVFZTY3JlZW4oZ3JpZCwgc2VnKTtcclxuXHRcdHRoaXMudmlld0ZhY3RvcnkuYXBwbHlUVlNjcmVlblZpZXcodHZTY3JlZW4pO1xyXG5cdFx0dHZTY3JlZW4uYXNzaWduVG9DZWxscyhncmlkTG9jYXRpb24pO1xyXG5cdH0sXHJcblxyXG5cdGFkZFN3aXRjaDogZnVuY3Rpb24oZ3JpZCwgZ3JpZExvY2F0aW9uLCBzZWcpIHtcclxuXHRcdHZhciBzd2l0Y2hPYmogPSBuZXcgR1MuU3dpdGNoKGdyaWQsIHNlZyk7XHJcblx0XHR0aGlzLnZpZXdGYWN0b3J5LmFwcGx5U3dpdGNoVmlldyhzd2l0Y2hPYmopO1xyXG5cdFx0c3dpdGNoT2JqLmFzc2lnblRvQ2VsbHMoZ3JpZExvY2F0aW9uKTtcclxuXHR9LFxyXG5cclxuXHRnZXRSZWdpb25CeVNlY3RvcklkOiBmdW5jdGlvbihncmlkLCBzZWN0b3JJZCkge1xyXG5cdFx0dmFyIHJlZ2lvbnMgPSBncmlkLnJlZ2lvbkluZm8ucmVnaW9ucztcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJlZ2lvbnMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0aWYgKHNlY3RvcklkIGluIHJlZ2lvbnNbaV0uc2VjdG9ySWRzKSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlZ2lvbnNbaV07XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRHQU1FLmhhbmRsZUZhdGFsRXJyb3IoXCJzZWN0b3IgaGFzIG5vIGNvcnJlc3BvbmRpbmcgcmVnaW9uXCIpO1xyXG5cdFx0cmV0dXJuO1xyXG5cdH0sXHJcbn07XHJcbiIsIkdTLlZpZXdGYWN0b3J5ID0gZnVuY3Rpb24ocmVuZGVyZXIsIG1hcCwgYXNzZXRzKSB7XHJcblx0dGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG5cdHRoaXMubWFwID0gbWFwO1xyXG5cclxuXHR0aGlzLnRleHR1cmVzID0gYXNzZXRzW0dTLkFzc2V0VHlwZXMuVGV4dHVyZV07XHJcblx0dGhpcy5jdWJlVGV4dHVyZXMgPSBhc3NldHNbR1MuQXNzZXRUeXBlcy5DdWJlVGV4dHVyZV07XHJcblx0dGhpcy5tZXNoZXMgPSBhc3NldHNbR1MuQXNzZXRUeXBlcy5NZXNoXTtcclxuXHJcblx0dGhpcy5hbmlzb3Ryb3B5ID0gcmVuZGVyZXIuZ2V0TWF4QW5pc290cm9weSgpO1xyXG5cdHRoaXMuZGVidWdCb3VuZGluZ0JveE1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmZmZmZmLCB3aXJlZnJhbWU6IHRydWUgfSk7XHJcblx0dGhpcy5kZWJ1Z1RyaWFuZ2xlTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGMwZmYsIHdpcmVmcmFtZTogdHJ1ZSB9KTtcclxuXHJcblx0dGhpcy50ZXhTY2FsZSA9IDE2O1xyXG5cdHRoaXMudHJpYW5nbGVDb3VudCA9IDA7XHJcbn07XHJcblxyXG5HUy5WaWV3RmFjdG9yeS5wcm90b3R5cGUgPSB7XHJcblx0Y29uc3RydWN0b3I6IEdTLlZpZXdGYWN0b3J5LFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdE9iamVjdC5rZXlzKHRoaXMudGV4dHVyZXMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XHJcblx0XHRcdHRoYXQudGV4dHVyZXNba2V5XS5hbmlzb3Ryb3B5ID0gdGhhdC5hbmlzb3Ryb3B5O1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5tYXRlcmlhbHMgPSB7fTtcclxuXHJcblx0XHR2YXIgdGV4dHVyZUFzc2V0cyA9IEdTLkFzc2V0c1tHUy5Bc3NldFR5cGVzLlRleHR1cmVdO1xyXG5cdFx0Zm9yICh2YXIgaSBpbiB0ZXh0dXJlQXNzZXRzKSB7XHJcblx0XHRcdHZhciB0ZXggPSB0ZXh0dXJlQXNzZXRzW2ldO1xyXG5cdFx0XHRpZiAodGV4LnR5cGUgPT09IEdTLlRleHR1cmVUeXBlcy5NYXApIHtcclxuXHRcdFx0XHR0aGlzLndyYXAodGhpcy50ZXh0dXJlc1tpXSk7XHJcblx0XHRcdFx0dGhpcy5tYXRlcmlhbHNbaV0gPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoeyBtYXA6IHRoaXMudGV4dHVyZXNbaV0gfSk7XHJcblx0XHRcdH0gZWxzZVxyXG5cdFx0XHRpZiAodGV4LnR5cGUgPT09IEdTLlRleHR1cmVUeXBlcy5UVlNjcmVlbikge1xyXG5cdFx0XHRcdHRoaXMudGV4dHVyZXNbaV0uZmxpcFkgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBlbnRpdGllcyA9IHRoaXMubWFwLmxheWVyT2JqZWN0c1tHUy5NYXBMYXllcnMuRW50aXR5XTtcclxuICAgIC8vIEhBQ0s6IGZvcmNlIG9ubGluZV9wbGF5ZXIgaW50byBlbnRpdGllc1xyXG4gICAgLy8gVE9ETzogY2hlY2sgdG8gc2VlIGlmIGlzIG9ubGluZSBtYXAgYW5kIGFkZCBtYXRlcmlhbCBpZiB0cnVlXHJcbiAgICBsZXQgb25saW5lTnR0ID0ge1xyXG4gICAgICBpZDogMjQsXHJcbiAgICAgIHBvczogbmV3IFRIUkVFLlZlY3RvcjIoLTEwMCwgLTEwMCksXHJcbiAgICAgIHR5cGU6IFwiT1wiLFxyXG4gICAgICB5Oi0xMDAsXHJcbiAgICAgIGlzU3RhdGljOiBmYWxzZSxcclxuICAgICAgcm90YXRpb246MFxyXG4gICAgfTtcclxuICAgIGVudGl0aWVzLnB1c2gob25saW5lTnR0KTtcclxuXHRcdHZhciBlbnRpdHlNYXRlcmlhbHMgPSB7fTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZW50aXRpZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIG50dCA9IGVudGl0aWVzW2ldO1xyXG5cclxuXHRcdFx0dmFyIGRlc2MgPSBHUy5NYXBFbnRpdGllc1tudHQudHlwZV07XHJcblx0XHRcdHZhciBuYW1lID0gZGVzYy5uYW1lO1xyXG5cdFx0XHRpZiAoZW50aXR5TWF0ZXJpYWxzW25hbWVdID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRlbnRpdHlNYXRlcmlhbHNbbmFtZV0gPSB0cnVlO1xyXG5cclxuXHRcdFx0XHR0aGlzLm1hdGVyaWFsc1tuYW1lXSA9IG5ldyBHUy5NZXNoUGhvbmdHbG93TWF0ZXJpYWwodGhpcy50ZXh0dXJlc1tuYW1lXSwgdGhpcy50ZXh0dXJlc1tuYW1lICsgXCJfZ2xvd1wiXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnZlcnRleENvbG9yTWF0ZXJpYWwgPSBuZXcgR1MuTWVzaFZlcnRleENvbG9yTWF0ZXJpYWwoKTtcclxuXHJcblx0XHRmb3IgKHZhciBpIGluIEdTLldlYXBvbnMpIHtcclxuXHRcdFx0dGhpcy53cmFwKHRoaXMudGV4dHVyZXNbaV0pO1xyXG5cdFx0XHR0aGlzLm1hdGVyaWFsc1tpXSA9IG5ldyBHUy5NZXNoUGhvbmdHbG93TWF0ZXJpYWwodGhpcy50ZXh0dXJlc1tpXSwgdGhpcy50ZXh0dXJlc1tpICsgXCJfZ2xvd1wiXSk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0U2t5Ym94TWVzaDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgbmFtZSA9IFwic2t5Ym94MVwiO1xyXG5cclxuXHRcdHZhciB0ZXggPSB0aGlzLmN1YmVUZXh0dXJlc1tuYW1lXTtcclxuXHRcdHRleC5mb3JtYXQgPSBUSFJFRS5SR0JGb3JtYXQ7XHJcblxyXG5cdFx0dmFyIHNoYWRlciA9IFRIUkVFLlNoYWRlckxpYltcImN1YmVcIl07XHJcblx0XHR2YXIgdW5pZm9ybXMgPSBUSFJFRS5Vbmlmb3Jtc1V0aWxzLmNsb25lKHNoYWRlci51bmlmb3Jtcyk7XHJcblx0XHR1bmlmb3Jtc1tcInRDdWJlXCJdLnZhbHVlID0gdGV4O1xyXG5cclxuXHRcdHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7XHJcblx0XHRcdGZyYWdtZW50U2hhZGVyOiBzaGFkZXIuZnJhZ21lbnRTaGFkZXIsXHJcblx0XHRcdHZlcnRleFNoYWRlcjogc2hhZGVyLnZlcnRleFNoYWRlcixcclxuXHRcdFx0dW5pZm9ybXM6IHVuaWZvcm1zLFxyXG5cdFx0XHRkZXB0aFdyaXRlOiBmYWxzZSxcclxuXHRcdFx0c2lkZTogVEhSRUUuQmFja1NpZGUsXHJcblx0XHR9KTtcclxuXHJcblx0XHR2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoMTAwMCwgMTAwMCwgMTAwMCk7XHJcblx0XHR2YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XHJcblxyXG5cdFx0cmV0dXJuIG1lc2g7XHJcblx0fSxcclxuXHJcblx0d3JhcDogZnVuY3Rpb24odGV4KSB7XHJcblx0XHR0ZXgud3JhcFMgPSB0ZXgud3JhcFQgPSBUSFJFRS5SZXBlYXRXcmFwcGluZztcclxuXHR9LFxyXG5cclxuXHRhcHBseVNlZ21lbnRWaWV3OiBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHR2YXIgc2VnID0gZ3JpZE9iamVjdC5zb3VyY2VPYmo7XHJcblxyXG5cdFx0dmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkdlb21ldHJ5KCk7XHJcblx0XHR2YXIgdHJpYW5nbGVzID0gdGhpcy5nZXRTZWdtZW50RGVmaW5lZFRyaWFuZ2xlcyhzZWcpO1xyXG5cdFx0R1MucHVzaEFycmF5KGdlb21ldHJ5LnZlcnRpY2VzLCB0cmlhbmdsZXMpO1xyXG5cclxuXHRcdHZhciBkaXN0YW5jZSA9IHNlZy5zdGFydC5kaXN0YW5jZVRvKHNlZy5lbmQpO1xyXG5cdFx0dmFyIGxlbmd0aDtcclxuXHRcdGlmIChkaXN0YW5jZSA+IHRoaXMudGV4U2NhbGUpIHtcclxuXHRcdFx0bGVuZ3RoID0gTWF0aC5yb3VuZCgoZGlzdGFuY2UgLyAodGhpcy50ZXhTY2FsZSAqIHRoaXMudGV4U2NhbGUpKSAqIHRoaXMudGV4U2NhbGUpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0bGVuZ3RoID0gZGlzdGFuY2UgLyB0aGlzLnRleFNjYWxlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcihzZWcubGlnaHRDb2xvcik7XHJcblx0XHR2YXIgZW1pc3NpdmUgPSB0aGlzLmdldEVtaXNzaXZlQ29sb3IoZ3JpZE9iamVjdC5zZWN0b3IubGlnaHRMZXZlbCk7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpICs9IDMpIHtcclxuXHRcdFx0dmFyIGZhY2UgPSBuZXcgVEhSRUUuRmFjZTMoaSwgaSArIDEsIGkgKyAyLCBudWxsLCBjb2xvcik7XHJcblx0XHRcdGZhY2UuZW1pc3NpdmUgPSBlbWlzc2l2ZTtcclxuXHJcblx0XHRcdGdlb21ldHJ5LmZhY2VzLnB1c2goZmFjZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Z2VvbWV0cnkuY29tcHV0ZUZhY2VOb3JtYWxzKCk7XHJcblx0XHRnZW9tZXRyeS5jb21wdXRlVmVydGV4Tm9ybWFscygpO1xyXG5cclxuXHRcdGdyaWRPYmplY3QucmVnaW9uLm1lc2guZ2VvbWV0cnkubWVyZ2UoZ2VvbWV0cnkpO1xyXG5cclxuXHRcdGdyaWRPYmplY3Qudmlldy5jb2xsaXNpb25EYXRhLnRyaWFuZ2xlcyA9IHRoaXMuZ2V0U2VnbWVudFRyaWFuZ2xlcyhzZWcpO1xyXG5cdFx0dGhpcy5hcHBseUNvbmNyZXRlQm91bmRpbmdCb3goZ3JpZE9iamVjdCwgdHJpYW5nbGVzKTtcclxuXHJcblx0XHR0aGlzLnRyaWFuZ2xlQ291bnQgKz0gZ3JpZE9iamVjdC52aWV3LmNvbGxpc2lvbkRhdGEudHJpYW5nbGVzLmxlbmd0aCAvIDM7XHJcblx0fSxcclxuXHJcblx0Z2V0RW1pc3NpdmVDb2xvcjogZnVuY3Rpb24obGlnaHRMZXZlbCkge1xyXG5cdFx0dmFyIGxpZ2h0TGV2ZWxGYWN0b3IgPSAwLjE7XHJcblx0XHR2YXIgbWluTGlnaHRMZXZlbCA9IDAuMTtcclxuXHRcdHZhciBtYXhMaWdodExldmVsID0gMC43NTtcclxuXHJcblx0XHR2YXIgeCA9IGxpZ2h0TGV2ZWwgKiBsaWdodExldmVsRmFjdG9yO1xyXG5cdFx0eCAqPSB4O1xyXG5cdFx0eCA9IEdTLk1hdGhIZWxwZXIuY2xhbXAoeCwgbWluTGlnaHRMZXZlbCwgbWF4TGlnaHRMZXZlbCk7XHJcblxyXG5cdFx0cmV0dXJuIG5ldyBUSFJFRS5Db2xvcigweGZmZmZmZikubXVsdGlwbHlTY2FsYXIoeCk7XHJcblx0fSxcclxuXHJcblx0YXBwbHlTZWN0b3JWaWV3OiBmdW5jdGlvbihncmlkT2JqZWN0LCBjZWlsaW5nKSB7XHJcblx0XHR2YXIgc2VjdG9yID0gZ3JpZE9iamVjdC5zb3VyY2VPYmo7XHJcblxyXG5cdFx0dmFyIHRyaWFuZ2xlcyA9IFtdO1xyXG5cclxuXHRcdHZhciBnZW9tZXRyeTtcclxuXHJcblx0XHRpZiAoIWNlaWxpbmcpIHtcclxuXHRcdFx0aWYgKHNlY3Rvci5lbGV2YXRvciAhPT0gdHJ1ZSkge1xyXG5cdFx0XHRcdGdlb21ldHJ5ID0gdGhpcy5nZXRTZWN0b3JHZW9tZXRyeShzZWN0b3IsIHRyaWFuZ2xlcywgZmFsc2UpO1xyXG5cdFx0XHRcdGdyaWRPYmplY3QucmVnaW9uLm1lc2guZ2VvbWV0cnkubWVyZ2UoZ2VvbWV0cnkpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR2YXIgaGFzQ2VpbGluZyA9IChzZWN0b3IuY2VpbGluZyAhPT0gdW5kZWZpbmVkKSA/IHNlY3Rvci5jZWlsaW5nIDogdHJ1ZTtcclxuXHRcdFx0aWYgKGhhc0NlaWxpbmcpIHtcclxuXHRcdFx0XHRnZW9tZXRyeSA9IHRoaXMuZ2V0U2VjdG9yR2VvbWV0cnkoc2VjdG9yLCB0cmlhbmdsZXMsIHRydWUpO1xyXG5cdFx0XHRcdGdyaWRPYmplY3QucmVnaW9uLm1lc2guZ2VvbWV0cnkubWVyZ2UoZ2VvbWV0cnkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Z3JpZE9iamVjdC52aWV3LmNvbGxpc2lvbkRhdGEudHJpYW5nbGVzID0gdHJpYW5nbGVzO1xyXG5cdFx0dGhpcy5hcHBseUNvbmNyZXRlQm91bmRpbmdCb3goZ3JpZE9iamVjdCwgdHJpYW5nbGVzKTtcclxuXHJcblx0XHR0aGlzLnRyaWFuZ2xlQ291bnQgKz0gdHJpYW5nbGVzLmxlbmd0aCAvIDM7XHJcblx0fSxcclxuXHJcblx0YXBwbHlDb25jcmV0ZUJvdW5kaW5nQm94OiBmdW5jdGlvbihncmlkT2JqZWN0LCB0cmlhbmdsZXMpIHtcclxuXHRcdHZhciBib3VuZGluZ0JveCA9IG5ldyBUSFJFRS5Cb3gzKCkuc2V0RnJvbVBvaW50cyh0cmlhbmdsZXMpO1xyXG5cdFx0dmFyIGNlbnRlciA9IGJvdW5kaW5nQm94Lm1pbi5jbG9uZSgpLmFkZChib3VuZGluZ0JveC5tYXgpLmRpdmlkZVNjYWxhcigyKTtcclxuXHRcdHZhciBkZWJ1Z01lc2ggPSB0aGlzLmdldERlYnVnTWVzaChjZW50ZXIpO1xyXG5cdFx0ZGVidWdNZXNoLnNjYWxlLmNvcHkoYm91bmRpbmdCb3gubWF4KS5zdWIoYm91bmRpbmdCb3gubWluKS5hZGRTY2FsYXIoMC4wMSk7XHJcblx0XHRncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ0JveCA9IGJvdW5kaW5nQm94O1xyXG5cdFx0Z3JpZE9iamVjdC52aWV3LmRlYnVnTWVzaCA9IGRlYnVnTWVzaDtcclxuXHR9LFxyXG5cclxuXHRnZXRTZWN0b3JHZW9tZXRyeTogZnVuY3Rpb24oc2VjdG9yLCBzZWN0b3JUcmlhbmdsZXMsIGNlaWxpbmcpIHtcclxuXHRcdHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5HZW9tZXRyeSgpO1xyXG5cdFx0dmFyIHRyaWFuZ2xlcyA9IHRoaXMuZ2V0U2VjdG9yVHJpYW5nbGVzKHNlY3RvciwgY2VpbGluZyk7XHJcblx0XHRHUy5wdXNoQXJyYXkoZ2VvbWV0cnkudmVydGljZXMsIHRyaWFuZ2xlcyk7XHJcblx0XHRHUy5wdXNoQXJyYXkoc2VjdG9yVHJpYW5nbGVzLCB0aGlzLmdldFNlY3RvclRyaWFuZ2xlcyhzZWN0b3IsIGNlaWxpbmcsIHRydWUpKTtcclxuXHJcblx0XHR2YXIgZW1pc3NpdmUgPSB0aGlzLmdldEVtaXNzaXZlQ29sb3Ioc2VjdG9yLmxpZ2h0TGV2ZWwpO1xyXG5cdFx0dmFyIGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKGNlaWxpbmcgPyBzZWN0b3IuY2VpbGluZ0NhdENvbG9yIDogc2VjdG9yLmxpZ2h0Q29sb3IpO1xyXG5cclxuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgdHJpYW5nbGVzLmxlbmd0aDsgaiArPSAzKSB7XHJcblx0XHRcdHZhciBmYWNlID0gbmV3IFRIUkVFLkZhY2UzKGosIGogKyAxLCBqICsgMiwgbnVsbCwgY29sb3IpO1xyXG5cdFx0XHRmYWNlLmVtaXNzaXZlID0gZW1pc3NpdmU7XHJcblxyXG5cdFx0XHRnZW9tZXRyeS5mYWNlcy5wdXNoKGZhY2UpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGdlb21ldHJ5LmNvbXB1dGVGYWNlTm9ybWFscygpO1xyXG5cdFx0Z2VvbWV0cnkuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTtcclxuXHJcblx0XHRyZXR1cm4gZ2VvbWV0cnk7XHJcblx0fSxcclxuXHJcblx0Z2V0U2VnbWVudERlZmluZWRUcmlhbmdsZXM6IGZ1bmN0aW9uKHNlZykge1xyXG5cdFx0dmFyIHRyaWFuZ2xlcyA9IFtdO1xyXG5cclxuXHRcdHZhciBib3R0b21SaWdodEluZGV4ID0gMDtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2VnLmluZGljZXMubGVuZ3RoOyBpICs9IDMpIHtcclxuXHRcdFx0dHJpYW5nbGVzLnB1c2goc2VnLnZlcnRpY2VzW3NlZy5pbmRpY2VzW2ldXSk7XHJcblx0XHRcdHRyaWFuZ2xlcy5wdXNoKHNlZy52ZXJ0aWNlc1tzZWcuaW5kaWNlc1tpICsgMV1dKTtcclxuXHRcdFx0dHJpYW5nbGVzLnB1c2goc2VnLnZlcnRpY2VzW3NlZy5pbmRpY2VzW2kgKyAyXV0pO1xyXG5cclxuXHRcdFx0aWYgKHNlZy5pbmRpY2VzW2kgKyAyXSA9PSBzZWcuYm90dG9tUmlnaHRJbmRleCkge1xyXG5cdFx0XHRcdGJvdHRvbVJpZ2h0SW5kZXggPSBpICsgMztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0c2VnLmJvdHRvbVJpZ2h0SW5kZXggPSBib3R0b21SaWdodEluZGV4O1xyXG5cclxuXHRcdHJldHVybiB0cmlhbmdsZXM7XHJcblx0fSxcclxuXHJcblx0Z2V0U2VnbWVudFRyaWFuZ2xlczogZnVuY3Rpb24oc2VnKSB7XHJcblx0XHR2YXIgdHJpYW5nbGVzID0gW107XHJcblxyXG5cdFx0dHJpYW5nbGVzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoc2VnLnN0YXJ0LngsIHNlZy50b3BZLCBzZWcuc3RhcnQueSkpO1xyXG5cdFx0dHJpYW5nbGVzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoc2VnLmVuZC54LCBzZWcudG9wWSwgc2VnLmVuZC55KSk7XHJcblx0XHR0cmlhbmdsZXMucHVzaChuZXcgVEhSRUUuVmVjdG9yMyhzZWcuc3RhcnQueCwgc2VnLmJvdHRvbVksIHNlZy5zdGFydC55KSk7XHJcblx0XHR0cmlhbmdsZXMucHVzaChuZXcgVEhSRUUuVmVjdG9yMyhzZWcuZW5kLngsIHNlZy50b3BZLCBzZWcuZW5kLnkpKTtcclxuXHRcdHRyaWFuZ2xlcy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKHNlZy5lbmQueCwgc2VnLmJvdHRvbVksIHNlZy5lbmQueSkpO1xyXG5cdFx0dHJpYW5nbGVzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoc2VnLnN0YXJ0LngsIHNlZy5ib3R0b21ZLCBzZWcuc3RhcnQueSkpO1xyXG5cclxuXHRcdHJldHVybiB0cmlhbmdsZXM7XHJcblx0fSxcclxuXHJcblx0Z2V0U2VjdG9yVHJpYW5nbGVzOiBmdW5jdGlvbihzZWN0b3IsIGNlaWxpbmcsIGdldENvbGxpc2lvblRyaWFuZ2xlcykge1xyXG5cdFx0dmFyIHRyaWFuZ2xlcyA9IFtdO1xyXG5cclxuXHRcdHZhciB2ID0gc2VjdG9yLnZlcnRpY2VzO1xyXG5cdFx0dmFyIGlkeCA9IHNlY3Rvci5pbmRpY2VzO1xyXG5cclxuXHRcdGlmIChnZXRDb2xsaXNpb25UcmlhbmdsZXMpIHtcclxuXHRcdFx0diA9IHNlY3Rvci5jb2xsaXNpb25WZXJ0aWNlcztcclxuXHRcdFx0aWR4ID0gc2VjdG9yLmNvbGxpc2lvbkluZGljZXM7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCFjZWlsaW5nKSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgaWR4Lmxlbmd0aDsgaSArPSAzKSB7XHJcblx0XHRcdFx0dHJpYW5nbGVzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjModltpZHhbaSArIDJdXS54LCBzZWN0b3IuZmxvb3JUb3BZLCB2W2lkeFtpICsgMl1dLnkpKTtcclxuXHRcdFx0XHR0cmlhbmdsZXMucHVzaChuZXcgVEhSRUUuVmVjdG9yMyh2W2lkeFtpICsgMV1dLngsIHNlY3Rvci5mbG9vclRvcFksIHZbaWR4W2kgKyAxXV0ueSkpO1xyXG5cdFx0XHRcdHRyaWFuZ2xlcy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKHZbaWR4W2ldXS54LCBzZWN0b3IuZmxvb3JUb3BZLCB2W2lkeFtpXV0ueSkpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGlkeC5sZW5ndGg7IGkgKz0gMykge1xyXG5cdFx0XHRcdHRyaWFuZ2xlcy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKHZbaWR4W2ldXS54LCBzZWN0b3IuY2VpbEJvdHRvbVksIHZbaWR4W2ldXS55KSk7XHJcblx0XHRcdFx0dHJpYW5nbGVzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjModltpZHhbaSArIDFdXS54LCBzZWN0b3IuY2VpbEJvdHRvbVksIHZbaWR4W2kgKyAxXV0ueSkpO1xyXG5cdFx0XHRcdHRyaWFuZ2xlcy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKHZbaWR4W2kgKyAyXV0ueCwgc2VjdG9yLmNlaWxCb3R0b21ZLCB2W2lkeFtpICsgMl1dLnkpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0cmlhbmdsZXM7XHJcblx0fSxcclxuXHJcblx0YXBwbHlFbnRpdHlWaWV3OiBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHR2YXIgdmVydGljZXMgPSBHUy5DdWJlLmdldFZlcnRpY2VzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdFx0dmFyIG50dCA9IGdyaWRPYmplY3Quc291cmNlT2JqO1xyXG5cdFx0XHR2YXIgZGVzYyA9IEdTLk1hcEVudGl0aWVzW250dC50eXBlXTtcclxuXHRcdFx0dmFyIG5hbWUgPSBHUy5NYXBFbnRpdGllc1tudHQudHlwZV0ubmFtZTtcclxuXHJcblx0XHRcdHZhciBvZmZzZXQgPSBncmlkT2JqZWN0Lm9mZnNldDtcclxuXHRcdFx0dmFyIHNjYWxlID0gZ3JpZE9iamVjdC5zY2FsZTtcclxuXHRcdFx0dmFyIHNpemUgPSBncmlkT2JqZWN0LnNpemU7XHJcblxyXG5cdFx0XHR2YXIgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsc1tuYW1lXS5jbG9uZSgpO1xyXG5cclxuXHRcdFx0dmFyIG1lc2g7XHJcblx0XHRcdGlmIChuYW1lID09PSBcInNwYXduXCIpIHtcclxuXHRcdFx0XHRtZXNoID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XHJcbiAgICAgICAgbWVzaC5wb3NpdGlvbi5jb3B5KG9mZnNldCk7XHJcbiAgICAgICAgbWVzaC5wb3NpdGlvbi5jb3B5KGdyaWRPYmplY3QucG9zaXRpb24pO1xyXG4gICAgICAgIG1lc2guc2NhbGUuY29weShzY2FsZSk7XHJcblxyXG4gICAgICAgIGdyaWRPYmplY3Qudmlldy5tZXNoID0gbWVzaDtcclxuICAgICAgICBncmlkT2JqZWN0LnZpZXcuZGVidWdNZXNoID0gdGhpcy5nZXREZWJ1Z01lc2goZ3JpZE9iamVjdC5wb3NpdGlvbik7XHJcbiAgICAgICAgICByZXR1cm47IC8vIE5vIERyYXdcclxuICAgICAgfVxyXG5cdFx0XHRpZiAoZGVzYy5hbmltYXRpb25zID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRtZXNoID0gdGhpcy5tZXNoZXNbbmFtZV0uY2xvbmUoKTtcclxuXHRcdFx0XHRtZXNoLm1hdGVyaWFsID0gbWF0ZXJpYWw7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0bWVzaCA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xyXG5cdFx0XHRcdHZhciBkYXRhID0gbWVzaC51c2VyRGF0YTtcclxuXHRcdFx0XHRkYXRhLmFuaW1hdGlvbnMgPSB7fTtcclxuXHRcdFx0XHRPYmplY3Qua2V5cyhkZXNjLmFuaW1hdGlvbnMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XHJcblx0XHRcdFx0XHR2YXIgY291bnQgPSBkZXNjLmFuaW1hdGlvbnNba2V5XTtcclxuXHRcdFx0XHRcdGRhdGEuYW5pbWF0aW9uc1trZXldID0gW107XHJcblxyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdHZhciBhbmltYXRpb25OYW1lID0gbmFtZSArIFwiX1wiICsga2V5ICsgaTtcclxuXHRcdFx0XHRcdFx0dmFyIGFuaW1NZXNoID0gdGhhdC5tZXNoZXNbYW5pbWF0aW9uTmFtZV0uY2xvbmUoKTtcclxuXHRcdFx0XHRcdFx0YW5pbU1lc2gudmlzaWJsZSA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHRhbmltTWVzaC5tYXRlcmlhbCA9IG1hdGVyaWFsO1xyXG5cdFx0XHRcdFx0XHRkYXRhLmFuaW1hdGlvbnNba2V5XS5wdXNoKGFuaW1NZXNoKTtcclxuXHRcdFx0XHRcdFx0bWVzaC5hZGQoYW5pbU1lc2gpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRtZXNoLnBvc2l0aW9uLmNvcHkob2Zmc2V0KTtcclxuXHRcdFx0bWVzaC5wb3NpdGlvbi5jb3B5KGdyaWRPYmplY3QucG9zaXRpb24pO1xyXG5cdFx0XHRtZXNoLnNjYWxlLmNvcHkoc2NhbGUpO1xyXG5cclxuXHRcdFx0Z3JpZE9iamVjdC52aWV3Lm1lc2ggPSBtZXNoO1xyXG5cdFx0XHRncmlkT2JqZWN0LnZpZXcuZGVidWdNZXNoID0gdGhpcy5nZXREZWJ1Z01lc2goZ3JpZE9iamVjdC5wb3NpdGlvbik7XHJcblxyXG5cdFx0XHRpZiAoZ3JpZE9iamVjdCBpbnN0YW5jZW9mIEdTLk1vbnN0ZXIgfHxcclxuICAgICAgICAgIGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5PbmxpbmVQbGF5ZXIpIHtcclxuXHRcdFx0XHRncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS50cmlhbmdsZXMgPSBbXTtcclxuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHR2YXIgdiA9IHZlcnRpY2VzW2ldLmNsb25lKCk7XHJcblx0XHRcdFx0XHR2Lm11bHRpcGx5KHNpemUpLmFkZChncmlkT2JqZWN0LnZpZXcubWVzaC5wb3NpdGlvbik7XHJcblx0XHRcdFx0XHRncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS50cmlhbmdsZXMucHVzaCh2KTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGdyaWRPYmplY3Qudmlldy5jb2xsaXNpb25EYXRhLmJvdW5kaW5nU3F1YXJlLnNldEZyb21Qb2ludHMoW1xyXG5cdFx0XHRcdFx0Z3JpZE9iamVjdC5wb3NpdGlvbi50b1ZlY3RvcjIoKS5zdWIoZ3JpZE9iamVjdC5zaXplLnRvVmVjdG9yMigpKSxcclxuXHRcdFx0XHRcdGdyaWRPYmplY3QucG9zaXRpb24udG9WZWN0b3IyKCkuYWRkKGdyaWRPYmplY3Quc2l6ZS50b1ZlY3RvcjIoKSksXHJcblx0XHRcdFx0XSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGdldFNlZ21lbnRzRm9yTW92aW5nU2VjdG9yOiBmdW5jdGlvbihncmlkT2JqZWN0LCBlbGV2YXRvcikge1xyXG5cdFx0dmFyIHNlY3RvciA9IGdyaWRPYmplY3Quc2VjdG9yO1xyXG5cdFx0dmFyIHNlZ3MgPSBbXTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNlY3Rvci5jb2xsaXNpb25WZXJ0aWNlcy5sZW5ndGggLSAxOyBpKyspIHtcclxuXHRcdFx0c2Vncy5wdXNoKHtcclxuXHRcdFx0XHRzdGFydDogc2VjdG9yLmNvbGxpc2lvblZlcnRpY2VzW2ldLmNsb25lKCksXHJcblx0XHRcdFx0ZW5kOiBzZWN0b3IuY29sbGlzaW9uVmVydGljZXNbaSArIDFdLmNsb25lKCksXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0c2Vncy5wdXNoKHtcclxuXHRcdFx0c3RhcnQ6IHNlY3Rvci5jb2xsaXNpb25WZXJ0aWNlc1tpXS5jbG9uZSgpLFxyXG5cdFx0XHRlbmQ6IHNlY3Rvci5jb2xsaXNpb25WZXJ0aWNlc1swXS5jbG9uZSgpLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0aWYgKGVsZXZhdG9yICE9PSB0cnVlKSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc2Vncy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHNlZ3NbaV0uYm90dG9tWSA9IHNlY3Rvci5mbG9vclRvcFk7XHJcblx0XHRcdFx0c2Vnc1tpXS50b3BZID0gc2VjdG9yLmNlaWxCb3R0b21ZO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNlZ3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRzZWdzW2ldLmJvdHRvbVkgPSBzZWN0b3IuZmxvb3JUb3BZIC0gc2VjdG9yLmVsZXZhdG9yTWF4SGVpZ2h0O1xyXG5cdFx0XHRcdHNlZ3NbaV0udG9wWSA9IHNlY3Rvci5mbG9vclRvcFk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gc2VncztcclxuXHR9LFxyXG5cclxuXHRhcHBseURvb3JWaWV3OiBmdW5jdGlvbihkb29yKSB7XHJcblx0XHR2YXIgdHJpYW5nbGVzID0gW107XHJcblxyXG5cdFx0ZG9vci5wb3NpdGlvbiA9IHRoaXMuZ2V0TW92aW5nU2VjdG9yUG9zaXRpb24oZG9vcik7XHJcblx0XHRkb29yLnZpZXcuY29sbGlzaW9uRGF0YS5zZWdtZW50cyA9IHRoaXMuZ2V0U2VnbWVudHNGb3JNb3ZpbmdTZWN0b3IoZG9vciwgZmFsc2UpO1xyXG5cclxuXHRcdHZhciBjZW50ZXJNYXRlcmlhbCA9IHRoaXMudmVydGV4Q29sb3JNYXRlcmlhbDtcclxuXHRcdHZhciBzaWRlTWF0ZXJpYWwgPSB0aGlzLnZlcnRleENvbG9yTWF0ZXJpYWw7XHJcblx0XHRpZiAoIWRvb3Iuc2VjdG9yLnVzZVZlcnRleENvbG9ycykge1xyXG5cdFx0XHRjZW50ZXJNYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWxzW2Rvb3Iuc2VjdG9yLmNlaWxUZXhJZF0uY2xvbmUoKTtcclxuXHRcdFx0c2lkZU1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbHNbZG9vci5zZWN0b3Iuc2lkZVRleElkXS5jbG9uZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBtZXNoID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XHJcblx0XHRtZXNoLmNoaWxkcmVuLnB1c2godGhpcy5nZXRNb3ZpbmdTZWN0b3JDZW50ZXJNZXNoKGRvb3IsIHRyaWFuZ2xlcywgY2VudGVyTWF0ZXJpYWwpKTtcclxuXHRcdG1lc2guY2hpbGRyZW4ucHVzaCh0aGlzLmdldE1vdmluZ1NlY3RvclNpZGVNZXNoKGRvb3IsIHRyaWFuZ2xlcywgc2lkZU1hdGVyaWFsKSk7XHJcblxyXG5cdFx0bWVzaC5jaGlsZHJlblswXS5wb3NpdGlvbi5jb3B5KGRvb3IucG9zaXRpb24pO1xyXG5cdFx0bWVzaC5jaGlsZHJlblsxXS5wb3NpdGlvbi5jb3B5KGRvb3IucG9zaXRpb24pO1xyXG5cclxuXHRcdGRvb3Iudmlldy5tZXNoID0gbWVzaDtcclxuXHRcdGRvb3Iudmlldy5jb2xsaXNpb25EYXRhLnRyaWFuZ2xlcyA9IHRyaWFuZ2xlcztcclxuXHRcdGRvb3Iudmlldy5kZWJ1Z01lc2ggPSB0aGlzLmdldERlYnVnTWVzaChkb29yLnBvc2l0aW9uKTtcclxuXHRcdC8vIGRvb3Iudmlldy5kZWJ1Z01lc2ggPSB0aGlzLmdldERlYnVnVHJpYW5nbGVNZXNoKHRyaWFuZ2xlcyk7XHJcblxyXG5cdFx0dmFyIGJveCA9IGRvb3Iudmlldy5jb2xsaXNpb25EYXRhLmJvdW5kaW5nQm94O1xyXG5cdFx0Ym94LnNldEZyb21Qb2ludHModHJpYW5nbGVzKTtcclxuXHRcdGRvb3Iuc2l6ZSA9IGJveC5tYXguY2xvbmUoKS5zdWIoYm94Lm1pbikuZGl2aWRlU2NhbGFyKDIpO1xyXG5cclxuXHRcdHRoaXMudHJpYW5nbGVDb3VudCArPSB0cmlhbmdsZXMubGVuZ3RoIC8gMztcclxuXHR9LFxyXG5cclxuXHRhcHBseUVsZXZhdG9yVmlldzogZnVuY3Rpb24oZWxldmF0b3IpIHtcclxuXHRcdHZhciB0cmlhbmdsZXMgPSBbXTtcclxuXHJcblx0XHRlbGV2YXRvci5wb3NpdGlvbiA9IHRoaXMuZ2V0TW92aW5nU2VjdG9yUG9zaXRpb24oZWxldmF0b3IsIHRydWUpO1xyXG5cdFx0ZWxldmF0b3Iudmlldy5jb2xsaXNpb25EYXRhLnNlZ21lbnRzID0gdGhpcy5nZXRTZWdtZW50c0Zvck1vdmluZ1NlY3RvcihlbGV2YXRvciwgdHJ1ZSk7XHJcblxyXG5cdFx0dmFyIGNlbnRlck1hdGVyaWFsID0gdGhpcy52ZXJ0ZXhDb2xvck1hdGVyaWFsO1xyXG5cdFx0dmFyIHNpZGVNYXRlcmlhbCA9IHRoaXMudmVydGV4Q29sb3JNYXRlcmlhbDtcclxuXHRcdGlmICghZWxldmF0b3Iuc2VjdG9yLnVzZVZlcnRleENvbG9ycykge1xyXG5cdFx0XHRjZW50ZXJNYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWxzW2VsZXZhdG9yLnNlY3Rvci5mbG9vclRleElkXS5jbG9uZSgpO1xyXG5cdFx0XHRzaWRlTWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsc1tlbGV2YXRvci5zZWN0b3Iuc2lkZVRleElkXS5jbG9uZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBtZXNoID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XHJcblx0XHRtZXNoLmNoaWxkcmVuLnB1c2godGhpcy5nZXRNb3ZpbmdTZWN0b3JDZW50ZXJNZXNoKGVsZXZhdG9yLCB0cmlhbmdsZXMsXHJcblx0XHRcdGNlbnRlck1hdGVyaWFsLCB0cnVlKSk7XHJcblx0XHRtZXNoLmNoaWxkcmVuLnB1c2godGhpcy5nZXRNb3ZpbmdTZWN0b3JTaWRlTWVzaChlbGV2YXRvciwgdHJpYW5nbGVzLFxyXG5cdFx0XHRzaWRlTWF0ZXJpYWwsIHRydWUpKTtcclxuXHJcblx0XHRtZXNoLmNoaWxkcmVuWzBdLnBvc2l0aW9uLmNvcHkoZWxldmF0b3IucG9zaXRpb24pO1xyXG5cdFx0bWVzaC5jaGlsZHJlblsxXS5wb3NpdGlvbi5jb3B5KGVsZXZhdG9yLnBvc2l0aW9uKTtcclxuXHJcblx0XHRlbGV2YXRvci52aWV3Lm1lc2ggPSBtZXNoO1xyXG5cdFx0ZWxldmF0b3Iudmlldy5jb2xsaXNpb25EYXRhLnRyaWFuZ2xlcyA9IHRyaWFuZ2xlcztcclxuXHRcdGVsZXZhdG9yLnZpZXcuZGVidWdNZXNoID0gdGhpcy5nZXREZWJ1Z01lc2goZWxldmF0b3IucG9zaXRpb24pO1xyXG5cdFx0Ly9lbGV2YXRvci52aWV3LmRlYnVnTWVzaCA9IHRoaXMuZ2V0RGVidWdUcmlhbmdsZU1lc2godHJpYW5nbGVzKTtcclxuXHJcblx0XHR2YXIgYm94ID0gZWxldmF0b3Iudmlldy5jb2xsaXNpb25EYXRhLmJvdW5kaW5nQm94O1xyXG5cdFx0Ym94LnNldEZyb21Qb2ludHModHJpYW5nbGVzKTtcclxuXHRcdGVsZXZhdG9yLnNpemUgPSBib3gubWF4LmNsb25lKCkuc3ViKGJveC5taW4pLmRpdmlkZVNjYWxhcigyKTtcclxuXHJcblx0XHR0aGlzLnRyaWFuZ2xlQ291bnQgKz0gdHJpYW5nbGVzLmxlbmd0aCAvIDM7XHJcblx0fSxcclxuXHJcblx0Z2V0TW92aW5nU2VjdG9yUG9zaXRpb246IGZ1bmN0aW9uKG1vdmluZ1NlY3RvciwgZWxldmF0b3IpIHtcclxuXHRcdHZhciBib3ggPSBuZXcgVEhSRUUuQm94MigpLnNldEZyb21Qb2ludHMobW92aW5nU2VjdG9yLnNlY3Rvci52ZXJ0aWNlcyk7XHJcblx0XHR2YXIgY2VudGVyID0gYm94Lm1pbi5jbG9uZSgpLmFkZChib3gubWF4KS5kaXZpZGVTY2FsYXIoMik7XHJcblxyXG5cdFx0dmFyIHBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKGNlbnRlci54LCAwLCBjZW50ZXIueSk7XHJcblxyXG5cdFx0aWYgKGVsZXZhdG9yICE9PSB0cnVlKSB7XHJcblx0XHRcdHBvcy55ID0gKG1vdmluZ1NlY3Rvci5zZWN0b3IuZmxvb3JUb3BZICsgbW92aW5nU2VjdG9yLnNlY3Rvci5jZWlsQm90dG9tWSkgLyAyO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cG9zLnkgPSBtb3ZpbmdTZWN0b3Iuc2VjdG9yLmZsb29yVG9wWSAtIG1vdmluZ1NlY3Rvci5zZWN0b3IuZWxldmF0b3JNYXhIZWlnaHQgLyAyO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBwb3M7XHJcblx0fSxcclxuXHJcblx0Z2V0TW92aW5nU2VjdG9yU2lkZU1lc2g6IGZ1bmN0aW9uKG1vdmluZ1NlY3RvciwgbW92aW5nU2VjdG9yVHJpYW5nbGVzLCBtYXRlcmlhbCwgZWxldmF0b3IpIHtcclxuXHRcdHZhciBib3R0b21ZLCB0b3BZO1xyXG5cdFx0aWYgKGVsZXZhdG9yICE9PSB0cnVlKSB7XHJcblx0XHRcdGJvdHRvbVkgPSBtb3ZpbmdTZWN0b3Iuc2VjdG9yLmZsb29yVG9wWTtcclxuXHRcdFx0dG9wWSA9IG1vdmluZ1NlY3Rvci5zZWN0b3IuY2VpbEJvdHRvbVk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRib3R0b21ZID0gbW92aW5nU2VjdG9yLnNlY3Rvci5mbG9vclRvcFkgLSBtb3ZpbmdTZWN0b3Iuc2VjdG9yLmVsZXZhdG9yTWF4SGVpZ2h0O1xyXG5cdFx0XHR0b3BZID0gbW92aW5nU2VjdG9yLnNlY3Rvci5mbG9vclRvcFk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkdlb21ldHJ5KCk7XHJcblx0XHR2YXIgY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IobW92aW5nU2VjdG9yLnNlY3Rvci5saWdodENvbG9yKTtcclxuXHRcdHZhciBlbWlzc2l2ZSA9IHRoaXMuZ2V0RW1pc3NpdmVDb2xvcihtb3ZpbmdTZWN0b3Iuc2VjdG9yLmxpZ2h0TGV2ZWwpO1xyXG5cdFx0dmFyIHRyaWFuZ2xlcyA9IFtdO1xyXG5cclxuXHRcdHZhciBrID0gMDtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbW92aW5nU2VjdG9yLnNlY3Rvci52ZXJ0aWNlcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgbmV4dCA9IChpIDwgbW92aW5nU2VjdG9yLnNlY3Rvci52ZXJ0aWNlcy5sZW5ndGggLSAxKSA/IChpICsgMSkgOiAwO1xyXG5cclxuXHRcdFx0dmFyIHN0YXJ0ID0gbW92aW5nU2VjdG9yLnNlY3Rvci52ZXJ0aWNlc1tpXTtcclxuXHRcdFx0dmFyIGVuZCA9IG1vdmluZ1NlY3Rvci5zZWN0b3IudmVydGljZXNbbmV4dF07XHJcblxyXG5cdFx0XHR2YXIgZGlzdGFuY2UgPSBzdGFydC5kaXN0YW5jZVRvKGVuZCk7XHJcblx0XHRcdHZhciBsZW5ndGg7XHJcblx0XHRcdGlmIChkaXN0YW5jZSA+IHRoaXMudGV4U2NhbGUpIHtcclxuXHRcdFx0XHRsZW5ndGggPSBNYXRoLnJvdW5kKChkaXN0YW5jZSAvICh0aGlzLnRleFNjYWxlICogdGhpcy50ZXhTY2FsZSkpICogdGhpcy50ZXhTY2FsZSk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0bGVuZ3RoID0gZGlzdGFuY2UgLyB0aGlzLnRleFNjYWxlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR2YXIgdmVydGljZXMgPSBbXHJcblx0XHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoc3RhcnQueCwgdG9wWSwgc3RhcnQueSksXHJcblx0XHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoZW5kLngsIHRvcFksIGVuZC55KSxcclxuXHRcdFx0XHRuZXcgVEhSRUUuVmVjdG9yMyhzdGFydC54LCBib3R0b21ZLCBzdGFydC55KSxcclxuXHRcdFx0XHRuZXcgVEhSRUUuVmVjdG9yMyhlbmQueCwgdG9wWSwgZW5kLnkpLFxyXG5cdFx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKGVuZC54LCBib3R0b21ZLCBlbmQueSksXHJcblx0XHRcdFx0bmV3IFRIUkVFLlZlY3RvcjMoc3RhcnQueCwgYm90dG9tWSwgc3RhcnQueSksXHJcblx0XHRcdF07XHJcblxyXG5cdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IHZlcnRpY2VzLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdFx0dHJpYW5nbGVzLnB1c2godmVydGljZXNbal0uY2xvbmUoKSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdmVydGljZXMubGVuZ3RoOyBqKyspIHtcclxuXHRcdFx0XHR2ZXJ0aWNlc1tqXS5zdWIobW92aW5nU2VjdG9yLnBvc2l0aW9uKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0R1MucHVzaEFycmF5KGdlb21ldHJ5LnZlcnRpY2VzLCB2ZXJ0aWNlcyk7XHJcblxyXG5cdFx0XHRpZiAoIW1vdmluZ1NlY3Rvci5zZWN0b3IudXNlVmVydGV4Q29sb3JzKSB7XHJcblx0XHRcdFx0Z2VvbWV0cnkuZmFjZXMucHVzaChuZXcgVEhSRUUuRmFjZTMoaywgayArIDEsIGsgKyAyKSk7XHJcblx0XHRcdFx0Z2VvbWV0cnkuZmFjZXMucHVzaChuZXcgVEhSRUUuRmFjZTMoayArIDMsIGsgKyA0LCBrICsgNSkpO1xyXG5cclxuXHRcdFx0XHRnZW9tZXRyeS5mYWNlVmVydGV4VXZzWzBdLnB1c2goW1xyXG5cdFx0XHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoMCwgdG9wWSAvIHRoaXMudGV4U2NhbGUpLFxyXG5cdFx0XHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIobGVuZ3RoLCB0b3BZIC8gdGhpcy50ZXhTY2FsZSksXHJcblx0XHRcdFx0XHRuZXcgVEhSRUUuVmVjdG9yMigwLCBib3R0b21ZIC8gdGhpcy50ZXhTY2FsZSksXHJcblx0XHRcdFx0XSk7XHJcblx0XHRcdFx0Z2VvbWV0cnkuZmFjZVZlcnRleFV2c1swXS5wdXNoKFtcclxuXHRcdFx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKGxlbmd0aCwgdG9wWSAvIHRoaXMudGV4U2NhbGUpLFxyXG5cdFx0XHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIobGVuZ3RoLCBib3R0b21ZIC8gdGhpcy50ZXhTY2FsZSksXHJcblx0XHRcdFx0XHRuZXcgVEhSRUUuVmVjdG9yMigwLCBib3R0b21ZIC8gdGhpcy50ZXhTY2FsZSksXHJcblx0XHRcdFx0XSk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dmFyIGZhY2UxID0gbmV3IFRIUkVFLkZhY2UzKGssIGsgKyAxLCBrICsgMixcclxuXHRcdFx0XHRcdG51bGwsIGNvbG9yKTtcclxuXHRcdFx0XHRmYWNlMS5lbWlzc2l2ZSA9IGVtaXNzaXZlO1xyXG5cclxuXHRcdFx0XHRnZW9tZXRyeS5mYWNlcy5wdXNoKGZhY2UxKTtcclxuXHJcblx0XHRcdFx0dmFyIGZhY2UyID0gbmV3IFRIUkVFLkZhY2UzKGsgKyAzLCBrICsgNCwgayArIDUsXHJcblx0XHRcdFx0XHRudWxsLCBjb2xvcik7XHJcblx0XHRcdFx0ZmFjZTIuZW1pc3NpdmUgPSBlbWlzc2l2ZTtcclxuXHJcblx0XHRcdFx0Z2VvbWV0cnkuZmFjZXMucHVzaChmYWNlMik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGsgKz0gNjtcclxuXHRcdH1cclxuXHJcblx0XHRHUy5wdXNoQXJyYXkobW92aW5nU2VjdG9yVHJpYW5nbGVzLCB0cmlhbmdsZXMpO1xyXG5cclxuXHRcdGdlb21ldHJ5LmNvbXB1dGVGYWNlTm9ybWFscygpO1xyXG5cdFx0Z2VvbWV0cnkuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTtcclxuXHJcblx0XHRpZiAobW92aW5nU2VjdG9yLnNlY3Rvci51c2VWZXJ0ZXhDb2xvcnMpIHtcclxuXHRcdFx0dmFyIGJ1ZmZlckdlbyA9IG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpXHJcblx0XHRcdFx0LmZyb21HZW9tZXRyeShnZW9tZXRyeSwge1xyXG5cdFx0XHRcdFx0dmVydGV4Q29sb3JzOiBUSFJFRS5GYWNlQ29sb3JzXHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gbmV3IFRIUkVFLk1lc2goYnVmZmVyR2VvLCBtYXRlcmlhbCk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRNb3ZpbmdTZWN0b3JDZW50ZXJNZXNoOiBmdW5jdGlvbihtb3ZpbmdTZWN0b3IsIG1vdmluZ1NlY3RvclRyaWFuZ2xlcywgbWF0ZXJpYWwsIGVsZXZhdG9yKSB7XHJcblx0XHR2YXIgbWluSGVpZ2h0ID0gbW92aW5nU2VjdG9yLnNlY3Rvci5mbG9vclRvcFk7XHJcblxyXG5cdFx0dmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkdlb21ldHJ5KCk7XHJcblx0XHR2YXIgY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IobW92aW5nU2VjdG9yLnNlY3Rvci5saWdodENvbG9yKTtcclxuXHRcdHZhciBlbWlzc2l2ZSA9IHRoaXMuZ2V0RW1pc3NpdmVDb2xvcihtb3ZpbmdTZWN0b3Iuc2VjdG9yLmxpZ2h0TGV2ZWwpO1xyXG5cclxuXHRcdHZhciB2ID0gbW92aW5nU2VjdG9yLnNlY3Rvci52ZXJ0aWNlcztcclxuXHRcdHZhciBpZHggPSBtb3ZpbmdTZWN0b3Iuc2VjdG9yLmluZGljZXM7XHJcblx0XHR2YXIgdjAsIHYxLCB2MjtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgaWR4Lmxlbmd0aDsgaSArPSAzKSB7XHJcblx0XHRcdGlmIChlbGV2YXRvciA9PT0gdHJ1ZSkge1xyXG5cdFx0XHRcdHYwID0gbmV3IFRIUkVFLlZlY3RvcjModltpZHhbaSArIDJdXS54LCBtaW5IZWlnaHQsIHZbaWR4W2kgKyAyXV0ueSk7XHJcblx0XHRcdFx0djEgPSBuZXcgVEhSRUUuVmVjdG9yMyh2W2lkeFtpICsgMV1dLngsIG1pbkhlaWdodCwgdltpZHhbaSArIDFdXS55KTtcclxuXHRcdFx0XHR2MiA9IG5ldyBUSFJFRS5WZWN0b3IzKHZbaWR4W2ldXS54LCBtaW5IZWlnaHQsIHZbaWR4W2ldXS55KTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR2MCA9IG5ldyBUSFJFRS5WZWN0b3IzKHZbaWR4W2ldXS54LCBtaW5IZWlnaHQsIHZbaWR4W2ldXS55KTtcclxuXHRcdFx0XHR2MSA9IG5ldyBUSFJFRS5WZWN0b3IzKHZbaWR4W2kgKyAxXV0ueCwgbWluSGVpZ2h0LCB2W2lkeFtpICsgMV1dLnkpO1xyXG5cdFx0XHRcdHYyID0gbmV3IFRIUkVFLlZlY3RvcjModltpZHhbaSArIDJdXS54LCBtaW5IZWlnaHQsIHZbaWR4W2kgKyAyXV0ueSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICghbW92aW5nU2VjdG9yLnNlY3Rvci51c2VWZXJ0ZXhDb2xvcnMpIHtcclxuXHRcdFx0XHRnZW9tZXRyeS5mYWNlcy5wdXNoKG5ldyBUSFJFRS5GYWNlMyhpLCBpICsgMSwgaSArIDIpKTtcclxuXHRcdFx0XHRnZW9tZXRyeS5mYWNlVmVydGV4VXZzWzBdLnB1c2goW1xyXG5cdFx0XHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIodjAueCAvIHRoaXMudGV4U2NhbGUsIHYwLnogLyB0aGlzLnRleFNjYWxlKSxcclxuXHRcdFx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKHYxLnggLyB0aGlzLnRleFNjYWxlLCB2MS56IC8gdGhpcy50ZXhTY2FsZSksXHJcblx0XHRcdFx0XHRuZXcgVEhSRUUuVmVjdG9yMih2Mi54IC8gdGhpcy50ZXhTY2FsZSwgdjIueiAvIHRoaXMudGV4U2NhbGUpLFxyXG5cdFx0XHRcdF0pO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHZhciBmYWNlID0gbmV3IFRIUkVFLkZhY2UzKGksIGkgKyAxLCBpICsgMixcclxuXHRcdFx0XHRcdG51bGwsIGNvbG9yKTtcclxuXHRcdFx0XHRmYWNlLmVtaXNzaXZlID0gZW1pc3NpdmU7XHJcblxyXG5cdFx0XHRcdGdlb21ldHJ5LmZhY2VzLnB1c2goZmFjZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHYwLnN1Yihtb3ZpbmdTZWN0b3IucG9zaXRpb24pO1xyXG5cdFx0XHR2MS5zdWIobW92aW5nU2VjdG9yLnBvc2l0aW9uKTtcclxuXHRcdFx0djIuc3ViKG1vdmluZ1NlY3Rvci5wb3NpdGlvbik7XHJcblxyXG5cdFx0XHRnZW9tZXRyeS52ZXJ0aWNlcy5wdXNoKHYwKTtcclxuXHRcdFx0Z2VvbWV0cnkudmVydGljZXMucHVzaCh2MSk7XHJcblx0XHRcdGdlb21ldHJ5LnZlcnRpY2VzLnB1c2godjIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHYgPSBtb3ZpbmdTZWN0b3Iuc2VjdG9yLmNvbGxpc2lvblZlcnRpY2VzO1xyXG5cdFx0aWR4ID0gbW92aW5nU2VjdG9yLnNlY3Rvci5jb2xsaXNpb25JbmRpY2VzO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBpZHgubGVuZ3RoOyBpICs9IDMpIHtcclxuXHRcdFx0aWYgKGVsZXZhdG9yID09PSB0cnVlKSB7XHJcblx0XHRcdFx0djAgPSBuZXcgVEhSRUUuVmVjdG9yMyh2W2lkeFtpICsgMl1dLngsIG1pbkhlaWdodCwgdltpZHhbaSArIDJdXS55KTtcclxuXHRcdFx0XHR2MSA9IG5ldyBUSFJFRS5WZWN0b3IzKHZbaWR4W2kgKyAxXV0ueCwgbWluSGVpZ2h0LCB2W2lkeFtpICsgMV1dLnkpO1xyXG5cdFx0XHRcdHYyID0gbmV3IFRIUkVFLlZlY3RvcjModltpZHhbaV1dLngsIG1pbkhlaWdodCwgdltpZHhbaV1dLnkpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHYwID0gbmV3IFRIUkVFLlZlY3RvcjModltpZHhbaV1dLngsIG1pbkhlaWdodCwgdltpZHhbaV1dLnkpO1xyXG5cdFx0XHRcdHYxID0gbmV3IFRIUkVFLlZlY3RvcjModltpZHhbaSArIDFdXS54LCBtaW5IZWlnaHQsIHZbaWR4W2kgKyAxXV0ueSk7XHJcblx0XHRcdFx0djIgPSBuZXcgVEhSRUUuVmVjdG9yMyh2W2lkeFtpICsgMl1dLngsIG1pbkhlaWdodCwgdltpZHhbaSArIDJdXS55KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bW92aW5nU2VjdG9yVHJpYW5nbGVzLnB1c2godjApO1xyXG5cdFx0XHRtb3ZpbmdTZWN0b3JUcmlhbmdsZXMucHVzaCh2MSk7XHJcblx0XHRcdG1vdmluZ1NlY3RvclRyaWFuZ2xlcy5wdXNoKHYyKTtcclxuXHRcdH1cclxuXHJcblx0XHRnZW9tZXRyeS5jb21wdXRlRmFjZU5vcm1hbHMoKTtcclxuXHRcdGdlb21ldHJ5LmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7XHJcblxyXG5cdFx0aWYgKG1vdmluZ1NlY3Rvci5zZWN0b3IudXNlVmVydGV4Q29sb3JzKSB7XHJcblx0XHRcdHZhciBidWZmZXJHZW8gPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKVxyXG5cdFx0XHRcdC5mcm9tR2VvbWV0cnkoZ2VvbWV0cnksIHtcclxuXHRcdFx0XHRcdHZlcnRleENvbG9yczogVEhSRUUuRmFjZUNvbG9yc1xyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0cmV0dXJuIG5ldyBUSFJFRS5NZXNoKGJ1ZmZlckdlbywgbWF0ZXJpYWwpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0YXBwbHlUVlNjcmVlblZpZXc6IGZ1bmN0aW9uKHR2U2NyZWVuKSB7XHJcblx0XHR0dlNjcmVlbi52aWV3Lm1lc2ggPSB0aGlzLmdldFRWU2NyZWVuTWVzaCh0dlNjcmVlbik7XHJcblxyXG5cdFx0dHZTY3JlZW4udmlldy5tZXNoLm1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuXHRcdFx0bWFwOiB0aGlzLnRleHR1cmVzW3R2U2NyZWVuLnNlZ21lbnQudGV4SWRdLFxyXG5cdFx0XHRkZXB0aFdyaXRlOiBmYWxzZSxcclxuXHRcdFx0cG9seWdvbk9mZnNldDogdHJ1ZSxcclxuXHRcdFx0cG9seWdvbk9mZnNldEZhY3RvcjogLTQsXHJcblx0XHRcdHRyYW5zcGFyZW50OiB0cnVlLFxyXG5cdFx0fSk7XHJcblx0fSxcclxuXHJcblx0YXBwbHlTd2l0Y2hWaWV3OiBmdW5jdGlvbihzd2l0Y2hPYmopIHtcclxuXHRcdHN3aXRjaE9iai5zZWdtZW50LmJvdHRvbVkgKz0gODtcclxuXHRcdHN3aXRjaE9iai5zZWdtZW50LnRvcFkgPSBzd2l0Y2hPYmouc2VnbWVudC5ib3R0b21ZICsgODtcclxuXHRcdHN3aXRjaE9iai52aWV3Lm1lc2ggPSB0aGlzLmdldFRWU2NyZWVuTWVzaChzd2l0Y2hPYmopO1xyXG5cclxuXHRcdHN3aXRjaE9iai52aWV3LmNvbGxpc2lvbkRhdGEuYm91bmRpbmdCb3guc2V0RnJvbVBvaW50cyhbXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IzKHN3aXRjaE9iai5zZWdtZW50LnN0YXJ0LngsIHN3aXRjaE9iai5zZWdtZW50LmJvdHRvbVksIHN3aXRjaE9iai5zZWdtZW50LnN0YXJ0LnkpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMyhzd2l0Y2hPYmouc2VnbWVudC5lbmQueCwgc3dpdGNoT2JqLnNlZ21lbnQudG9wWSwgc3dpdGNoT2JqLnNlZ21lbnQuZW5kLnkpLFxyXG5cdFx0XSk7XHJcblxyXG5cdFx0c3dpdGNoT2JqLnZpZXcudGV4dHVyZU9uID0gdGhpcy50ZXh0dXJlcy5zd2l0Y2hfb247XHJcblx0XHRzd2l0Y2hPYmoudmlldy50ZXh0dXJlT2ZmID0gdGhpcy50ZXh0dXJlcy5zd2l0Y2hfb2ZmO1xyXG5cclxuXHRcdHN3aXRjaE9iai52aWV3Lm1lc2gubWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG5cdFx0XHRtYXA6IHN3aXRjaE9iai52aWV3LnRleHR1cmVPZmYsXHJcblx0XHRcdGRlcHRoV3JpdGU6IGZhbHNlLFxyXG5cdFx0XHRwb2x5Z29uT2Zmc2V0OiB0cnVlLFxyXG5cdFx0XHRwb2x5Z29uT2Zmc2V0RmFjdG9yOiAtNCxcclxuXHRcdFx0dHJhbnNwYXJlbnQ6IHRydWUsXHJcblx0XHR9KTtcclxuXHR9LFxyXG5cclxuXHRnZXRUVlNjcmVlbk1lc2g6IGZ1bmN0aW9uKHR2U2NyZWVuKSB7XHJcblx0XHR2YXIgc2VnID0gdHZTY3JlZW4uc2VnbWVudDtcclxuXHJcblx0XHR2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuR2VvbWV0cnkoKTtcclxuXHRcdHZhciB0cmlhbmdsZXMgPSB0aGlzLmdldFNlZ21lbnRUcmlhbmdsZXMoc2VnKTtcclxuXHRcdEdTLnB1c2hBcnJheShnZW9tZXRyeS52ZXJ0aWNlcywgdHJpYW5nbGVzKTtcclxuXHJcblx0XHRnZW9tZXRyeS5mYWNlcy5wdXNoKG5ldyBUSFJFRS5GYWNlMygwLCAxLCAyKSk7XHJcblx0XHRnZW9tZXRyeS5mYWNlcy5wdXNoKG5ldyBUSFJFRS5GYWNlMygzLCA0LCA1KSk7XHJcblxyXG5cdFx0Z2VvbWV0cnkuZmFjZVZlcnRleFV2c1swXS5wdXNoKFtcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoMSwgMCksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMigxLCAxKSxcclxuXHRcdF0pO1xyXG5cdFx0Z2VvbWV0cnkuZmFjZVZlcnRleFV2c1swXS5wdXNoKFtcclxuXHRcdFx0bmV3IFRIUkVFLlZlY3RvcjIoMCwgMCksXHJcblx0XHRcdG5ldyBUSFJFRS5WZWN0b3IyKDAsIDEpLFxyXG5cdFx0XHRuZXcgVEhSRUUuVmVjdG9yMigxLCAxKSxcclxuXHRcdF0pO1xyXG5cclxuXHRcdGdlb21ldHJ5LmNvbXB1dGVGYWNlTm9ybWFscygpO1xyXG5cdFx0Z2VvbWV0cnkuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTtcclxuXHJcblx0XHR2YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCB1bmRlZmluZWQpO1xyXG5cdFx0bWVzaC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7XHJcblx0XHRtZXNoLnJlbmRlckRlcHRoID0gMTAwMDtcclxuXHRcdHJldHVybiBtZXNoO1xyXG5cdH0sXHJcblxyXG5cdGdldFBsYXllclZpZXc6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHBsYXllclZpZXcgPSBuZXcgR1MuUGxheWVyVmlldygpO1xyXG5cdFx0dmFyIHdlYXBvbnMgPSBPYmplY3Qua2V5cyhHUy5XZWFwb25zKTtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgd2VhcG9ucy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgbmFtZSA9IHdlYXBvbnNbaV07XHJcblx0XHRcdGlmICh0aGlzLm1lc2hlc1tuYW1lXSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dmFyIG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbHNbbmFtZV0uY2xvbmUoKTtcclxuXHRcdFx0XHR2YXIgbWVzaCA9IHRoaXMubWVzaGVzW25hbWVdLmNsb25lKCk7XHJcblx0XHRcdFx0bWVzaC5tYXRlcmlhbCA9IG1hdGVyaWFsO1xyXG5cdFx0XHRcdHBsYXllclZpZXcuYWRkV2VhcG9uTWVzaChuYW1lLCBtZXNoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cGxheWVyVmlldy5pbml0KCk7XHJcblxyXG5cdFx0cmV0dXJuIHBsYXllclZpZXc7XHJcblx0fSxcclxuXHJcblx0Z2V0RGVidWdNZXNoOiBmdW5jdGlvbihwb3NpdGlvbikge1xyXG5cdFx0dmFyIGRlYnVnR2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoMSwgMSwgMSk7XHJcblx0XHR2YXIgZGVidWdNZXNoID0gbmV3IFRIUkVFLk1lc2goZGVidWdHZW9tZXRyeSwgdGhpcy5kZWJ1Z0JvdW5kaW5nQm94TWF0ZXJpYWwpO1xyXG5cdFx0ZGVidWdNZXNoLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pO1xyXG5cdFx0cmV0dXJuIGRlYnVnTWVzaDtcclxuXHR9LFxyXG5cclxuXHRnZXREZWJ1Z1RyaWFuZ2xlTWVzaDogZnVuY3Rpb24odHJpYW5nbGVzKSB7XHJcblx0XHR2YXIgZGVidWdHZW9tZXRyeSA9IG5ldyBUSFJFRS5HZW9tZXRyeSgpO1xyXG5cdFx0R1MucHVzaEFycmF5KGRlYnVnR2VvbWV0cnkudmVydGljZXMsIHRyaWFuZ2xlcyk7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpICs9IDMpIHtcclxuXHRcdFx0ZGVidWdHZW9tZXRyeS5mYWNlcy5wdXNoKG5ldyBUSFJFRS5GYWNlMyhpLCBpICsgMSwgaSArIDIpKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgZGVidWdNZXNoID0gbmV3IFRIUkVFLk1lc2goZGVidWdHZW9tZXRyeSwgdGhpcy5kZWJ1Z1RyaWFuZ2xlTWF0ZXJpYWwpO1xyXG5cdFx0ZGVidWdNZXNoLnVzZXJEYXRhLmlzVHJpYW5nbGVNZXNoID0gdHJ1ZTtcclxuXHRcdGRlYnVnTWVzaC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7XHJcblx0XHRyZXR1cm4gZGVidWdNZXNoO1xyXG5cdH0sXHJcbn07XHJcblxyXG5USFJFRS5FdmVudERpc3BhdGNoZXIucHJvdG90eXBlLmFwcGx5KEdTLlZpZXdGYWN0b3J5LnByb3RvdHlwZSk7XHJcbiIsIkdTLkFJTWFuYWdlciA9IGZ1bmN0aW9uKGdyaWQpIHtcclxuXHR0aGlzLmdyaWQgPSBncmlkO1xyXG5cdHRoaXMubWFwID0gZ3JpZC5tYXA7XHJcblx0dGhpcy5tYXBXb24gPSBmYWxzZTtcclxuXHJcblx0dGhpcy5tb25zdGVyc0tpbGxlZCA9IDA7XHJcblx0dGhpcy5tYXhNb25zdGVycyA9IDA7XHJcblx0dGhpcy5pdGVtc1BpY2tlZFVwID0gMDtcclxuXHR0aGlzLm1heEl0ZW1zID0gMDtcclxuXHJcblx0dGhpcy5sYXN0RnJhbWVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblx0dGhpcy50aW1lU3BlbnQgPSAwO1xyXG5cdHRoaXMubWludXRlcyA9IDA7XHJcblx0dGhpcy5zZWNvbmRzID0gMDtcclxuXHJcblx0dGhpcy5yZWdpb25zRGlzY292ZXJlZCA9IHt9O1xyXG59O1xyXG5cclxuR1MuQUlNYW5hZ2VyLnByb3RvdHlwZSA9IHtcclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuaW5pdFpvbmVzKCk7XHJcblxyXG5cdFx0dGhpcy5zZWN0b3JEaWN0ID0gdGhpcy5ncmlkLnJlZ2lvbkluZm8uc2VjdG9yRGljdDtcclxuXHRcdHRoaXMucmVnaW9ucyA9IHRoaXMuZ3JpZC5yZWdpb25JbmZvLnJlZ2lvbnM7XHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJlZ2lvbnMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dGhpcy5yZWdpb25zW2ldLm1lc2gudmlzaWJsZSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuYXNzaWduTW9uc3RlcnNUb1JlZ2lvbnMoKTtcclxuXHRcdHRoaXMuaW5pdEdyaWRPYmplY3RMaWJyYXJ5KCk7XHJcblx0XHR0aGlzLmluaXRTY3JpcHRzKCk7XHJcblx0fSxcclxuXHJcblx0aW5pdFpvbmVzOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuem9uZXMgPSB0aGlzLm1hcC5sYXllck9iamVjdHNbR1MuTWFwTGF5ZXJzLlpvbmVdO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnpvbmVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciB6b25lID0gdGhpcy56b25lc1tpXTtcclxuXHRcdFx0em9uZS5ib3VuZGluZ1NxdWFyZSA9IG5ldyBUSFJFRS5Cb3gyKCkuc2V0RnJvbVBvaW50cyhbem9uZS5zdGFydCwgem9uZS5lbmRdKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhc3NpZ25Nb25zdGVyc1RvUmVnaW9uczogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR0aGlzLmdyaWQuZm9yRWFjaFVuaXF1ZUdyaWRPYmplY3QoW0dTLk1vbnN0ZXJdLCBmdW5jdGlvbihtb25zdGVyKSB7XHJcblx0XHRcdGlmIChtb25zdGVyLnN0YXJ0aW5nU2VjdG9yICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHR2YXIgcmVnaW9uID0gdGhhdC5nZXRSZWdpb25CeVNlY3RvcklkKG1vbnN0ZXIuc3RhcnRpbmdTZWN0b3IuaWQpO1xyXG5cdFx0XHRcdGlmIChyZWdpb24gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0R0FNRS5oYW5kbGVGYXRhbEVycm9yKFwic2VjdG9yIG5vdCBpbiByZWdpb25cIik7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJlZ2lvbi5tb25zdGVycy5wdXNoKG1vbnN0ZXIpO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdEdBTUUuaGFuZGxlRmF0YWxFcnJvcihcIm1vbnN0ZXIgXCIgKyBtb25zdGVyLmlkICsgXCIgaGFzIG5vIHN0YXJ0aW5nIHNlY3RvclwiKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdGluaXRHcmlkT2JqZWN0TGlicmFyeTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dmFyIGxpYnJhcnkgPSB7XHJcblx0XHRcdGl0ZW1zOiB7fSxcclxuXHRcdFx0ZG9vcnM6IHt9LFxyXG5cdFx0XHRlbGV2YXRvcnM6IHt9LFxyXG5cdFx0XHRtb25zdGVyczoge30sXHJcblx0XHRcdHNlY3RvcnM6IHt9LFxyXG5cdFx0XHRzd2l0Y2hlczoge30sXHJcblx0XHR9O1xyXG5cclxuXHRcdHRoaXMuZ3JpZC5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdChbR1MuSXRlbSwgR1MuRG9vciwgR1MuRWxldmF0b3IsIEdTLk1vbnN0ZXIsIEdTLkNvbmNyZXRlLCBHUy5Td2l0Y2hdLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuSXRlbSkge1xyXG5cdFx0XHRcdGxpYnJhcnkuaXRlbXNbZ3JpZE9iamVjdC5zb3VyY2VPYmouaWRdID0gZ3JpZE9iamVjdDtcclxuXHRcdFx0fSBlbHNlXHJcblx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuRG9vcikge1xyXG5cdFx0XHRcdGxpYnJhcnkuZG9vcnNbZ3JpZE9iamVjdC5zZWN0b3IuaWRdID0gZ3JpZE9iamVjdDtcclxuXHRcdFx0fSBlbHNlXHJcblx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuRWxldmF0b3IpIHtcclxuXHRcdFx0XHRsaWJyYXJ5LmVsZXZhdG9yc1tncmlkT2JqZWN0LnNlY3Rvci5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdFx0XHR9IGVsc2VcclxuXHRcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Nb25zdGVyKSB7XHJcblx0XHRcdFx0bGlicmFyeS5tb25zdGVyc1tncmlkT2JqZWN0LnNvdXJjZU9iai5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdFx0XHR9IGVsc2VcclxuXHRcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Db25jcmV0ZSAmJiBncmlkT2JqZWN0LnR5cGUgPT0gR1MuTWFwTGF5ZXJzLlNlY3Rvcikge1xyXG5cdFx0XHRcdGxpYnJhcnkuc2VjdG9yc1tncmlkT2JqZWN0LnNvdXJjZU9iai5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdFx0XHR9IGVsc2VcclxuXHRcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Td2l0Y2gpIHtcclxuXHRcdFx0XHRsaWJyYXJ5LnN3aXRjaGVzW2dyaWRPYmplY3Quc2VnbWVudC5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHR0aGlzLmdyaWRPYmplY3RMaWJyYXJ5ID0gbGlicmFyeTtcclxuXHR9LFxyXG5cclxuXHRpbml0U2NyaXB0czogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5tYXAuaGFzU2NyaXB0ID09PSB0cnVlKSB7XHJcblx0XHRcdHRoaXMuc2NyaXB0ID0gbmV3IEdTLk1hcFNjcmlwdHNbdGhpcy5tYXAubmFtZV0odGhpcy5ncmlkT2JqZWN0TGlicmFyeSk7XHJcblx0XHRcdHRoaXMuc2NyaXB0LmluaXQoKTtcclxuXHJcblx0XHRcdHZhciBlbnRpdGllcyA9IHRoaXMuZ3JpZC5tYXAubGF5ZXJPYmplY3RzW0dTLk1hcExheWVycy5FbnRpdHldO1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGVudGl0aWVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIGVudGl0eSA9IGVudGl0aWVzW2ldO1xyXG5cdFx0XHRcdHZhciB0eXBlID0gR1MuTWFwRW50aXRpZXNbZW50aXR5LnR5cGVdLnR5cGU7XHJcblx0XHRcdFx0aWYgKHR5cGUgPT09IFwiTW9uc3RlclwiKSB7XHJcblx0XHRcdFx0XHR0aGlzLm1heE1vbnN0ZXJzKys7XHJcblx0XHRcdFx0fSBlbHNlXHJcblx0XHRcdFx0aWYgKHR5cGUgPT09IFwiSXRlbVwiKSB7XHJcblx0XHRcdFx0XHR0aGlzLm1heEl0ZW1zKys7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLnNjcmlwdCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuc2NyaXB0LnVwZGF0ZSgpO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuc2NyaXB0Lm1hcFdvbiAmJiAhdGhpcy5tYXBXb24pIHtcclxuXHRcdFx0XHR0aGlzLm1hcFdvbiA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIXRoaXMubWFwV29uKSB7XHJcblx0XHRcdHRoaXMudXBkYXRlVGltZSgpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVRpbWU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKCF0aGlzLmdyaWQucGxheWVyLmluTWVudSAmJiAhdGhpcy5vbmxpbmVQbGF5KSB7XHJcblx0XHRcdHRoaXMudGltZVNwZW50ICs9IHBlcmZvcm1hbmNlLm5vdygpIC0gdGhpcy5sYXN0RnJhbWVUaW1lO1xyXG5cdFx0XHR0aGlzLm1pbnV0ZXMgPSBNYXRoLmZsb29yKE1hdGguZmxvb3IodGhpcy50aW1lU3BlbnQpIC8gNjAwMDApO1xyXG5cdFx0XHR0aGlzLnNlY29uZHMgPSBNYXRoLmZsb29yKE1hdGguZmxvb3IodGhpcy50aW1lU3BlbnQpIC8gMTAwMCAtIHRoaXMubWludXRlcyAqIDYwKTtcclxuXHRcdH1cclxuXHRcdHRoaXMubGFzdEZyYW1lVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuXHRcdC8vIEdTLkRlYnVnVUkuc2V0U3RhdGljTGluZShcInRpbWUgc3BlbnRcIiwgR1MucGFkKHRoaXMubWludXRlcywgMikgKyBcIjpcIiArIEdTLnBhZCh0aGlzLnNlY29uZHMsIDIpKTtcclxuXHR9LFxyXG5cclxuXHRyZXN1bWU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5sYXN0RnJhbWVUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblx0fSxcclxuXHJcblx0b25Nb25zdGVyRGVhdGg6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5tb25zdGVyc0tpbGxlZCsrO1xyXG5cdH0sXHJcblxyXG5cdG9uUGxheWVyTW92ZTogZnVuY3Rpb24ocGxheWVyLCBvbGRQb3MsIG5ld1Bvcykge1xyXG5cdFx0aWYgKHRoaXMuc2NyaXB0ICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy5jaGVja1pvbmVzKHBsYXllciwgb2xkUG9zLCBuZXdQb3MpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMud2FrZVVwTmVhcmJ5TW9uc3RlcnMocGxheWVyKTtcclxuXHRcdHRoaXMuYXBwbHlSZWdpb25WaXNpYmlsaXR5KHBsYXllcik7XHJcblx0fSxcclxuXHJcblx0b25QbGF5ZXJTaG9vdDogZnVuY3Rpb24ocGxheWVyKSB7XHJcblx0XHR0aGlzLmFjdGl2YXRlTmVhcmJ5TW9uc3RlcnMocGxheWVyKTtcclxuXHR9LFxyXG5cclxuXHRvblBsYXllck9wZW5Eb29yOiBmdW5jdGlvbihkb29yKSB7XHJcblx0XHRpZiAodGhpcy5zY3JpcHQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLnNjcmlwdC5vblBsYXllck9wZW5Eb29yKGRvb3IpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdG9uUGxheWVySXRlbVBpY2t1cDogZnVuY3Rpb24ocGxheWVyLCBpdGVtKSB7XHJcblx0XHR0aGlzLml0ZW1zUGlja2VkVXArKztcclxuXHJcblx0XHRpZiAodGhpcy5zY3JpcHQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLnNjcmlwdC5vbkl0ZW1QaWNrdXAoaXRlbSk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0b25Td2l0Y2hTdGF0ZUNoYW5nZTogZnVuY3Rpb24oc3dpdGNoT2JqKSB7XHJcblx0XHRpZiAodGhpcy5zY3JpcHQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLnNjcmlwdC5vblN3aXRjaFN0YXRlQ2hhbmdlKHN3aXRjaE9iaik7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0YXBwbHlSZWdpb25WaXNpYmlsaXR5OiBmdW5jdGlvbihwbGF5ZXIpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmVnaW9ucy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR0aGlzLnJlZ2lvbnNbaV0ucmVhY2hlZFRoaXNGcmFtZSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciB2aXNpYmxlUmVnaW9ucyA9IDA7XHJcblx0XHR0aGlzLnByb3BhZ2F0ZVJlZ2lvbnMocGxheWVyLCBmdW5jdGlvbihyZWdpb24pIHtcclxuXHRcdFx0cmVnaW9uLnJlYWNoZWRUaGlzRnJhbWUgPSB0cnVlO1xyXG5cdFx0XHRyZWdpb24ubWVzaC52aXNpYmxlID0gdHJ1ZTtcclxuXHRcdFx0dmlzaWJsZVJlZ2lvbnMrKztcclxuXHRcdH0pO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yZWdpb25zLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciByZWdpb24gPSB0aGlzLnJlZ2lvbnNbaV07XHJcblx0XHRcdGlmIChyZWdpb24ubWVzaC52aXNpYmxlICYmICFyZWdpb24ucmVhY2hlZFRoaXNGcmFtZSkge1xyXG5cdFx0XHRcdHJlZ2lvbi5tZXNoLnZpc2libGUgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEdTLkRlYnVnVUkuc2V0U3RhdGljTGluZShcInRvdGFsIHJlZ2lvbnNcIiwgdGhpcy5yZWdpb25zLmxlbmd0aCk7XHJcblx0XHQvLyBHUy5EZWJ1Z1VJLnRyYWNrTnVtZXJpY1ZhbHVlKFwidmlzaWJsZSByZWdpb25zXCIsIHZpc2libGVSZWdpb25zKTtcclxuXHR9LFxyXG5cclxuXHRjaGVja1pvbmVzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBvbGRQb3MyZCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgbmV3UG9zMmQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwbGF5ZXIsIG9sZFBvcywgbmV3UG9zKSB7XHJcblx0XHRcdG9sZFBvcy50b1ZlY3RvcjIob2xkUG9zMmQpO1xyXG5cdFx0XHRuZXdQb3MudG9WZWN0b3IyKG5ld1BvczJkKTtcclxuXHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy56b25lcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciB6b25lID0gdGhpcy56b25lc1tpXTtcclxuXHRcdFx0XHR2YXIgYzEgPSB6b25lLmJvdW5kaW5nU3F1YXJlLmNvbnRhaW5zUG9pbnQob2xkUG9zMmQpO1xyXG5cdFx0XHRcdHZhciBjMiA9IHpvbmUuYm91bmRpbmdTcXVhcmUuY29udGFpbnNQb2ludChuZXdQb3MyZCk7XHJcblxyXG5cdFx0XHRcdGlmIChjMSAmJiAhYzIpIHtcclxuXHRcdFx0XHRcdHRoaXMuc2NyaXB0Lm9uWm9uZUxlYXZlKHpvbmUpO1xyXG5cdFx0XHRcdH0gZWxzZVxyXG5cdFx0XHRcdGlmICghYzEgJiYgYzIpIHtcclxuXHRcdFx0XHRcdHRoaXMuc2NyaXB0Lm9uWm9uZUVudGVyKHpvbmUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0d2FrZVVwTmVhcmJ5TW9uc3RlcnM6IGZ1bmN0aW9uKHBsYXllcikge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dGhpcy5wcm9wYWdhdGVSZWdpb25zKHBsYXllciwgZnVuY3Rpb24ocmVnaW9uKSB7IHRoYXQud2FrZVVwTW9uc3RlcnMocmVnaW9uKTsgfSk7XHJcblx0fSxcclxuXHJcblx0YWN0aXZhdGVOZWFyYnlNb25zdGVyczogZnVuY3Rpb24ocGxheWVyKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR0aGlzLnByb3BhZ2F0ZVJlZ2lvbnMocGxheWVyLCBmdW5jdGlvbihyZWdpb24pIHsgdGhhdC5hY3RpdmF0ZU1vbnN0ZXJzKHJlZ2lvbik7IH0pO1xyXG5cdH0sXHJcblxyXG5cdHByb3BhZ2F0ZVJlZ2lvbnM6IGZ1bmN0aW9uKHBsYXllciwgY2FsbGJhY2spIHtcclxuXHRcdHZhciBzZWN0b3IgPSBwbGF5ZXIuZ2V0U2VjdG9yKCk7XHJcblxyXG5cdFx0aWYgKHNlY3RvciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHZhciB0b1Zpc2l0ID0gWyB0aGlzLmdldFJlZ2lvbkJ5U2VjdG9ySWQoc2VjdG9yLmlkKSBdO1xyXG5cdFx0XHR2YXIgdmlzaXRlZCA9IHt9O1xyXG5cclxuXHRcdFx0d2hpbGUgKHRvVmlzaXQubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRcdHZhciByZWdpb24gPSB0b1Zpc2l0LnBvcCgpO1xyXG5cclxuXHRcdFx0XHRpZiAocmVnaW9uLmlkIGluIHZpc2l0ZWQpIHtcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR2aXNpdGVkW3JlZ2lvbi5pZF0gPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMucmVnaW9uc0Rpc2NvdmVyZWRbcmVnaW9uLmlkXSA9IHJlZ2lvbjtcclxuXHJcblx0XHRcdFx0Y2FsbGJhY2socmVnaW9uKTtcclxuXHRcdFx0XHRpZiAocmVnaW9uLmxpbmtlZFJlZ2lvbnMgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCByZWdpb24ubGlua2VkUmVnaW9ucy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0XHR2YXIgbGlua2VkID0gcmVnaW9uLmxpbmtlZFJlZ2lvbnNbaV07XHJcblx0XHRcdFx0XHRcdHZhciBzZWN0b3IgPSB0aGlzLnNlY3RvckRpY3RbbGlua2VkLmRvb3JJZF0uc2VjdG9yO1xyXG5cclxuXHRcdFx0XHRcdFx0aWYgKHNlY3Rvci5kb29yR3JpZE9iamVjdC5zdGF0ZSAhPT0gR1MuRG9vclN0YXRlcy5DbG9zZWQpIHtcclxuXHRcdFx0XHRcdFx0XHR0b1Zpc2l0LnB1c2gobGlua2VkLnJlZ2lvbik7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHR3YWtlVXBNb25zdGVyczogZnVuY3Rpb24ocmVnaW9uKSB7XHJcblx0XHRpZiAocmVnaW9uLmF3YWtlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJlZ2lvbi5tb25zdGVycy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRyZWdpb24ubW9uc3RlcnNbaV0ud2FrZVVwKCk7XHJcblx0XHR9XHJcblx0XHRyZWdpb24uYXdha2UgPSB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdGFjdGl2YXRlTW9uc3RlcnM6IGZ1bmN0aW9uKHJlZ2lvbikge1xyXG5cdFx0aWYgKHJlZ2lvbi5hY3RpdmUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcmVnaW9uLm1vbnN0ZXJzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHJlZ2lvbi5tb25zdGVyc1tpXS5hY3RpdmF0ZSgpO1xyXG5cdFx0fVxyXG5cdFx0cmVnaW9uLmFjdGl2ZSA9IHRydWU7XHJcblx0fSxcclxuXHJcblx0Z2V0UmVnaW9uQnlTZWN0b3JJZDogZnVuY3Rpb24oc2VjdG9ySWQpIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yZWdpb25zLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciByZWdpb24gPSB0aGlzLnJlZ2lvbnNbaV07XHJcblx0XHRcdGlmIChzZWN0b3JJZCBpbiByZWdpb24uc2VjdG9ySWRzKSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlZ2lvbjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdEdBTUUuaGFuZGxlRmF0YWxFcnJvcihcInNlY3RvciBoYXMgbm8gY29ycmVzcG9uZGluZyByZWdpb25cIik7XHJcblx0fSxcclxufTtcclxuIiwiR1MuQ2hyb21lQXBwRlBTQ29udHJvbHMgPSBmdW5jdGlvbihjYW1lcmEpIHtcblx0dGhpcy5jYW1lcmEgPSBjYW1lcmE7XG5cblx0dGhpcy5leWUgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xuXHR0aGlzLmZvbGxvd2luZ0V5ZSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XG5cdHRoaXMubG9vayA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xMCkuYWRkKHRoaXMuZXllKTtcblx0dGhpcy5sb29rTm9PZmZzZXQgPSB0aGlzLmxvb2suY2xvbmUoKTtcblxuXHR0aGlzLm1vdmVTcGVlZCA9IDE7XG5cdHRoaXMubG9va1NwZWVkID0gMC4wNjYgKiAoR1MuU2V0dGluZ3MubW91c2UgLyA1KTtcblx0dGhpcy5tb3VzZUludmVydFkgPSBHUy5TZXR0aW5ncy5tb3VzZUludmVydFk7XG5cblx0dGhpcy5mb3J3YXJkTG9va1ZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKTtcblx0dGhpcy5mb3J3YXJkTW92ZVZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKTtcblx0dGhpcy5yaWdodExvb2tWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygxLCAwLCAwKTtcblx0dGhpcy5yaWdodE1vdmVWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygxLCAwLCAwKTtcblxuXHR0aGlzLnhBbmdsZSA9IDI3MDtcblx0dGhpcy55QW5nbGUgPSA5MDtcblx0dGhpcy52aWV3T2Zmc2V0WSA9IDA7XG5cdHRoaXMuZXllT2Zmc2V0WSA9IDMuNTtcblxuXHR0aGlzLnBvaW50ZXJMb2NrRW5hYmxlZCA9IGZhbHNlO1xuXG5cdHRoaXMub25IYW5kbGVDb2xsaXNpb25zID0gZnVuY3Rpb24ob2xkUG9zLCBuZXdQb3MpIHt9O1xuXG5cdHRoaXMuZW5hYmxlZCA9IHRydWU7XG5cdHRoaXMuZmx5ID0gZmFsc2U7XG5cdHRoaXMueVNtb290aGluZyA9IGZhbHNlO1xuXHR0aGlzLnlTbW9vdGhpbmdGYWN0b3IgPSAwLjE7XG59O1xuXG5HUy5DaHJvbWVBcHBGUFNDb250cm9scy5wcm90b3R5cGUgPSB7XG5cdGNvbnN0cnVjdG9yOiBHUy5DaHJvbWVBcHBGUFNDb250cm9scyxcblxuXHRpbml0OiBmdW5jdGlvbigpIHtcblx0XHR2YXIgdGhhdCA9IHRoaXM7XG5cdFx0dmFyIHBvaW50ZXJMb2NrID0gXCJwb2ludGVyTG9ja0VsZW1lbnRcIiBpbiBkb2N1bWVudDtcblx0XHRpZiAoIXBvaW50ZXJMb2NrKSB7XG5cdFx0XHRHQU1FLmhhbmRsZUZhdGFsRXJyb3IoXCJQb2ludGVyIExvY2sgQVBJIG5vdCBzdXBwb3J0ZWRcIik7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0dGhpcy5jYW52YXMgPSAkKFwiI2dhbWUtY2FudmFzXCIpWzBdO1xuXHRcdHRoaXMuZGVidWdDYW52YXMgPSAkKFwiI2RlYnVnLXVpLWNhbnZhc1wiKVswXTtcblxuXHRcdHRoaXMuc2V0Vmlld0FuZ2xlcyh0aGlzLnhBbmdsZSwgdGhpcy55QW5nbGUpO1xuXHR9LFxuXG5cdGVuYWJsZTogZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xuXHRcdHRoaXMuY2FudmFzLnJlcXVlc3RQb2ludGVyTG9jaygpO1xuXHRcdCQoZG9jdW1lbnQpLm9mZihcIm1vdXNlbW92ZS5mcHNDb250cm9sc1wiKTtcblx0XHQkKGRvY3VtZW50KS5vbihcIm1vdXNlbW92ZS5mcHNDb250cm9sc1wiLCBmdW5jdGlvbihlKSB7IHRoYXQub25Nb3VzZU1vdmUoZS5vcmlnaW5hbEV2ZW50KTsgfSk7XG5cdH0sXG5cblx0ZGlzYWJsZTogZnVuY3Rpb24oKSB7XG5cdFx0ZG9jdW1lbnQuZXhpdFBvaW50ZXJMb2NrKCk7XG5cdFx0JChkb2N1bWVudCkub2ZmKFwibW91c2Vtb3ZlLmZwc0NvbnRyb2xzXCIpO1xuXHR9LFxuXG5cblx0b25Nb3VzZU1vdmU6IGZ1bmN0aW9uKGUpIHtcblx0XHRpZiAoIXRoaXMuZW5hYmxlZCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHZhciBteCA9IGUubW92ZW1lbnRYIHx8IGUubW96TW92ZW1lbnRYIHx8IGUud2Via2l0TW92ZW1lbnRYIHx8IDA7XG5cdFx0dmFyIG15ID0gZS5tb3ZlbWVudFkgfHwgZS5tb3pNb3ZlbWVudFkgfHwgZS53ZWJraXRNb3ZlbWVudFkgfHwgMDtcblxuXHRcdHZhciBpbnZlcnRZID0gdGhpcy5tb3VzZUludmVydFkgPyAtMSA6IDE7XG5cblx0XHR0aGlzLnNldFZpZXdBbmdsZXModGhpcy54QW5nbGUgKyBteCAqIHRoaXMubG9va1NwZWVkLCB0aGlzLnlBbmdsZSArIGludmVydFkgKiBteSAqIHRoaXMubG9va1NwZWVkKTtcblx0fSxcblxuXHRzZXRWaWV3T2Zmc2V0WTogZnVuY3Rpb24oeSkge1xuXHRcdHRoaXMudmlld09mZnNldFkgPSB5O1xuXHR9LFxuXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XG5cdFx0aWYgKCF0aGlzLmVuYWJsZWQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR2YXIgeCA9IDA7XG5cdFx0dmFyIHogPSAwO1xuXG5cdFx0aWYgKEdTLktleWJpbmRzLm1vdmVGb3J3YXJkLmluVXNlKSB7XG5cdFx0XHR6Kys7XG5cdFx0fVxuXHRcdGlmIChHUy5LZXliaW5kcy5tb3ZlQmFja3dhcmQuaW5Vc2UpIHtcblx0XHRcdHotLTtcblx0XHR9XG5cdFx0aWYgKEdTLktleWJpbmRzLnN0cmFmZUxlZnQuaW5Vc2UpIHtcblx0XHRcdHgtLTtcblx0XHR9XG5cdFx0aWYgKEdTLktleWJpbmRzLnN0cmFmZVJpZ2h0LmluVXNlKSB7XG5cdFx0XHR4Kys7XG5cdFx0fVxuXG5cdFx0dGhpcy5tb3ZlKHgsIHopO1xuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudCh7IHR5cGU6IFwidXBkYXRlXCIsIHBvczogdGhpcy5leWUsIHhBbmdsZTogdGhpcy54QW5nbGUsIHlBbmdsZTogdGhpcy55QW5nbGUsIGxvb2s6IHRoaXMubG9va05vT2Zmc2V0IH0pO1xuXHR9LFxuXG5cdG1vdmVUbzogZnVuY3Rpb24ocG9zKSB7XG5cdFx0dGhpcy5leWUuY29weShwb3MpO1xuXHRcdHRoaXMudXBkYXRlQ2FtZXJhKCk7XG5cdH0sXG5cblx0bW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0dmFyIG5ld1BvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XG5cdFx0dmFyIGF1eCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XG5cblx0XHRyZXR1cm4gZnVuY3Rpb24oeCwgeikge1xuXHRcdFx0bmV3UG9zLmNvcHkodGhpcy5leWUpO1xuXG5cdFx0XHRpZiAoeCAhPT0gMCB8fCB6ICE9PSAwKSB7XG5cdFx0XHRcdGF1eC5jb3B5KHRoaXMucmlnaHRNb3ZlVmVjdG9yKS5tdWx0aXBseVNjYWxhcih0aGlzLm1vdmVTcGVlZCAqIHgpO1xuXHRcdFx0XHRuZXdQb3MuYWRkKGF1eCk7XG5cdFx0XHRcdGF1eC5jb3B5KHRoaXMuZm9yd2FyZE1vdmVWZWN0b3IpLm11bHRpcGx5U2NhbGFyKHRoaXMubW92ZVNwZWVkICogeik7XG5cdFx0XHRcdG5ld1Bvcy5hZGQoYXV4KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5vbkhhbmRsZUNvbGxpc2lvbnModGhpcy5leWUsIG5ld1Bvcyk7XG5cblx0XHRcdHRoaXMuZXllLmNvcHkobmV3UG9zKTtcblx0XHRcdHRoaXMudXBkYXRlQ2FtZXJhKCk7XG5cdFx0fVxuXHR9KCksXG5cblx0dXBkYXRlQ2FtZXJhOiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLmZvbGxvd2luZ0V5ZS54ID0gdGhpcy5leWUueDtcblx0XHR0aGlzLmZvbGxvd2luZ0V5ZS56ID0gdGhpcy5leWUuejtcblx0XHRpZiAodGhpcy55U21vb3RoaW5nKSB7XG5cdFx0XHRpZiAodGhpcy5mb2xsb3dpbmdFeWUueSAhPSB0aGlzLmV5ZS55KSB7XG5cdFx0XHRcdHRoaXMuZm9sbG93aW5nRXllLnkgPSB0aGlzLmZvbGxvd2luZ0V5ZS55ICsgdGhpcy55U21vb3RoaW5nRmFjdG9yICogKHRoaXMuZXllLnkgLSB0aGlzLmZvbGxvd2luZ0V5ZS55KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5mb2xsb3dpbmdFeWUueSA9IHRoaXMuZXllLnk7XG5cdFx0fVxuXG5cdFx0dGhpcy5jYW1lcmEucG9zaXRpb24uY29weSh0aGlzLmZvbGxvd2luZ0V5ZSk7XG5cdFx0dGhpcy5jYW1lcmEucG9zaXRpb24ueSArPSB0aGlzLnZpZXdPZmZzZXRZICsgdGhpcy5leWVPZmZzZXRZO1xuXHRcdHRoaXMubG9va05vT2Zmc2V0LmFkZFZlY3RvcnModGhpcy5mb2xsb3dpbmdFeWUsIHRoaXMuZm9yd2FyZExvb2tWZWN0b3IpO1xuXHRcdHRoaXMubG9vay5hZGRWZWN0b3JzKHRoaXMuY2FtZXJhLnBvc2l0aW9uLCB0aGlzLmZvcndhcmRMb29rVmVjdG9yKTtcblx0XHR0aGlzLmNhbWVyYS5sb29rQXQodGhpcy5sb29rKTtcblx0fSxcblxuXHRzZXRWaWV3QW5nbGVzOiBmdW5jdGlvbigpIHtcblx0XHR2YXIgcmlnaHQgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xuXHRcdHZhciBmb3J3YXJkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcblxuXHRcdHJldHVybiBmdW5jdGlvbih4LCB5KSB7XG5cdFx0XHR0aGlzLnhBbmdsZSA9IHg7XG5cdFx0XHR0aGlzLnlBbmdsZSA9IEdTLk1hdGhIZWxwZXIuY2xhbXAoeSwgMTAsIDE3MCk7XG5cblx0XHRcdHZhciB4ID0gTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqIHRoaXMueUFuZ2xlKSAqIE1hdGguY29zKE1hdGguUEkgLyAxODAgKiB0aGlzLnhBbmdsZSk7XG5cdFx0XHR2YXIgeSA9IE1hdGguY29zKE1hdGguUEkgLyAxODAgKiB0aGlzLnlBbmdsZSk7XG5cdFx0XHR2YXIgeiA9IE1hdGguc2luKE1hdGguUEkgLyAxODAgKiB0aGlzLnlBbmdsZSkgKiBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogdGhpcy54QW5nbGUpO1xuXG5cdFx0XHRmb3J3YXJkLnNldCh4LCB5LCB6KTtcblxuXHRcdFx0eCA9IE1hdGguc2luKE1hdGguUEkgLyAxODAgKiB0aGlzLnlBbmdsZSkgKiBNYXRoLmNvcyhNYXRoLlBJIC8gMTgwICogKHRoaXMueEFuZ2xlICsgOTApKTtcblx0XHRcdHogPSBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogdGhpcy55QW5nbGUpICogTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqICh0aGlzLnhBbmdsZSArIDkwKSk7XG5cblx0XHRcdHJpZ2h0LnNldCh4LCAwLCB6KTtcblxuXHRcdFx0dGhpcy5mb3J3YXJkTG9va1ZlY3Rvci5jb3B5KGZvcndhcmQpO1xuXHRcdFx0aWYgKCF0aGlzLmZseSkge1xuXHRcdFx0XHR0aGlzLmZvcndhcmRNb3ZlVmVjdG9yLnNldChmb3J3YXJkLngsIDAsIGZvcndhcmQueikubm9ybWFsaXplKCk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0dGhpcy5mb3J3YXJkTW92ZVZlY3Rvci5jb3B5KGZvcndhcmQpLm5vcm1hbGl6ZSgpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5yaWdodExvb2tWZWN0b3IuY29weShyaWdodCkubm9ybWFsaXplKCk7XG5cdFx0XHR0aGlzLnJpZ2h0TW92ZVZlY3Rvci5jb3B5KHJpZ2h0KS5ub3JtYWxpemUoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVDYW1lcmEoKTtcblx0XHR9XG5cdH0oKSxcblxuXHRkaXNwb3NlOiBmdW5jdGlvbihjYWxsYmFjaykge1xuXHRcdHRoaXMub25IYW5kbGVDb2xsaXNpb25zID0gdW5kZWZpbmVkO1xuXHRcdHRoaXMuZGlzYWJsZSgpO1xuXHR9LFxufTtcblxuVEhSRUUuRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZS5hcHBseShHUy5DaHJvbWVBcHBGUFNDb250cm9scy5wcm90b3R5cGUpOyIsIkdTLkNvbGxpc2lvblR5cGVzID0ge1xyXG5cdE5vbmU6IDAsXHJcblx0RW52aXJvbm1lbnQ6IDEsXHJcblx0RW50aXR5OiAyLFxyXG59O1xyXG5cclxuR1MuQ29sbGlzaW9uTWFuYWdlciA9IGZ1bmN0aW9uKGdyaWQpIHtcclxuXHR0aGlzLmdyaWQgPSBncmlkO1xyXG5cdHRoaXMuZ3Jhdml0eSA9IDEuMzM7XHJcbn07XHJcblxyXG5HUy5Db2xsaXNpb25NYW5hZ2VyLnByb3RvdHlwZSA9IHtcclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHR9LFxyXG5cclxuXHRjb2xsaWRlT25saW5lUGxheWVyOiBmdW5jdGlvbihtb25zdGVyLCBvbGRQb3MsIG5ld1Bvcykge1xyXG4gICAgcmV0dXJuIHRoaXMuY29sbGlkZU1vbnN0ZXIobW9uc3Rlciwgb2xkUG9zLCBuZXdQb3MpO1xyXG4gIH0sXHJcblxyXG5cdGNvbGxpZGVQbGF5ZXI6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG9sZFBvc0JlZm9yZU1vdmUgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwbGF5ZXIsIG9sZFBvcywgbmV3UG9zKSB7XHJcblx0XHRcdG9sZFBvc0JlZm9yZU1vdmUuY29weShvbGRQb3MpO1xyXG5cclxuXHRcdFx0dGhpcy5jb2xsaWRlUGxheWVyRW52aXJvbm1lbnQocGxheWVyLCBvbGRQb3MsIG5ld1Bvcyk7XHJcblx0XHRcdHRoaXMudXBkYXRlR3JpZExvY2F0aW9uRWxsaXBzb2lkKHBsYXllciwgbmV3UG9zKTtcclxuXHRcdFx0dGhpcy5jb2xsaWRlUGxheWVySXRlbXMocGxheWVyKTtcclxuXHRcdFx0dGhpcy51cGRhdGVQbGF5ZXJVc2VUYXJnZXQocGxheWVyKTtcclxuXHJcblx0XHRcdHRoaXMuZ3JpZC5haU1hbmFnZXIub25QbGF5ZXJNb3ZlKHBsYXllciwgb2xkUG9zQmVmb3JlTW92ZSwgbmV3UG9zKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGNvbGxpZGVQbGF5ZXJFbnZpcm9ubWVudDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgcG9pbnRzID0gWyBuZXcgVEhSRUUuVmVjdG9yMigpLCBuZXcgVEhSRUUuVmVjdG9yMigpLCBuZXcgVEhSRUUuVmVjdG9yMigpLCBuZXcgVEhSRUUuVmVjdG9yMigpIF07XHJcblx0XHR2YXIgcG9pbnRzM2QgPSBbIG5ldyBUSFJFRS5WZWN0b3IzKCksIG5ldyBUSFJFRS5WZWN0b3IzKCksIG5ldyBUSFJFRS5WZWN0b3IzKCksIG5ldyBUSFJFRS5WZWN0b3IzKCkgXTtcclxuXHRcdHZhciB2ZWxvY2l0eUJvdW5kaW5nQm94ID0gbmV3IFRIUkVFLkJveDMoKTtcclxuXHRcdHZhciB0eXBlcyA9IFtHUy5Nb25zdGVyLCBHUy5Db25jcmV0ZSwgR1MuRG9vciwgR1MuRWxldmF0b3JdO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwbGF5ZXIsIG9sZFBvcywgbmV3UG9zKSB7XHJcblx0XHRcdHZhciBsc3AgPSBwbGF5ZXIudmlldy5jb2xsaXNpb25EYXRhLmVsbGlwc29pZDtcclxuXHJcblx0XHRcdHBvaW50c1swXS5zZXQob2xkUG9zLnggKyBsc3AueCwgb2xkUG9zLnogKyBsc3Aueik7XHJcblx0XHRcdHBvaW50c1sxXS5zZXQob2xkUG9zLnggLSBsc3AueCwgb2xkUG9zLnogLSBsc3Aueik7XHJcblx0XHRcdHBvaW50c1syXS5zZXQobmV3UG9zLnggKyBsc3AueCwgbmV3UG9zLnogKyBsc3Aueik7XHJcblx0XHRcdHBvaW50c1szXS5zZXQobmV3UG9zLnggLSBsc3AueCwgbmV3UG9zLnogLSBsc3Aueik7XHJcblxyXG5cdFx0XHR2YXIgZ3JpZExvY2F0aW9uID0gdGhpcy5ncmlkLmdldEdyaWRMb2NhdGlvbkZyb21Qb2ludHMocG9pbnRzKTtcclxuXHJcblx0XHRcdHBvaW50czNkWzBdLmNvcHkob2xkUG9zKS5zdWIocGxheWVyLnNpemUpO1xyXG5cdFx0XHRwb2ludHMzZFsxXS5jb3B5KG9sZFBvcykuYWRkKHBsYXllci5zaXplKTtcclxuXHRcdFx0cG9pbnRzM2RbMl0uY29weShuZXdQb3MpLnN1YihwbGF5ZXIuc2l6ZSk7XHJcblx0XHRcdHBvaW50czNkWzNdLmNvcHkobmV3UG9zKS5hZGQocGxheWVyLnNpemUpO1xyXG5cclxuXHRcdFx0dmVsb2NpdHlCb3VuZGluZ0JveC5zZXRGcm9tUG9pbnRzKHBvaW50czNkKTtcclxuXHRcdFx0dmVsb2NpdHlCb3VuZGluZ0JveC5leHBhbmRCeVNjYWxhcih0aGlzLmdyYXZpdHkgKiAyKTtcclxuXHJcblx0XHRcdGlmIChncmlkTG9jYXRpb24gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHRyaWFuZ2xlSXRlcmF0b3IgPSB0aGlzLmdyaWQuZ2V0VHJpYW5nbGVJdGVyYXRvcihncmlkTG9jYXRpb24sIHR5cGVzLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHRcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Nb25zdGVyICYmIGdyaWRPYmplY3QuZGVhZCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRyZXR1cm4gZ3JpZE9iamVjdC52aWV3LmNvbGxpc2lvbkRhdGEuYm91bmRpbmdCb3guaXNJbnRlcnNlY3Rpb25Cb3godmVsb2NpdHlCb3VuZGluZ0JveCk7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0dmFyIGdyYXZpdHkgPSBwbGF5ZXIuZmx5RW5hYmxlZCA/IDAgOiB0aGlzLmdyYXZpdHk7XHJcblx0XHRcdHZhciByZXN1bHQgPSBHUy5Db2xsaXNpb25IZWxwZXIuaGFuZGxlQ29sbGlzaW9uc1NsaWRpbmcob2xkUG9zLCBuZXdQb3MsIGdyYXZpdHksIGxzcCwgdHJpYW5nbGVJdGVyYXRvcik7XHJcblx0XHRcdHBsYXllci5hZnRlckNvbGxpc2lvbihyZXN1bHQpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0c2xpZGluZ0JveExpbmVDb2xsaXNpb246IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG5ld1BvczAgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIGF1eCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgc2xpZGVWZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgZXBzaWxvbiA9IDAuMDA1O1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihvbGRQb3MsIG5ld1BvcywgYm94LCBsaW5lU2VnbWVudEl0ZXJhdG9yKSB7XHJcblx0XHRcdG5ld1BvczAuY29weShuZXdQb3MpO1xyXG5cclxuXHRcdFx0dmFyIGsgPSAwO1xyXG5cdFx0XHR2YXIgZm91bmRDb2xsaXNpb247XHJcblxyXG5cdFx0XHR3aGlsZSAoayA8IDUpIHtcclxuXHRcdFx0XHRmb3VuZENvbGxpc2lvbiA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHRsaW5lU2VnbWVudEl0ZXJhdG9yKGl0ZXJhdG9yKTtcclxuXHJcblx0XHRcdFx0aWYgKCFmb3VuZENvbGxpc2lvbikge1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRrKys7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG5ld1Bvcy5jb3B5KG5ld1BvczApO1xyXG5cclxuXHRcdFx0ZnVuY3Rpb24gaXRlcmF0b3Ioc2VnKSB7XHJcblx0XHRcdFx0R0FNRS5ncmlkLnRvdGFsQm94U2VnbWVudENoZWNrcysrO1xyXG5cdFx0XHRcdHZhciByZXN1bHQgPSBib3guaXNJbnRlcnNlY3Rpb25MaW5lU3dlcHQob2xkUG9zLCBuZXdQb3MwLCBzZWcpO1xyXG5cclxuXHRcdFx0XHRpZiAocmVzdWx0LmZvdW5kQ29sbGlzaW9uKSB7XHJcblx0XHRcdFx0XHRmb3VuZENvbGxpc2lvbiA9IHRydWU7XHJcblxyXG5cdFx0XHRcdFx0YXV4LmNvcHkobmV3UG9zMCkuc3ViKHJlc3VsdC5wb3MpO1xyXG5cdFx0XHRcdFx0dmFyIG0gPSAtYXV4LmRvdChyZXN1bHQubm9ybWFsKTtcclxuXHJcblx0XHRcdFx0XHRzbGlkZVZlbG9jaXR5LmNvcHkoYXV4KTtcclxuXHRcdFx0XHRcdGF1eC5jb3B5KHJlc3VsdC5ub3JtYWwpLm11bHRpcGx5U2NhbGFyKG0pO1xyXG5cdFx0XHRcdFx0c2xpZGVWZWxvY2l0eS5hZGQoYXV4KTtcclxuXHJcblx0XHRcdFx0XHRhdXguY29weShyZXN1bHQucG9zKS5zdWIobmV3UG9zMCkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoZXBzaWxvbik7XHJcblx0XHRcdFx0XHRyZXN1bHQucG9zLmFkZChhdXgpO1xyXG5cclxuXHRcdFx0XHRcdG5ld1BvczAuY29weShyZXN1bHQucG9zKS5hZGQoc2xpZGVWZWxvY2l0eSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRjb2xsaWRlUGxheWVySXRlbXM6IGZ1bmN0aW9uKHBsYXllcikge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dGhpcy5ncmlkLmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxscyhwbGF5ZXIubGlua2VkR3JpZENlbGxzLCBbR1MuSXRlbV0sIGZ1bmN0aW9uKGl0ZW0pIHtcclxuXHRcdFx0aWYgKHBsYXllci52aWV3LmNvbGxpc2lvbkRhdGEuYm91bmRpbmdCb3guaXNJbnRlcnNlY3Rpb25Cb3goaXRlbS52aWV3LmNvbGxpc2lvbkRhdGEuYm91bmRpbmdCb3gpKSB7XHJcblx0XHRcdFx0cGxheWVyLm9uSXRlbUNvbGxpc2lvbihpdGVtKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlUGxheWVyVXNlVGFyZ2V0OiBmdW5jdGlvbihwbGF5ZXIpIHtcclxuXHRcdHZhciByYXkgPSBuZXcgVEhSRUUuUmF5KCk7XHJcblx0XHR2YXIgcG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIGVuZFBvaW50ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBhdXggPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHBvaW50cyA9IFsgbmV3IFRIUkVFLlZlY3RvcjIoKSwgbmV3IFRIUkVFLlZlY3RvcjIoKSBdO1xyXG5cdFx0dmFyIHVzYWJsZVR5cGVzID0gW0dTLkRvb3IsIEdTLlN3aXRjaF07XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHBsYXllcikge1xyXG5cdFx0XHRwbGF5ZXIudXNlVGFyZ2V0ID0gbnVsbDtcclxuXHJcblx0XHRcdHBvc2l0aW9uLmNvcHkocGxheWVyLnBvc2l0aW9uKTtcclxuXHRcdFx0cG9zaXRpb24ueSArPSBwbGF5ZXIuY29udHJvbHMuZXllT2Zmc2V0WTtcclxuXHJcblx0XHRcdHJheS5zZXQocG9zaXRpb24sIHBsYXllci5kaXJlY3Rpb24pO1xyXG5cdFx0XHRhdXguY29weShwbGF5ZXIuZGlyZWN0aW9uKS5tdWx0aXBseVNjYWxhcihwbGF5ZXIudXNlUmFuZ2UpO1xyXG5cdFx0XHRlbmRQb2ludC5jb3B5KHBvc2l0aW9uKS5hZGQoYXV4KTtcclxuXHJcblx0XHRcdHBvc2l0aW9uLnRvVmVjdG9yMihwb2ludHNbMF0pO1xyXG5cdFx0XHRlbmRQb2ludC50b1ZlY3RvcjIocG9pbnRzWzFdKTtcclxuXHJcblx0XHRcdHZhciBncmlkTG9jYXRpb24gPSB0aGlzLmdyaWQuZ2V0R3JpZExvY2F0aW9uRnJvbVBvaW50cyhwb2ludHMpO1xyXG5cdFx0XHRpZiAoZ3JpZExvY2F0aW9uID09PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciBjZWxscyA9IHRoaXMuZ3JpZC5nZXRDZWxsc0Zyb21HcmlkTG9jYXRpb24oZ3JpZExvY2F0aW9uKTtcclxuXHRcdFx0dmFyIG1pbkRpc3QgPSBJbmZpbml0eTtcclxuXHRcdFx0dmFyIG1pbk9iamVjdCA9IG51bGw7XHJcblx0XHRcdHRoaXMuZ3JpZC5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdEluQ2VsbHMoY2VsbHMsIHVzYWJsZVR5cGVzLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHRcdFx0aWYgKHJheS5pbnRlcnNlY3RzT3JTdGFydHNJbkJveChncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ0JveCwgYXV4KSAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0dmFyIGRpc3QgPSBhdXguZGlzdGFuY2VUbyhwb3NpdGlvbik7XHJcblx0XHRcdFx0XHRpZiAoZGlzdCA8PSBwbGF5ZXIudXNlUmFuZ2UgJiYgZGlzdCA8IG1pbkRpc3QpIHtcclxuXHRcdFx0XHRcdFx0bWluRGlzdCA9IGRpc3Q7XHJcblx0XHRcdFx0XHRcdG1pbk9iamVjdCA9IGdyaWRPYmplY3Q7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHBsYXllci51c2VUYXJnZXQgPSBtaW5PYmplY3Q7XHJcblx0XHRcdHBsYXllci5jYW5Vc2UgPSAobWluT2JqZWN0ICE9PSBudWxsICYmIG1pbk9iamVjdC51c2FibGUpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Y2hlY2tNb25zdGVyTGluZU9mU2lnaHQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGRpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgcG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdFx0dmFyIHR5cGVzRW52aXJvbm1lbnQgPSBbR1MuRWxldmF0b3IsIEdTLkRvb3IsIEdTLkNvbmNyZXRlXTtcclxuXHRcdHZhciB0eXBlc0VudGl0eSA9IFtHUy5QbGF5ZXJdO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihtb25zdGVyLCB0YXJnZXQsIHJhbmdlKSB7XHJcblx0XHRcdHBvc2l0aW9uLmNvcHkobW9uc3Rlci5wb3NpdGlvbik7XHJcblx0XHRcdGRpcmVjdGlvbi5jb3B5KHRhcmdldC5wb3NpdGlvbikuc3ViKG1vbnN0ZXIucG9zaXRpb24pLm5vcm1hbGl6ZSgpO1xyXG5cclxuXHRcdFx0dmFyIHN0ZXBzID0gTWF0aC5jZWlsKHJhbmdlIC8gR1MuSGl0c2NhbkhlbHBlci51bml0TGVuZ3RoKTtcclxuXHRcdFx0dmFyIHJlc3VsdCA9IEdTLkhpdHNjYW5IZWxwZXIuZ2V0SW50ZXJzZWN0aW9uKHBvc2l0aW9uLCBkaXJlY3Rpb24sIHRoaXMuZ3JpZCwgdHlwZXNFbnZpcm9ubWVudCwgdHlwZXNFbnRpdHksIHN0ZXBzLCBtb25zdGVyKTtcclxuXHRcdFx0cmV0dXJuIChyZXN1bHQudHlwZSA9PT0gR1MuQ29sbGlzaW9uVHlwZXMuRW50aXR5ICYmIHJlc3VsdC5ncmlkT2JqZWN0ID09PSB0YXJnZXQpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Y29sbGlkZU1vbnN0ZXI6IGZ1bmN0aW9uKG1vbnN0ZXIsIG9sZFBvcywgbmV3UG9zKSB7XHJcblx0XHR0aGlzLmNvbGxpZGVNb25zdGVyUGxheWVyRW52aXJvbm1lbnQobW9uc3Rlciwgb2xkUG9zLCBuZXdQb3MpO1xyXG5cdFx0dGhpcy51cGRhdGVHcmlkTG9jYXRpb25FbGxpcHNvaWQobW9uc3RlciwgbmV3UG9zKTtcclxuXHR9LFxyXG5cclxuXHRjb2xsaWRlTW9uc3RlclBsYXllckVudmlyb25tZW50OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwb2ludHMgPSBbIG5ldyBUSFJFRS5WZWN0b3IyKCksIG5ldyBUSFJFRS5WZWN0b3IyKCksIG5ldyBUSFJFRS5WZWN0b3IyKCksIG5ldyBUSFJFRS5WZWN0b3IyKCkgXTtcclxuXHRcdHZhciB0eXBlcyA9IFtHUy5QbGF5ZXIsIEdTLk1vbnN0ZXIsIEdTLk9ubGluZVBsYXllcl07XHJcblx0XHR2YXIgYXV4ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciB2ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgdmVsb2NpdHlCb3ggPSBuZXcgVEhSRUUuQm94MigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihtb25zdGVyLCBvbGRQb3MsIG5ld1Bvcykge1xyXG5cdFx0XHR2YXIgbHNwID0gbW9uc3Rlci52aWV3LmNvbGxpc2lvbkRhdGEuZWxsaXBzb2lkO1xyXG5cclxuXHRcdFx0cG9pbnRzWzBdLnNldChvbGRQb3MueCArIGxzcC54LCBvbGRQb3MueiArIGxzcC56KTtcclxuXHRcdFx0cG9pbnRzWzFdLnNldChvbGRQb3MueCAtIGxzcC54LCBvbGRQb3MueiAtIGxzcC56KTtcclxuXHRcdFx0cG9pbnRzWzJdLnNldChuZXdQb3MueCArIGxzcC54LCBuZXdQb3MueiArIGxzcC56KTtcclxuXHRcdFx0cG9pbnRzWzNdLnNldChuZXdQb3MueCAtIGxzcC54LCBuZXdQb3MueiAtIGxzcC56KTtcclxuXHJcblx0XHRcdHZhciBncmlkTG9jYXRpb24gPSB0aGlzLmdyaWQuZ2V0R3JpZExvY2F0aW9uRnJvbVBvaW50cyhwb2ludHMpO1xyXG5cclxuXHRcdFx0aWYgKGdyaWRMb2NhdGlvbiA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLmhhbmRsZUNvbmNyZXRlQ29sbGlzaW9ucyhncmlkTG9jYXRpb24sIG9sZFBvcywgbmV3UG9zLCBtb25zdGVyLnNpemUpO1xyXG5cclxuXHRcdFx0cG9pbnRzWzBdLnNldChvbGRQb3MueCArIGxzcC54LCBvbGRQb3MueiArIGxzcC56KTtcclxuXHRcdFx0cG9pbnRzWzFdLnNldChvbGRQb3MueCAtIGxzcC54LCBvbGRQb3MueiAtIGxzcC56KTtcclxuXHRcdFx0cG9pbnRzWzJdLnNldChuZXdQb3MueCArIGxzcC54LCBuZXdQb3MueiArIGxzcC56KTtcclxuXHRcdFx0cG9pbnRzWzNdLnNldChuZXdQb3MueCAtIGxzcC54LCBuZXdQb3MueiAtIGxzcC56KTtcclxuXHJcblx0XHRcdGdyaWRMb2NhdGlvbiA9IHRoaXMuZ3JpZC5nZXRHcmlkTG9jYXRpb25Gcm9tUG9pbnRzKHBvaW50cyk7XHJcblxyXG5cdFx0XHRpZiAoZ3JpZExvY2F0aW9uICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHR2YXIgY2VsbHMgPSB0aGlzLmdyaWQuZ2V0Q2VsbHNGcm9tR3JpZExvY2F0aW9uKGdyaWRMb2NhdGlvbik7XHJcblx0XHRcdFx0YXV4LnN1YlZlY3RvcnMobmV3UG9zLCBvbGRQb3MpLnRvVmVjdG9yMih2ZWxvY2l0eSk7XHJcblx0XHRcdFx0dmVsb2NpdHlCb3guY29weShtb25zdGVyLnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ1NxdWFyZSk7XHJcblx0XHRcdFx0dmVsb2NpdHlCb3gubWluLmFkZCh2ZWxvY2l0eSk7XHJcblx0XHRcdFx0dmVsb2NpdHlCb3gubWF4LmFkZCh2ZWxvY2l0eSk7XHJcblxyXG5cdFx0XHRcdHZhciBmb3VuZENvbGxpc2lvbiA9IGZhbHNlO1xyXG5cdFx0XHRcdHZhciBjb2xsaXNpb25HcmlkT2JqZWN0ID0gbnVsbDtcclxuXHRcdFx0XHR0aGlzLmdyaWQuZm9yRWFjaFVuaXF1ZUdyaWRPYmplY3RJbkNlbGxzKGNlbGxzLCB0eXBlcywgZnVuY3Rpb24oZ3JpZE9iamVjdCkge1xyXG5cdFx0XHRcdFx0aWYgKGZvdW5kQ29sbGlzaW9uIHx8IGdyaWRPYmplY3QgPT09IG1vbnN0ZXIgfHwgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Nb25zdGVyIHx8IGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5PbmxpbmVQbGF5ZXIgJiYgZ3JpZE9iamVjdC5kZWFkKSkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKHZlbG9jaXR5Qm94LmlzSW50ZXJzZWN0aW9uQm94KGdyaWRPYmplY3Qudmlldy5jb2xsaXNpb25EYXRhLmJvdW5kaW5nU3F1YXJlKSkge1xyXG5cdFx0XHRcdFx0XHRmb3VuZENvbGxpc2lvbiA9IHRydWU7XHJcblx0XHRcdFx0XHRcdGNvbGxpc2lvbkdyaWRPYmplY3QgPSBncmlkT2JqZWN0O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHRpZiAoIWZvdW5kQ29sbGlzaW9uKSB7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHZhciB5ID0gbmV3UG9zLnk7XHJcblx0XHRcdFx0XHRuZXdQb3MuY29weShvbGRQb3MpO1xyXG5cdFx0XHRcdFx0bmV3UG9zLnkgPSB5O1xyXG5cdFx0XHRcdFx0aWYgKGNvbGxpc2lvbkdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Nb25zdGVyKSB7XHJcblx0XHRcdFx0XHRcdG1vbnN0ZXIuc2NhdHRlcigpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0aGFuZGxlQ29uY3JldGVDb2xsaXNpb25zOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBvbGRQb3MyZCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgbmV3UG9zMmQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIHNpemUyZCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdFx0dmFyIGJveCA9IG5ldyBUSFJFRS5Cb3gyKCk7XHJcblx0XHR2YXIgYm94TmV3ID0gbmV3IFRIUkVFLkJveDIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oZ3JpZExvY2F0aW9uLCBvbGRQb3MsIG5ld1Bvcywgc2l6ZSkge1xyXG5cdFx0XHRvbGRQb3MudG9WZWN0b3IyKG9sZFBvczJkKTtcclxuXHRcdFx0bmV3UG9zLnRvVmVjdG9yMihuZXdQb3MyZCk7XHJcblx0XHRcdHNpemUudG9WZWN0b3IyKHNpemUyZCk7XHJcblxyXG5cdFx0XHRib3gubWluLmNvcHkob2xkUG9zMmQpLnN1YihzaXplMmQpO1xyXG5cdFx0XHRib3gubWF4LmNvcHkob2xkUG9zMmQpLmFkZChzaXplMmQpO1xyXG5cdFx0XHRib3hOZXcubWluLmNvcHkobmV3UG9zMmQpLnN1YihzaXplMmQpO1xyXG5cdFx0XHRib3hOZXcubWF4LmNvcHkobmV3UG9zMmQpLmFkZChzaXplMmQpO1xyXG5cclxuXHRcdFx0dmFyIGNlbGxzID0gdGhpcy5ncmlkLmdldENlbGxzRnJvbUdyaWRMb2NhdGlvbihncmlkTG9jYXRpb24pO1xyXG5cdFx0XHR2YXIgbmV3U2VjdG9yID0gdGhpcy5nZXRTZWN0b3JIZWlnaHRzKGNlbGxzLCBib3hOZXcpO1xyXG5cclxuXHRcdFx0dmFyIGNvbmRpdGlvbiA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfTtcclxuXHRcdFx0aWYgKG5ld1NlY3RvciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dmFyIGN1cnJlbnRIZWlnaHQgPSBuZXdQb3MueSAtIHNpemUueTtcclxuXHRcdFx0XHR2YXIgbmV3SGVpZ2h0ID0gbmV3U2VjdG9yLmZsb29ySGVpZ2h0O1xyXG5cclxuXHRcdFx0XHRpZiAoTWF0aC5hYnMobmV3U2VjdG9yLmNlaWxIZWlnaHQgLSBuZXdTZWN0b3IuZmxvb3JIZWlnaHQpID49IHNpemUueSAqIDIpIHtcclxuXHRcdFx0XHRcdG5ld1Bvcy55ID0gbmV3SGVpZ2h0ICsgc2l6ZS55O1xyXG5cdFx0XHRcdFx0dmFyIG1pbkhlaWdodCA9IG5ld1Bvcy55IC0gc2l6ZS55ICsgMC4wMztcclxuXHRcdFx0XHRcdHZhciBtYXhIZWlnaHQgPSBuZXdQb3MueSArIHNpemUueSArIDAuMDM7XHJcblxyXG5cdFx0XHRcdFx0Y29uZGl0aW9uID0gZnVuY3Rpb24oc2VnKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiAoc2VnLmJvdHRvbVkgPj0gbWluSGVpZ2h0ICYmIHNlZy5ib3R0b21ZIDw9IG1heEhlaWdodCB8fFxyXG5cdFx0XHRcdFx0XHRcdHNlZy50b3BZID49IG1pbkhlaWdodCAmJiBzZWcudG9wWSA8PSBtYXhIZWlnaHQgfHxcclxuXHRcdFx0XHRcdFx0XHRzZWcuYm90dG9tWSA8IG1pbkhlaWdodCAmJiBzZWcudG9wWSA+IG1heEhlaWdodCk7XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIHNlZ21lbnRJdGVyYXRvciA9IHRoaXMuZ3JpZC5nZXRTZWdtZW50SXRlcmF0b3IoZ3JpZExvY2F0aW9uLCBjb25kaXRpb24pO1xyXG5cdFx0XHRcdHRoaXMuc2xpZGluZ0JveExpbmVDb2xsaXNpb24ob2xkUG9zMmQsIG5ld1BvczJkLCBib3gsIHNlZ21lbnRJdGVyYXRvcik7XHJcblxyXG5cdFx0XHRcdG5ld1Bvcy54ID0gbmV3UG9zMmQueDtcclxuXHRcdFx0XHRuZXdQb3MueiA9IG5ld1BvczJkLnk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0bmV3UG9zLmNvcHkob2xkUG9zKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Z2V0U2VjdG9ySGVpZ2h0czogZnVuY3Rpb24oY2VsbHMsIGJveCkge1xyXG5cdFx0dmFyIGhlaWdodHMgPSBbXTtcclxuXHJcblx0XHR2YXIgcmVzdWx0ID0ge1xyXG5cdFx0XHRmbG9vckhlaWdodDogLUluZmluaXR5LFxyXG5cdFx0XHRjZWlsSGVpZ2h0OiBJbmZpbml0eSxcclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIHNlY3RvcjtcclxuXHRcdHRoaXMuZ3JpZC5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdEluQ2VsbHMoY2VsbHMsIFtHUy5Db25jcmV0ZSwgR1MuRWxldmF0b3JdLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuQ29uY3JldGUpIHtcclxuXHRcdFx0XHRpZiAoZ3JpZE9iamVjdC50eXBlID09PSBHUy5NYXBMYXllcnMuU2VjdG9yKSB7XHJcblx0XHRcdFx0XHRzZWN0b3IgPSBncmlkT2JqZWN0LnNvdXJjZU9iajtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRzZWN0b3IgPSBncmlkT2JqZWN0LnNlY3RvcjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0R0FNRS5ncmlkLnRvdGFsQm94U2VjdG9yQ2hlY2tzKys7XHJcblx0XHRcdGlmIChHUy5Qb2x5Z29uSGVscGVyLmludGVyc2VjdGlvblNlY3RvckJveChzZWN0b3IsIGJveCkpIHtcclxuXHRcdFx0XHR2YXIgZmxvb3JIZWlnaHQgPSBzZWN0b3IuZmxvb3JUb3BZO1xyXG5cdFx0XHRcdGlmIChmbG9vckhlaWdodCA+IHJlc3VsdC5mbG9vckhlaWdodCkge1xyXG5cdFx0XHRcdFx0cmVzdWx0LmZsb29ySGVpZ2h0ID0gZmxvb3JIZWlnaHQ7XHJcblx0XHRcdFx0XHRyZXN1bHQuY2VpbEhlaWdodCA9IChzZWN0b3IuY2VpbGluZyA9PT0gdHJ1ZSkgPyBzZWN0b3IuY2VpbEJvdHRvbVkgOiBJbmZpbml0eTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aGVpZ2h0cy5wdXNoKGZsb29ySGVpZ2h0KTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblxyXG5cdFx0aWYgKGhlaWdodHMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRoZWlnaHRzLnNvcnQoKTtcclxuXHJcblx0XHRcdHZhciBtYXhEaXN0YW5jZSA9IDA7XHJcblx0XHRcdHZhciBkaXN0YW5jZTtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHRzLmxlbmd0aCAtIDE7IGkrKykge1xyXG5cdFx0XHRcdGRpc3RhbmNlID0gTWF0aC5hYnMoaGVpZ2h0c1tpICsgMV0gLSBoZWlnaHRzW2ldKTtcclxuXHRcdFx0XHRpZiAoZGlzdGFuY2UgPiBtYXhEaXN0YW5jZSkge1xyXG5cdFx0XHRcdFx0bWF4RGlzdGFuY2UgPSBkaXN0YW5jZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChtYXhEaXN0YW5jZSA8PSA2KSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB1bmRlZmluZWQ7XHJcblx0fSxcclxuXHJcblx0aXNFbnRpdHlOZWFyRG9vcjogZnVuY3Rpb24oZG9vciwgdHlwZXMpIHtcclxuXHRcdHR5cGVzID0gdHlwZXMgfHwgW0dTLk1vbnN0ZXIsIEdTLlBsYXllcl07XHJcblxyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dmFyIGNvbGxpZGVkID0gZmFsc2U7XHJcblx0XHR2YXIgZG9vckJvdW5kaW5nQm94ID0gZG9vci52aWV3LmNvbGxpc2lvbkRhdGEuYm91bmRpbmdCb3g7XHJcblxyXG5cdFx0dGhpcy5ncmlkLmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxscyhkb29yLmxpbmtlZEdyaWRDZWxscywgdHlwZXMsIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0aWYgKCFjb2xsaWRlZCkge1xyXG5cdFx0XHRcdGlmICghZ3JpZE9iamVjdC5kZWFkICYmIGRvb3JCb3VuZGluZ0JveC5pc0ludGVyc2VjdGlvbkJveChncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ0JveCkpIHtcclxuXHRcdFx0XHRcdGNvbGxpZGVkID0gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cclxuXHRcdHJldHVybiBjb2xsaWRlZDtcclxuXHR9LFxyXG5cclxuXHRlbGV2YXRvck1vdmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIG5ld1BvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgcG9zMmQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihlbGV2YXRvciwgdmVsb2NpdHkpIHtcclxuXHRcdFx0dmFyIHR5cGVzID0gW0dTLkl0ZW1dO1xyXG5cdFx0XHRpZiAodmVsb2NpdHkgPiAwKSB7XHJcblx0XHRcdFx0dHlwZXMucHVzaChHUy5Nb25zdGVyKTtcclxuXHRcdFx0XHR0eXBlcy5wdXNoKEdTLlBsYXllcik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdFx0dmFyIGVsZXZhdG9yQm91bmRpbmdCb3ggPSBlbGV2YXRvci52aWV3LmNvbGxpc2lvbkRhdGEuYm91bmRpbmdCb3g7XHJcblxyXG5cdFx0XHR2YXIgYm91bmRpbmdCb3g7XHJcblx0XHRcdHRoaXMuZ3JpZC5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdEluQ2VsbHMoZWxldmF0b3IubGlua2VkR3JpZENlbGxzLCB0eXBlcywgZnVuY3Rpb24oZ3JpZE9iamVjdCkge1xyXG5cdFx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuSXRlbSkge1xyXG5cdFx0XHRcdFx0aWYgKGdyaWRPYmplY3QuaXNTdGF0aWMgPT09IHRydWUpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ym91bmRpbmdCb3ggPSBncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ0JveDtcclxuXHRcdFx0XHRpZiAoYm91bmRpbmdCb3guaXNJbnRlcnNlY3Rpb25Cb3goZWxldmF0b3JCb3VuZGluZ0JveCkpIHtcclxuXHRcdFx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuSXRlbSkge1xyXG5cdFx0XHRcdFx0XHRpZiAoZ3JpZE9iamVjdC5lbGV2YXRvcklkICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdFx0XHRpZiAoZ3JpZE9iamVjdC5lbGV2YXRvcklkICE9IGVsZXZhdG9yLmlkKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGdyaWRPYmplY3QucG9zaXRpb24udG9WZWN0b3IyKHBvczJkKTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoR1MuUG9seWdvbkhlbHBlci5zZWN0b3JDb250YWluc1BvaW50KGVsZXZhdG9yLnNlY3RvciwgcG9zMmQsIHRydWUpKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRncmlkT2JqZWN0LmVsZXZhdG9ySWQgPSBlbGV2YXRvci5pZDtcclxuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdG5ld1Bvcy5jb3B5KGdyaWRPYmplY3QucG9zaXRpb24pO1xyXG5cdFx0XHRcdFx0bmV3UG9zLnkgKz0gdmVsb2NpdHk7XHJcblx0XHRcdFx0XHRncmlkT2JqZWN0LnVwZGF0ZUNvbGxpc2lvbkRhdGEobmV3UG9zKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Y29sbGlkZVByb2plY3RpbGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHBvaW50cyA9IFsgbmV3IFRIUkVFLlZlY3RvcjIoKSwgbmV3IFRIUkVFLlZlY3RvcjIoKSwgbmV3IFRIUkVFLlZlY3RvcjIoKSwgbmV3IFRIUkVFLlZlY3RvcjIoKSBdO1xyXG5cdFx0dmFyIG5vcm1hbCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHByb2plY3RpbGUsIG9sZFBvcywgbmV3UG9zKSB7XHJcblx0XHRcdHZhciBsc3AgPSBwcm9qZWN0aWxlLnZpZXcuY29sbGlzaW9uRGF0YS5lbGxpcHNvaWQ7XHJcblxyXG5cdFx0XHRwb2ludHNbMF0uc2V0KG9sZFBvcy54ICsgbHNwLngsIG9sZFBvcy56ICsgbHNwLnopO1xyXG5cdFx0XHRwb2ludHNbMV0uc2V0KG9sZFBvcy54IC0gbHNwLngsIG9sZFBvcy56IC0gbHNwLnopO1xyXG5cdFx0XHRwb2ludHNbMl0uc2V0KG5ld1Bvcy54ICsgbHNwLngsIG5ld1Bvcy56ICsgbHNwLnopO1xyXG5cdFx0XHRwb2ludHNbM10uc2V0KG5ld1Bvcy54IC0gbHNwLngsIG5ld1Bvcy56IC0gbHNwLnopO1xyXG5cclxuXHRcdFx0dmFyIGdyaWRMb2NhdGlvbiA9IHRoaXMuZ3JpZC5nZXRHcmlkTG9jYXRpb25Gcm9tUG9pbnRzKHBvaW50cyk7XHJcblx0XHRcdGlmIChncmlkTG9jYXRpb24gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dmFyIHJlc3VsdCA9IHtcclxuXHRcdFx0XHR0eXBlOiBHUy5Db2xsaXNpb25UeXBlcy5Ob25lLFxyXG5cdFx0XHRcdHBvczogbmV3IFRIUkVFLlZlY3RvcjMoKSxcclxuXHRcdFx0XHRncmlkT2JqZWN0OiBudWxsLFxyXG5cdFx0XHRcdGRpc3RhbmNlOiBJbmZpbml0eSxcclxuXHRcdFx0XHRub3JtYWw6IG5ldyBUSFJFRS5WZWN0b3IzKCksXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHR0aGlzLmNvbGxpZGVQcm9qZWN0aWxlRW52aXJvbm1lbnQocHJvamVjdGlsZSwgZ3JpZExvY2F0aW9uLCBvbGRQb3MsIG5ld1BvcywgcmVzdWx0KTtcclxuXHRcdFx0dGhpcy5jb2xsaWRlUHJvamVjdGlsZUVudGl0aWVzKHByb2plY3RpbGUsIGdyaWRMb2NhdGlvbiwgb2xkUG9zLCBuZXdQb3MsIHJlc3VsdCk7XHJcblxyXG5cdFx0XHRpZiAocmVzdWx0LnR5cGUgIT09IEdTLkNvbGxpc2lvblR5cGVzLk5vbmUpIHtcclxuXHRcdFx0XHRpZiAocmVzdWx0LnR5cGUgPT09IEdTLkNvbGxpc2lvblR5cGVzLkVudmlyb25tZW50KSB7XHJcblx0XHRcdFx0XHR0aGlzLmdyaWQuYWRkRW52aXJvbm1lbnRJbXBhY3RQYXJ0aWNsZXMocmVzdWx0LnBvcywgcmVzdWx0Lm5vcm1hbCwgcHJvamVjdGlsZS5jb2xvcik7XHJcblx0XHRcdFx0XHRyZXN1bHQuZ3JpZE9iamVjdC5vbkhpdChwcm9qZWN0aWxlKTtcclxuXHRcdFx0XHR9IGVsc2VcclxuXHRcdFx0XHRpZiAocmVzdWx0LnR5cGUgPT09IEdTLkNvbGxpc2lvblR5cGVzLkVudGl0eSkge1xyXG5cdFx0XHRcdFx0aWYgKHJlc3VsdC5ncmlkT2JqZWN0LmNvbnN0cnVjdG9yID09PSBwcm9qZWN0aWxlLnNvdXJjZUdyaWRPYmplY3QuY29uc3RydWN0b3IpIHtcclxuXHRcdFx0XHRcdFx0bm9ybWFsLmNvcHkocmVzdWx0LnBvcykuc3ViKHByb2plY3RpbGUucG9zaXRpb24pLm5vcm1hbGl6ZSgpO1xyXG5cdFx0XHRcdFx0XHR0aGlzLmdyaWQuYWRkRW52aXJvbm1lbnRJbXBhY3RQYXJ0aWNsZXMocmVzdWx0LnBvcywgbm9ybWFsLCBwcm9qZWN0aWxlLmNvbG9yKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuZ3JpZC5hZGRFbnRpdHlJbXBhY3RQYXJ0aWNsZXMocmVzdWx0LnBvcywgcmVzdWx0LmdyaWRPYmplY3QuYmxvb2RDb2xvcik7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC5ncmlkT2JqZWN0Lm9uSGl0KHByb2plY3RpbGUpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0cHJvamVjdGlsZS51cGRhdGVDb2xsaXNpb25EYXRhKHJlc3VsdC5wb3MpO1xyXG5cdFx0XHRcdHByb2plY3RpbGUub25IaXQoKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRwcm9qZWN0aWxlLnVwZGF0ZUNvbGxpc2lvbkRhdGEobmV3UG9zKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFwcm9qZWN0aWxlLnJlbW92ZWQpIHtcclxuXHRcdFx0XHR0aGlzLnVwZGF0ZUdyaWRMb2NhdGlvbkVsbGlwc29pZChwcm9qZWN0aWxlLCBuZXdQb3MpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRjb2xsaWRlUHJvamVjdGlsZUVudmlyb25tZW50OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwb2ludHMzZCA9IFsgbmV3IFRIUkVFLlZlY3RvcjMoKSwgbmV3IFRIUkVFLlZlY3RvcjMoKSwgbmV3IFRIUkVFLlZlY3RvcjMoKSwgbmV3IFRIUkVFLlZlY3RvcjMoKSBdO1xyXG5cdFx0dmFyIHZlbG9jaXR5Qm91bmRpbmdCb3ggPSBuZXcgVEhSRUUuQm94MygpO1xyXG5cdFx0dmFyIHR5cGVzID0gW0dTLkNvbmNyZXRlLCBHUy5Eb29yLCBHUy5FbGV2YXRvcl07XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKHByb2plY3RpbGUsIGdyaWRMb2NhdGlvbiwgb2xkUG9zLCBuZXdQb3MsIHJlc3VsdCkge1xyXG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0XHR2YXIgbHNwID0gcHJvamVjdGlsZS52aWV3LmNvbGxpc2lvbkRhdGEuZWxsaXBzb2lkO1xyXG5cclxuXHRcdFx0cG9pbnRzM2RbMF0uY29weShvbGRQb3MpLnN1Yihwcm9qZWN0aWxlLnNpemUpO1xyXG5cdFx0XHRwb2ludHMzZFsxXS5jb3B5KG9sZFBvcykuYWRkKHByb2plY3RpbGUuc2l6ZSk7XHJcblx0XHRcdHBvaW50czNkWzJdLmNvcHkobmV3UG9zKS5zdWIocHJvamVjdGlsZS5zaXplKTtcclxuXHRcdFx0cG9pbnRzM2RbM10uY29weShuZXdQb3MpLmFkZChwcm9qZWN0aWxlLnNpemUpO1xyXG5cclxuXHRcdFx0dmVsb2NpdHlCb3VuZGluZ0JveC5zZXRGcm9tUG9pbnRzKHBvaW50czNkKTtcclxuXHJcblx0XHRcdHZhciB0cmlhbmdsZUl0ZXJhdG9yID0gdGhpcy5ncmlkLmdldFRyaWFuZ2xlSXRlcmF0b3IoZ3JpZExvY2F0aW9uLCB0eXBlcywgZnVuY3Rpb24oZ3JpZE9iamVjdCkge1xyXG5cdFx0XHRcdHJldHVybiBncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ0JveC5pc0ludGVyc2VjdGlvbkJveCh2ZWxvY2l0eUJvdW5kaW5nQm94KTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHR2YXIgdHJpYW5nbGVSZXN1bHQgPSBHUy5Db2xsaXNpb25IZWxwZXIuaGFuZGxlQ29sbGlzaW9uc0ZpcnN0SGl0KG9sZFBvcywgbmV3UG9zLCAwLCBsc3AsIHRyaWFuZ2xlSXRlcmF0b3IpO1xyXG5cdFx0XHRpZiAodHJpYW5nbGVSZXN1bHQuZm91bmRDb2xsaXNpb24pIHtcclxuXHRcdFx0XHR2YXIgZGlzdCA9IG9sZFBvcy5kaXN0YW5jZVRvU3F1YXJlZCh0cmlhbmdsZVJlc3VsdC5wb3MpO1xyXG5cclxuXHRcdFx0XHRpZiAoZGlzdCA8IHJlc3VsdC5kaXN0YW5jZSkge1xyXG5cdFx0XHRcdFx0cmVzdWx0LnR5cGUgPSBHUy5Db2xsaXNpb25UeXBlcy5FbnZpcm9ubWVudDtcclxuXHRcdFx0XHRcdHJlc3VsdC5wb3MuY29weSh0cmlhbmdsZVJlc3VsdC5wb3MpO1xyXG5cdFx0XHRcdFx0cmVzdWx0Lm5vcm1hbC5jb3B5KHRyaWFuZ2xlUmVzdWx0Lm5vcm1hbCk7XHJcblx0XHRcdFx0XHRyZXN1bHQuZGlzdGFuY2UgPSBkaXN0O1xyXG5cdFx0XHRcdFx0cmVzdWx0LmdyaWRPYmplY3QgPSB0cmlhbmdsZVJlc3VsdC5ncmlkT2JqZWN0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Y29sbGlkZVByb2plY3RpbGVFbnRpdGllczogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgbWluUG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBjb2xsaXNpb25Qb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgdHlwZXMgPSBbR1MuTW9uc3RlciwgR1MuUGxheWVyXTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ocHJvamVjdGlsZSwgZ3JpZExvY2F0aW9uLCBvbGRQb3MsIG5ld1BvcywgcmVzdWx0KSB7XHJcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdFx0dmFyIHByb2plY3RpbGVCb3ggPSBwcm9qZWN0aWxlLnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ0JveDtcclxuXHRcdFx0dmFyIGdyaWRPYmplY3RCb3g7XHJcblx0XHRcdHZhciBjZWxscyA9IHRoaXMuZ3JpZC5nZXRDZWxsc0Zyb21HcmlkTG9jYXRpb24oZ3JpZExvY2F0aW9uKTtcclxuXHJcblx0XHRcdHRoaXMuZ3JpZC5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdEluQ2VsbHMoY2VsbHMsIHR5cGVzLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHRcdFx0aWYgKGdyaWRPYmplY3QuZGVhZCB8fCBwcm9qZWN0aWxlLnNvdXJjZUdyaWRPYmplY3QgPT09IGdyaWRPYmplY3QpIHtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGdyaWRPYmplY3RCb3ggPSBncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5ib3VuZGluZ0JveDtcclxuXHJcblx0XHRcdFx0aWYgKHByb2plY3RpbGVCb3guaXNJbnRlcnNlY3Rpb25Cb3hTd2VwdChvbGRQb3MsIG5ld1BvcywgZ3JpZE9iamVjdEJveCwgZ3JpZE9iamVjdC5wb3NpdGlvbiwgY29sbGlzaW9uUG9pbnQpKSB7XHJcblx0XHRcdFx0XHR2YXIgZGlzdCA9IG9sZFBvcy5kaXN0YW5jZVRvU3F1YXJlZChjb2xsaXNpb25Qb2ludCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKGRpc3QgPCByZXN1bHQuZGlzdGFuY2UpIHtcclxuXHRcdFx0XHRcdFx0cmVzdWx0LnR5cGUgPSBHUy5Db2xsaXNpb25UeXBlcy5FbnRpdHk7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC5wb3MuY29weShjb2xsaXNpb25Qb2ludCk7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC5kaXN0YW5jZSA9IGRpc3Q7XHJcblx0XHRcdFx0XHRcdHJlc3VsdC5ncmlkT2JqZWN0ID0gZ3JpZE9iamVjdDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0dXBkYXRlR3JpZExvY2F0aW9uRWxsaXBzb2lkOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBwb2ludHMgPSBbIG5ldyBUSFJFRS5WZWN0b3IyKCksIG5ldyBUSFJFRS5WZWN0b3IyKCkgXTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oZ3JpZE9iamVjdCwgbmV3UG9zKSB7XHJcblx0XHRcdHZhciBsc3AgPSBncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5lbGxpcHNvaWQ7XHJcblxyXG5cdFx0XHRwb2ludHNbMF0uc2V0KG5ld1Bvcy54ICsgbHNwLngsIG5ld1Bvcy56ICsgbHNwLnopO1xyXG5cdFx0XHRwb2ludHNbMV0uc2V0KG5ld1Bvcy54IC0gbHNwLngsIG5ld1Bvcy56IC0gbHNwLnopO1xyXG5cclxuXHRcdFx0dmFyIGdyaWRMb2NhdGlvbiA9IHRoaXMuZ3JpZC5nZXRHcmlkTG9jYXRpb25Gcm9tUG9pbnRzKHBvaW50cyk7XHJcblx0XHRcdGdyaWRPYmplY3QuYXNzaWduVG9DZWxscyhncmlkTG9jYXRpb24pO1xyXG5cdFx0XHRncmlkT2JqZWN0LnVwZGF0ZUNvbGxpc2lvbkRhdGEobmV3UG9zKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGhpdHNjYW46IGZ1bmN0aW9uKHNvdXJjZUdyaWRPYmplY3QsIHByb2plY3RpbGVTdGFydCwgd2VhcG9uLCB4QW5nbGUsIHlBbmdsZSkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dmFyIHR5cGVzRW52aXJvbm1lbnQgPSBbR1MuQ29uY3JldGUsIEdTLkRvb3IsIEdTLkVsZXZhdG9yXTtcclxuXHRcdHZhciB0eXBlc0VudGl0eSA9IFtdO1xyXG5cclxuXHRcdGlmIChzb3VyY2VHcmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuUGxheWVyKSB7XHJcblx0XHRcdHR5cGVzRW50aXR5LnB1c2goR1MuTW9uc3Rlcik7XHJcblx0XHR9XHJcblxyXG5cdFx0R1MuSGl0c2NhbkhlbHBlci5zcHJlYWQod2VhcG9uLCB4QW5nbGUsIHlBbmdsZSwgZnVuY3Rpb24oZGlyKSB7XHJcblx0XHRcdHZhciByZXN1bHQgPSBHUy5IaXRzY2FuSGVscGVyLmdldEludGVyc2VjdGlvbihwcm9qZWN0aWxlU3RhcnQsIGRpciwgdGhhdC5ncmlkLCB0eXBlc0Vudmlyb25tZW50LCB0eXBlc0VudGl0eSk7XHJcblxyXG5cdFx0XHRpZiAocmVzdWx0LnR5cGUgPT09IEdTLkNvbGxpc2lvblR5cGVzLkVudmlyb25tZW50KSB7XHJcblx0XHRcdFx0dGhhdC5ncmlkLmFkZEVudmlyb25tZW50SW1wYWN0UGFydGljbGVzKHJlc3VsdC5wb3MsIHJlc3VsdC5ub3JtYWwsXHJcblx0XHRcdFx0XHR3ZWFwb24uaW1wYWN0UGFydGljbGVDb2xvciwgd2VhcG9uLmltcGFjdFBhcnRpY2xlQ291bnQpO1xyXG5cdFx0XHRcdHJlc3VsdC5ncmlkT2JqZWN0Lm9uSGl0KCk7XHJcblx0XHRcdH0gZWxzZVxyXG5cdFx0XHRpZiAocmVzdWx0LnR5cGUgPT09IEdTLkNvbGxpc2lvblR5cGVzLkVudGl0eSkge1xyXG5cdFx0XHRcdHRoYXQuZ3JpZC5hZGRFbnRpdHlJbXBhY3RQYXJ0aWNsZXMocmVzdWx0LnBvcywgcmVzdWx0LmdyaWRPYmplY3QuYmxvb2RDb2xvcik7XHJcblx0XHRcdFx0cmVzdWx0LmdyaWRPYmplY3Qub25IaXQoeyBkYW1hZ2U6IHdlYXBvbi5kYW1hZ2UgfSk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH0sXHJcbn07XHJcbiIsIkdTLkZQU0NvbnRyb2xzID0gZnVuY3Rpb24oY2FtZXJhKSB7XHJcblx0dGhpcy5jYW1lcmEgPSBjYW1lcmE7XHJcblxyXG5cdHRoaXMuZXllID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHR0aGlzLmZvbGxvd2luZ0V5ZSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0dGhpcy5sb29rID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgLTEwKS5hZGQodGhpcy5leWUpO1xyXG5cdHRoaXMubG9va05vT2Zmc2V0ID0gdGhpcy5sb29rLmNsb25lKCk7XHJcblxyXG5cdHRoaXMubW92ZVNwZWVkID0gMTtcclxuXHR0aGlzLmxvb2tTcGVlZCA9IDAuMDY2ICogKEdTLlNldHRpbmdzLm1vdXNlIC8gNSk7XHJcblx0dGhpcy5tb3VzZUludmVydFkgPSBHUy5TZXR0aW5ncy5tb3VzZUludmVydFk7XHJcblxyXG5cdHRoaXMuZm9yd2FyZExvb2tWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAtMSk7XHJcblx0dGhpcy5mb3J3YXJkTW92ZVZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIC0xKTtcclxuXHR0aGlzLnJpZ2h0TG9va1ZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKDEsIDAsIDApO1xyXG5cdHRoaXMucmlnaHRNb3ZlVmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoMSwgMCwgMCk7XHJcblxyXG5cdHRoaXMueEFuZ2xlID0gMjcwO1xyXG5cdHRoaXMueUFuZ2xlID0gOTA7XHJcblx0dGhpcy52aWV3T2Zmc2V0WSA9IDA7XHJcblx0dGhpcy5leWVPZmZzZXRZID0gMy41O1xyXG5cclxuXHR0aGlzLnBvaW50ZXJMb2NrRW5hYmxlZCA9IGZhbHNlO1xyXG5cclxuXHR0aGlzLm9uSGFuZGxlQ29sbGlzaW9ucyA9IGZ1bmN0aW9uKG9sZFBvcywgbmV3UG9zKSB7fTtcclxuXHJcblx0dGhpcy5lbmFibGVkID0gdHJ1ZTtcclxuXHR0aGlzLmZseSA9IGZhbHNlO1xyXG5cdHRoaXMueVNtb290aGluZyA9IGZhbHNlO1xyXG5cdHRoaXMueVNtb290aGluZ0ZhY3RvciA9IDAuMTtcdFxyXG59O1xyXG5cclxuR1MuRlBTQ29udHJvbHMucHJvdG90eXBlID0ge1xyXG5cdGNvbnN0cnVjdG9yOiBHUy5GUFNDb250cm9scyxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR2YXIgcG9pbnRlckxvY2sgPSBcInBvaW50ZXJMb2NrRWxlbWVudFwiIGluIGRvY3VtZW50IHx8IFwibW96UG9pbnRlckxvY2tFbGVtZW50XCIgaW4gZG9jdW1lbnQgfHwgXCJ3ZWJraXRQb2ludGVyTG9ja0VsZW1lbnRcIiBpbiBkb2N1bWVudDtcclxuXHRcdGlmICghcG9pbnRlckxvY2spIHtcclxuXHRcdFx0dGhyb3cgXCJQb2ludGVyIExvY2sgQVBJIG5vdCBzdXBwb3J0ZWRcIjtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmF0dGFjaEV2ZW50cygpO1xyXG5cclxuXHRcdHRoaXMuc2V0Vmlld0FuZ2xlcyh0aGlzLnhBbmdsZSwgdGhpcy55QW5nbGUpO1xyXG5cdH0sXHJcblxyXG5cdGF0dGFjaEV2ZW50czogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0JChkb2N1bWVudCkub24oXCJwb2ludGVybG9ja2NoYW5nZS5mcHNDb250cm9sc1wiLCBmdW5jdGlvbihlKSB7IHRoYXQub25Qb2ludGVyTG9ja0NoYW5nZShlKTsgfSk7XHJcblx0XHQkKGRvY3VtZW50KS5vbihcIm1venBvaW50ZXJsb2NrY2hhbmdlLmZwc0NvbnRyb2xzXCIsIGZ1bmN0aW9uKGUpIHsgdGhhdC5vblBvaW50ZXJMb2NrQ2hhbmdlKGUpOyB9KTtcclxuXHRcdCQoZG9jdW1lbnQpLm9uKFwid2Via2l0cG9pbnRlcmxvY2tjaGFuZ2UuZnBzQ29udHJvbHNcIiwgZnVuY3Rpb24oZSkgeyB0aGF0Lm9uUG9pbnRlckxvY2tDaGFuZ2UoZSk7IH0pO1xyXG5cclxuXHRcdCQoZG9jdW1lbnQpLm9uKFwicG9pbnRlcmxvY2tlcnJvci5mcHNDb250cm9sc1wiLCBmdW5jdGlvbihlKSB7IHRoYXQub25Qb2ludGVyTG9ja0Vycm9yKGUpOyB9KTtcclxuXHRcdCQoZG9jdW1lbnQpLm9uKFwibW96cG9pbnRlcmxvY2tlcnJvci5mcHNDb250cm9sc1wiLCBmdW5jdGlvbihlKSB7IHRoYXQub25Qb2ludGVyTG9ja0Vycm9yKGUpOyB9KTtcclxuXHRcdCQoZG9jdW1lbnQpLm9uKFwid2Via2l0cG9pbnRlcmxvY2tlcnJvci5mcHNDb250cm9sc1wiLCBmdW5jdGlvbihlKSB7IHRoYXQub25Qb2ludGVyTG9ja0Vycm9yKGUpOyB9KTtcclxuXHJcblx0XHR0aGlzLmNhbnZhcyA9ICQoXCIjZ2FtZS1jYW52YXNcIilbMF07XHJcblx0XHR0aGlzLmRlYnVnQ2FudmFzID0gJChcIiNkZWJ1Zy11aS1jYW52YXNcIilbMF07XHJcblxyXG5cdFx0dmFyIHJpZ2h0TW91c2VEb3duID0gZmFsc2U7XHJcblx0XHQkKHRoaXMuZGVidWdDYW52YXMpLm9uKFwibW91c2Vkb3duLmZwc0NvbnRyb2xzXCIsIGZ1bmN0aW9uKGUpIHsgXHJcblx0XHRcdGlmIChlLndoaWNoID09IDMpIHsgXHJcblx0XHRcdFx0cmlnaHRNb3VzZURvd24gPSB0cnVlOyBcclxuXHRcdFx0fSBcclxuXHRcdH0pO1xyXG5cdFx0JCh0aGlzLmRlYnVnQ2FudmFzKS5vbihcIm1vdXNldXAuZnBzQ29udHJvbHNcIiwgZnVuY3Rpb24oZSkgeyBcclxuXHRcdFx0aWYgKGUud2hpY2ggPT0gMyAmJiByaWdodE1vdXNlRG93bikgeyBcclxuXHRcdFx0XHRyaWdodE1vdXNlRG93biA9IGZhbHNlOyBcclxuXHRcdFx0XHR0aGF0LmVuYWJsZSgpOyBcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fSxcclxuXHRcclxuXHRkZXRhY2hFdmVudHM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0JCh0aGlzLmRlYnVnQ2FudmFzKS5vZmYoXCJtb3VzZWRvd24uZnBzQ29udHJvbHNcIik7XHJcblx0XHQkKHRoaXMuZGVidWdDYW52YXMpLm9mZihcIm1vdXNldXAuZnBzQ29udHJvbHNcIik7XHJcblxyXG5cdFx0JChkb2N1bWVudCkub2ZmKFwicG9pbnRlcmxvY2tjaGFuZ2UuZnBzQ29udHJvbHNcIik7XHJcblx0XHQkKGRvY3VtZW50KS5vZmYoXCJtb3pwb2ludGVybG9ja2NoYW5nZS5mcHNDb250cm9sc1wiKTtcclxuXHRcdCQoZG9jdW1lbnQpLm9mZihcIndlYmtpdHBvaW50ZXJsb2NrY2hhbmdlLmZwc0NvbnRyb2xzXCIpO1xyXG5cclxuXHRcdCQoZG9jdW1lbnQpLm9mZihcInBvaW50ZXJsb2NrZXJyb3IuZnBzQ29udHJvbHNcIik7XHJcblx0XHQkKGRvY3VtZW50KS5vZmYoXCJtb3pwb2ludGVybG9ja2Vycm9yLmZwc0NvbnRyb2xzXCIpO1xyXG5cdFx0JChkb2N1bWVudCkub2ZmKFwid2Via2l0cG9pbnRlcmxvY2tlcnJvci5mcHNDb250cm9sc1wiKTtcclxuXHR9LFxyXG5cclxuXHRlbmFibGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKCF0aGlzLnBvaW50ZXJMb2NrRW5hYmxlZCkge1xyXG5cdFx0XHR0aGlzLmNhbnZhcy5yZXF1ZXN0UG9pbnRlckxvY2sgPSB0aGlzLmNhbnZhcy5yZXF1ZXN0UG9pbnRlckxvY2sgfHwgXHJcblx0XHRcdFx0dGhpcy5jYW52YXMubW96UmVxdWVzdFBvaW50ZXJMb2NrIHx8IHRoaXMuY2FudmFzLndlYmtpdFJlcXVlc3RQb2ludGVyTG9jaztcclxuXHRcdFx0dGhpcy5jYW52YXMucmVxdWVzdFBvaW50ZXJMb2NrKCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZGlzYWJsZTogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5wb2ludGVyTG9ja0VuYWJsZWQpIHtcclxuXHRcdFx0ZG9jdW1lbnQuZXhpdFBvaW50ZXJMb2NrID0gZG9jdW1lbnQuZXhpdFBvaW50ZXJMb2NrIHx8IGRvY3VtZW50Lm1vekV4aXRQb2ludGVyTG9jayB8fCBkb2N1bWVudC53ZWJraXRFeGl0UG9pbnRlckxvY2s7XHJcblx0XHRcdGRvY3VtZW50LmV4aXRQb2ludGVyTG9jaygpO1x0XHRcdFxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdG9uUG9pbnRlckxvY2tDaGFuZ2U6IGZ1bmN0aW9uKGUpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR2YXIgaXNDYW52YXMgPSBkb2N1bWVudC5wb2ludGVyTG9ja0VsZW1lbnQgPT09IHRoaXMuY2FudmFzIHx8IGRvY3VtZW50Lm1velBvaW50ZXJMb2NrRWxlbWVudCA9PT0gdGhpcy5jYW52YXMgfHxcclxuXHRcdFx0ZG9jdW1lbnQud2Via2l0UG9pbnRlckxvY2tFbGVtZW50ID09PSB0aGlzLmNhbnZhcztcclxuXHJcblx0XHRpZiAoaXNDYW52YXMpIHtcclxuXHRcdFx0dGhpcy5wb2ludGVyTG9ja0VuYWJsZWQgPSB0cnVlO1xyXG5cdFx0XHQkKGRvY3VtZW50KS5vbihcIm1vdXNlbW92ZS5mcHNDb250cm9sc1wiLCBmdW5jdGlvbihlKSB7IHRoYXQub25Nb3VzZU1vdmUoZS5vcmlnaW5hbEV2ZW50KTsgfSk7XHJcblx0XHRcdHRoaXMuZGlzcGF0Y2hFdmVudCh7IHR5cGU6IFwicG9pbnRlckxvY2tFbmFibGVkXCIgfSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnBvaW50ZXJMb2NrRW5hYmxlZCA9IGZhbHNlO1xyXG5cdFx0XHQkKGRvY3VtZW50KS5vZmYoXCJtb3VzZW1vdmUuZnBzQ29udHJvbHNcIik7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5kaXNwb3NlQ2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHRoaXMuZGV0YWNoRXZlbnRzKCk7XHJcblx0XHRcdFx0dGhpcy5kaXNwb3NlQ2FsbGJhY2soKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR0aGlzLmRpc3BhdGNoRXZlbnQoeyB0eXBlOiBcInBvaW50ZXJMb2NrRGlzYWJsZWRcIiB9KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdG9uUG9pbnRlckxvY2tFcnJvcjogZnVuY3Rpb24oKSB7XHJcblx0fSxcclxuXHJcblx0b25Nb3VzZU1vdmU6IGZ1bmN0aW9uKGUpIHtcclxuXHRcdGlmICghdGhpcy5lbmFibGVkKSB7XHJcblx0XHRcdHJldHVyblxyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBteCA9IGUubW92ZW1lbnRYIHx8IGUubW96TW92ZW1lbnRYIHx8IGUud2Via2l0TW92ZW1lbnRYIHx8IDA7XHJcblx0XHR2YXIgbXkgPSBlLm1vdmVtZW50WSB8fCBlLm1vek1vdmVtZW50WSB8fCBlLndlYmtpdE1vdmVtZW50WSB8fCAwO1xyXG5cclxuXHRcdHZhciBpbnZlcnRZID0gdGhpcy5tb3VzZUludmVydFkgPyAtMSA6IDE7XHJcblxyXG5cdFx0dGhpcy5zZXRWaWV3QW5nbGVzKHRoaXMueEFuZ2xlICsgbXggKiB0aGlzLmxvb2tTcGVlZCwgdGhpcy55QW5nbGUgKyBpbnZlcnRZICogbXkgKiB0aGlzLmxvb2tTcGVlZCk7XHJcblx0fSxcclxuXHJcblx0c2V0Vmlld09mZnNldFk6IGZ1bmN0aW9uKHkpIHtcclxuXHRcdHRoaXMudmlld09mZnNldFkgPSB5O1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAoIXRoaXMuZW5hYmxlZCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHggPSAwO1xyXG5cdFx0dmFyIHogPSAwO1xyXG5cclxuXHRcdGlmIChHUy5LZXliaW5kcy5tb3ZlRm9yd2FyZC5pblVzZSkge1xyXG5cdFx0XHR6Kys7XHJcblx0XHR9XHJcblx0XHRpZiAoR1MuS2V5YmluZHMubW92ZUJhY2t3YXJkLmluVXNlKSB7XHJcblx0XHRcdHotLTtcclxuXHRcdH1cclxuXHRcdGlmIChHUy5LZXliaW5kcy5zdHJhZmVMZWZ0LmluVXNlKSB7XHJcblx0XHRcdHgtLTtcclxuXHRcdH1cclxuXHRcdGlmIChHUy5LZXliaW5kcy5zdHJhZmVSaWdodC5pblVzZSkge1xyXG5cdFx0XHR4Kys7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5tb3ZlKHgsIHopO1xyXG5cdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogXCJ1cGRhdGVcIiwgcG9zOiB0aGlzLmV5ZSwgeEFuZ2xlOiB0aGlzLnhBbmdsZSwgeUFuZ2xlOiB0aGlzLnlBbmdsZSwgbG9vazogdGhpcy5sb29rTm9PZmZzZXQgfSk7XHJcblx0fSxcclxuXHJcblx0bW92ZVRvOiBmdW5jdGlvbihwb3MpIHtcclxuXHRcdHRoaXMuZXllLmNvcHkocG9zKTtcclxuXHRcdHRoaXMudXBkYXRlQ2FtZXJhKCk7XHJcblx0fSxcclxuXHJcblx0bW92ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgbmV3UG9zID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBhdXggPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbih4LCB6KSB7XHJcblx0XHRcdG5ld1Bvcy5jb3B5KHRoaXMuZXllKTtcclxuXHJcblx0XHRcdGlmICh4ICE9PSAwIHx8IHogIT09IDApIHtcclxuXHRcdFx0XHRhdXguY29weSh0aGlzLnJpZ2h0TW92ZVZlY3RvcikubXVsdGlwbHlTY2FsYXIodGhpcy5tb3ZlU3BlZWQgKiB4KTtcclxuXHRcdFx0XHRuZXdQb3MuYWRkKGF1eCk7XHJcblx0XHRcdFx0YXV4LmNvcHkodGhpcy5mb3J3YXJkTW92ZVZlY3RvcikubXVsdGlwbHlTY2FsYXIodGhpcy5tb3ZlU3BlZWQgKiB6KTtcclxuXHRcdFx0XHRuZXdQb3MuYWRkKGF1eCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMub25IYW5kbGVDb2xsaXNpb25zKHRoaXMuZXllLCBuZXdQb3MpO1xyXG5cclxuXHRcdFx0dGhpcy5leWUuY29weShuZXdQb3MpO1xyXG5cdFx0XHR0aGlzLnVwZGF0ZUNhbWVyYSgpO1xyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0dXBkYXRlQ2FtZXJhOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuZm9sbG93aW5nRXllLnggPSB0aGlzLmV5ZS54O1xyXG5cdFx0dGhpcy5mb2xsb3dpbmdFeWUueiA9IHRoaXMuZXllLno7XHJcblx0XHRpZiAodGhpcy55U21vb3RoaW5nKSB7XHJcblx0XHRcdGlmICh0aGlzLmZvbGxvd2luZ0V5ZS55ICE9IHRoaXMuZXllLnkpIHtcclxuXHRcdFx0XHR0aGlzLmZvbGxvd2luZ0V5ZS55ID0gdGhpcy5mb2xsb3dpbmdFeWUueSArIHRoaXMueVNtb290aGluZ0ZhY3RvciAqICh0aGlzLmV5ZS55IC0gdGhpcy5mb2xsb3dpbmdFeWUueSk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuZm9sbG93aW5nRXllLnkgPSB0aGlzLmV5ZS55O1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuY2FtZXJhLnBvc2l0aW9uLmNvcHkodGhpcy5mb2xsb3dpbmdFeWUpO1xyXG5cdFx0dGhpcy5jYW1lcmEucG9zaXRpb24ueSArPSB0aGlzLnZpZXdPZmZzZXRZICsgdGhpcy5leWVPZmZzZXRZO1xyXG5cdFx0dGhpcy5sb29rTm9PZmZzZXQuYWRkVmVjdG9ycyh0aGlzLmZvbGxvd2luZ0V5ZSwgdGhpcy5mb3J3YXJkTG9va1ZlY3Rvcik7XHJcblx0XHR0aGlzLmxvb2suYWRkVmVjdG9ycyh0aGlzLmNhbWVyYS5wb3NpdGlvbiwgdGhpcy5mb3J3YXJkTG9va1ZlY3Rvcik7XHJcblx0XHR0aGlzLmNhbWVyYS5sb29rQXQodGhpcy5sb29rKTtcclxuXHR9LFxyXG5cdFxyXG5cdHNldFZpZXdBbmdsZXM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJpZ2h0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHRcdHZhciBmb3J3YXJkID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24oeCwgeSkge1xyXG5cdFx0XHR0aGlzLnhBbmdsZSA9IHg7XHJcblx0XHRcdHRoaXMueUFuZ2xlID0gR1MuTWF0aEhlbHBlci5jbGFtcCh5LCAxMCwgMTcwKTtcclxuXHJcblx0XHRcdHZhciB4ID0gTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqIHRoaXMueUFuZ2xlKSAqIE1hdGguY29zKE1hdGguUEkgLyAxODAgKiB0aGlzLnhBbmdsZSk7XHJcblx0XHRcdHZhciB5ID0gTWF0aC5jb3MoTWF0aC5QSSAvIDE4MCAqIHRoaXMueUFuZ2xlKTtcclxuXHRcdFx0dmFyIHogPSBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogdGhpcy55QW5nbGUpICogTWF0aC5zaW4oTWF0aC5QSSAvIDE4MCAqIHRoaXMueEFuZ2xlKTtcclxuXHJcblx0XHRcdGZvcndhcmQuc2V0KHgsIHksIHopO1xyXG5cclxuXHRcdFx0eCA9IE1hdGguc2luKE1hdGguUEkgLyAxODAgKiB0aGlzLnlBbmdsZSkgKiBNYXRoLmNvcyhNYXRoLlBJIC8gMTgwICogKHRoaXMueEFuZ2xlICsgOTApKTtcclxuXHRcdFx0eiA9IE1hdGguc2luKE1hdGguUEkgLyAxODAgKiB0aGlzLnlBbmdsZSkgKiBNYXRoLnNpbihNYXRoLlBJIC8gMTgwICogKHRoaXMueEFuZ2xlICsgOTApKTtcclxuXHJcblx0XHRcdHJpZ2h0LnNldCh4LCAwLCB6KTtcclxuXHJcblx0XHRcdHRoaXMuZm9yd2FyZExvb2tWZWN0b3IuY29weShmb3J3YXJkKTtcclxuXHRcdFx0aWYgKCF0aGlzLmZseSkge1xyXG5cdFx0XHRcdHRoaXMuZm9yd2FyZE1vdmVWZWN0b3Iuc2V0KGZvcndhcmQueCwgMCwgZm9yd2FyZC56KS5ub3JtYWxpemUoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLmZvcndhcmRNb3ZlVmVjdG9yLmNvcHkoZm9yd2FyZCkubm9ybWFsaXplKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5yaWdodExvb2tWZWN0b3IuY29weShyaWdodCkubm9ybWFsaXplKCk7XHJcblx0XHRcdHRoaXMucmlnaHRNb3ZlVmVjdG9yLmNvcHkocmlnaHQpLm5vcm1hbGl6ZSgpO1xyXG5cclxuXHRcdFx0dGhpcy51cGRhdGVDYW1lcmEoKTtcclxuXHRcdH1cclxuXHR9KCksXHJcblxyXG5cdGRpc3Bvc2U6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcblx0XHRpZiAodGhpcy5wb2ludGVyTG9ja0VuYWJsZWQpIHtcclxuXHRcdFx0dGhpcy5kaXNwb3NlQ2FsbGJhY2sgPSBjYWxsYmFjaztcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLm9uSGFuZGxlQ29sbGlzaW9ucyA9IHVuZGVmaW5lZDtcclxuXHRcdHRoaXMuZGlzYWJsZSgpO1xyXG5cclxuXHRcdGlmICghdGhpcy5wb2ludGVyTG9ja0VuYWJsZWQpIHtcclxuXHRcdFx0dGhpcy5kZXRhY2hFdmVudHMoKTtcclxuXHRcdFx0Y2FsbGJhY2soKTtcclxuXHRcdH1cclxuXHR9LFxyXG59O1xyXG5cclxuVEhSRUUuRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZS5hcHBseShHUy5GUFNDb250cm9scy5wcm90b3R5cGUpOyIsIkdTLkdyYXBoaWNzTWFuYWdlciA9IGZ1bmN0aW9uKHJlbmRlcmVyLCBjYW1lcmEpIHtcclxuXHR0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XHJcblx0dGhpcy5jYW1lcmEgPSBjYW1lcmE7XHJcblxyXG5cdHRoaXMubm9Qb3N0UHJvY2Vzc2luZyA9IGZhbHNlO1xyXG5cdHRoaXMubm9pc2VUZXh0dXJlU2l6ZSA9IDI1NjtcclxuXHJcblx0dGhpcy5zaG93V2VhcG9uID0gR1MuU2V0dGluZ3Muc2hvd1dlYXBvbjtcclxufTtcclxuXHJcbkdTLkdyYXBoaWNzTWFuYWdlci5wcm90b3R5cGUgPSB7XHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmluaXRFZmZlY3RDb21wb3NlcigpO1xyXG5cclxuXHRcdHRoaXMuYmxvb21FbmFibGVkID0gR1MuU2V0dGluZ3MuYmxvb207XHJcblx0XHR0aGlzLmZ4YWFFbmFibGVkID0gR1MuU2V0dGluZ3MuZnhhYTtcclxuXHRcdHRoaXMuc3Nhb0VuYWJsZWQgPSBHUy5TZXR0aW5ncy5zc2FvO1xyXG5cdFx0dGhpcy5ub2lzZUVuYWJsZWQgPSBHUy5TZXR0aW5ncy5ub2lzZTtcclxuXHRcdHRoaXMudmlnbmV0dGVFbmFibGVkID0gR1MuU2V0dGluZ3MudmlnbmV0dGU7XHRcdFxyXG5cdFx0dGhpcy5oYWxmU2l6ZUVuYWJsZWQgPSBHUy5TZXR0aW5ncy5oYWxmU2l6ZTtcclxuXHJcblx0XHR0aGlzLm1vbm9jaHJvbWVFbmFibGVkID0gZmFsc2U7XHJcblx0fSxcclxuXHJcblx0c2V0R3JpZDogZnVuY3Rpb24oZ3JpZCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMuZ3JpZCA9IGdyaWQ7XHJcblx0XHR0aGlzLnNjZW5lID0gZ3JpZC5zY2VuZTtcclxuXHJcblx0XHR0aGF0LmVmZmVjdENvbG9yLnVuaWZvcm1zW1wiY29sb3JcIl0udmFsdWUuc2V0UkdCKDAsIDAsIDApO1xyXG5cdFx0Z3JpZC5wbGF5ZXIucGxheWVyVmlldy5hZGRFdmVudExpc3RlbmVyKFwic2NyZWVuT3ZlcmxheUNvbG9yQ2hhbmdlXCIsIGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0dGhhdC5lZmZlY3RDb2xvci51bmlmb3Jtc1tcImNvbG9yXCJdLnZhbHVlLmNvcHkoZS5jb2xvcik7XHJcblx0XHR9KTtcclxuXHR9LFxyXG5cclxuXHRpbml0RWZmZWN0Q29tcG9zZXI6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jb21wb3NlciA9IG5ldyBUSFJFRS5FZmZlY3RDb21wb3Nlcih0aGlzLnJlbmRlcmVyKTtcclxuXHJcblx0XHR2YXIgZGVwdGhTaGFkZXIgPSBUSFJFRS5TaGFkZXJMaWJbXCJkZXB0aFJHQkFcIl07XHJcblx0XHR2YXIgZGVwdGhVbmlmb3JtcyA9IFRIUkVFLlVuaWZvcm1zVXRpbHMuY2xvbmUoZGVwdGhTaGFkZXIudW5pZm9ybXMpO1xyXG5cclxuXHRcdHRoaXMuZGVwdGhNYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCh7IFxyXG5cdFx0XHRmcmFnbWVudFNoYWRlcjogZGVwdGhTaGFkZXIuZnJhZ21lbnRTaGFkZXIsIFxyXG5cdFx0XHR2ZXJ0ZXhTaGFkZXI6IGRlcHRoU2hhZGVyLnZlcnRleFNoYWRlciwgXHJcblx0XHRcdHVuaWZvcm1zOiBkZXB0aFVuaWZvcm1zIFxyXG5cdFx0fSk7XHJcblx0XHR0aGlzLmRlcHRoTWF0ZXJpYWwuYmxlbmRpbmcgPSBUSFJFRS5Ob0JsZW5kaW5nO1xyXG5cclxuXHRcdHRoaXMuZGVwdGhUYXJnZXQgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCwgeyBcclxuXHRcdFx0bWluRmlsdGVyOiBUSFJFRS5OZWFyZXN0RmlsdGVyLCBcclxuXHRcdFx0bWFnRmlsdGVyOiBUSFJFRS5OZWFyZXN0RmlsdGVyLCBcclxuXHRcdFx0Zm9ybWF0OiBUSFJFRS5SR0JBRm9ybWF0IFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5lZmZlY3RTU0FPID0gbmV3IFRIUkVFLlNoYWRlclBhc3MoVEhSRUUuU1NBT1NoYWRlcik7XHJcblx0XHR0aGlzLmVmZmVjdFNTQU8udW5pZm9ybXNbXCJ0RGVwdGhcIl0udmFsdWUgPSB0aGlzLmRlcHRoVGFyZ2V0O1xyXG5cdFx0dGhpcy5lZmZlY3RTU0FPLnVuaWZvcm1zW1wic2l6ZVwiXS52YWx1ZS5zZXQod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XHJcblx0XHR0aGlzLmVmZmVjdFNTQU8udW5pZm9ybXNbXCJjYW1lcmFOZWFyXCJdLnZhbHVlID0gdGhpcy5jYW1lcmEubmVhcjtcclxuXHRcdHRoaXMuZWZmZWN0U1NBTy51bmlmb3Jtc1tcImNhbWVyYUZhclwiXS52YWx1ZSA9IHRoaXMuY2FtZXJhLmZhcjtcclxuXHJcblx0XHR0aGlzLmVmZmVjdEZpbHRlciA9IG5ldyBUSFJFRS5TaGFkZXJQYXNzKEdTLkJyaWdodG5lc3NGaWx0ZXJTaGFkZXIpO1xyXG5cdFx0dGhpcy5lZmZlY3RCbG9vbSA9IG5ldyBUSFJFRS5CbG9vbVBhc3MoMSwgMjUsIDQsIDUxMik7XHJcblx0XHR0aGlzLmVmZmVjdEJsb29tLm5lZWRzU3dhcCA9IHRydWU7XHJcblxyXG5cdFx0dGhpcy5lZmZlY3RHbG93ID0gbmV3IFRIUkVFLlNoYWRlclBhc3MoR1MuR2xvd1NoYWRlcik7XHJcblx0XHR0aGlzLmVmZmVjdEdsb3cudW5pZm9ybXNbXCJ0R2xvd1wiXS52YWx1ZSA9IHRoaXMuZWZmZWN0Qmxvb20ucmVuZGVyVGFyZ2V0WTtcclxuXHRcdHRoaXMuZWZmZWN0R2xvdy51bmlmb3Jtc1tcImludGVuc2l0eVwiXS52YWx1ZSA9IDE7XHJcblxyXG5cdFx0dGhpcy5lZmZlY3RDb2xvciA9IG5ldyBUSFJFRS5TaGFkZXJQYXNzKEdTLkNvbG9yU2hhZGVyKTtcclxuXHRcdHRoaXMuZWZmZWN0Q29sb3IudW5pZm9ybXNbXCJjb2xvclwiXS52YWx1ZSA9IG5ldyBUSFJFRS5Db2xvcigweDAwMDAwMCk7XHJcblxyXG5cdFx0dGhpcy5lZmZlY3RGWEFBID0gbmV3IFRIUkVFLlNoYWRlclBhc3MoVEhSRUUuRlhBQVNoYWRlcik7XHJcblx0XHR0aGlzLmVmZmVjdEZYQUEudW5pZm9ybXNbXCJyZXNvbHV0aW9uXCJdLnZhbHVlLnNldCgxIC8gd2luZG93LmlubmVyV2lkdGgsIDEgLyB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG5cclxuXHRcdHRoaXMuZWZmZWN0VmlnbmV0dGUgPSBuZXcgVEhSRUUuU2hhZGVyUGFzcyhUSFJFRS5WaWduZXR0ZVNoYWRlcik7XHJcblx0XHR0aGlzLmVmZmVjdE5vaXNlID0gbmV3IFRIUkVFLlNoYWRlclBhc3MoR1MuTm9pc2VTaGFkZXIpO1xyXG5cdFx0dGhpcy5lZmZlY3ROb2lzZS51bmlmb3Jtc1tcInROb2lzZVwiXS52YWx1ZSA9IHRoaXMuZ2V0Tm9pc2VUZXh0dXJlKHRoaXMubm9pc2VUZXh0dXJlU2l6ZSk7XHJcblx0XHR0aGlzLmVmZmVjdE5vaXNlLnVuaWZvcm1zW1wicmF0aW9cIl0udmFsdWUuc2V0KHdpbmRvdy5pbm5lcldpZHRoIC8gdGhpcy5ub2lzZVRleHR1cmVTaXplLCB3aW5kb3cuaW5uZXJIZWlnaHQgLyB0aGlzLm5vaXNlVGV4dHVyZVNpemUpO1xyXG5cclxuXHRcdHRoaXMuZWZmZWN0TW9ub2Nocm9tZSA9IG5ldyBUSFJFRS5TaGFkZXJQYXNzKFRIUkVFLkx1bWlub3NpdHlTaGFkZXIpO1xyXG5cclxuXHRcdHZhciBlZmZlY3RDb3B5ID0gbmV3IFRIUkVFLlNoYWRlclBhc3MoVEhSRUUuQ29weVNoYWRlcik7XHJcblx0XHRlZmZlY3RDb3B5LnJlbmRlclRvU2NyZWVuID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLmNvbXBvc2VyLmFkZFBhc3ModGhpcy5lZmZlY3RGaWx0ZXIpO1xyXG5cdFx0dGhpcy5jb21wb3Nlci5hZGRQYXNzKHRoaXMuZWZmZWN0Qmxvb20pO1xyXG5cdFx0dGhpcy5jb21wb3Nlci5hZGRQYXNzKHRoaXMuZWZmZWN0Tm9pc2UpO1xyXG5cdFx0dGhpcy5jb21wb3Nlci5hZGRQYXNzKHRoaXMuZWZmZWN0R2xvdyk7XHJcblx0XHR0aGlzLmNvbXBvc2VyLmFkZFBhc3ModGhpcy5lZmZlY3RTU0FPKTtcclxuXHRcdHRoaXMuY29tcG9zZXIuYWRkUGFzcyh0aGlzLmVmZmVjdENvbG9yKTtcclxuXHRcdHRoaXMuY29tcG9zZXIuYWRkUGFzcyh0aGlzLmVmZmVjdEZYQUEpO1xyXG5cdFx0dGhpcy5jb21wb3Nlci5hZGRQYXNzKHRoaXMuZWZmZWN0VmlnbmV0dGUpO1x0XHRcclxuXHRcdHRoaXMuY29tcG9zZXIuYWRkUGFzcyh0aGlzLmVmZmVjdE1vbm9jaHJvbWUpO1xyXG5cdFx0dGhpcy5jb21wb3Nlci5hZGRQYXNzKGVmZmVjdENvcHkpO1xyXG5cdH0sXHJcblxyXG5cdHJlbmRlclRvU2NyZWVuOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMucmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5yZW5kZXJlci5jbGVhcih0cnVlLCB0cnVlLCBmYWxzZSk7XHJcblxyXG5cdFx0dGhpcy5yZW5kZXJlci5yZW5kZXIodGhpcy5ncmlkLnNreWJveC5zY2VuZSwgdGhpcy5ncmlkLnNreWJveC5jYW1lcmEpO1xyXG5cdFx0dGhpcy5yZW5kZXJlci5yZW5kZXIodGhpcy5zY2VuZSwgdGhpcy5jYW1lcmEpO1xyXG5cclxuXHRcdHRoaXMucmVuZGVyZXIuY2xlYXIoZmFsc2UsIHRydWUsIGZhbHNlKTtcclxuXHJcblx0XHR2YXIgcGxheWVyVmlldyA9IHRoaXMuZ3JpZC5wbGF5ZXIucGxheWVyVmlldztcclxuXHRcdHRoaXMucmVuZGVyZXIucmVuZGVyKHBsYXllclZpZXcuc2NlbmUsIHBsYXllclZpZXcuY2FtZXJhKTtcclxuXHR9LFxyXG5cclxuXHRyZW5kZXI6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHJlbmRlclRhcmdldCA9IHRoaXMuY29tcG9zZXIucmVuZGVyVGFyZ2V0MjtcclxuXHRcdHRoaXMucmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5yZW5kZXJlci5jbGVhclRhcmdldChyZW5kZXJUYXJnZXQsIHRydWUsIHRydWUsIGZhbHNlKTtcclxuXHJcblx0XHR0aGlzLnJlbmRlcmVyLnJlbmRlcih0aGlzLmdyaWQuc2t5Ym94LnNjZW5lLCB0aGlzLmdyaWQuc2t5Ym94LmNhbWVyYSwgcmVuZGVyVGFyZ2V0KTtcclxuXHRcdHRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMuc2NlbmUsIHRoaXMuY2FtZXJhLCByZW5kZXJUYXJnZXQpO1xyXG5cclxuXHRcdHRoaXMucmVuZGVyZXIuY2xlYXJUYXJnZXQocmVuZGVyVGFyZ2V0LCBmYWxzZSwgdHJ1ZSwgZmFsc2UpO1xyXG5cclxuXHRcdGlmICh0aGlzLnNob3dXZWFwb24pIHtcclxuXHRcdFx0dmFyIHBsYXllclZpZXcgPSB0aGlzLmdyaWQucGxheWVyLnBsYXllclZpZXc7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIucmVuZGVyKHBsYXllclZpZXcuc2NlbmUsIHBsYXllclZpZXcuY2FtZXJhLCByZW5kZXJUYXJnZXQpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHJlbmRlckRlcHRoVGFyZ2V0OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciByZW5kZXJUYXJnZXQgPSB0aGlzLmRlcHRoVGFyZ2V0O1xyXG5cdFx0dGhpcy5yZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcclxuXHJcblx0XHR0aGlzLnJlbmRlcmVyLmNsZWFyVGFyZ2V0KHJlbmRlclRhcmdldCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpO1xyXG5cclxuXHRcdHRoaXMuc2NlbmUub3ZlcnJpZGVNYXRlcmlhbCA9IHRoaXMuZGVwdGhNYXRlcmlhbDtcclxuXHRcdHRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMuc2NlbmUsIHRoaXMuY2FtZXJhLCByZW5kZXJUYXJnZXQpO1xyXG5cdFx0dGhpcy5zY2VuZS5vdmVycmlkZU1hdGVyaWFsID0gbnVsbDtcclxuXHJcblx0XHR0aGlzLnJlbmRlcmVyLmNsZWFyVGFyZ2V0KHJlbmRlclRhcmdldCwgZmFsc2UsIHRydWUsIGZhbHNlKTtcclxuXHJcblx0XHRpZiAodGhpcy5zaG93V2VhcG9uKSB7XHJcblx0XHRcdHZhciBwbGF5ZXJWaWV3ID0gdGhpcy5ncmlkLnBsYXllci5wbGF5ZXJWaWV3O1xyXG5cdFx0XHRwbGF5ZXJWaWV3LnNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgPSB0aGlzLmRlcHRoTWF0ZXJpYWw7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIucmVuZGVyKHBsYXllclZpZXcuc2NlbmUsIHBsYXllclZpZXcuY2FtZXJhLCByZW5kZXJUYXJnZXQpO1xyXG5cdFx0XHRwbGF5ZXJWaWV3LnNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGRyYXc6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKHRoaXMubm9Qb3N0UHJvY2Vzc2luZykge1xyXG5cdFx0XHR0aGlzLnJlbmRlclRvU2NyZWVuKCk7XHJcblx0XHR9IGVsc2Uge1x0XHRcdFxyXG5cdFx0XHR0aGlzLnJlbmRlcigpO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuc3Nhb0VuYWJsZWQpIHtcclxuXHRcdFx0XHR0aGlzLnJlbmRlckRlcHRoVGFyZ2V0KCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMuY29tcG9zZXIucmVuZGVyKCk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0b25SZXNpemU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcblx0XHR2YXIgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5cclxuXHRcdGlmICh0aGlzLl9oYWxmU2l6ZUVuYWJsZWQpIHtcclxuXHRcdFx0d2lkdGggKj0gMC41O1xyXG5cdFx0XHRoZWlnaHQgKj0gMC41O1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBkZXB0aFRhcmdldCA9IHRoaXMuZGVwdGhUYXJnZXQuY2xvbmUoKTtcclxuXHRcdGRlcHRoVGFyZ2V0LndpZHRoID0gd2lkdGg7XHJcblx0XHRkZXB0aFRhcmdldC5oZWlnaHQgPSBoZWlnaHQ7XHJcblx0XHR0aGlzLmRlcHRoVGFyZ2V0ID0gZGVwdGhUYXJnZXQ7XHJcblx0XHR0aGlzLmVmZmVjdFNTQU8udW5pZm9ybXNbXCJ0RGVwdGhcIl0udmFsdWUgPSB0aGlzLmRlcHRoVGFyZ2V0O1xyXG5cclxuXHRcdHRoaXMuZWZmZWN0U1NBTy51bmlmb3Jtc1tcInNpemVcIl0udmFsdWUuc2V0KHdpZHRoLCBoZWlnaHQpO1xyXG5cdFx0dGhpcy5lZmZlY3RGWEFBLnVuaWZvcm1zW1wicmVzb2x1dGlvblwiXS52YWx1ZS5zZXQoMSAvIHdpZHRoLCAxIC8gaGVpZ2h0KTtcclxuXHRcdHRoaXMuZWZmZWN0Tm9pc2UudW5pZm9ybXNbXCJyYXRpb1wiXS52YWx1ZS5zZXQod2lkdGggLyB0aGlzLm5vaXNlVGV4dHVyZVNpemUsIGhlaWdodCAvIHRoaXMubm9pc2VUZXh0dXJlU2l6ZSk7XHJcblx0XHR0aGlzLmNvbXBvc2VyLnNldFNpemUod2lkdGgsIGhlaWdodCk7XHJcblxyXG5cdFx0JCh0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQpLmNzcyhcIndpZHRoXCIsIHdpbmRvdy5pbm5lcldpZHRoICsgXCJweFwiKS5jc3MoXCJoZWlnaHRcIiwgd2luZG93LmlubmVySGVpZ2h0ICsgXCJweFwiKTtcclxuXHR9LFxyXG5cclxuXHRnZXROb2lzZVRleHR1cmU6IGZ1bmN0aW9uKHNpemUpIHtcclxuXHRcdHNpemUgPSBzaXplIHx8IDI1NjtcclxuXHJcblx0XHR2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuXHRcdGNhbnZhcy53aWR0aCA9IHNpemU7XHJcblx0XHRjYW52YXMuaGVpZ2h0ID0gc2l6ZTtcclxuXHRcdGNhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMSlcIjtcclxuXHJcblx0XHR2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHRcdGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1vdmVyXCI7XHJcblx0XHRjdHguc2F2ZSgpO1xyXG5cclxuXHRcdHZhciBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHNpemUsIHNpemUpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDAsIG4gPSBzaXplICogc2l6ZSAqIDQ7IGkgPCBuOyBpICs9IDQpIHtcclxuXHRcdFx0dmFyIHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpO1xyXG5cdFx0XHRpbWFnZURhdGEuZGF0YVtpXSA9IHg7XHJcblx0XHRcdGltYWdlRGF0YS5kYXRhW2kgKyAxXSA9IHg7XHJcblx0XHRcdGltYWdlRGF0YS5kYXRhW2kgKyAyXSA9IHg7XHJcblx0XHRcdGltYWdlRGF0YS5kYXRhW2kgKyAzXSA9IDI1NTtcclxuXHRcdH1cclxuXHJcblx0XHRjdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XHJcblxyXG5cdFx0dmFyIHRleCA9IG5ldyBUSFJFRS5UZXh0dXJlKGNhbnZhcyk7XHJcblx0XHR0ZXgud3JhcFMgPSB0ZXgud3JhcFQgPSBUSFJFRS5SZXBlYXRXcmFwcGluZztcclxuXHRcdHRleC5uZWVkc1VwZGF0ZSA9IHRydWU7XHJcblx0XHRyZXR1cm4gdGV4O1xyXG5cdH0sXHJcblxyXG5cdHJlc2V0OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuZ3JpZCA9IHVuZGVmaW5lZDtcclxuXHRcdHRoaXMuc2NlbmUgPSB1bmRlZmluZWQ7XHJcblx0fSxcclxuXHJcblx0c2V0IHNzYW9FbmFibGVkKHZhbHVlKSB7XHJcblx0XHRpZiAodGhpcy5lZmZlY3RTU0FPICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy5lZmZlY3RTU0FPLmVuYWJsZWQgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXQgc3Nhb0VuYWJsZWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5lZmZlY3RTU0FPLmVuYWJsZWQ7XHJcblx0fSxcclxuXHJcblx0c2V0IGJsb29tRW5hYmxlZCh2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuZWZmZWN0Qmxvb20gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmVmZmVjdEZpbHRlci5lbmFibGVkID0gdmFsdWU7XHJcblx0XHRcdHRoaXMuZWZmZWN0Qmxvb20uZW5hYmxlZCA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLmVmZmVjdEdsb3cuZW5hYmxlZCA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGdldCBibG9vbUVuYWJsZWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5lZmZlY3RCbG9vbS5lbmFibGVkO1xyXG5cdH0sXHJcblxyXG5cdHNldCBmeGFhRW5hYmxlZCh2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuZWZmZWN0RlhBQSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZWZmZWN0RlhBQS5lbmFibGVkID0gdmFsdWU7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0IGZ4YWFFbmFibGVkKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZWZmZWN0RlhBQS5lbmFibGVkO1xyXG5cdH0sXHJcblxyXG5cdHNldCB2aWduZXR0ZUVuYWJsZWQodmFsdWUpIHtcclxuXHRcdGlmICh0aGlzLmVmZmVjdFZpZ25ldHRlICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy5lZmZlY3RWaWduZXR0ZS5lbmFibGVkID0gdmFsdWU7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0IHZpZ25ldHRlRW5hYmxlZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLmVmZmVjdFZpZ25ldHRlLmVuYWJsZWQ7XHJcblx0fSxcclxuXHJcblx0c2V0IG1vbm9jaHJvbWVFbmFibGVkKHZhbHVlKSB7XHJcblx0XHRpZiAodGhpcy5lZmZlY3RNb25vY2hyb21lICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy5lZmZlY3RNb25vY2hyb21lLmVuYWJsZWQgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXQgbW9ub2Nocm9tZUVuYWJsZWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5lZmZlY3RNb25vY2hyb21lLmVuYWJsZWQ7XHJcblx0fSxcclxuXHJcblx0c2V0IG5vaXNlRW5hYmxlZCh2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuZWZmZWN0Tm9pc2UgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmVmZmVjdE5vaXNlLmVuYWJsZWQgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXQgbm9pc2VFbmFibGVkKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZWZmZWN0Tm9pc2UuZW5hYmxlZDtcclxuXHR9LFxyXG5cclxuXHRzZXQgaGFsZlNpemVFbmFibGVkKHZhbHVlKSB7XHRcdFxyXG5cdFx0dGhpcy5faGFsZlNpemVFbmFibGVkID0gdmFsdWU7XHJcblx0XHR0aGlzLm9uUmVzaXplKCk7XHJcblx0fSxcclxuXHJcblx0Z2V0IGhhbGZTaXplRW5hYmxlZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9oYWxmU2l6ZUVuYWJsZWQ7XHJcblx0fSxcclxufTsiLCJHUy5HcmlkID0gZnVuY3Rpb24ocmVuZGVyZXIsIHNjZW5lKSB7XHJcblx0dGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG5cdHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuXHJcblx0dGhpcy5jb25jcmV0ZU1lc2hlcyA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xyXG5cdHRoaXMuZW50aXR5TWVzaGVzID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XHJcblxyXG5cdHRoaXMuc3RvcE1vbnN0ZXJzID0gZmFsc2U7XHJcblxyXG5cdHRoaXMuZGVidWdFbnRpdHlNZXNoZXMgPSBmYWxzZTtcclxuXHR0aGlzLmRlYnVnQ29uY3JldGVNZXNoZXMgPSBmYWxzZTtcclxuXHR0aGlzLmRlYnVnQ2VsbExpbmVzID0gZmFsc2U7XHJcbn07XHJcblxyXG5HUy5HcmlkLnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuR3JpZCxcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnBhcnRpY2xlVmlldyA9IG5ldyBHUy5QYXJ0aWNsZVZpZXcodGhpcyk7XHJcblx0XHR0aGlzLnBhcnRpY2xlVmlldy5pbml0KCk7XHJcblxyXG5cdFx0dGhpcy5jb2xsaXNpb25NYW5hZ2VyID0gbmV3IEdTLkNvbGxpc2lvbk1hbmFnZXIodGhpcyk7XHJcblx0XHR0aGlzLmNvbGxpc2lvbk1hbmFnZXIuaW5pdCgpO1xyXG5cclxuXHRcdHRoaXMubGlnaHRpbmdWaWV3ID0gbmV3IEdTLkxpZ2h0aW5nVmlldyh0aGlzKTtcclxuXHRcdHRoaXMubGlnaHRpbmdWaWV3LmluaXQoKTtcclxuXHJcblx0XHR0aGlzLmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0KHVuZGVmaW5lZCwgZnVuY3Rpb24oZ3JpZE9iamVjdCkge1xyXG5cdFx0XHRncmlkT2JqZWN0LmluaXQoKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuYWlNYW5hZ2VyID0gbmV3IEdTLkFJTWFuYWdlcih0aGlzKTtcclxuXHRcdHRoaXMuYWlNYW5hZ2VyLmluaXQoKTtcclxuXHJcblx0XHR0aGlzLmFkZENvbmNyZXRlTWVzaGVzVG9TY2VuZSgpO1xyXG5cdFx0dGhpcy5hZGRFbnRpdHlNZXNoZXNUb1NjZW5lKCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuZGVidWdDZWxsTGluZXMpIHtcclxuXHRcdFx0dGhpcy5hZGREZWJ1Z0NlbGxMaW5lcygpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGluaXRTa3lib3g6IGZ1bmN0aW9uKHNreWJveE1lc2gpIHtcclxuXHRcdHRoaXMuc2t5Ym94ID0ge1xyXG5cdFx0XHRtZXNoOiBza3lib3hNZXNoLFxyXG5cdFx0XHRzY2VuZTogbmV3IFRIUkVFLlNjZW5lKCksXHJcblx0XHRcdGNhbWVyYTogbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKEdTLlNldHRpbmdzLmZvdiwgd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQsIDEsIDIwMDApLFxyXG5cdFx0fVxyXG5cdFx0dGhpcy5za3lib3guc2NlbmUuYWRkKHNreWJveE1lc2gpO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5wYXJ0aWNsZVZpZXcudXBkYXRlKCk7XHJcblx0XHR0aGlzLmxpZ2h0aW5nVmlldy51cGRhdGUoKTtcclxuXHRcdHRoaXMuYWlNYW5hZ2VyLnVwZGF0ZSgpO1xyXG5cclxuXHRcdHRoaXMudG90YWxTcGhlcmVUcmlhbmdsZUNoZWNrcyA9IDA7XHJcblx0XHR0aGlzLnRvdGFsQm94U2VjdG9yQ2hlY2tzID0gMDtcclxuXHRcdHRoaXMudG90YWxCb3hTZWdtZW50Q2hlY2tzID0gMDtcclxuXHJcblx0XHR2YXIgcHJvamVjdGlsZUNvdW50ID0gMDtcclxuXHRcdHZhciBpdGVtQ291bnQgPSAwO1xyXG5cdFx0dmFyIGFjdGl2ZU1vbnN0ZXJDb3VudCA9IDA7XHJcblxyXG5cdFx0dGhpcy5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdCh1bmRlZmluZWQsIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Nb25zdGVyKSB7XHJcblx0XHRcdFx0aWYgKCF0aGF0LnN0b3BNb25zdGVycykge1xyXG5cdFx0XHRcdFx0Z3JpZE9iamVjdC51cGRhdGUoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Z3JpZE9iamVjdC51cGRhdGUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblxyXG5cdFx0aWYgKHRoaXMucGxheWVyLmxpbmtlZEdyaWRDZWxscy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0dGhpcy5wbGF5ZXIudXBkYXRlKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIHJvdGF0aW9uTWF0cml4ID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5leHRyYWN0Um90YXRpb24odGhpcy5wbGF5ZXIuY2FtZXJhLm1hdHJpeFdvcmxkKTtcclxuXHRcdHRoaXMuc2t5Ym94LmNhbWVyYS5yb3RhdGlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgocm90YXRpb25NYXRyaXgsIHRoaXMuc2t5Ym94LmNhbWVyYS5yb3RhdGlvbi5vcmRlcik7XHJcblxyXG5cdFx0Ly8gR1MuRGVidWdVSS50cmFja051bWVyaWNWYWx1ZShcInRvdGFsIGJveCBzZWN0b3IgY2hlY2tzXCIsIHRoaXMudG90YWxCb3hTZWN0b3JDaGVja3MpO1xyXG5cdFx0Ly8gR1MuRGVidWdVSS50cmFja051bWVyaWNWYWx1ZShcInRvdGFsIGJveCBzZWdtZW50IGNoZWNrc1wiLCB0aGlzLnRvdGFsQm94U2VnbWVudENoZWNrcyk7XHJcblx0XHQvLyBHUy5EZWJ1Z1VJLnRyYWNrTnVtZXJpY1ZhbHVlKFwidG90YWwgc3BoZXJlIHRyaWFuZ2xlIGNoZWNrc1wiLCB0aGlzLnRvdGFsU3BoZXJlVHJpYW5nbGVDaGVja3MpO1xyXG5cdH0sXHJcblxyXG5cdGFkZENvbmNyZXRlTWVzaGVzVG9TY2VuZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR0aGlzLmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0KFtHUy5Db25jcmV0ZV0sIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0aWYgKHRoYXQuZGVidWdDb25jcmV0ZU1lc2hlcykge1xyXG5cdFx0XHRcdHRoYXQuY29uY3JldGVNZXNoZXMuY2hpbGRyZW4ucHVzaChncmlkT2JqZWN0LnZpZXcuZGVidWdNZXNoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblxyXG5cdFx0dmFyIHJlZ2lvbnMgPSB0aGlzLnJlZ2lvbkluZm8ucmVnaW9ucztcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcmVnaW9ucy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgbWVzaCA9IHJlZ2lvbnNbaV0ubWVzaDtcclxuXHJcblx0XHRcdHZhciBidWZmZXJHZW8gPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKTtcclxuXHRcdFx0YnVmZmVyR2VvLmZyb21HZW9tZXRyeShtZXNoLmdlb21ldHJ5LCB7XHJcblx0XHRcdFx0dmVydGV4Q29sb3JzOiBUSFJFRS5GYWNlQ29sb3JzXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRtZXNoLmdlb21ldHJ5ID0gYnVmZmVyR2VvO1xyXG5cclxuXHRcdFx0dGhpcy5jb25jcmV0ZU1lc2hlcy5jaGlsZHJlbi5wdXNoKG1lc2gpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuc2NlbmUuYWRkKHRoaXMuY29uY3JldGVNZXNoZXMpO1xyXG5cdH0sXHJcblxyXG5cdGFkZEVudGl0eU1lc2hlc1RvU2NlbmU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dGhpcy5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdChbR1MuSXRlbSwgR1MuTW9uc3RlciwgR1MuRG9vciwgR1MuRWxldmF0b3IsIEdTLlRWU2NyZWVuLCBHUy5Td2l0Y2hdLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0XHRcdGlmICh0aGF0LmRlYnVnRW50aXR5TWVzaGVzICYmIGdyaWRPYmplY3Qudmlldy5kZWJ1Z01lc2ggIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdGdyaWRPYmplY3Qudmlldy5tZXNoLmNoaWxkcmVuLnB1c2goZ3JpZE9iamVjdC52aWV3LmRlYnVnTWVzaCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoYXQuZW50aXR5TWVzaGVzLmNoaWxkcmVuLnB1c2goZ3JpZE9iamVjdC52aWV3Lm1lc2gpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5zY2VuZS5hZGQodGhpcy5lbnRpdHlNZXNoZXMpO1xyXG5cclxuXHRcdC8vIGlmICh0aGlzLmRlYnVnRW50aXR5TWVzaGVzKSB7XHJcblx0XHQvLyBcdHRoaXMuc2NlbmUuYWRkKHRoaXMucGxheWVyLnZpZXcuZGVidWdNZXNoKTtcclxuXHRcdC8vIH1cclxuXHR9LFxyXG5cclxuICBhZGRFbnRpdHlNZXNoVG9TY2VuZTogZnVuY3Rpb24gKGdyaWRPYmplY3QpIHtcclxuICAgIHRoaXMuc2NlbmUuY2hpbGRyZW4ucHVzaChncmlkT2JqZWN0LnZpZXcubWVzaCk7XHJcbiAgfSxcclxuXHJcblx0YWRkRGVidWdMaW5lOiBmdW5jdGlvbihwb3MwLCBwb3MxLCBjb2xvcikge1xyXG5cdFx0Y29sb3IgPSAoY29sb3IgIT09IHVuZGVmaW5lZCkgPyBjb2xvcjogMHhmZmZmZmY7XHJcblxyXG5cdFx0dmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkdlb21ldHJ5KCk7XHJcblx0XHRnZW9tZXRyeS52ZXJ0aWNlcy5wdXNoKHBvczApO1xyXG5cdFx0Z2VvbWV0cnkudmVydGljZXMucHVzaChwb3MxKTtcclxuXHRcdHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiBjb2xvciB9KTtcclxuXHRcdHZhciBsaW5lID0gbmV3IFRIUkVFLkxpbmUoZ2VvbWV0cnksIG1hdGVyaWFsKTtcclxuXHRcdHRoaXMuc2NlbmUuYWRkKGxpbmUpO1xyXG5cdH0sXHJcblxyXG5cdGFkZERlYnVnQ2VsbExpbmVzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBoZWlnaHQgPSAyO1xyXG5cdFx0dmFyIGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKDAsIDAsIDAuNSkuZ2V0SGV4KCk7XHJcblxyXG5cdFx0dmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkodGhpcy53aWR0aCAqIHRoaXMuY2VsbFNpemUsIHRoaXMuaGVpZ2h0ICogdGhpcy5jZWxsU2l6ZSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG5cdFx0dmFyIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6IGNvbG9yLCB3aXJlZnJhbWU6IHRydWUgfSk7XHJcblx0XHR2YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XHJcblx0XHRtZXNoLnJvdGF0aW9uLnggPSAtTWF0aC5QSSAvIDI7XHJcblxyXG5cdFx0dmFyIHYgPSB0aGlzLm1hcC5ib3VuZHMubWluLmNsb25lKCkubXVsdGlwbHlTY2FsYXIoLTEpO1xyXG5cdFx0di5zdWIodGhpcy5tYXAuYm91bmRzLm1heC5jbG9uZSgpLnN1Yih0aGlzLm1hcC5ib3VuZHMubWluKS5kaXZpZGVTY2FsYXIoMikpO1xyXG5cdFx0bWVzaC5wb3NpdGlvbi54ID0gLXYueDtcclxuXHRcdG1lc2gucG9zaXRpb24ueSA9IGhlaWdodDtcclxuXHRcdG1lc2gucG9zaXRpb24ueiA9IC12Lnk7XHJcblxyXG5cdFx0dGhpcy5zY2VuZS5hZGQobWVzaCk7XHJcblx0fSxcclxuXHJcblx0YWRkUHJvamVjdGlsZTogZnVuY3Rpb24oc291cmNlR3JpZE9iamVjdCwgdHlwZSwgcG9zaXRpb24sIGRpcmVjdGlvbikge1xyXG5cdFx0dmFyIHByb2plY3RpbGUgPSBuZXcgR1MuUHJvamVjdGlsZSh0aGlzLCBzb3VyY2VHcmlkT2JqZWN0LCB0eXBlLCBwb3NpdGlvbiwgZGlyZWN0aW9uKTtcclxuXHRcdHByb2plY3RpbGUuaW5pdCgpO1xyXG5cclxuXHRcdGlmICh0aGlzLmRlYnVnRW50aXR5TWVzaGVzKSB7XHJcblx0XHRcdHByb2plY3RpbGUudmlldy5kZWJ1Z01lc2ggPSBuZXcgVEhSRUUuTWVzaChcclxuXHRcdFx0XHRuZXcgVEhSRUUuQm94R2VvbWV0cnkoMSwgMSwgMSksXHJcblx0XHRcdFx0bmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6IDB4ZmZmZmZmLCB3aXJlZnJhbWU6IHRydWUgfSlcclxuXHRcdFx0KTtcclxuXHJcblx0XHRcdHRoaXMuc2NlbmUuYWRkKHByb2plY3RpbGUudmlldy5kZWJ1Z01lc2gpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMubGlnaHRpbmdWaWV3LmFkZFByb2plY3RpbGVMaWdodChwcm9qZWN0aWxlKTtcclxuXHR9LFxyXG5cclxuXHRhZGRFbnZpcm9ubWVudEltcGFjdFBhcnRpY2xlczogZnVuY3Rpb24ocG9zaXRpb24sIG5vcm1hbCwgY29sb3IsIG4pIHtcclxuXHRcdG4gPSBuIHx8IDU7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykge1xyXG5cdFx0XHR2YXIgcGFydGljbGUgPSB0aGlzLnBhcnRpY2xlVmlldy5hZGRQYXJ0aWNsZSgxLCAxLCAxLCBjb2xvciwgR1MuUGFydGljbGVNb3ZlbWVudFR5cGVzLkZhbGxpbmcsIHBvc2l0aW9uKTtcclxuXHRcdFx0dGhpcy5wYXJ0aWNsZVZpZXcuYWxpZ25QYXJ0aWNsZVRyYWplY3RvcnlUb05vcm1hbChwYXJ0aWNsZSwgbm9ybWFsKTtcclxuXHRcdFx0cGFydGljbGUubWVzaC5wb3NpdGlvbi5jb3B5KHBvc2l0aW9uKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRhZGRFbnRpdHlJbXBhY3RQYXJ0aWNsZXM6IGZ1bmN0aW9uKHBvc2l0aW9uLCBjb2xvciwgbikge1xyXG5cdFx0biA9IG4gfHwgMztcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7XHJcblx0XHRcdHZhciBwYXJ0aWNsZSA9IHRoaXMucGFydGljbGVWaWV3LmFkZFBhcnRpY2xlKDEsIDEsIDEsIGNvbG9yLCBHUy5QYXJ0aWNsZU1vdmVtZW50VHlwZXMuR3VzaGluZywgcG9zaXRpb24pO1xyXG5cdFx0XHRwYXJ0aWNsZS5tZXNoLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGdldE1lc2hGcm9tQm94MjogZnVuY3Rpb24oYm94MiwgbWF0ZXJpYWwpIHtcclxuXHRcdHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5HZW9tZXRyeSgpO1xyXG5cclxuXHRcdGdlb21ldHJ5LnZlcnRpY2VzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoYm94Mi5taW4ueCwgMCwgYm94Mi5taW4ueSkpO1xyXG5cdFx0Z2VvbWV0cnkudmVydGljZXMucHVzaChuZXcgVEhSRUUuVmVjdG9yMyhib3gyLm1heC54LCAwLCBib3gyLm1pbi55KSk7XHJcblx0XHRnZW9tZXRyeS52ZXJ0aWNlcy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKGJveDIubWluLngsIDAsIGJveDIubWF4LnkpKTtcclxuXHRcdGdlb21ldHJ5LnZlcnRpY2VzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoYm94Mi5tYXgueCwgMCwgYm94Mi5tYXgueSkpO1xyXG5cclxuXHRcdGdlb21ldHJ5LmZhY2VzLnB1c2gobmV3IFRIUkVFLkZhY2UzKDAsIDEsIDIpKTtcclxuXHRcdGdlb21ldHJ5LmZhY2VzLnB1c2gobmV3IFRIUkVFLkZhY2UzKDEsIDMsIDIpKTtcclxuXHJcblx0XHR2YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XHJcblx0XHRyZXR1cm4gbWVzaDtcclxuXHR9LFxyXG5cclxuXHRhZGREZWJ1Z0dyaWRMb2NhdGlvbjogZnVuY3Rpb24oZ3JpZExvY2F0aW9uKSB7XHJcblx0XHR2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZjAwZmYsIHdpcmVmcmFtZTogdHJ1ZSB9KTtcclxuXHRcdHZhciBtZXNoID0gdGhpcy5nZXRNZXNoRnJvbUJveDIoZ3JpZExvY2F0aW9uLmJveDIsIG1hdGVyaWFsKTtcclxuXHRcdHRoaXMuc2NlbmUuYWRkKG1lc2gpO1xyXG5cdH0sXHJcblxyXG5cdGZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxsczogZnVuY3Rpb24oY2VsbHMsIHR5cGVzLCBjYWxsYmFjaykge1xyXG5cdFx0dmFyIGdyaWRPYmplY3RzID0ge307XHJcblxyXG5cdFx0aWYgKHR5cGVzICE9PSB1bmRlZmluZWQgJiYgdHlwZXMubGVuZ3RoID4gMCkge1xyXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGNlbGxzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0dmFyIGNlbGwgPSBjZWxsc1tpXTtcclxuXHJcblx0XHRcdFx0Zm9yICh2YXIgayA9IDA7IGsgPCBjZWxsLmNoaWxkcmVuLmxlbmd0aDsgaysrKSB7XHJcblx0XHRcdFx0XHR2YXIgZ3JpZE9iamVjdCA9IGNlbGwuY2hpbGRyZW5ba107XHJcblx0XHRcdFx0XHRmb3IgKHZhciBlID0gMDsgZSA8IHR5cGVzLmxlbmd0aDsgZSsrKSB7XHJcblx0XHRcdFx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgdHlwZXNbZV0pIHtcclxuXHRcdFx0XHRcdFx0XHRncmlkT2JqZWN0c1tncmlkT2JqZWN0LmlkXSA9IGdyaWRPYmplY3Q7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgY2VsbHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgY2VsbCA9IGNlbGxzW2ldO1xyXG5cclxuXHRcdFx0XHRmb3IgKHZhciBrID0gMDsgayA8IGNlbGwuY2hpbGRyZW4ubGVuZ3RoOyBrKyspIHtcclxuXHRcdFx0XHRcdHZhciBncmlkT2JqZWN0ID0gY2VsbC5jaGlsZHJlbltrXTtcclxuXHRcdFx0XHRcdGdyaWRPYmplY3RzW2dyaWRPYmplY3QuaWRdID0gZ3JpZE9iamVjdDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRPYmplY3Qua2V5cyhncmlkT2JqZWN0cykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcclxuXHRcdFx0Y2FsbGJhY2soZ3JpZE9iamVjdHNba2V5XSk7XHJcblx0XHR9KTtcclxuXHR9LFxyXG5cclxuXHRmb3JFYWNoVW5pcXVlR3JpZE9iamVjdDogZnVuY3Rpb24odHlwZXMsIGNhbGxiYWNrKSB7XHJcblx0XHR2YXIgZ3JpZE9iamVjdHMgPSB7fTtcclxuXHJcblx0XHRpZiAodHlwZXMgIT09IHVuZGVmaW5lZCAmJiB0eXBlcy5sZW5ndGggPiAwKSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5oZWlnaHQ7IGkrKykge1xyXG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy53aWR0aDsgaisrKSB7XHJcblx0XHRcdFx0XHR2YXIgY2VsbCA9IHRoaXMuY2VsbHNbaV1bal07XHJcblxyXG5cdFx0XHRcdFx0Zm9yICh2YXIgayA9IDA7IGsgPCBjZWxsLmNoaWxkcmVuLmxlbmd0aDsgaysrKSB7XHJcblx0XHRcdFx0XHRcdHZhciBncmlkT2JqZWN0ID0gY2VsbC5jaGlsZHJlbltrXTtcclxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgZSA9IDA7IGUgPCB0eXBlcy5sZW5ndGg7IGUrKykge1xyXG5cdFx0XHRcdFx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgdHlwZXNbZV0pIHtcclxuXHRcdFx0XHRcdFx0XHRcdGdyaWRPYmplY3RzW2dyaWRPYmplY3QuaWRdID0gZ3JpZE9iamVjdDtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5oZWlnaHQ7IGkrKykge1xyXG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy53aWR0aDsgaisrKSB7XHJcblx0XHRcdFx0XHR2YXIgY2VsbCA9IHRoaXMuY2VsbHNbaV1bal07XHJcblxyXG5cdFx0XHRcdFx0Zm9yICh2YXIgayA9IDA7IGsgPCBjZWxsLmNoaWxkcmVuLmxlbmd0aDsgaysrKSB7XHJcblx0XHRcdFx0XHRcdHZhciBncmlkT2JqZWN0ID0gY2VsbC5jaGlsZHJlbltrXTtcclxuXHRcdFx0XHRcdFx0Z3JpZE9iamVjdHNbZ3JpZE9iamVjdC5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdE9iamVjdC5rZXlzKGdyaWRPYmplY3RzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHRjYWxsYmFjayhncmlkT2JqZWN0c1trZXldKTtcclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdHJlbW92ZUVudGl0eU1lc2g6IGZ1bmN0aW9uKG1lc2gpIHtcclxuXHRcdHRoaXMuZW50aXR5TWVzaGVzLnJlbW92ZShtZXNoKTtcclxuXHR9LFxyXG5cclxuXHRpc1BvaW50SW5NYXBCb3VuZHM6IGZ1bmN0aW9uKHBvaW50KSB7XHJcblx0XHRyZXR1cm4gdGhpcy5tYXAuYm91bmRzLmNvbnRhaW5zUG9pbnQocG9pbnQpO1xyXG5cdH0sXHJcblxyXG5cdGdldEdyaWRMb2NhdGlvbkZyb21Qb2ludHM6IGZ1bmN0aW9uKHBvaW50cykge1xyXG5cdFx0dmFyIGJveDIgPSBuZXcgVEhSRUUuQm94MigpLnNldEZyb21Qb2ludHMocG9pbnRzKTtcclxuXHJcblx0XHRpZiAodGhpcy5tYXAuYm91bmRzLmlzSW50ZXJzZWN0aW9uQm94KGJveDIpKSB7XHJcblx0XHRcdHZhciBncmlkTWluID0gdGhpcy5nZXRHcmlkQ29vcmRzKGJveDIubWluKTtcclxuXHRcdFx0dmFyIGdyaWRNYXggPSB0aGlzLmdldEdyaWRDb29yZHMoYm94Mi5tYXgpO1xyXG5cclxuXHRcdFx0Z3JpZE1pbi54ID0gR1MuTWF0aEhlbHBlci5jbGFtcChncmlkTWluLngsIDAsIHRoaXMud2lkdGggLSAxKTtcclxuXHRcdFx0Z3JpZE1pbi55ID0gR1MuTWF0aEhlbHBlci5jbGFtcChncmlkTWluLnksIDAsIHRoaXMuaGVpZ2h0IC0gMSk7XHJcblx0XHRcdGdyaWRNYXgueCA9IEdTLk1hdGhIZWxwZXIuY2xhbXAoZ3JpZE1heC54LCAwLCB0aGlzLndpZHRoIC0gMSk7XHJcblx0XHRcdGdyaWRNYXgueSA9IEdTLk1hdGhIZWxwZXIuY2xhbXAoZ3JpZE1heC55LCAwLCB0aGlzLmhlaWdodCAtIDEpO1xyXG5cclxuXHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRib3gyOiBib3gyLFxyXG5cdFx0XHRcdGdyaWRNaW46IGdyaWRNaW4sXHJcblx0XHRcdFx0Z3JpZE1heDogZ3JpZE1heCxcclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRHcmlkQ29vcmRzOiBmdW5jdGlvbihwb2ludCkge1xyXG5cdFx0dmFyIHAgPSBwb2ludC5jbG9uZSgpLnN1Yih0aGlzLm1hcC5ib3VuZHMubWluKTtcclxuXHRcdHAueCA9IE1hdGguZmxvb3IocC54IC8gdGhpcy5jZWxsU2l6ZSk7XHJcblx0XHRwLnkgPSBNYXRoLmZsb29yKHAueSAvIHRoaXMuY2VsbFNpemUpO1xyXG5cdFx0cmV0dXJuIHA7XHJcblx0fSxcclxuXHJcblx0Z2V0Q2VsbHNGcm9tR3JpZExvY2F0aW9uOiBmdW5jdGlvbihncmlkTG9jYXRpb24pIHtcclxuXHRcdHZhciBjZWxscyA9IFtdO1xyXG5cclxuXHRcdHZhciBtaW4gPSBncmlkTG9jYXRpb24uZ3JpZE1pbjtcclxuXHRcdHZhciBtYXggPSBncmlkTG9jYXRpb24uZ3JpZE1heDtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gbWluLnk7IGkgPD0gbWF4Lnk7IGkrKykge1xyXG5cdFx0XHRmb3IgKHZhciBqID0gbWluLng7IGogPD0gbWF4Lng7IGorKykge1xyXG5cdFx0XHRcdGNlbGxzLnB1c2godGhpcy5jZWxsc1tpXVtqXSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gY2VsbHM7XHJcblx0fSxcclxuXHJcblx0Z2V0VHJpYW5nbGVJdGVyYXRvcjogZnVuY3Rpb24oZ3JpZExvY2F0aW9uLCB0eXBlcywgY29uZGl0aW9uKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR2YXIgY2VsbHMgPSB0aGF0LmdldENlbGxzRnJvbUdyaWRMb2NhdGlvbihncmlkTG9jYXRpb24pO1xyXG5cclxuXHRcdGlmIChjb25kaXRpb24gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oY2FsbGJhY2spIHtcclxuXHRcdFx0XHR0aGF0LmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxscyhjZWxscywgdHlwZXMsIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0XHRcdHZhciB0cmlhbmdsZXMgPSBncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS50cmlhbmdsZXM7XHJcblxyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpICs9IDMpIHtcclxuXHRcdFx0XHRcdFx0Y2FsbGJhY2soZ3JpZE9iamVjdCwgdHJpYW5nbGVzW2ldLCB0cmlhbmdsZXNbaSArIDFdLCB0cmlhbmdsZXNbaSArIDJdLCBpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xyXG5cdFx0XHR0aGF0LmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxscyhjZWxscywgdHlwZXMsIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0XHRpZiAoY29uZGl0aW9uKGdyaWRPYmplY3QpKSB7XHJcblx0XHRcdFx0XHR2YXIgdHJpYW5nbGVzID0gZ3JpZE9iamVjdC52aWV3LmNvbGxpc2lvbkRhdGEudHJpYW5nbGVzO1xyXG5cclxuXHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSArPSAzKSB7XHJcblx0XHRcdFx0XHRcdGNhbGxiYWNrKGdyaWRPYmplY3QsIHRyaWFuZ2xlc1tpXSwgdHJpYW5nbGVzW2kgKyAxXSwgdHJpYW5nbGVzW2kgKyAyXSwgaSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRTZWdtZW50SXRlcmF0b3I6IGZ1bmN0aW9uKGdyaWRMb2NhdGlvbiwgY29uZGl0aW9uKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR2YXIgY2VsbHMgPSB0aGF0LmdldENlbGxzRnJvbUdyaWRMb2NhdGlvbihncmlkTG9jYXRpb24pO1xyXG5cclxuXHRcdGlmIChjb25kaXRpb24gPT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oY2FsbGJhY2spIHtcclxuXHRcdFx0XHR0aGF0LmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxscyhjZWxscywgW0dTLkNvbmNyZXRlLCBHUy5FbGV2YXRvciwgR1MuRG9vcl0sIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuQ29uY3JldGUgJiYgZ3JpZE9iamVjdC50eXBlID09PSBHUy5NYXBMYXllcnMuU2VnbWVudCkge1xyXG5cdFx0XHRcdFx0XHRjYWxsYmFjayhncmlkT2JqZWN0LnNvdXJjZU9iaik7XHJcblx0XHRcdFx0XHR9IGVsc2VcclxuXHRcdFx0XHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuRWxldmF0b3IgfHwgZ3JpZE9iamVjdCBpbnN0YW5jZW9mIEdTLkRvb3IpIHtcclxuXHRcdFx0XHRcdFx0dmFyIHNlZ3MgPSBncmlkT2JqZWN0LnZpZXcuY29sbGlzaW9uRGF0YS5zZWdtZW50cztcclxuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdFx0Y2FsbGJhY2soc2Vnc1tpXSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xyXG5cdFx0XHR0aGF0LmZvckVhY2hVbmlxdWVHcmlkT2JqZWN0SW5DZWxscyhjZWxscywgW0dTLkNvbmNyZXRlLCBHUy5FbGV2YXRvciwgR1MuRG9vcl0sIGZ1bmN0aW9uKGdyaWRPYmplY3QpIHtcclxuXHRcdFx0XHRpZiAoZ3JpZE9iamVjdCBpbnN0YW5jZW9mIEdTLkNvbmNyZXRlICYmIGdyaWRPYmplY3QudHlwZSA9PT0gR1MuTWFwTGF5ZXJzLlNlZ21lbnQpIHtcclxuXHRcdFx0XHRcdGlmIChjb25kaXRpb24oZ3JpZE9iamVjdC5zb3VyY2VPYmopKSB7XHJcblx0XHRcdFx0XHRcdGNhbGxiYWNrKGdyaWRPYmplY3Quc291cmNlT2JqKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9IGVsc2VcclxuXHRcdFx0XHRpZiAoZ3JpZE9iamVjdCBpbnN0YW5jZW9mIEdTLkVsZXZhdG9yIHx8IGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Eb29yKSB7XHJcblx0XHRcdFx0XHR2YXIgc2VncyA9IGdyaWRPYmplY3Qudmlldy5jb2xsaXNpb25EYXRhLnNlZ21lbnRzO1xyXG5cdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzZWdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRcdGlmIChjb25kaXRpb24oc2Vnc1tpXSkpIHtcclxuXHRcdFx0XHRcdFx0XHRjYWxsYmFjayhzZWdzW2ldKTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Y2xlYXJTY2VuZTogZnVuY3Rpb24oKSB7XHJcblx0XHRmb3IgKHZhciBpID0gdGhpcy5zY2VuZS5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHR2YXIgb2JqID0gdGhpcy5zY2VuZS5jaGlsZHJlbltpXTtcclxuXHRcdFx0dGhpcy5zY2VuZS5yZW1vdmUob2JqKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRvblJlc2l6ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnNreWJveC5jYW1lcmEuYXNwZWN0ID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblx0XHR0aGlzLnNreWJveC5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZUZvdjogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnNreWJveC5jYW1lcmEuZm92ID0gR1MuU2V0dGluZ3MuZm92O1xyXG5cdFx0dGhpcy5za3lib3guY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuXHR9LFxyXG5cclxuICBzcGF3bkVudGl0eTogZnVuY3Rpb24gKG50dCkge1xyXG4gICAgdmFyIHR5cGUgPSBHUy5NYXBFbnRpdGllc1tudHQudHlwZV0udHlwZTtcclxuXHJcbiAgICB2YXIgZ3JpZE9iamVjdCA9IG5ldyBHU1t0eXBlXSh0aGlzLCBHUy5NYXBMYXllcnMuRW50aXR5LCBudHQpO1xyXG4gICAgdmFyIG9mZnNldCA9IGdyaWRPYmplY3Qub2Zmc2V0O1xyXG4gICAgdmFyIHNpemUgPSBncmlkT2JqZWN0LnNpemU7XHJcbiAgICBncmlkT2JqZWN0LnBvc2l0aW9uID0gb2Zmc2V0LmNsb25lKCk7XHJcbiAgICBncmlkT2JqZWN0LnBvc2l0aW9uLnggKz0gbnR0LnBvcy54O1xyXG4gICAgZ3JpZE9iamVjdC5wb3NpdGlvbi55ICs9IG50dC55IHx8IDA7XHJcbiAgICBncmlkT2JqZWN0LnBvc2l0aW9uLnogKz0gbnR0LnBvcy55O1xyXG5cclxuICAgIGdyaWRPYmplY3QuaXNTdGF0aWMgPSBudHQuaXNTdGF0aWM7XHJcblxyXG4gICAgdmFyIHBvaW50cyA9IFtcclxuICAgICAgbnR0LnBvcy5jbG9uZSgpLmFkZChuZXcgVEhSRUUuVmVjdG9yMihvZmZzZXQueCwgb2Zmc2V0LnopKS5zdWIobmV3IFRIUkVFLlZlY3RvcjIoc2l6ZS54LCBzaXplLnopKSxcclxuICAgICAgbnR0LnBvcy5jbG9uZSgpLmFkZChuZXcgVEhSRUUuVmVjdG9yMihvZmZzZXQueCwgb2Zmc2V0LnopKS5hZGQobmV3IFRIUkVFLlZlY3RvcjIoc2l6ZS54LCBzaXplLnopKSxcclxuICAgIF07XHJcbiAgICB2YXIgZ3JpZExvY2F0aW9uID0gdGhpcy5nZXRHcmlkTG9jYXRpb25Gcm9tUG9pbnRzKHBvaW50cyk7XHJcbiAgICB0aGlzLnZpZXdGYWN0b3J5LmFwcGx5RW50aXR5VmlldyhncmlkT2JqZWN0KTtcclxuICAgIGdyaWRPYmplY3QuYXNzaWduVG9DZWxscyhncmlkTG9jYXRpb24pO1xyXG4gICAgZ3JpZE9iamVjdC5zdGFydGluZ1NlY3RvciA9IGdyaWRPYmplY3QuZ2V0U2VjdG9yKCk7XHJcbiAgICByZXR1cm4gZ3JpZE9iamVjdDtcclxuICB9LFxyXG5cclxuICBzcGF3bkVudGl0eUF0UnVudGltZTogZnVuY3Rpb24gKG50dCkge1xyXG4gICAgbGV0IGdyaWRPYmogPSB0aGlzLnNwYXduRW50aXR5KG50dCk7XHJcbiAgICBncmlkT2JqLmluaXQoKTtcclxuICAgIHRoaXMuYWRkRW50aXR5TWVzaFRvU2NlbmUoZ3JpZE9iaik7XHJcbiAgICByZXR1cm4gZ3JpZE9iajtcclxuICB9LFxyXG5cclxufTtcclxuIiwiR1MuTWFwU2NyaXB0ID0gZnVuY3Rpb24oZ3JpZE9iamVjdExpYnJhcnkpIHtcclxuXHR0aGlzLmxpYiA9IGdyaWRPYmplY3RMaWJyYXJ5O1xyXG5cdFxyXG5cdHRoaXMubWFwTmFtZSA9IFwibWFwIG5hbWVcIjtcclxuXHR0aGlzLm1hcFdvbiA9IGZhbHNlO1xyXG5cdHRoaXMubmV4dE1hcCA9IHVuZGVmaW5lZDtcclxuXHRcclxuXHR0aGlzLnNlY3JldHNGb3VuZCA9IDA7XHJcblx0dGhpcy5tYXhTZWNyZXRzID0gMDtcclxuXHR0aGlzLm11c2ljVHJhY2sgPSBcInNpbXBsZV9hY3Rpb25fYmVhdFwiO1xyXG59O1xyXG5cclxuR1MuTWFwU2NyaXB0LnByb3RvdHlwZSA9IHtcclxuXHRjb25zdHJ1Y3RvcjogR1MuTWFwU2NyaXB0LFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG5cdH0sXHJcblxyXG5cdG9uWm9uZUVudGVyOiBmdW5jdGlvbih6b25lKSB7XHJcblx0fSxcclxuXHJcblx0b25ab25lTGVhdmU6IGZ1bmN0aW9uKHpvbmUpIHtcclxuXHR9LFxyXG5cclxuXHRvbkl0ZW1QaWNrdXA6IGZ1bmN0aW9uKGl0ZW0pIHtcclxuXHR9LFxyXG5cclxuXHRvblBsYXllck9wZW5Eb29yOiBmdW5jdGlvbihkb29yKSB7XHJcblx0fSxcclxuXHJcblx0b25Td2l0Y2hTdGF0ZUNoYW5nZTogZnVuY3Rpb24oc3dpdGNoT2JqKSB7XHJcblx0fSxcclxuXHJcblx0Zm91bmRTZWNyZXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5zZWNyZXRzRm91bmQrKztcclxuXHRcdEdTLkRlYnVnVUkuYWRkVGVtcExpbmUoXCJzZWNyZXQgZm91bmRcIik7XHJcblx0fSxcclxuXHJcblx0Z2V0R3JpZE9iamVjdHNCeUlkOiBmdW5jdGlvbih0eXBlLCBpZEFycmF5KSB7XHJcblx0XHR2YXIgbGlzdCA9IFtdO1xyXG5cdFx0dmFyIHNvdXJjZSA9IHRoaXMubGliW3R5cGVdO1xyXG5cdFx0Zm9yICh2YXIgaSBpbiBzb3VyY2UpIHtcdFx0XHRcclxuXHRcdFx0aWYgKGlkQXJyYXkuaW5kZXhPZihwYXJzZUludChpLCAxMCkpICE9IC0xKSB7XHRcdFx0XHRcclxuXHRcdFx0XHRsaXN0LnB1c2goc291cmNlW2ldKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGxpc3Q7XHJcblx0fSxcclxufTsiLCJHUy5NdXNpY01hbmFnZXIgPSBmdW5jdGlvbigpIHtcclxuXHR0aGlzLnZvbHVtZSA9IEdTLlNldHRpbmdzLm11c2ljIC8gMTA7XHJcbn07XHJcblxyXG5HUy5NdXNpY01hbmFnZXIucHJvdG90eXBlID0ge1xyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGN0eDtcclxuXHJcblx0XHRpZiAodHlwZW9mIEF1ZGlvQ29udGV4dCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG5cdFx0XHRjdHggPSBuZXcgQXVkaW9Db250ZXh0KCk7XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICh0eXBlb2Ygd2Via2l0QXVkaW9Db250ZXh0ICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcblx0XHRcdGN0eCA9IG5ldyB3ZWJraXRBdWRpb0NvbnRleHQoKTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdEdBTUUuaGFuZGxlRmF0YWxFcnJvcihcIk5vIEF1ZGlvQ29udGV4dCBzdXBwb3J0XCIpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5jdHggPSBjdHg7XHJcblxyXG5cdFx0aWYgKCF0aGlzLmN0eC5jcmVhdGVHYWluKSB7XHJcblx0XHRcdHRoaXMuY3R4LmNyZWF0ZUdhaW4gPSBjdHguY3JlYXRlR2Fpbk5vZGU7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5nYWluTm9kZSA9IHRoaXMuY3R4LmNyZWF0ZUdhaW4oKTtcclxuXHRcdHRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IHRoaXMuX3ZvbHVtZTtcclxuXHRcdHRoaXMuZ2Fpbk5vZGUuY29ubmVjdCh0aGlzLmN0eC5kZXN0aW5hdGlvbik7XHJcblxyXG5cdFx0dGhpcy5pbml0VHJhY2tzKCk7XHJcblx0fSxcclxuXHJcblx0cGxheVRyYWNrOiBmdW5jdGlvbihuYW1lKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR0aGlzLmN1cnJlbnRUcmFjayA9IHRoaXMudHJhY2tzW25hbWVdO1xyXG5cclxuXHRcdGlmICh0aGlzLnNvdXJjZSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuc291cmNlLnN0b3AoMCk7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5zb3VyY2UgPSB0aGlzLmN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcclxuXHRcdHRoaXMuc291cmNlLmJ1ZmZlciA9IHRoaXMuY3VycmVudFRyYWNrLmJ1ZmZlcjtcclxuXHRcdHRoaXMuc291cmNlLmxvb3AgPSB0cnVlO1xyXG5cdFx0dGhpcy5zb3VyY2UuY29ubmVjdCh0aGlzLmdhaW5Ob2RlKTtcclxuXHRcdGlmICghdGhpcy5zb3VyY2Uuc3RhcnQpIHtcclxuXHRcdFx0dGhpcy5zb3VyY2Uuc3RhcnQgPSBzb3VyY2Uubm90ZU9uO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5zb3VyY2Uuc3RhcnQoMCk7XHJcblx0fSxcclxuXHJcblx0aW5pdFRyYWNrczogZnVuY3Rpb24oc291bmRCdWZmZXJzKSB7XHJcblx0XHR0aGlzLnRyYWNrcyA9IHt9O1xyXG5cdFx0Zm9yICh2YXIgaSBpbiBzb3VuZEJ1ZmZlcnMpIHtcclxuXHRcdFx0dGhpcy50cmFja3NbaV0gPSB7XHJcblx0XHRcdFx0YnVmZmVyOiBzb3VuZEJ1ZmZlcnNbaV0sXHJcblx0XHRcdFx0ZHVyYXRpb246IE1hdGguY2VpbChzb3VuZEJ1ZmZlcnNbaV0ubGVuZ3RoIC8gdGhpcy5jdHguc2FtcGxlUmF0ZSAqIDEwMDApLFxyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHNldCB2b2x1bWUodmFsdWUpIHtcclxuXHRcdHRoaXMuX3ZvbHVtZSA9IHZhbHVlO1xyXG5cdFx0aWYgKHRoaXMuZ2Fpbk5vZGUgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmdhaW5Ob2RlLmdhaW4udmFsdWUgPSB0aGlzLl92b2x1bWU7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0IHZvbHVtZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLl92b2x1bWU7XHJcblx0fSxcclxufTsiLCJHUy5PbmxpbmVNYW5hZ2VyID0gZnVuY3Rpb24oZ3JpZCkge1xyXG5cdHRoaXMubWFwV29uID0gZmFsc2U7XHJcblxyXG5cdHRoaXMub25saW5lUGxheWVyc0tpbGxlZCA9IDA7XHJcbiAgdGhpcy5vbmxpbmVSb29tID0gbmV3IEdTLk9ubGluZVJvb20oKTtcclxufTtcclxuXHJcbkdTLk9ubGluZU1hbmFnZXIucHJvdG90eXBlID0ge1xyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0Ly8gdGhpcy5pbml0R3JpZE9iamVjdExpYnJhcnkoKTtcclxuXHRcdC8vIHRoaXMuaW5pdFNjcmlwdHMoKTtcclxuICAgIHRoaXMuY2FsbGJhY2tzID0ge307XHJcbiAgICB0aGlzLnNvY2tldCA9IHsgZW1pdDogKCkgPT4ge319XHJcbiAgICB0aGlzLm9ubGluZVJvb20uaW5pdCgpO1xyXG5cdH0sXHJcblxyXG4gIGlzQ3VycmVudENsaWVudChjbGllbnQpIHtcclxuICAgIGNsaWVudC5pZCA9PT0gdGhpcy5zb2NrZXQuaWQ7XHJcbiAgfSxcclxuXHJcbiAgc2V0R3JpZDogZnVuY3Rpb24gKGdyaWcpIHtcclxuICAgIHRoaXMuZ3JpZCA9IGdyaWQ7XHJcbiAgICB0aGlzLm1hcCA9IGdyaWQubWFwO1xyXG4gIH0sXHJcblxyXG4gIHNldHVwQ2xpZW50czogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5vbmxpbmVSb29tLnNldHVwQ2xpZW50cygpO1xyXG4gIH0sXHJcblxyXG4gIHNvY2tldExpc3RlbmVyczogZnVuY3Rpb24gKHNvY2tldCkge1xyXG4gICAgLy8gc29ja2V0LnVzZVBlZXJDb25uZWN0aW9uID0gdHJ1ZTtcclxuXHJcbiAgICAvLyB0aGlzIGV2ZW50IHdpbGwgYmUgdHJpZ2dlcmVkIG92ZXIgdGhlIHNvY2tldCB0cmFuc3BvcnRcclxuICAgIC8vIHVudGlsIGB1c2VQZWVyQ29ubmVjdGlvbmAgaXMgc2V0IHRvIGB0cnVlYFxyXG4gICAgc29ja2V0Lm9uKCdwZWVyLW1zZycsIChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc29ja2V0Lm9uKCdnZXQtcm9vbXMnLCAoZGF0YSkgPT4ge1xyXG4gICAgICAodGhpcy5jYWxsYmFja3MuZ2V0Um9vbXMgfHwgKChlKSA9PiB7fSkpKGRhdGEucm9vbXMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gc29ja2V0Lm9uKCdkZWFkLW1vbnN0ZXInLCB0aGlzLm9uTW9uc3RlckRlYXRoLmJpbmQodGhpcykpO1xyXG4gICAgc29ja2V0Lm9uKCdzZXR1cC1yb29tJywgdGhpcy5vblNldHVwUm9vbS5iaW5kKHRoaXMpKTtcclxuICAgIHNvY2tldC5vbigncGxheWVyLWRpZScsIHRoaXMub25PbmxpbmVQbGF5ZXJEZWF0aC5iaW5kKHRoaXMpKTtcclxuICAgIHNvY2tldC5vbigncGxheWVyLXJlc3Bhd24nLCB0aGlzLm9uT25saW5lUGxheWVyUmVzcGF3bi5iaW5kKHRoaXMpKTtcclxuICAgIHNvY2tldC5vbigncGxheWVyLWpvaW4nLCB0aGlzLm9uT25saW5lUGxheWVySm9pbi5iaW5kKHRoaXMpKTtcclxuICAgIC8vIHNvY2tldC5vbigncGxheWVyLW1vdmUnLCB0aGlzLm9uT25saW5lUGxheWVyTW92ZS5iaW5kKHRoaXMpKTtcclxuICAgIHNvY2tldC5vbigncGxheWVyLXNob290JywgdGhpcy5vbk9ubGluZVBsYXllclNob290LmJpbmQodGhpcykpO1xyXG4gICAgc29ja2V0Lm9uKCdwbGF5ZXItcGlja3VwJywgdGhpcy5vbk9ubGluZVBsYXllckl0ZW1QaWNrdXAuYmluZCh0aGlzKSk7XHJcbiAgICBzb2NrZXQub24oJ2Rvb3Itb3BlbicsIHRoaXMub25PbmxpbmVQbGF5ZXJPcGVuRG9vci5iaW5kKHRoaXMpKTtcclxuICAgIHNvY2tldC5vbignc3dpdGNoLWNoYW5nZScsIHRoaXMub25Td2l0Y2hTdGF0ZUNoYW5nZS5iaW5kKHRoaXMpKTtcclxuICAgIHNvY2tldC5vbigncm9vbS1waW5nJywgdGhpcy5vblJvb21QaW5nLmJpbmQodGhpcykpO1xyXG4gICAgc29ja2V0Lm9uKCd1c2UtZWxldmF0b3InLCB0aGlzLm9uVXNlRWxldmF0b3IuYmluZCh0aGlzKSk7XHJcbiAgICAvLyBzb2NrZXQub24oJ3VwLWVsZXZhdG9yJywgdGhpcy5vblVwRWxldmF0b3IuYmluZCh0aGlzKSk7XHJcbiAgICAvLyBzb2NrZXQub24oJ2Rvd24tZWxldmF0b3InLCB0aGlzLm9uRG93bkVsZXZhdG9yLmJpbmQodGhpcykpO1xyXG4gICAgc29ja2V0Lm9uKCdlbnRlci1zZWN0b3InLCB0aGlzLm9uRW50ZXJTZWN0b3IuYmluZCh0aGlzKSk7XHJcbiAgICBzb2NrZXQub24oJ3pvbmUtZW50ZXInLCB0aGlzLm9uWm9uZUVudGVyLmJpbmQodGhpcykpO1xyXG4gICAgc29ja2V0Lm9uKCd6b25lLWxlYXZlJywgdGhpcy5vblpvbmVMZWF2ZS5iaW5kKHRoaXMpKTtcclxuICAgIHNvY2tldC5vbignbWFwLXdvbicsIHRoaXMub25NYXBXb24uYmluZCh0aGlzKSk7XHJcbiAgfSxcclxuXHJcbiAgc3RhcnQ6IGZ1bmN0aW9uIChjYikge1xyXG4gICAgdGhpcy5jYWxsYmFja3MuZ2V0Um9vbXMgPSBjYjtcclxuICAgIEdTLlNvY2tldC5pbml0KCk7XHJcblxyXG4gICAgdGhpcy5zb2NrZXQgPSBHUy5Tb2NrZXQuaW87XHJcbiAgICB0aGlzLnNvY2tldExpc3RlbmVycyh0aGlzLnNvY2tldCk7XHJcbiAgICB0aGlzLmdldFJvb21zKCk7XHJcblxyXG4gIH0sXHJcblxyXG4gIHN0b3A6IGZ1bmN0aW9uICgpIHtcclxuICAgIEdTLlNvY2tldC5jbG9zZSgpO1xyXG4gIH0sXHJcblxyXG4gIHN0YXJ0R2FtZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5waW5nSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB0aGlzLnJvb21QaW5nKCksIDEwMCk7XHJcbiAgfSxcclxuXHJcbiAgc3RvcEdhbWU6IGZ1bmN0aW9uICgpIHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5waW5nSW50ZXJ2YWwpO1xyXG4gIH0sXHJcblxyXG5cdC8vIGluaXRHcmlkT2JqZWN0TGlicmFyeTogZnVuY3Rpb24oKSB7XHJcblx0Ly8gXHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdC8vIFx0dmFyIGxpYnJhcnkgPSB7XHJcblx0Ly8gXHRcdGl0ZW1zOiB7fSxcclxuXHQvLyBcdFx0ZG9vcnM6IHt9LFxyXG5cdC8vIFx0XHRlbGV2YXRvcnM6IHt9LFxyXG5cdC8vIFx0XHRtb25zdGVyczoge30sXHJcblx0Ly8gXHRcdHNlY3RvcnM6IHt9LFxyXG5cdC8vIFx0XHRzd2l0Y2hlczoge30sXHJcblx0Ly8gXHR9O1xyXG5cclxuXHQvLyBcdHRoaXMuZ3JpZC5mb3JFYWNoVW5pcXVlR3JpZE9iamVjdChbR1MuSXRlbSwgR1MuRG9vciwgR1MuRWxldmF0b3IsIEdTLk1vbnN0ZXIsIEdTLkNvbmNyZXRlLCBHUy5Td2l0Y2hdLCBmdW5jdGlvbihncmlkT2JqZWN0KSB7XHJcblx0Ly8gXHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuSXRlbSkge1xyXG5cdC8vIFx0XHRcdGxpYnJhcnkuaXRlbXNbZ3JpZE9iamVjdC5zb3VyY2VPYmouaWRdID0gZ3JpZE9iamVjdDtcclxuXHQvLyBcdFx0fSBlbHNlXHJcblx0Ly8gXHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuRG9vcikge1xyXG5cdC8vIFx0XHRcdGxpYnJhcnkuZG9vcnNbZ3JpZE9iamVjdC5zZWN0b3IuaWRdID0gZ3JpZE9iamVjdDtcclxuXHQvLyBcdFx0fSBlbHNlXHJcblx0Ly8gXHRcdGlmIChncmlkT2JqZWN0IGluc3RhbmNlb2YgR1MuRWxldmF0b3IpIHtcclxuXHQvLyBcdFx0XHRsaWJyYXJ5LmVsZXZhdG9yc1tncmlkT2JqZWN0LnNlY3Rvci5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdC8vIFx0XHR9IGVsc2VcclxuXHQvLyBcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Nb25zdGVyKSB7XHJcblx0Ly8gXHRcdFx0bGlicmFyeS5tb25zdGVyc1tncmlkT2JqZWN0LnNvdXJjZU9iai5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdC8vIFx0XHR9IGVsc2VcclxuXHQvLyBcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Db25jcmV0ZSAmJiBncmlkT2JqZWN0LnR5cGUgPT0gR1MuTWFwTGF5ZXJzLlNlY3Rvcikge1xyXG5cdC8vIFx0XHRcdGxpYnJhcnkuc2VjdG9yc1tncmlkT2JqZWN0LnNvdXJjZU9iai5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdC8vIFx0XHR9IGVsc2VcclxuXHQvLyBcdFx0aWYgKGdyaWRPYmplY3QgaW5zdGFuY2VvZiBHUy5Td2l0Y2gpIHtcclxuXHQvLyBcdFx0XHRsaWJyYXJ5LnN3aXRjaGVzW2dyaWRPYmplY3Quc2VnbWVudC5pZF0gPSBncmlkT2JqZWN0O1xyXG5cdC8vIFx0XHR9XHJcblx0Ly8gXHR9KTtcclxuXHJcblx0Ly8gXHR0aGlzLmdyaWRPYmplY3RMaWJyYXJ5ID0gbGlicmFyeTtcclxuXHQvLyB9LFxyXG5cclxuXHQvLyBpbml0U2NyaXB0czogZnVuY3Rpb24oKSB7XHJcblx0Ly8gXHRpZiAodGhpcy5tYXAuaGFzU2NyaXB0ID09PSB0cnVlKSB7XHJcblx0Ly8gXHRcdHRoaXMuc2NyaXB0ID0gbmV3IEdTLk1hcFNjcmlwdHNbdGhpcy5tYXAubmFtZV0odGhpcy5ncmlkT2JqZWN0TGlicmFyeSk7XHJcblx0Ly8gXHRcdHRoaXMuc2NyaXB0LmluaXQoKTtcclxuXHJcblx0Ly8gXHRcdHZhciBlbnRpdGllcyA9IHRoaXMuZ3JpZC5tYXAubGF5ZXJPYmplY3RzW0dTLk1hcExheWVycy5FbnRpdHldO1xyXG5cdC8vIFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGVudGl0aWVzLmxlbmd0aDsgaSsrKSB7XHJcblx0Ly8gXHRcdFx0dmFyIGVudGl0eSA9IGVudGl0aWVzW2ldO1xyXG5cdC8vIFx0XHRcdHZhciB0eXBlID0gR1MuTWFwRW50aXRpZXNbZW50aXR5LnR5cGVdLnR5cGU7XHJcblx0Ly8gXHRcdFx0aWYgKHR5cGUgPT09IFwiTW9uc3RlclwiKSB7XHJcblx0Ly8gXHRcdFx0XHR0aGlzLm1heE1vbnN0ZXJzKys7XHJcblx0Ly8gXHRcdFx0fSBlbHNlXHJcblx0Ly8gXHRcdFx0aWYgKHR5cGUgPT09IFwiSXRlbVwiKSB7XHJcblx0Ly8gXHRcdFx0XHR0aGlzLm1heEl0ZW1zKys7XHJcblx0Ly8gXHRcdFx0fVxyXG5cdC8vIFx0XHR9XHJcblx0Ly8gXHR9XHJcblx0Ly8gfSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdC8vIGlmICh0aGlzLnNjcmlwdCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHQvLyBcdHRoaXMuc2NyaXB0LnVwZGF0ZSgpO1xyXG5cclxuXHRcdC8vIFx0aWYgKHRoaXMuc2NyaXB0Lm1hcFdvbiAmJiAhdGhpcy5tYXBXb24pIHtcclxuXHRcdC8vIFx0XHR0aGlzLm1hcFdvbiA9IHRydWU7XHJcblx0XHQvLyBcdH1cclxuXHRcdC8vIH1cclxuXHJcblx0XHQvLyBpZiAoIXRoaXMubWFwV29uKSB7XHJcbiAgICAvLyAgIHRoaXMudXBkYXRlVGltZSgpO1xyXG5cdFx0Ly8gfVxyXG5cdH0sXHJcbiAgLy8gTGlzdGVuZXJzXHJcblx0b25Nb25zdGVyRGVhdGg6IGZ1bmN0aW9uKCkge1xyXG5cdFx0Ly8gdGhpcy5tb25zdGVyc0tpbGxlZCsrO1xyXG5cdH0sXHJcblxyXG5cdG9uT25saW5lUGxheWVyUmVzcGF3bjogZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgdGhpcy5vbmxpbmVSb29tLmNsaWVudFJlc3Bhd24oZGF0YS5pZCk7XHJcblx0fSxcclxuXHJcblx0b25PbmxpbmVQbGF5ZXJEZWF0aDogZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0Ly8gdGhpcy5vbmxpbmVQbGF5ZXJzS2lsbGVkKys7XHJcbiAgICB0aGlzLm9ubGluZVJvb20uY2xpZW50RGllKGRhdGEuaWQpO1xyXG5cdH0sXHJcblxyXG5cdG9uT25saW5lUGxheWVySm9pbjogZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgY29uc29sZS5sb2coJ3BsYXllciBqb2luZWQnKTtcclxuICAgIGNvbnNvbGUuZGlyKGRhdGEpO1xyXG5cdFx0Ly8gdGhpcy5vbmxpbmVQbGF5ZXJzS2lsbGVkKys7XHJcbiAgICB0aGlzLm9ubGluZVJvb20uYWRkQ2xpZW50KGRhdGEpO1xyXG5cdH0sXHJcblxyXG5cdG9uT25saW5lUGxheWVyTW92ZTogZnVuY3Rpb24ocGxheWVyLCBvbGRQb3MsIG5ld1Bvcykge1xyXG5cdFx0aWYgKHRoaXMuc2NyaXB0ICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy5jaGVja1pvbmVzKHBsYXllciwgb2xkUG9zLCBuZXdQb3MpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMud2FrZVVwTmVhcmJ5TW9uc3RlcnMocGxheWVyKTtcclxuXHRcdHRoaXMuYXBwbHlSZWdpb25WaXNpYmlsaXR5KHBsYXllcik7XHJcblx0fSxcclxuXHJcblx0Y2hlY2tab25lczogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgb2xkUG9zMmQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdFx0dmFyIG5ld1BvczJkID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24ocGxheWVyLCBvbGRQb3MsIG5ld1Bvcykge1xyXG5cdFx0XHRvbGRQb3MudG9WZWN0b3IyKG9sZFBvczJkKTtcclxuXHRcdFx0bmV3UG9zLnRvVmVjdG9yMihuZXdQb3MyZCk7XHJcblxyXG4gICAgICBsZXQgYWlNYW5hZ2VyID0gR0FNRS5ncmlkLmFpTWFuYWdlcjtcclxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhaU1hbmFnZXIuem9uZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgem9uZSA9IGFpTWFuYWdlci56b25lc1tpXTtcclxuXHRcdFx0XHR2YXIgYzEgPSB6b25lLmJvdW5kaW5nU3F1YXJlLmNvbnRhaW5zUG9pbnQob2xkUG9zMmQpO1xyXG5cdFx0XHRcdHZhciBjMiA9IHpvbmUuYm91bmRpbmdTcXVhcmUuY29udGFpbnNQb2ludChuZXdQb3MyZCk7XHJcblxyXG5cdFx0XHRcdGlmIChjMSAmJiAhYzIpIHtcclxuXHRcdFx0XHRcdHRoaXMuem9uZUxlYXZlKGkpO1xyXG5cdFx0XHRcdH0gZWxzZVxyXG5cdFx0XHRcdGlmICghYzEgJiYgYzIpIHtcclxuXHRcdFx0XHRcdHRoaXMuem9uZUVudGVyKGkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0b25PbmxpbmVQbGF5ZXJTaG9vdDogZnVuY3Rpb24ocGxheWVyKSB7XHJcblx0XHQvLyB0aGlzLmFjdGl2YXRlTmVhcmJ5TW9uc3RlcnMocGxheWVyKTtcclxuICAgIHRoaXMub25saW5lUm9vbS5hZGRQcm9qZWN0aWxlKHBsYXllci5pZCk7XHJcblx0fSxcclxuXHJcblx0b25PbmxpbmVQbGF5ZXJPcGVuRG9vcjogZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgbGV0IGlkID0gZGF0YS5kb29ySW5mby5pZDtcclxuICAgIGxldCBhaU1hbmFnZXIgPSBHQU1FLmdyaWQuYWlNYW5hZ2VyO1xyXG4gICAgbGV0IGRvb3JPYmogPSBhaU1hbmFnZXIuZ3JpZE9iamVjdExpYnJhcnkuZG9vcnNbaWRdO1xyXG4gICAgZG9vck9iai5vblVzZSgpO1xyXG5cdH0sXHJcblxyXG5cdG9uT25saW5lUGxheWVySXRlbVBpY2t1cDogZnVuY3Rpb24ocGxheWVyLCBvbGRfaXRlbSkge1xyXG5cdFx0Ly8gdGhpcy5pdGVtc1BpY2tlZFVwKys7XHJcblx0XHRHQU1FLmdyaWQuZm9yRWFjaFVuaXF1ZUdyaWRPYmplY3RJbkNlbGxzKEdBTUUuZ3JpZC5wbGF5ZXIubGlua2VkR3JpZENlbGxzLCBbR1MuSXRlbV0sIGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgaWYgKGl0ZW0uaWQgPT09IG9sZF9pdGVtLmlkKSB7XHJcbiAgICAgICAgaXRlbS5yZW1vdmUoKTtcclxuICAgICAgICBHQU1FLmdyaWQuYWlNYW5hZ2VyLm9uSXRlbVBpY2t1cChpdGVtKTtcclxuICAgICAgfVxyXG5cdFx0fSk7XHJcblx0fSxcclxuXHJcblx0b25ab25lTGVhdmU6IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIGxldCBhaU1hbmFnZXIgPSBHQU1FLmdyaWQuYWlNYW5hZ2VyO1xyXG4gICAgbGV0IHogPSBhaU1hbmFnZXIuem9uZXNbZGF0YS56b25lLmlkXTtcclxuICAgIGFpTWFuYWdlci5zY3JpcHQub25ab25lTGVhdmUoeik7XHJcblx0fSxcclxuXHJcblx0b25ab25lRW50ZXI6IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIGxldCBhaU1hbmFnZXIgPSBHQU1FLmdyaWQuYWlNYW5hZ2VyO1xyXG4gICAgbGV0IHogPSBhaU1hbmFnZXIuem9uZXNbZGF0YS56b25lLmlkXTtcclxuICAgIGFpTWFuYWdlci5zY3JpcHQub25ab25lRW50ZXIoeik7XHJcblx0fSxcclxuXHJcblx0b25FbnRlclNlY3RvcjogZnVuY3Rpb24oc2VjdG9yKSB7XHJcbiAgICBsZXQgYWlNYW5hZ2VyID0gR0FNRS5ncmlkLmFpTWFuYWdlcjtcclxuICAgIGxldCBzZWN0b3JPYmogPSBhaU1hbmFnZXIuZ3JpZE9iamVjdExpYnJhcnkuc2VjdG9yc1tzZWN0b3IuaWRdO1xyXG4gICAgLy8gYWlNYW5hZ2VyLm9uU3dpdGNoU3RhdGVDaGFuZ2Uoc2VjdG9yT2JqKTtcclxuXHR9LFxyXG5cclxuXHRvblVwRWxldmF0b3I6IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIGxldCBpZCA9IGRhdGEuZWxldmF0b3JJbmZvLmlkO1xyXG4gICAgbGV0IGFpTWFuYWdlciA9IEdBTUUuZ3JpZC5haU1hbmFnZXI7XHJcbiAgICBsZXQgZWxldmF0b3JPYmogPSBhaU1hbmFnZXIuZ3JpZE9iamVjdExpYnJhcnkuZWxldmF0b3JzW2lkXTtcclxuICAgIGVsZXZhdG9yT2JqLm9uVXAoZmFsc2UpO1xyXG5cdH0sXHJcblxyXG5cdG9uRG93bkVsZXZhdG9yOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICBsZXQgaWQgPSBkYXRhLmVsZXZhdG9ySW5mby5pZDtcclxuICAgIGxldCBhaU1hbmFnZXIgPSBHQU1FLmdyaWQuYWlNYW5hZ2VyO1xyXG4gICAgbGV0IGVsZXZhdG9yT2JqID0gYWlNYW5hZ2VyLmdyaWRPYmplY3RMaWJyYXJ5LmVsZXZhdG9yc1tpZF07XHJcbiAgICBlbGV2YXRvck9iai5vbkRvd24oZmFsc2UpO1xyXG5cdH0sXHJcblxyXG5cdG9uVXNlRWxldmF0b3I6IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIGxldCBpZCA9IGRhdGEuZWxldmF0b3JJbmZvLmlkO1xyXG4gICAgbGV0IGFpTWFuYWdlciA9IEdBTUUuZ3JpZC5haU1hbmFnZXI7XHJcbiAgICBsZXQgZWxldmF0b3JPYmogPSBhaU1hbmFnZXIuZ3JpZE9iamVjdExpYnJhcnkuZWxldmF0b3JzW2lkXTtcclxuICAgIGVsZXZhdG9yT2JqLm9uVXNlKCk7XHJcblx0fSxcclxuXHJcblx0b25Td2l0Y2hTdGF0ZUNoYW5nZTogZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgbGV0IGlkID0gZGF0YS5zd2l0Y2hJbmZvLmlkXHJcbiAgICBsZXQgYWlNYW5hZ2VyID0gR0FNRS5ncmlkLmFpTWFuYWdlcjtcclxuICAgIGxldCBzd2l0Y2hPYmogPSBhaU1hbmFnZXIuZ3JpZE9iamVjdExpYnJhcnkuc3dpdGNoZXNbaWRdO1xyXG4gICAgYWlNYW5hZ2VyLm9uU3dpdGNoU3RhdGVDaGFuZ2Uoc3dpdGNoT2JqKTtcclxuXHR9LFxyXG5cclxuICBvblNldHVwUm9vbTogZnVuY3Rpb24gKHJvb20pIHtcclxuICAgIHRoaXMub25saW5lUm9vbS5zZXR1cFJvb20ocm9vbSk7XHJcbiAgICB0aGlzLnN0YXJ0R2FtZSgpO1xyXG4gIH0sXHJcblxyXG4gIG9uUm9vbVBpbmc6IGZ1bmN0aW9uKHJvb20pIHtcclxuICAgIGxldCBpZCA9IHRoaXMuc29ja2V0LmlkO1xyXG4gICAgdGhpcy5vbmxpbmVSb29tLnJvb21QaW5nKHJvb20sIGlkKTtcclxuICAgIGxldCBwbGF5ZXIgPSB7XHJcbiAgICAgIGlkLFxyXG4gICAgICB4OiBHQU1FLmdyaWQucGxheWVyLnBvc2l0aW9uLngsXHJcbiAgICAgIHk6IEdBTUUuZ3JpZC5wbGF5ZXIucG9zaXRpb24ueSxcclxuICAgICAgejogR0FNRS5ncmlkLnBsYXllci5wb3NpdGlvbi56LFxyXG4gICAgICBkaXJlY3Rpb246IEdBTUUuZ3JpZC5wbGF5ZXIuZGlyZWN0aW9uLFxyXG4gICAgfTtcclxuICAgIHRoaXMuc29ja2V0LmVtaXQoJ3BsYXllci1tb3ZlJywgcGxheWVyKVxyXG4gIH0sXHJcblxyXG4gIG9uTWFwV29uOiBmdW5jdGlvbiAoKSB7XHJcbiAgICBHQU1FLmdyaWQuYWlNYW5hZ2VyLm1hcFdvbiA9IHRydWU7XHJcbiAgfSxcclxuXHJcbiAgLy8gRXZlbnRzXHJcbiAgam9pblJvb206IGZ1bmN0aW9uKHJvb20pIHtcclxuICAgIEdTLkdhbWUub25saW5lUGxheSA9IHRydWU7XHJcbiAgICB0aGlzLnNvY2tldC5lbWl0KCdqb2luLXJvb20nLCB7IHJvb21OYW1lOiBHUy5TZXR0aW5ncy5yb29tTmFtZSB9KVxyXG4gIH0sXHJcblxyXG4gIHJvb21QaW5nOiBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMuc29ja2V0LmVtaXQoJ3Jvb20tcGluZycsIHsgcm9vbU5hbWU6IEdTLlNldHRpbmdzLnJvb21OYW1lIH0pXHJcbiAgfSxcclxuXHJcbiAgZ2V0Um9vbXM6IGZ1bmN0aW9uKHJvb20pIHtcclxuICAgIHRoaXMuc29ja2V0LmVtaXQoJ2dldC1yb29tcycsIHt9KTtcclxuICB9LFxyXG4gIHBsYXllclNob290OiBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMuc29ja2V0LmVtaXQoJ3BsYXllci1zaG9vdCcsIHt9KTtcclxuICB9LFxyXG4gIHBsYXllckRpZTogZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgdGhpcy5zb2NrZXQuZW1pdCgncGxheWVyLWRpZScsIHsga2lsbGVyOiBkYXRhLmtpbGxJZCB9KTtcclxuICB9LFxyXG4gIHBsYXllclJlc3Bhd246IGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5zb2NrZXQuZW1pdCgncGxheWVyLXJlc3Bhd24nLCB7fSk7XHJcbiAgfSxcclxuICBwbGF5ZXJQaWNrdXA6IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgIHRoaXMuc29ja2V0LmVtaXQoJ3BsYXllci1waWNrdXAnLCB7IGlkOiBpdGVtLnNvdXJjZU9iai5pZCB9KTtcclxuICB9LFxyXG4gIG9wZW5Eb29yOiBmdW5jdGlvbihkb29yKSB7XHJcbiAgICB0aGlzLnNvY2tldC5lbWl0KCdkb29yLW9wZW4nLCB7IGlkOiBkb29yLnNlY3Rvci5pZCB9KTtcclxuICB9LFxyXG4gIHVzZUVsZXZhdG9yOiBmdW5jdGlvbihlbGV2YXRvcikge1xyXG4gICAgdGhpcy5zb2NrZXQuZW1pdCgndXNlLWVsZXZhdG9yJywgeyBpZDogZWxldmF0b3Iuc2VjdG9yLmlkIH0pO1xyXG4gIH0sXHJcbiAgLy8gdXBFbGV2YXRvcjogZnVuY3Rpb24oZWxldmF0b3IpIHtcclxuICAvLyAgIHRoaXMuc29ja2V0LmVtaXQoJ3VwLWVsZXZhdG9yJywgeyBpZDogZWxldmF0b3Iuc2VjdG9yLmlkIH0pO1xyXG4gIC8vIH0sXHJcbiAgLy8gZG93bkVsZXZhdG9yOiBmdW5jdGlvbihlbGV2YXRvcikge1xyXG4gIC8vICAgdGhpcy5zb2NrZXQuZW1pdCgnZG93bi1lbGV2YXRvcicsIHsgaWQ6IGVsZXZhdG9yLnNlY3Rvci5pZCB9KTtcclxuICAvLyB9LFxyXG4gIGVudGVyU2VjdG9yOiBmdW5jdGlvbihzZWN0b3IpIHtcclxuICAgIHRoaXMuc29ja2V0LmVtaXQoJ2VudGVyLXNlY3RvcicsIHsgaWQ6IHNlY3Rvci5zb3VyY2VPYmouaWQgfSk7XHJcbiAgfSxcclxuICBzd2l0Y2hTdGF0ZUNoYW5nZTogZnVuY3Rpb24oc3dpdGNoT2JqKSB7XHJcbiAgICB0aGlzLnNvY2tldC5lbWl0KCdzd2l0Y2gtY2hhbmdlJywgeyBpZDogc3dpdGNoT2JqLnNlZ21lbnQuaWQgfSk7XHJcbiAgfSxcclxuXHJcbiAgem9uZUVudGVyOiBmdW5jdGlvbih6b25lKSB7XHJcbiAgICB0aGlzLnNvY2tldC5lbWl0KCd6b25lLWVudGVyJywgeyBpZDogem9uZSB9KTtcclxuICB9LFxyXG5cclxuICB6b25lTGVhdmU6IGZ1bmN0aW9uKHpvbmUpIHtcclxuICAgIHRoaXMuc29ja2V0LmVtaXQoJ3pvbmUtbGVhdmUnLCB7IGlkOiB6b25lIH0pO1xyXG4gIH0sXHJcblxyXG4gIHVzZVRhcmdldDogZnVuY3Rpb24gKG9iaikge1xyXG4gICAgbGV0IGxpYnJhcnkgPSBHQU1FLmdyaWQuYWlNYW5hZ2VyLmdyaWRPYmplY3RMaWJyYXJ5O1xyXG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIEdTLkRvb3IpIHtcclxuICAgICAgdGhpcy5vcGVuRG9vcihvYmopO1xyXG4gICAgfSBlbHNlXHJcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgR1MuRWxldmF0b3IpIHtcclxuICAgICAgdGhpcy51c2VFbGV2YXRvcihvYmopO1xyXG4gICAgfSBlbHNlXHJcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgR1MuU3dpdGNoKSB7XHJcbiAgICAgIHRoaXMuc3dpdGNoU3RhdGVDaGFuZ2Uob2JqKTtcclxuICAgIH1cclxuICB9XHJcbn07XHJcbiIsIkdTLlNvdW5kTWFuYWdlciA9IGZ1bmN0aW9uKCkge1xyXG5cdHRoaXMudm9sdW1lID0gR1MuU2V0dGluZ3Muc291bmQgLyAxMDtcclxufTtcclxuXHJcbkdTLlNvdW5kTWFuYWdlci5wcm90b3R5cGUgPSB7XHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgY3R4O1xyXG5cclxuXHRcdGlmICh0eXBlb2YgQXVkaW9Db250ZXh0ICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcblx0XHRcdGN0eCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcclxuXHRcdH0gZWxzZVxyXG5cdFx0aWYgKHR5cGVvZiB3ZWJraXRBdWRpb0NvbnRleHQgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdFx0Y3R4ID0gbmV3IHdlYmtpdEF1ZGlvQ29udGV4dCgpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0R0FNRS5oYW5kbGVGYXRhbEVycm9yKFwiTm8gQXVkaW9Db250ZXh0IHN1cHBvcnRcIik7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmN0eCA9IGN0eDtcclxuXHJcblx0XHRpZiAoIXRoaXMuY3R4LmNyZWF0ZUdhaW4pIHtcclxuXHRcdFx0dGhpcy5jdHguY3JlYXRlR2FpbiA9IGN0eC5jcmVhdGVHYWluTm9kZTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmdhaW5Ob2RlID0gdGhpcy5jdHguY3JlYXRlR2FpbigpO1xyXG5cdFx0dGhpcy5nYWluTm9kZS5nYWluLnZhbHVlID0gdGhpcy5fdm9sdW1lO1xyXG5cclxuXHRcdHRoaXMuY29tcHJlc3NvciA9IHRoaXMuY3R4LmNyZWF0ZUR5bmFtaWNzQ29tcHJlc3NvcigpO1xyXG5cdFx0dGhpcy5nYWluTm9kZS5jb25uZWN0KHRoaXMuY29tcHJlc3Nvcik7XHJcblx0XHR0aGlzLmNvbXByZXNzb3IuY29ubmVjdCh0aGlzLmN0eC5kZXN0aW5hdGlvbik7XHJcblxyXG5cdFx0dGhpcy5pbml0U291bmRzKCk7XHJcblx0fSxcclxuXHJcblx0cGxheVNvdW5kOiBmdW5jdGlvbihuYW1lKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR2YXIgc291bmQgPSB0aGlzLnNvdW5kc1tuYW1lXTtcclxuXHJcblx0XHRpZiAoc291bmQuaXNQbGF5aW5nICYmICFzb3VuZC5hbGxvd011bHRpcGxlQXRPbmNlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgc291cmNlID0gdGhpcy5jdHguY3JlYXRlQnVmZmVyU291cmNlKCk7XHJcblx0XHRzb3VyY2UuYnVmZmVyID0gdGhpcy5zb3VuZHNbbmFtZV0uYnVmZmVyO1xyXG5cdFx0c291cmNlLmNvbm5lY3QodGhpcy5nYWluTm9kZSk7XHJcblx0XHRpZiAoIXNvdXJjZS5zdGFydCkge1xyXG5cdFx0XHRzb3VyY2Uuc3RhcnQgPSBzb3VyY2Uubm90ZU9uO1xyXG5cdFx0fVxyXG5cdFx0c291cmNlLnN0YXJ0KDApO1xyXG5cclxuXHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHNvdW5kLmlzUGxheWluZyA9IGZhbHNlIH0sIHNvdW5kLmR1cmF0aW9uKTtcclxuXHJcblx0XHRzb3VuZC5pc1BsYXlpbmcgPSB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdGluaXRTb3VuZHM6IGZ1bmN0aW9uKHNvdW5kQnVmZmVycykge1xyXG5cdFx0dGhpcy5zb3VuZHMgPSB7fTtcclxuXHRcdGZvciAodmFyIGkgaW4gc291bmRCdWZmZXJzKSB7XHJcblx0XHRcdHRoaXMuc291bmRzW2ldID0ge1xyXG5cdFx0XHRcdGJ1ZmZlcjogc291bmRCdWZmZXJzW2ldLFxyXG5cdFx0XHRcdGR1cmF0aW9uOiBNYXRoLmNlaWwoc291bmRCdWZmZXJzW2ldLmxlbmd0aCAvIHRoaXMuY3R4LnNhbXBsZVJhdGUgKiAxMDAwKSxcclxuXHRcdFx0XHRpc1BsYXlpbmc6IGZhbHNlLFxyXG5cdFx0XHRcdGFsbG93TXVsdGlwbGVBdE9uY2U6IEdTLkFzc2V0c1tHUy5Bc3NldFR5cGVzLlNvdW5kXVtpXS5hbGxvd011bHRpcGxlQXRPbmNlLFxyXG5cdFx0XHR9O1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHNldCB2b2x1bWUodmFsdWUpIHtcclxuXHRcdHRoaXMuX3ZvbHVtZSA9IHZhbHVlO1xyXG5cdFx0aWYgKHRoaXMuZ2Fpbk5vZGUgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmdhaW5Ob2RlLmdhaW4udmFsdWUgPSB0aGlzLl92b2x1bWU7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0Z2V0IHZvbHVtZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLl92b2x1bWU7XHJcblx0fSxcclxufTsiLCJHUy5BbmltYXRpb25WaWV3ID0gZnVuY3Rpb24oZ3JpZE9iamVjdCkge1xyXG5cdHRoaXMuZ3JpZE9iamVjdCA9IGdyaWRPYmplY3Q7XHJcblxyXG5cdHRoaXMubG9vcHMgPSB7XHJcblx0XHRhdHRhY2s6IHtcclxuXHRcdFx0ZGVsYXk6IDEwLFxyXG5cdFx0fSxcclxuXHRcdGluYWN0aXZlOiB7XHJcblx0XHRcdGRlbGF5OiAzMCxcclxuXHRcdH0sXHJcblx0XHR3YWxrOiB7XHJcblx0XHRcdGRlbGF5OiBncmlkT2JqZWN0LndhbGtEZWxheSxcclxuXHRcdH0sXHJcblx0XHRkZWF0aDoge1xyXG5cdFx0XHRkZWxheTogMzAsXHJcblx0XHRcdHJ1bk9uY2U6IHRydWUsXHJcblx0XHR9LFxyXG5cdH07XHJcblxyXG5cdHRoaXMuZmxvYXRZRGVsdGEgPSAwLjU7XHJcblx0dGhpcy5mbG9hdEFuZ2xlID0gMDtcclxuXHR0aGlzLmZsb2F0U3BlZWQgPSAwLjE3NTtcclxuXHR0aGlzLmluYWN0aXZlRmxvYXRTcGVlZCA9IDAuMDg3NTtcclxuXHR0aGlzLnBhaW5NYXhBbmdsZSA9IE1hdGguUEkgLyAyO1xyXG5cdHRoaXMucGFpbkFuZ2xlID0gMDtcclxuXHR0aGlzLnBhaW5TcGVlZCA9IDAuMDU7XHJcblx0dGhpcy5wYWluU2duID0gMTtcclxuXHJcblx0dGhpcy5yb3RhdGlvbllPZmZzZXQgPSAwO1xyXG5cdHRoaXMucG9zaXRpb25ZT2Zmc2V0ID0gMDtcclxuXHJcblx0dGhpcy5jdXJyZW50TWVzaCA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xyXG59O1xyXG5cclxuR1MuQW5pbWF0aW9uVmlldy5wcm90b3R5cGUgPSB7XHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0JC5leHRlbmQodHJ1ZSwgdGhpcywgdGhpcy5ncmlkT2JqZWN0LnZpZXcubWVzaC51c2VyRGF0YSk7XHJcblxyXG5cdFx0T2JqZWN0LmtleXModGhpcy5hbmltYXRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHR2YXIgbG9vcCA9IHRoYXQubG9vcHNba2V5XTtcclxuXHRcdFx0aWYgKHRoYXQubG9vcHNba2V5XSA9PT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0R0FNRS5oYW5kbGVGYXRhbEVycm9yKFwiYW5pbWF0aW9uIGxvb3Agbm90IGZvdW5kXCIpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bG9vcC5pbmRleCA9IDA7XHJcblx0XHRcdGxvb3AuZnJhbWVzID0gdGhhdC5hbmltYXRpb25zW2tleV07XHJcblx0XHRcdGxvb3AubWF4ID0gbG9vcC5mcmFtZXMubGVuZ3RoO1xyXG5cdFx0XHRsb29wLmNvb2xkb3duID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGxvb3AuZGVsYXkgLSAxKSkgKyAxO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5pbml0SW5hY3RpdmVMb29wKCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBsb29wID0gdGhpcy5jdXJyZW50TG9vcDtcclxuXHJcblx0XHRpZiAoIShsb29wLnJ1bk9uY2UgJiYgbG9vcC5pbmRleCA9PT0gbG9vcC5tYXggLSAxKSkge1xyXG5cdFx0XHRpZiAobG9vcC5jb29sZG93biA+IDApIHtcclxuXHRcdFx0XHRsb29wLmNvb2xkb3duLS07XHJcblx0XHRcdFx0aWYgKGxvb3AuY29vbGRvd24gPT09IDApIHtcclxuXHRcdFx0XHRcdGxvb3AuY29vbGRvd24gPSBsb29wLmRlbGF5O1xyXG5cclxuXHRcdFx0XHRcdGxvb3AuaW5kZXgrKztcclxuXHRcdFx0XHRcdGlmIChsb29wLmluZGV4ID09PSBsb29wLm1heCkge1xyXG5cdFx0XHRcdFx0XHRsb29wLmluZGV4ID0gMDtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHR0aGlzLnN3aXRjaE1lc2goKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIXRoaXMuZ3JpZE9iamVjdC5kZWFkKSB7XHJcblx0XHRcdGlmICh0aGlzLmdyaWRPYmplY3QubW92aW5nKSB7XHJcblx0XHRcdFx0dGhpcy5mbG9hdEFuZ2xlICs9IHRoaXMuZmxvYXRTcGVlZDtcclxuXHRcdFx0fSBlbHNlXHJcblx0XHRcdGlmIChsb29wID09PSB0aGlzLmxvb3BzLmluYWN0aXZlKSB7XHJcblx0XHRcdFx0dGhpcy5mbG9hdEFuZ2xlICs9IHRoaXMuaW5hY3RpdmVGbG9hdFNwZWVkO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLnBvc2l0aW9uWU9mZnNldCA9IHRoaXMuZmxvYXRZRGVsdGEgKiBNYXRoLnNpbih0aGlzLmZsb2F0QW5nbGUpO1xyXG5cclxuXHRcdFx0aWYgKE1hdGguYWJzKHRoaXMucGFpbkFuZ2xlKSA+IDApIHtcclxuXHRcdFx0XHR0aGlzLnBhaW5BbmdsZSAtPSB0aGlzLnBhaW5TZ24gKiB0aGlzLnBhaW5TcGVlZDtcclxuXHRcdFx0XHRpZiAodGhpcy5wYWluU2duID09IDEgJiYgdGhpcy5wYWluQW5nbGUgPCAwKSB7XHJcblx0XHRcdFx0XHR0aGlzLmdyaWRPYmplY3QuaW5QYWluID0gZmFsc2U7XHJcblx0XHRcdFx0XHR0aGlzLnBhaW5BbmdsZSA9IDA7XHJcblx0XHRcdFx0fSBlbHNlXHJcblx0XHRcdFx0aWYgKHRoaXMucGFpblNnbiA9PSAtMSAmJiB0aGlzLnBhaW5BbmdsZSA+IDApIHtcclxuXHRcdFx0XHRcdHRoaXMuZ3JpZE9iamVjdC5pblBhaW4gPSBmYWxzZTtcclxuXHRcdFx0XHRcdHRoaXMucGFpbkFuZ2xlID0gMDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMucm90YXRpb25ZT2Zmc2V0ID0gdGhpcy5wYWluQW5nbGU7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0aW5pdEluYWN0aXZlTG9vcDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgd2FsayA9IHRoaXMubG9vcHMud2FsaztcclxuXHJcblx0XHR2YXIgbG9vcCA9IHRoaXMubG9vcHMuaW5hY3RpdmU7XHJcblx0XHRsb29wLmluZGV4ID0gMDtcclxuXHRcdGxvb3AuZnJhbWVzID0gW107XHJcblx0XHRsb29wLmNvb2xkb3duID0gbG9vcC5kZWxheTtcclxuXHJcblx0XHRsb29wLmZyYW1lcy5wdXNoKHdhbGsuZnJhbWVzWzBdKTtcclxuXHRcdGxvb3AuZnJhbWVzLnB1c2god2Fsay5mcmFtZXNbMl0pO1xyXG5cclxuXHRcdGxvb3AubWF4ID0gbG9vcC5mcmFtZXMubGVuZ3RoO1xyXG5cdH0sXHJcblxyXG5cdHBhaW46IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpID09PSAwKSB7XHJcblx0XHRcdHRoaXMucGFpbkFuZ2xlID0gdGhpcy5wYWluTWF4QW5nbGU7XHJcblx0XHRcdHRoaXMucGFpblNnbiA9IDE7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnBhaW5BbmdsZSA9IC10aGlzLnBhaW5NYXhBbmdsZTtcclxuXHRcdFx0dGhpcy5wYWluU2duID0gLTE7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZGVhdGg6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5zZXRMb29wKFwiZGVhdGhcIik7XHJcblx0XHR0aGlzLnJvdGF0aW9uWU9mZnNldCA9IDA7XHJcblx0XHR0aGlzLnBvc2l0aW9uWU9mZnNldCA9IDA7XHJcblx0fSxcclxuXHJcblx0c2V0TG9vcDogZnVuY3Rpb24obmFtZSkge1xyXG5cdFx0dGhpcy5jdXJyZW50TG9vcCA9IHRoaXMubG9vcHNbbmFtZV07XHJcblx0XHR0aGlzLnN3aXRjaE1lc2goKTtcclxuXHR9LFxyXG5cclxuXHRzd2l0Y2hNZXNoOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBsb29wID0gdGhpcy5jdXJyZW50TG9vcDtcclxuXHJcblx0XHR0aGlzLmN1cnJlbnRNZXNoLnZpc2libGUgPSBmYWxzZTtcclxuXHRcdHRoaXMuY3VycmVudE1lc2ggPSBsb29wLmZyYW1lc1tsb29wLmluZGV4XTtcclxuXHRcdHRoaXMuY3VycmVudE1lc2gudmlzaWJsZSA9IHRydWU7XHJcblx0fSxcclxufTsiLCJHUy5MaWdodGluZ1ZpZXcgPSBmdW5jdGlvbihncmlkKSB7XHJcblx0dGhpcy5ncmlkID0gZ3JpZDtcclxuXHR0aGlzLnBsYXllciA9IGdyaWQucGxheWVyO1xyXG5cclxuXHR0aGlzLndvcmxkU2NlbmUgPSBncmlkLnNjZW5lO1xyXG5cdHRoaXMucGxheWVyU2NlbmUgPSBncmlkLnBsYXllci5wbGF5ZXJWaWV3LnNjZW5lO1xyXG5cclxuXHR0aGlzLmFtYmllbnRDb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQigwLCAwLCAwKTtcclxuXHJcblx0dGhpcy5kaXJlY3Rpb25hbENvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKDEsIDEsIDEpLmdldEhleCgpO1xyXG5cdHRoaXMuZGlyZWN0aW9uYWxQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDEsIDEsIDEpO1xyXG5cdHRoaXMuZGlyZWN0aW9uYWxJbnRlbnNpdHkgPSAwO1xyXG5cclxuXHR0aGlzLm11enpsZUZsYXNoUG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAtMywgLTEyKTtcclxuXHR0aGlzLm11enpsZUZsYXNoRGlzdGFuY2UgPSAyNTY7XHJcblx0dGhpcy5tdXp6bGVGbGFzaE1heEludGVuc2l0eSA9IDE7XHJcblx0dGhpcy5tdXp6bGVGbGFzaEludGVuc2l0eSA9IG5ldyBHUy5TbW9vdGhOdW1iZXIoMCwgMC4xKTtcclxuXHJcblx0dGhpcy5wcm9qZWN0aWxlSW50ZW5zaXR5ID0gMTtcclxuXHR0aGlzLnByb2plY3RpbGVEaXN0YW5jZSA9IDMyO1xyXG5cdHRoaXMubWF4UHJvamVjdGlsZVBvaW50TGlnaHRzID0gMTA7XHJcblxyXG5cdHRoaXMucGxheWVyVG9yY2hEaXN0YW5jZSA9IDI1NjtcclxuXHR0aGlzLnBsYXllclRvcmNoSW50ZW5zaXR5ID0gMC41O1xyXG5cdHRoaXMucGxheWVyVG9yY2hDb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQigxLCAxLCAxKTtcclxuXHJcblx0dGhpcy53b3JsZExpZ2h0cyA9IHt9O1xyXG5cdHRoaXMucGxheWVyTGlnaHRzID0ge307XHJcblx0dGhpcy5wcm9qZWN0aWxlTGlnaHRzID0gW107XHJcbn07XHJcblxyXG5HUy5MaWdodGluZ1ZpZXcucHJvdG90eXBlID0ge1xyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5pbml0V29ybGRMaWdodHMoKTtcclxuXHRcdHRoaXMuaW5pdFBsYXllckxpZ2h0cygpO1xyXG5cdH0sXHJcblxyXG5cdGluaXRXb3JsZExpZ2h0czogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgYW1iaWVudExpZ2h0ID0gbmV3IFRIUkVFLkFtYmllbnRMaWdodCh0aGlzLmFtYmllbnRDb2xvcik7XHJcblx0XHR0aGlzLndvcmxkU2NlbmUuYWRkKGFtYmllbnRMaWdodCk7XHJcblx0XHR0aGlzLndvcmxkTGlnaHRzLmFtYmllbnQgPSBhbWJpZW50TGlnaHQ7XHJcblxyXG5cdFx0dmFyIHBvaW50TGlnaHQgPSBuZXcgVEhSRUUuUG9pbnRMaWdodCgpO1xyXG5cdFx0cG9pbnRMaWdodC5pbnRlbnNpdHkgPSB0aGlzLm11enpsZUZsYXNoSW50ZW5zaXR5LnZhbHVlO1xyXG5cdFx0cG9pbnRMaWdodC5kaXN0YW5jZSA9IHRoaXMubXV6emxlRmxhc2hEaXN0YW5jZTtcclxuXHRcdHRoaXMud29ybGRTY2VuZS5hZGQocG9pbnRMaWdodCk7XHJcblx0XHR0aGlzLndvcmxkTGlnaHRzLm11enpsZUZsYXNoID0gcG9pbnRMaWdodDtcdFx0XHJcblxyXG5cdFx0dmFyIGRpckxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQodGhpcy5kaXJlY3Rpb25hbENvbG9yLCB0aGlzLmRpcmVjdGlvbmFsSW50ZW5zaXR5KTtcclxuXHRcdGRpckxpZ2h0LnBvc2l0aW9uLmNvcHkodGhpcy5kaXJlY3Rpb25hbFBvc2l0aW9uKTtcclxuXHRcdHRoaXMud29ybGRTY2VuZS5hZGQoZGlyTGlnaHQpO1xyXG5cdFx0dGhpcy53b3JsZExpZ2h0cy5kaXJlY3Rpb25hbCA9IGRpckxpZ2h0O1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tYXhQcm9qZWN0aWxlUG9pbnRMaWdodHM7IGkrKykge1xyXG5cdFx0XHR2YXIgcG9pbnRMaWdodCA9IG5ldyBUSFJFRS5Qb2ludExpZ2h0KCk7XHJcblx0XHRcdHBvaW50TGlnaHQuaW50ZW5zaXR5ID0gMDtcclxuXHRcdFx0cG9pbnRMaWdodC5kaXN0YW5jZSA9IHRoaXMucHJvamVjdGlsZURpc3RhbmNlO1xyXG5cclxuXHRcdFx0dmFyIGxpZ2h0ID0ge1xyXG5cdFx0XHRcdGFjdGl2ZTogZmFsc2UsXHJcblx0XHRcdFx0cG9pbnRMaWdodDogcG9pbnRMaWdodCxcclxuXHRcdFx0XHRpbnRlbnNpdHk6IG5ldyBHUy5TbW9vdGhOdW1iZXIodGhpcy5wcm9qZWN0aWxlSW50ZW5zaXR5LCAwLjEpLFxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0dGhpcy53b3JsZFNjZW5lLmFkZChwb2ludExpZ2h0KTtcclxuXHRcdFx0dGhpcy5wcm9qZWN0aWxlTGlnaHRzLnB1c2gobGlnaHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBwbGF5ZXJUb3JjaCA9IG5ldyBUSFJFRS5Qb2ludExpZ2h0KCk7XHJcblx0XHRwbGF5ZXJUb3JjaC5jb2xvci5jb3B5KHRoaXMucGxheWVyVG9yY2hDb2xvcik7XHJcblx0XHRwbGF5ZXJUb3JjaC5pbnRlbnNpdHkgPSB0aGlzLnBsYXllclRvcmNoSW50ZW5zaXR5O1xyXG5cdFx0cGxheWVyVG9yY2guZGlzdGFuY2UgPSB0aGlzLnBsYXllclRvcmNoRGlzdGFuY2U7XHJcblx0XHR0aGlzLndvcmxkU2NlbmUuYWRkKHBsYXllclRvcmNoKTtcclxuXHRcdHRoaXMud29ybGRMaWdodHMucGxheWVyVG9yY2ggPSBwbGF5ZXJUb3JjaDtcclxuXHJcblx0XHR2YXIgcGxheWVyU2NlbmVUb3JjaCA9IG5ldyBUSFJFRS5Qb2ludExpZ2h0KCk7XHJcblx0XHRwbGF5ZXJTY2VuZVRvcmNoLmNvbG9yLmNvcHkodGhpcy5wbGF5ZXJUb3JjaENvbG9yKTtcclxuXHRcdHBsYXllclNjZW5lVG9yY2guaW50ZW5zaXR5ID0gdGhpcy5wbGF5ZXJUb3JjaEludGVuc2l0eTtcclxuXHRcdHBsYXllclNjZW5lVG9yY2guZGlzdGFuY2UgPSB0aGlzLnBsYXllclRvcmNoRGlzdGFuY2U7XHJcblx0XHR0aGlzLnBsYXllclNjZW5lLmFkZChwbGF5ZXJTY2VuZVRvcmNoKTtcclxuXHRcdHRoaXMucGxheWVyTGlnaHRzLnBsYXllclRvcmNoID0gcGxheWVyU2NlbmVUb3JjaDtcclxuXHR9LFxyXG5cclxuXHRpbml0UGxheWVyTGlnaHRzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBhbWJpZW50TGlnaHQgPSBuZXcgVEhSRUUuQW1iaWVudExpZ2h0KHRoaXMuYW1iaWVudENvbG9yKTtcclxuXHRcdHRoaXMucGxheWVyU2NlbmUuYWRkKGFtYmllbnRMaWdodCk7XHJcblx0XHR0aGlzLnBsYXllckxpZ2h0cy5hbWJpZW50ID0gYW1iaWVudExpZ2h0O1xyXG5cclxuXHRcdHZhciBwb2ludExpZ2h0ID0gbmV3IFRIUkVFLlBvaW50TGlnaHQoKTtcclxuXHRcdHBvaW50TGlnaHQucG9zaXRpb24uY29weSh0aGlzLm11enpsZUZsYXNoUG9zaXRpb24pO1xyXG5cdFx0cG9pbnRMaWdodC5pbnRlbnNpdHkgPSB0aGlzLm11enpsZUZsYXNoSW50ZW5zaXR5LnZhbHVlO1xyXG5cdFx0cG9pbnRMaWdodC5kaXN0YW5jZSA9IHRoaXMubXV6emxlRmxhc2hEaXN0YW5jZTtcclxuXHRcdHRoaXMucGxheWVyU2NlbmUuYWRkKHBvaW50TGlnaHQpO1xyXG5cdFx0dGhpcy5wbGF5ZXJMaWdodHMubXV6emxlRmxhc2ggPSBwb2ludExpZ2h0O1xyXG5cdFx0XHJcblx0XHR2YXIgZGlyTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCh0aGlzLmRpcmVjdGlvbmFsQ29sb3IsIHRoaXMuZGlyZWN0aW9uYWxJbnRlbnNpdHkpO1xyXG5cdFx0ZGlyTGlnaHQucG9zaXRpb24uY29weSh0aGlzLmRpcmVjdGlvbmFsUG9zaXRpb24pO1xyXG5cdFx0dGhpcy5wbGF5ZXJTY2VuZS5hZGQoZGlyTGlnaHQpO1xyXG5cdFx0dGhpcy5wbGF5ZXJMaWdodHMuZGlyZWN0aW9uYWwgPSBkaXJMaWdodDtcclxuXHJcblx0XHR0aGlzLnBsYXllci5wbGF5ZXJWaWV3LmxpZ2h0aW5nVmlldyA9IHRoaXM7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlUGxheWVyTGlnaHRzOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB4QW5nbGUgPSBNYXRoLlBJIC8gMTgwICogKHRoaXMucGxheWVyLnlBbmdsZSAtIDkwKTtcclxuXHRcdHZhciB5QW5nbGUgPSBNYXRoLlBJIC8gMTgwICogKHRoaXMucGxheWVyLnhBbmdsZSArIDkwKTtcclxuXHRcdHZhciBtYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvblgoeEFuZ2xlKS5tdWx0aXBseShuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvblkoeUFuZ2xlKSk7XHJcblx0XHR2YXIgZGlyUG9zID0gdGhpcy53b3JsZExpZ2h0cy5kaXJlY3Rpb25hbC5wb3NpdGlvbjtcclxuXHRcdHRoaXMucGxheWVyTGlnaHRzLmRpcmVjdGlvbmFsLnBvc2l0aW9uLmNvcHkoZGlyUG9zKS5hcHBseU1hdHJpeDQobWF0cml4KTtcclxuXHJcblx0XHR0aGlzLm11enpsZUZsYXNoSW50ZW5zaXR5LnVwZGF0ZSgpO1xyXG5cdFx0dGhpcy53b3JsZExpZ2h0cy5tdXp6bGVGbGFzaC5wb3NpdGlvbi5jb3B5KHRoaXMucGxheWVyLnBvc2l0aW9uKTtcclxuXHRcdHRoaXMud29ybGRMaWdodHMubXV6emxlRmxhc2gucG9zaXRpb24ueSArPSB0aGlzLnBsYXllci5zaXplLnkgKiAwLjU7XHJcblx0XHR0aGlzLndvcmxkTGlnaHRzLm11enpsZUZsYXNoLmludGVuc2l0eSA9IHRoaXMubXV6emxlRmxhc2hJbnRlbnNpdHkudmFsdWU7XHJcblx0XHR0aGlzLnBsYXllckxpZ2h0cy5tdXp6bGVGbGFzaC5pbnRlbnNpdHkgPSB0aGlzLm11enpsZUZsYXNoSW50ZW5zaXR5LnZhbHVlO1x0XHRcclxuXHJcblx0XHR0aGlzLndvcmxkTGlnaHRzLnBsYXllclRvcmNoLnBvc2l0aW9uLmNvcHkodGhpcy5wbGF5ZXIucG9zaXRpb24pO1xyXG5cdH0sXHJcblxyXG5cdGJlZ2luTXV6emxlRmxhc2g6IGZ1bmN0aW9uKGNvbG9yKSB7XHJcblx0XHR0aGlzLm11enpsZUZsYXNoSW50ZW5zaXR5LnZhbHVlID0gdGhpcy5tdXp6bGVGbGFzaE1heEludGVuc2l0eTtcclxuXHRcdHRoaXMud29ybGRMaWdodHMubXV6emxlRmxhc2guY29sb3IuY29weShjb2xvcik7XHJcblx0XHR0aGlzLnBsYXllckxpZ2h0cy5tdXp6bGVGbGFzaC5jb2xvci5jb3B5KGNvbG9yKTtcclxuXHR9LFxyXG5cclxuXHRlbmRNdXp6bGVGbGFzaDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLm11enpsZUZsYXNoSW50ZW5zaXR5LnNldFRhcmdldFZhbHVlKDApO1xyXG5cdH0sXHJcblxyXG5cdGFkZFByb2plY3RpbGVMaWdodDogZnVuY3Rpb24ocHJvamVjdGlsZSkge1xyXG5cdFx0dmFyIGxpZ2h0O1xyXG5cclxuXHRcdGxpZ2h0ID0gdGhpcy5wcm9qZWN0aWxlTGlnaHRzLnNoaWZ0KCk7XHJcblxyXG5cdFx0bGlnaHQuYWN0aXZlID0gdHJ1ZTtcclxuXHRcdGxpZ2h0LnByb2plY3RpbGUgPSBwcm9qZWN0aWxlO1xyXG5cdFx0bGlnaHQuaW50ZW5zaXR5LnZhbHVlID0gdGhpcy5wcm9qZWN0aWxlSW50ZW5zaXR5O1xyXG5cdFx0bGlnaHQuaW50ZW5zaXR5LnNldFRhcmdldFZhbHVlKHRoaXMucHJvamVjdGlsZUludGVuc2l0eSk7XHJcblx0XHRsaWdodC5wb2ludExpZ2h0LmNvbG9yLnNldEhleChwcm9qZWN0aWxlLmNvbG9yKTtcclxuXHRcdGxpZ2h0LnBvaW50TGlnaHQucG9zaXRpb24uY29weShwcm9qZWN0aWxlLnBvc2l0aW9uKTtcclxuXHRcdGxpZ2h0LnBvaW50TGlnaHQuaW50ZW5zaXR5ID0gbGlnaHQuaW50ZW5zaXR5LnZhbHVlO1x0XHRcclxuXHRcdFxyXG5cdFx0dGhpcy5wcm9qZWN0aWxlTGlnaHRzLnB1c2gobGlnaHQpO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucHJvamVjdGlsZUxpZ2h0cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHR2YXIgbGlnaHQgPSB0aGlzLnByb2plY3RpbGVMaWdodHNbaV07XHJcblxyXG5cdFx0XHRpZiAoIWxpZ2h0LmFjdGl2ZSkge1xyXG5cdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAobGlnaHQucHJvamVjdGlsZS5yZW1vdmVkKSB7XHJcblx0XHRcdFx0bGlnaHQuaW50ZW5zaXR5LnNldFRhcmdldFZhbHVlKDApO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRsaWdodC5pbnRlbnNpdHkudXBkYXRlKCk7XHJcblx0XHRcdGxpZ2h0LnBvaW50TGlnaHQuaW50ZW5zaXR5ID0gbGlnaHQuaW50ZW5zaXR5LnZhbHVlO1xyXG5cdFx0XHRsaWdodC5wb2ludExpZ2h0LnBvc2l0aW9uLmNvcHkobGlnaHQucHJvamVjdGlsZS5wb3NpdGlvbik7XHJcblxyXG5cdFx0XHRpZiAobGlnaHQuaW50ZW5zaXR5LnZhbHVlID09PSAwKSB7XHJcblx0XHRcdFx0bGlnaHQuYWN0aXZlID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG59OyIsIkdTLlBhcnRpY2xlTW92ZW1lbnRUeXBlcyA9IHtcclxuXHRTdGF0aWM6IDAsXHJcblx0RmFsbGluZzogMSxcclxuXHRHdXNoaW5nOiAyLFxyXG59O1xyXG5cclxuR1MuUGFydGljbGVWaWV3ID0gZnVuY3Rpb24oZ3JpZCkge1xyXG5cdHRoaXMuZ3JpZCA9IGdyaWQ7XHJcblx0dGhpcy5zY2VuZSA9IGdyaWQuc2NlbmU7XHJcblxyXG5cdHRoaXMucGFydGljbGVzID0gW107XHJcblx0dGhpcy5nZW9tZXRyaWVzID0ge307XHJcblx0dGhpcy5tYXRlcmlhbHMgPSB7fTtcclxuXHJcblx0dGhpcy5wYXJ0aWNsZVNwZWVkID0gMC4wMDA3NTtcclxuXHR0aGlzLnBhcnRpY2xlR3Jhdml0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIC0wLjAwMywgMCk7XHJcbn07XHJcblxyXG5HUy5QYXJ0aWNsZVZpZXcucHJvdG90eXBlID0ge1xyXG5cdGNvbnN0cnVjdG9yOiBHUy5QYXJ0aWNsZVZpZXcsXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5yb290ID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XHJcblx0XHR0aGlzLnJvb3QudXNlckRhdGEgPSBcInBhcnRpY2xlIHJvb3RcIjtcclxuXHRcdHRoaXMuc2NlbmUuYWRkKHRoaXMucm9vdCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdC8vIEdTLkRlYnVnVUkudHJhY2tOdW1lcmljVmFsdWUoXCJwYXJ0aWNsZXNcIiwgdGhpcy5wYXJ0aWNsZXMubGVuZ3RoKTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGFydGljbGVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBwYXJ0aWNsZSA9IHRoaXMucGFydGljbGVzW2ldO1xyXG5cclxuXHRcdFx0aWYgKHBhcnRpY2xlLm1vdmVtZW50VHlwZSAhPSBHUy5QYXJ0aWNsZU1vdmVtZW50VHlwZXMuU3RhdGljKSB7XHJcblx0XHRcdFx0aWYgKHBhcnRpY2xlLmxhbmRlZCAhPT0gdHJ1ZSkge1xyXG5cdFx0XHRcdFx0cGFydGljbGUuYWNjZWxlcmF0aW9uLmFkZChwYXJ0aWNsZS5ncmF2aXR5KTtcclxuXHRcdFx0XHRcdHBhcnRpY2xlLnZlbG9jaXR5LmFkZChwYXJ0aWNsZS5hY2NlbGVyYXRpb24pO1xyXG5cdFx0XHRcdFx0cGFydGljbGUubWVzaC5wb3NpdGlvbi5hZGQocGFydGljbGUudmVsb2NpdHkpO1xyXG5cdFx0XHRcdFx0cGFydGljbGUubWVzaC5yb3RhdGlvbi55ICs9IHBhcnRpY2xlLnJvdGF0aW9uU3BlZWQ7XHJcblx0XHRcdFx0XHRwYXJ0aWNsZS5saWZlKys7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHBhcnRpY2xlLmZsb29ySW1wYWN0WSAhPT0gdW5kZWZpbmVkICYmIHBhcnRpY2xlLm1lc2gucG9zaXRpb24ueSA8IHBhcnRpY2xlLmZsb29ySW1wYWN0WSkge1xyXG5cdFx0XHRcdFx0XHRwYXJ0aWNsZS5tZXNoLnBvc2l0aW9uLnkgPSBwYXJ0aWNsZS5mbG9vckltcGFjdFkgKyAwLjU7XHJcblx0XHRcdFx0XHRcdHBhcnRpY2xlLmxhbmRlZCA9IHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHBhcnRpY2xlLmRlY2F5VGltZSAtPSAwLjAxO1xyXG5cdFx0XHRcdFx0cGFydGljbGUubWVzaC5zY2FsZS5zZXQocGFydGljbGUuZGVjYXlUaW1lLCBwYXJ0aWNsZS5kZWNheVRpbWUsIHBhcnRpY2xlLmRlY2F5VGltZSk7XHJcblx0XHRcdFx0XHRpZiAocGFydGljbGUuZGVjYXlUaW1lIDw9IDApIHtcclxuXHRcdFx0XHRcdFx0cGFydGljbGUudG9CZVJlbW92ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAodmFyIGkgPSB0aGlzLnBhcnRpY2xlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG5cdFx0XHRpZiAodGhpcy5wYXJ0aWNsZXNbaV0udG9CZVJlbW92ZWQpIHtcclxuXHRcdFx0XHR0aGlzLnJlbW92ZVBhcnRpY2xlKHRoaXMucGFydGljbGVzW2ldLCBpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGFkZFBhcnRpY2xlOiBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgY29sb3IsIG1vdmVtZW50VHlwZSwgcG9zaXRpb24pIHtcclxuXHRcdHZhciBnZW9tZXRyeSA9IHRoaXMuZ2V0R2VvbWV0cnkod2lkdGgsIGhlaWdodCwgZGVwdGgpO1xyXG5cdFx0dmFyIG1hdGVyaWFsID0gdGhpcy5nZXRNYXRlcmlhbChjb2xvcik7XHJcblx0XHR2YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XHJcblxyXG5cdFx0bW92ZW1lbnRUeXBlID0gKG1vdmVtZW50VHlwZSAhPT0gdW5kZWZpbmVkKSA/IG1vdmVtZW50VHlwZSA6IEdTLlBhcnRpY2xlTW92ZW1lbnRUeXBlcy5TdGF0aWM7XHJcblxyXG5cdFx0dmFyIHBhcnRpY2xlID0ge1xyXG5cdFx0XHRtZXNoOiBtZXNoLFxyXG5cdFx0XHRwb3NpdGlvbjogcG9zaXRpb24sXHJcblx0XHRcdHJvdGF0aW9uU3BlZWQ6IE1hdGgucmFuZG9tKCkgKiAwLjI1LFxyXG5cdFx0XHRtb3ZlbWVudFR5cGU6IG1vdmVtZW50VHlwZSxcclxuXHRcdFx0Y29sb3I6IGNvbG9yLFxyXG5cdFx0XHRkZWNheVRpbWU6IDEsXHJcblx0XHR9O1xyXG5cclxuXHRcdGlmIChtb3ZlbWVudFR5cGUgIT0gR1MuUGFydGljbGVNb3ZlbWVudFR5cGVzLlN0YXRpYykge1xyXG5cdFx0XHRwYXJ0aWNsZS5ncmF2aXR5ID0gdGhpcy5wYXJ0aWNsZUdyYXZpdHkuY2xvbmUoKTtcclxuXHJcblx0XHRcdGlmIChtb3ZlbWVudFR5cGUgPT0gR1MuUGFydGljbGVNb3ZlbWVudFR5cGVzLkZhbGxpbmcpIHtcclxuXHRcdFx0XHRwYXJ0aWNsZS5ob3Jpem9udGFsU3BlZWQgPSAxNTtcclxuXHRcdFx0XHRwYXJ0aWNsZS52ZXJ0aWNhbFNwZWVkID0gTWF0aC5yYW5kb20oKSAqIDEwO1xyXG5cdFx0XHR9IGVsc2VcclxuXHRcdFx0aWYgKG1vdmVtZW50VHlwZSA9PSBHUy5QYXJ0aWNsZU1vdmVtZW50VHlwZXMuR3VzaGluZykge1xyXG5cdFx0XHRcdHBhcnRpY2xlLmhvcml6b250YWxTcGVlZCA9IDIwO1xyXG5cdFx0XHRcdHBhcnRpY2xlLnZlcnRpY2FsU3BlZWQgPSBNYXRoLnJhbmRvbSgpICogMTAgKyA2MDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5jYWxjdWxhdGVBY2NlbGVyYXRpb24ocGFydGljbGUpO1x0XHRcclxuXHRcdFx0XHJcblx0XHRcdHBhcnRpY2xlLnZlbG9jaXR5ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0XHRcdHRoaXMuY2FsY3VsYXRlRmxvb3JJbXBhY3RZKHBhcnRpY2xlKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnJvb3QuYWRkKG1lc2gpO1xyXG5cdFx0dGhpcy5wYXJ0aWNsZXMucHVzaChwYXJ0aWNsZSk7XHJcblxyXG5cdFx0cmV0dXJuIHBhcnRpY2xlO1xyXG5cdH0sXHJcblxyXG5cdHJlbW92ZVBhcnRpY2xlOiBmdW5jdGlvbihwYXJ0aWNsZSwgaW5kZXgpIHtcclxuXHRcdHZhciBpID0gKGluZGV4ICE9PSB1bmRlZmluZWQpID8gaW5kZXggOiB0aGlzLnBhcnRpY2xlcy5pbmRleE9mKHBhcnRpY2xlKTtcclxuXHRcdGlmIChpID4gLTEpIHtcclxuXHRcdFx0dGhpcy5yb290LnJlbW92ZShwYXJ0aWNsZS5tZXNoKTtcclxuXHRcdFx0dGhpcy5wYXJ0aWNsZXMuc3BsaWNlKGksIDEpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGNhbGN1bGF0ZUZsb29ySW1wYWN0WTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgZmF1eEdyaWRPYmplY3QgPSB7XHJcblx0XHRcdGdyaWQ6IG51bGwsXHJcblx0XHRcdHBvc2l0aW9uOiBuZXcgVEhSRUUuVmVjdG9yMygpLFxyXG5cdFx0XHRsaW5rZWRHcmlkQ2VsbHM6IG51bGwsXHJcblx0XHR9O1xyXG5cdFx0dmFyIHBvc2l0aW9uMmQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwYXJ0aWNsZSkge1xyXG5cdFx0XHRwYXJ0aWNsZS5wb3NpdGlvbi50b1ZlY3RvcjIocG9zaXRpb24yZCk7XHJcblx0XHRcdHZhciBncmlkTG9jYXRpb24gPSB0aGlzLmdyaWQuZ2V0R3JpZExvY2F0aW9uRnJvbVBvaW50cyhbcG9zaXRpb24yZF0pO1xyXG5cclxuXHRcdFx0aWYgKGdyaWRMb2NhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0ZmF1eEdyaWRPYmplY3QuZ3JpZCA9IHRoaXMuZ3JpZDtcclxuXHRcdFx0XHRmYXV4R3JpZE9iamVjdC5wb3NpdGlvbi5jb3B5KHBhcnRpY2xlLnBvc2l0aW9uKTtcclxuXHRcdFx0XHRmYXV4R3JpZE9iamVjdC5saW5rZWRHcmlkQ2VsbHMgPSB0aGlzLmdyaWQuZ2V0Q2VsbHNGcm9tR3JpZExvY2F0aW9uKGdyaWRMb2NhdGlvbik7XHJcblxyXG5cdFx0XHRcdHZhciBzZWN0b3IgPSBHUy5HcmlkT2JqZWN0LnByb3RvdHlwZS5nZXRTZWN0b3IuY2FsbChmYXV4R3JpZE9iamVjdCk7XHJcblx0XHRcdFx0aWYgKHNlY3RvciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRwYXJ0aWNsZS5mbG9vckltcGFjdFkgPSBzZWN0b3IuZmxvb3JUb3BZO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0ZmF1eEdyaWRPYmplY3QuZ3JpZCA9IG51bGw7XHJcblx0XHRcdFx0ZmF1eEdyaWRPYmplY3QubGlua2VkR3JpZENlbGxzID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH0oKSxcclxuXHJcblx0Y2FsY3VsYXRlQWNjZWxlcmF0aW9uOiBmdW5jdGlvbihwYXJ0aWNsZSkge1xyXG5cdFx0cGFydGljbGUuYWNjZWxlcmF0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoTWF0aC5yYW5kb20oKSAqIDIgLSAxLCAwLCBNYXRoLnJhbmRvbSgpICogMiAtIDEpO1xyXG5cdFx0cGFydGljbGUuYWNjZWxlcmF0aW9uLm5vcm1hbGl6ZSgpO1xyXG5cdFx0cGFydGljbGUuYWNjZWxlcmF0aW9uLm11bHRpcGx5U2NhbGFyKHBhcnRpY2xlLmhvcml6b250YWxTcGVlZCk7XHJcblx0XHRwYXJ0aWNsZS5hY2NlbGVyYXRpb24ueSA9IHBhcnRpY2xlLnZlcnRpY2FsU3BlZWQ7XHJcblx0XHRwYXJ0aWNsZS5hY2NlbGVyYXRpb24ubXVsdGlwbHlTY2FsYXIodGhpcy5wYXJ0aWNsZVNwZWVkKTtcclxuXHR9LFxyXG5cclxuXHRhbGlnblBhcnRpY2xlVHJhamVjdG9yeVRvTm9ybWFsOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBub3JtYWwyZCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0XHR2YXIgYXhpcyA9IG5ldyBUSFJFRS5WZWN0b3IyKDEsIDApO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbihwYXJ0aWNsZSwgbm9ybWFsKSB7XHJcblx0XHRcdGlmIChub3JtYWwueCA9PT0gMCAmJiBub3JtYWwueiA9PT0gMCkge1xyXG5cdFx0XHRcdGlmIChub3JtYWwueSA9PSAtMSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0cGFydGljbGUuaG9yaXpvbnRhbFNwZWVkID0gMjA7XHJcblx0XHRcdFx0cGFydGljbGUudmVydGljYWxTcGVlZCA9IE1hdGgucmFuZG9tKCkgKiAxMCArIDMwO1xyXG5cclxuXHRcdFx0XHR0aGlzLmNhbGN1bGF0ZUFjY2VsZXJhdGlvbihwYXJ0aWNsZSk7XHJcblxyXG5cdFx0XHRcdC8vIHRoaXMuZ3JpZC5hZGREZWJ1Z0xpbmUocGFydGljbGUucG9zaXRpb24uY2xvbmUoKSwgXHJcblx0XHRcdFx0Ly8gcGFydGljbGUucG9zaXRpb24uY2xvbmUoKS5hZGQocGFydGljbGUuYWNjZWxlcmF0aW9uLmNsb25lKCkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoNSkpLCAweDAwODBmZik7XHJcblxyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bm9ybWFsLnRvVmVjdG9yMihub3JtYWwyZCk7XHJcblx0XHRcdHZhciBhbmdsZSA9IEdTLk1hdGhIZWxwZXIudmVjMkFuZ2xlRGlyZWN0ZWQoYXhpcywgbm9ybWFsMmQpICsgTWF0aC5QSTtcclxuXHJcblx0XHRcdHZhciBrID0gYW5nbGUgLSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSTtcclxuXHRcdFx0bm9ybWFsMmQuc2V0KE1hdGguc2luKGspLCBNYXRoLmNvcyhrKSk7XHJcblxyXG5cdFx0XHRwYXJ0aWNsZS5hY2NlbGVyYXRpb24ueCA9IG5vcm1hbDJkLng7XHJcblx0XHRcdHBhcnRpY2xlLmFjY2VsZXJhdGlvbi56ID0gbm9ybWFsMmQueTtcclxuXHRcdFx0cGFydGljbGUuYWNjZWxlcmF0aW9uLm11bHRpcGx5U2NhbGFyKHBhcnRpY2xlLmhvcml6b250YWxTcGVlZCAqIHRoaXMucGFydGljbGVTcGVlZCk7XHJcblx0XHRcdHBhcnRpY2xlLmFjY2VsZXJhdGlvbi55ID0gcGFydGljbGUudmVydGljYWxTcGVlZCAqIHRoaXMucGFydGljbGVTcGVlZDtcclxuXHJcblx0XHRcdC8vIHRoaXMuZ3JpZC5hZGREZWJ1Z0xpbmUocGFydGljbGUucG9zaXRpb24uY2xvbmUoKSwgXHJcblx0XHRcdC8vIFx0cGFydGljbGUucG9zaXRpb24uY2xvbmUoKS5hZGQocGFydGljbGUuYWNjZWxlcmF0aW9uLmNsb25lKCkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoNSkpLCAweDAwODBmZik7XHJcblxyXG5cdFx0XHRwYXJ0aWNsZS5tZXNoLnJvdGF0aW9uLnkgKz0gYW5nbGU7XHJcblxyXG5cdFx0XHR0aGlzLmNhbGN1bGF0ZUZsb29ySW1wYWN0WShwYXJ0aWNsZSk7XHRcdFx0XHJcblx0XHR9XHJcblx0fSgpLFxyXG5cclxuXHRnZXRHZW9tZXRyeTogZnVuY3Rpb24od2lkdGgsIGhlaWdodCwgZGVwdGgpIHtcclxuXHRcdHZhciBpZCA9IHdpZHRoLnRvRml4ZWQoMikgKyBoZWlnaHQudG9GaXhlZCgyKSArIGRlcHRoLnRvRml4ZWQoMik7XHJcblx0XHRpZiAoIShpZCBpbiB0aGlzLmdlb21ldHJpZXMpKSB7XHJcblx0XHRcdHRoaXMuZ2VvbWV0cmllc1tpZF0gPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkod2lkdGgsIGhlaWdodCwgZGVwdGgpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRoaXMuZ2VvbWV0cmllc1tpZF07XHJcblx0fSxcclxuXHJcblx0Z2V0TWF0ZXJpYWw6IGZ1bmN0aW9uKGNvbG9yKSB7XHJcblx0XHR2YXIgaWQgPSBjb2xvci50b1N0cmluZygpO1xyXG5cdFx0aWYgKCEoaWQgaW4gdGhpcy5tYXRlcmlhbHMpKSB7XHJcblx0XHRcdHRoaXMubWF0ZXJpYWxzW2lkXSA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiBjb2xvciB9KTtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzLm1hdGVyaWFsc1tpZF07XHJcblx0fSxcclxufTsiLCJHUy5QbGF5ZXJWaWV3ID0gZnVuY3Rpb24oKSB7XHJcblx0dGhpcy53ZWFwb25zID0ge1xyXG5cdFx0cGlzdG9sOiB7XHJcblx0XHRcdHBvc2l0aW9uOiBuZXcgVEhSRUUuVmVjdG9yMygyLjc1LCAtMi41LCAtNCksXHJcblx0XHRcdHN0YXJ0UG9zaXRpb246IG5ldyBUSFJFRS5WZWN0b3IzKDIuNSwgLTYuNSwgMSksXHJcblx0XHRcdHNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMygwLjQsIDAuNCwgMC40KSxcclxuXHRcdFx0cm90YXRpb246IG5ldyBUSFJFRS5WZWN0b3IzKDAsIFRIUkVFLk1hdGguZGVnVG9SYWQoLTkwKSwgMCksXHJcblx0XHRcdHB1c2hiYWNrOiAxLFxyXG5cdFx0XHRzaG9vdEJhY2t3YXJkRmFjdG9yOiAwLjUsXHJcblx0XHRcdHNob290Rm9yd2FyZEZhY3RvcjogMC41LFxyXG5cdFx0XHRtdXp6bGVEdXJhdGlvbjogR1MubXNUb0ZyYW1lcygyNTApLFxyXG5cdFx0XHRtdXp6bGVGbGFzaENvbG9yOiBuZXcgVEhSRUUuQ29sb3IoKS5zZXRSR0IoMSwgMSwgMSksXHJcblx0XHR9LFxyXG5cdFx0ZG91YmxlX3Nob3RndW46IHtcclxuXHRcdFx0cG9zaXRpb246IG5ldyBUSFJFRS5WZWN0b3IzKDIuMjUsIC0zLjUsIC0zKSxcclxuXHRcdFx0c3RhcnRQb3NpdGlvbjogbmV3IFRIUkVFLlZlY3RvcjMoMi41LCAtNi41LCAxKSxcclxuXHRcdFx0c2NhbGU6IG5ldyBUSFJFRS5WZWN0b3IzKDAuNCwgMC40LCAwLjQpLFxyXG5cdFx0XHRyb3RhdGlvbjogbmV3IFRIUkVFLlZlY3RvcjMoMCwgVEhSRUUuTWF0aC5kZWdUb1JhZCgxODApLCAwKSxcclxuXHRcdFx0cHVzaGJhY2s6IDIsXHJcblx0XHRcdHNob290QmFja3dhcmRGYWN0b3I6IDAuMSxcclxuXHRcdFx0c2hvb3RGb3J3YXJkRmFjdG9yOiAwLjksXHJcblx0XHRcdG11enpsZUR1cmF0aW9uOiBHUy5tc1RvRnJhbWVzKDI1MCksXHJcblx0XHRcdG11enpsZUZsYXNoQ29sb3I6IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQigxLCAxLCAxKSxcclxuXHRcdH0sXHJcblx0XHRoeXBlcl9ibGFzdGVyOiB7XHJcblx0XHRcdHBvc2l0aW9uOiBuZXcgVEhSRUUuVmVjdG9yMygyLjc1LCAtMi41LCAtMyksXHJcblx0XHRcdHN0YXJ0UG9zaXRpb246IG5ldyBUSFJFRS5WZWN0b3IzKDIuNSwgLTYuNSwgMSksXHJcblx0XHRcdHNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMygwLjQsIDAuNCwgMC40KSxcclxuXHRcdFx0cm90YXRpb246IG5ldyBUSFJFRS5WZWN0b3IzKDAsIFRIUkVFLk1hdGguZGVnVG9SYWQoLTkwKSwgMCksXHJcblx0XHRcdHB1c2hiYWNrOiAxLFxyXG5cdFx0XHRzaG9vdEJhY2t3YXJkRmFjdG9yOiAwLjUsXHJcblx0XHRcdHNob290Rm9yd2FyZEZhY3RvcjogMC41LFxyXG5cdFx0XHRtdXp6bGVEdXJhdGlvbjogR1MubXNUb0ZyYW1lcygxMjUpLFxyXG5cdFx0XHRtdXp6bGVGbGFzaENvbG9yOiBuZXcgVEhSRUUuQ29sb3IoKS5zZXRSR0IoMSwgMSwgMSksXHJcblx0XHR9LFxyXG5cdH1cclxuXHQkLmV4dGVuZCh0cnVlLCB0aGlzLndlYXBvbnMsIEdTLldlYXBvbnMpO1xyXG5cclxuXHR0aGlzLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XHJcblx0dGhpcy5jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNzUsIHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0LCAwLjEsIDEwMCk7XHJcblxyXG5cdHRoaXMuc2NyZWVuT3ZlcmxheUNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKDB4MDAwMDAwKTtcclxuXHR0aGlzLnNjcmVlbk92ZXJsYXlDb2xvckZhZGVTcGVlZCA9IDAuMDI7XHJcblx0dGhpcy5tdXp6bGVDb29sZG93biA9IDA7XHJcblxyXG5cdHRoaXMud2VhcG9uUmVhZHkgPSBmYWxzZTtcclxuXHJcblx0dGhpcy53ZWFwb25Cb2IgPSB7XHJcblx0XHRlbmFibGVkOiBHUy5TZXR0aW5ncy53ZWFwb25Cb2IsXHJcblx0XHRtYWduaXR1ZGVYOiAwLjUsXHJcblx0XHRtYWduaXR1ZGVZOiAwLjUsXHJcblx0XHRvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IzKCksXHJcblx0XHRyYWRpYW46IDAsXHJcblx0XHRzcGVlZDogMC4xLFxyXG5cdH07XHJcblxyXG5cdHRoaXMudmlld0JvYiA9IHtcclxuXHRcdGVuYWJsZWQ6IEdTLlNldHRpbmdzLnZpZXdCb2IsXHJcblx0XHRtYWduaXR1ZGU6IDEuNSxcclxuXHRcdG9mZnNldDogMCxcclxuXHRcdHJhZGlhbjogMCxcclxuXHRcdHNwZWVkOiAwLjIsXHJcblx0fTtcclxuXHJcblx0dGhpcy52aWV3VGhyb3R0bGUgPSBuZXcgR1MuU21vb3RoTnVtYmVyKDAsIDAuMSk7XHJcblx0dGhpcy53ZWFwb25UaHJvdHRsZSA9IG5ldyBHUy5TbW9vdGhOdW1iZXIoMCwgMC4xKTtcclxuXHJcblx0dGhpcy50d2VlbnMgPSB7XHJcblx0XHRzaG9vdDoge1xyXG5cdFx0XHRlYXNpbmc6IFRXRUVOLkVhc2luZy5TaW51c29pZGFsLkluT3V0LFxyXG5cdFx0fSxcclxuXHRcdHNob3c6IHtcclxuXHRcdFx0ZWFzaW5nOiBUV0VFTi5FYXNpbmcuQmFjay5PdXQsXHJcblx0XHRcdGR1cmF0aW9uOiA1MDAsXHJcblx0XHR9LFxyXG5cdFx0aGlkZToge1xyXG5cdFx0XHRlYXNpbmc6IFRXRUVOLkVhc2luZy5CYWNrLkluT3V0LFxyXG5cdFx0XHRkdXJhdGlvbjogMjUwLFxyXG5cdFx0fSxcclxuXHR9O1xyXG59O1xyXG5cclxuR1MuUGxheWVyVmlldy5wcm90b3R5cGUgPSB7XHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHRPYmplY3Qua2V5cyh0aGlzLndlYXBvbnMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XHJcblx0XHRcdHRoYXQuaW5pdFdlYXBvbk1lc2goa2V5KTtcclxuXHRcdH0pO1xyXG5cdH0sXHJcblxyXG5cdGFkZFdlYXBvbk1lc2g6IGZ1bmN0aW9uKG5hbWUsIG1lc2gpIHtcclxuXHRcdHRoaXMud2VhcG9uc1tuYW1lXS5tZXNoID0gbWVzaDtcclxuXHR9LFxyXG5cclxuXHRnZXRXZWFwb25NZXNoZXM6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cdFx0dmFyIG1lc2hlcyA9IFtdO1xyXG5cdFx0T2JqZWN0LmtleXModGhpcy53ZWFwb25zKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xyXG5cdFx0XHR2YXIgd2VhcG9uID0gdGhhdC53ZWFwb25zW2tleV07XHJcblx0XHRcdG1lc2hlcy5wdXNoKHdlYXBvbi5tZXNoKTtcclxuXHRcdH0pO1xyXG5cdFx0cmV0dXJuIG1lc2hlcztcclxuXHR9LFxyXG5cclxuXHRpbml0V2VhcG9uTWVzaDogZnVuY3Rpb24obmFtZSkge1xyXG5cdFx0dmFyIHdlYXBvbiA9IHRoaXMud2VhcG9uc1tuYW1lXTtcclxuXHJcblx0XHRpZiAod2VhcG9uLm1lc2ggIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR3ZWFwb24ubWVzaC52aXNpYmxlID0gZmFsc2U7XHJcblx0XHRcdHdlYXBvbi5tZXNoLnBvc2l0aW9uLmNvcHkod2VhcG9uLnBvc2l0aW9uKTtcclxuXHRcdFx0d2VhcG9uLm1lc2gucm90YXRpb24ueCA9IHdlYXBvbi5yb3RhdGlvbi54O1xyXG5cdFx0XHR3ZWFwb24ubWVzaC5yb3RhdGlvbi55ID0gd2VhcG9uLnJvdGF0aW9uLnk7XHJcblx0XHRcdHdlYXBvbi5tZXNoLnJvdGF0aW9uLnogPSB3ZWFwb24ucm90YXRpb24uejtcclxuXHRcdFx0d2VhcG9uLm1lc2guc2NhbGUuY29weSh3ZWFwb24uc2NhbGUpO1xyXG5cclxuXHRcdFx0dGhpcy5zY2VuZS5hZGQod2VhcG9uLm1lc2gpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmxpZ2h0aW5nVmlldy51cGRhdGVQbGF5ZXJMaWdodHMoKTtcclxuXHRcdHRoaXMudXBkYXRlTXV6emxlRmxhc2goKTtcclxuXHRcdHRoaXMudXBkYXRlTGlnaHRMZXZlbCgpO1xyXG5cdFx0dGhpcy51cGRhdGVWaWV3Qm9iKCk7XHJcblx0XHR0aGlzLnVwZGF0ZVdlYXBvbkJvYigpO1xyXG5cdFx0dGhpcy51cGRhdGVTY3JlZW5PdmVybGF5KCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlTXV6emxlRmxhc2g6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKHRoaXMubXV6emxlQ29vbGRvd24gPiAwKSB7XHJcblx0XHRcdHRoaXMubXV6emxlQ29vbGRvd24tLTtcclxuXHRcdFx0aWYgKHRoaXMubXV6emxlQ29vbGRvd24gPT09IDApIHtcclxuXHRcdFx0XHR0aGlzLmxpZ2h0aW5nVmlldy5lbmRNdXp6bGVGbGFzaCgpO1x0XHRcdFx0XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHR1cGRhdGVMaWdodExldmVsOiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLndlYXBvbiAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMucGxheWVyLmdldExpZ2h0Q29sb3JGcm9tU2VjdG9yKHRoaXMud2VhcG9uLm1lc2gubWF0ZXJpYWwuZW1pc3NpdmUpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVRocm90dGxlOiBmdW5jdGlvbihvbGRQb3MsIG5ld1Bvcykge1xyXG5cdFx0dmFyIHZlbG9jaXR5ID0gb2xkUG9zLnRvVmVjdG9yMigpLmRpc3RhbmNlVG8obmV3UG9zLnRvVmVjdG9yMigpKTtcclxuXHRcdHRoaXMudmlld1Rocm90dGxlLnNldFRhcmdldFZhbHVlKHZlbG9jaXR5IC8gdGhpcy5wbGF5ZXIubW92ZVNwZWVkKTtcclxuXHRcdHRoaXMudmlld1Rocm90dGxlLnVwZGF0ZSgpO1xyXG5cdFx0aWYgKCF0aGlzLnBsYXllci5zaG9vdGluZyAmJiB0aGlzLndlYXBvblJlYWR5KSB7XHRcdFx0XHJcblx0XHRcdHRoaXMud2VhcG9uVGhyb3R0bGUuc2V0VGFyZ2V0VmFsdWUodmVsb2NpdHkgLyB0aGlzLnBsYXllci5tb3ZlU3BlZWQpO1xyXG5cdFx0XHR0aGlzLndlYXBvblRocm90dGxlLnVwZGF0ZSgpO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHJlc2V0V2VhcG9uVGhyb3R0bGU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy53ZWFwb25UaHJvdHRsZS52YWx1ZSA9IDA7XHJcblx0XHR0aGlzLndlYXBvbkJvYi5yYWRpYW4gPSAwO1xyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVZpZXdCb2I6IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKHRoaXMudmlld0JvYi5lbmFibGVkKSB7XHJcblx0XHRcdHRoaXMucGxheWVyLmNvbnRyb2xzLnNldFZpZXdPZmZzZXRZKHRoaXMudmlld0JvYi5vZmZzZXQpO1xyXG5cdFx0XHR0aGlzLnZpZXdCb2IucmFkaWFuICs9IHRoaXMudmlld0JvYi5zcGVlZDtcclxuXHRcdFx0dGhpcy52aWV3Qm9iLm9mZnNldCA9IHRoaXMudmlld1Rocm90dGxlLnZhbHVlICogdGhpcy52aWV3Qm9iLm1hZ25pdHVkZSAqIE1hdGguc2luKHRoaXMudmlld0JvYi5yYWRpYW4pO1x0XHRcdFxyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHVwZGF0ZVdlYXBvbkJvYjogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy53ZWFwb25Cb2IuZW5hYmxlZCAmJiAhdGhpcy5wbGF5ZXIuc2hvb3RpbmcpIHtcdFx0XHRcclxuXHRcdFx0dGhpcy53ZWFwb25Cb2IucmFkaWFuICs9IHRoaXMud2VhcG9uQm9iLnNwZWVkO1xyXG5cclxuXHRcdFx0dmFyIHggPSB0aGlzLndlYXBvblRocm90dGxlLnZhbHVlICogdGhpcy53ZWFwb25Cb2IubWFnbml0dWRlWCAqIE1hdGguc2luKHRoaXMud2VhcG9uQm9iLnJhZGlhbik7XHJcblx0XHRcdHZhciB5ID0gLU1hdGguYWJzKHRoaXMud2VhcG9uVGhyb3R0bGUudmFsdWUgKiB0aGlzLndlYXBvbkJvYi5tYWduaXR1ZGVZICogTWF0aC5zaW4odGhpcy53ZWFwb25Cb2IucmFkaWFuKSk7XHJcblxyXG5cdFx0XHR0aGlzLndlYXBvbkJvYi5vZmZzZXQuc2V0KHgsIHksIDApO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMud2VhcG9uICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHR0aGlzLndlYXBvbi5tZXNoLnBvc2l0aW9uLmNvcHkodGhpcy53ZWFwb24ucG9zaXRpb24uY2xvbmUoKS5hZGQodGhpcy53ZWFwb25Cb2Iub2Zmc2V0KSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRzaG9vdDogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5yZXNldFdlYXBvblRocm90dGxlKCk7XHRcclxuXHJcblx0XHR0aGlzLndlYXBvbi5tZXNoLnBvc2l0aW9uLmNvcHkodGhpcy53ZWFwb24ucG9zaXRpb24pO1xyXG5cclxuXHRcdHZhciBiYWNrd2FyZCA9IHRoaXMud2VhcG9uLnBvc2l0aW9uLmNsb25lKCk7XHJcblx0XHRiYWNrd2FyZC56ICs9IHRoaXMud2VhcG9uLnB1c2hiYWNrO1xyXG5cdFx0dmFyIHR3ZWVuU2hvb3RCYWNrd2FyZCA9IG5ldyBUV0VFTi5Ud2Vlbih0aGlzLndlYXBvbi5tZXNoLnBvc2l0aW9uKS50byhiYWNrd2FyZCwgXHJcblx0XHRcdHRoaXMud2VhcG9uLmNvb2xkb3duICogdGhpcy53ZWFwb24uc2hvb3RCYWNrd2FyZEZhY3Rvcik7XHJcblx0XHR0d2VlblNob290QmFja3dhcmQuZWFzaW5nKHRoaXMudHdlZW5zLnNob290LmVhc2luZyk7XHJcblxyXG5cdFx0dmFyIHR3ZWVuU2hvb3RGb3J3YXJkID0gbmV3IFRXRUVOLlR3ZWVuKHRoaXMud2VhcG9uLm1lc2gucG9zaXRpb24pLnRvKHRoaXMud2VhcG9uLnBvc2l0aW9uLCBcclxuXHRcdFx0dGhpcy53ZWFwb24uY29vbGRvd24gKiB0aGlzLndlYXBvbi5zaG9vdEZvcndhcmRGYWN0b3IpO1xyXG5cdFx0dHdlZW5TaG9vdEZvcndhcmQuZWFzaW5nKHRoaXMudHdlZW5zLnNob290LmVhc2luZyk7XHJcblxyXG5cdFx0dHdlZW5TaG9vdEJhY2t3YXJkLmNoYWluKHR3ZWVuU2hvb3RGb3J3YXJkKTtcclxuXHRcdHR3ZWVuU2hvb3RCYWNrd2FyZC5zdGFydCgpO1xyXG5cclxuXHRcdHRoaXMuc2hvd011enpsZUZsYXNoKCk7XHJcblx0fSxcclxuXHJcblx0c2hvd011enpsZUZsYXNoOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMubGlnaHRpbmdWaWV3LmJlZ2luTXV6emxlRmxhc2godGhpcy53ZWFwb24ubXV6emxlRmxhc2hDb2xvcik7XHJcblx0XHR0aGlzLm11enpsZUNvb2xkb3duID0gdGhpcy53ZWFwb24ubXV6emxlRHVyYXRpb247XHJcblx0fSxcclxuXHJcblx0Y2hhbmdlVG9XZWFwb25JbnN0YW50OiBmdW5jdGlvbihuYW1lKSB7XHJcblx0XHR0aGlzLnJlc2V0V2VhcG9uVGhyb3R0bGUoKTtcclxuXHJcblx0XHRpZiAodGhpcy53ZWFwb24gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLndlYXBvbi5tZXNoLnZpc2libGUgPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLndlYXBvblJlYWR5ID0gdHJ1ZTtcclxuXHRcdHRoaXMud2VhcG9uID0gdGhpcy53ZWFwb25zW25hbWVdO1xyXG5cdFx0dGhpcy53ZWFwb24ubWVzaC52aXNpYmxlID0gdHJ1ZTtcclxuXHRcdHRoaXMud2VhcG9uLm1lc2gucG9zaXRpb24uY29weSh0aGlzLndlYXBvbi5zdGFydFBvc2l0aW9uKTtcclxuXHR9LFxyXG5cclxuXHRjaGFuZ2VUb1dlYXBvbjogZnVuY3Rpb24obmFtZSkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMucmVzZXRXZWFwb25UaHJvdHRsZSgpO1xyXG5cclxuXHRcdHRoaXMud2VhcG9uUmVhZHkgPSBmYWxzZTtcclxuXHRcdGlmICh0aGlzLndlYXBvbiAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuaGlkZVdlYXBvbihmdW5jdGlvbigpIHtcclxuXHRcdFx0XHR0aGF0LnNob3dXZWFwb24obmFtZSk7XHJcblx0XHRcdH0pXHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLnNob3dXZWFwb24obmFtZSk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0c2hvd1dlYXBvbjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2spIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHJcblx0XHR0aGlzLndlYXBvbiA9IHRoaXMud2VhcG9uc1tuYW1lXTtcclxuXHRcdHRoaXMud2VhcG9uLm1lc2gudmlzaWJsZSA9IHRydWU7XHRcdFxyXG5cdFx0dGhpcy53ZWFwb24ubWVzaC5wb3NpdGlvbi5jb3B5KHRoaXMud2VhcG9uLnN0YXJ0UG9zaXRpb24pO1xyXG5cclxuXHRcdHZhciB0d2VlbiA9IG5ldyBUV0VFTi5Ud2Vlbih0aGlzLndlYXBvbi5tZXNoLnBvc2l0aW9uKS50byh0aGlzLndlYXBvbi5wb3NpdGlvbiwgdGhpcy50d2VlbnMuc2hvdy5kdXJhdGlvbik7XHJcblx0XHR0d2Vlbi5lYXNpbmcodGhpcy50d2VlbnMuc2hvdy5lYXNpbmcpO1xyXG5cdFx0dHdlZW4ub25Db21wbGV0ZShmdW5jdGlvbigpIHtcclxuXHRcdFx0dHdlZW4ub25Db21wbGV0ZShudWxsKTtcclxuXHRcdFx0dGhhdC53ZWFwb25SZWFkeSA9IHRydWU7XHJcblx0XHRcdGlmIChjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0Y2FsbGJhY2soKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHR0d2Vlbi5zdGFydCgpO1xyXG5cdH0sXHJcblxyXG5cdGhpZGVXZWFwb246IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblx0XHR0aGlzLndlYXBvblJlYWR5ID0gZmFsc2U7XHJcblxyXG5cdFx0dmFyIHR3ZWVuID0gbmV3IFRXRUVOLlR3ZWVuKHRoaXMud2VhcG9uLm1lc2gucG9zaXRpb24pLnRvKHRoaXMud2VhcG9uLnN0YXJ0UG9zaXRpb24sIHRoaXMudHdlZW5zLmhpZGUuZHVyYXRpb24pO1xyXG5cdFx0dHdlZW4uZWFzaW5nKHRoaXMudHdlZW5zLmhpZGUuZWFzaW5nKTtcclxuXHRcdHR3ZWVuLm9uQ29tcGxldGUoZnVuY3Rpb24oKSB7XHJcblx0XHRcdHR3ZWVuLm9uQ29tcGxldGUobnVsbCk7XHJcblx0XHRcdHRoYXQud2VhcG9uLm1lc2gudmlzaWJsZSA9IGZhbHNlO1xyXG5cdFx0XHRpZiAoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdGNhbGxiYWNrKCk7XHJcblx0XHRcdH1cclxuXHRcdH0pXHJcblx0XHR0d2Vlbi5zdGFydCgpO1xyXG5cdH0sXHRcclxuXHJcblx0b25SZXNpemU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jYW1lcmEuYXNwZWN0ID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblx0XHR0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XHJcblx0fSxcclxuXHJcblx0b25JdGVtUGlja3VwOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuc2NyZWVuT3ZlcmxheUNvbG9yLnNldFJHQigwLjMsIDAuMywgMCk7XHJcblx0XHR0aGlzLmRpc3BhdGNoRXZlbnQoeyB0eXBlOiBcInNjcmVlbk92ZXJsYXlDb2xvckNoYW5nZVwiLCBjb2xvcjogdGhpcy5zY3JlZW5PdmVybGF5Q29sb3IgfSk7XHJcblx0fSxcclxuXHJcblx0b25EYW1hZ2U6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5zY3JlZW5PdmVybGF5Q29sb3Iuc2V0UkdCKDAuNiwgMCwgMCk7XHJcblx0XHR0aGlzLmRpc3BhdGNoRXZlbnQoeyB0eXBlOiBcInNjcmVlbk92ZXJsYXlDb2xvckNoYW5nZVwiLCBjb2xvcjogdGhpcy5zY3JlZW5PdmVybGF5Q29sb3IgfSk7XHJcblx0fSxcclxuXHJcblx0b25EZWF0aDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLnBsYXllci5jb250cm9scy5leWUueSAtPSB0aGlzLnBsYXllci5zaXplLnk7XHJcblx0XHR0aGlzLnBsYXllci5jb250cm9scy51cGRhdGVDYW1lcmEoKTtcclxuXHJcblx0XHRpZiAodGhpcy53ZWFwb24gIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHR0aGlzLmhpZGVXZWFwb24oKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHR1cGRhdGVTY3JlZW5PdmVybGF5OiBmdW5jdGlvbigpIHtcclxuXHRcdGlmICh0aGlzLnNjcmVlbk92ZXJsYXlDb2xvci5yID4gMCB8fFxyXG5cdFx0XHR0aGlzLnNjcmVlbk92ZXJsYXlDb2xvci5nID4gMCB8fFxyXG5cdFx0XHR0aGlzLnNjcmVlbk92ZXJsYXlDb2xvci5iID4gMCkge1xyXG5cclxuXHRcdFx0dGhpcy5zY3JlZW5PdmVybGF5Q29sb3IuYWRkU2NhbGFyKC10aGlzLnNjcmVlbk92ZXJsYXlDb2xvckZhZGVTcGVlZCk7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5zY3JlZW5PdmVybGF5Q29sb3IuciA8IDApIHtcclxuXHRcdFx0XHR0aGlzLnNjcmVlbk92ZXJsYXlDb2xvci5yID0gMDtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5zY3JlZW5PdmVybGF5Q29sb3IuZyA8IDApIHtcclxuXHRcdFx0XHR0aGlzLnNjcmVlbk92ZXJsYXlDb2xvci5nID0gMDtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5zY3JlZW5PdmVybGF5Q29sb3IuYiA8IDApIHtcclxuXHRcdFx0XHR0aGlzLnNjcmVlbk92ZXJsYXlDb2xvci5iID0gMDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5kaXNwYXRjaEV2ZW50KHsgdHlwZTogXCJzY3JlZW5PdmVybGF5Q29sb3JDaGFuZ2VcIiwgY29sb3I6IHRoaXMuc2NyZWVuT3ZlcmxheUNvbG9yIH0pO1xyXG5cdFx0fVxyXG5cdH0sXHJcbn07XHJcblxyXG5USFJFRS5FdmVudERpc3BhdGNoZXIucHJvdG90eXBlLmFwcGx5KEdTLlBsYXllclZpZXcucHJvdG90eXBlKTtcclxuIiwiXHJcbkdTLkdhbWVWZXJzaW9uID0gXCJ2MS4yLjJcIjtcclxuR1MuUmVsZWFzZURhdGUgPSBcImFwcmlsIDIwMTdcIjtcclxuXHJcbkdTLkdhbWVTdGF0ZXMgPSB7XHJcblx0RGlzcG9zZTogMCxcclxuXHRQcmVMb2FkOiAxLFxyXG5cdExvYWRpbmc6IDIsXHJcblx0UG9zdExvYWQ6IDMsXHJcblx0UGxheTogNCxcclxuXHRNZW51OiA1LFxyXG59O1xyXG5cclxuR1MuR2FtZSA9IGZ1bmN0aW9uKCkge1xyXG5cdEdTLkJhc2UuY2FsbCh0aGlzKTtcclxufTtcclxuXHJcbkdTLkdhbWUucHJvdG90eXBlID0gR1MuaW5oZXJpdChHUy5CYXNlLCB7XHJcblx0Y29uc3RydWN0b3I6IEdTLkdhbWUsXHJcblxyXG5cdHByZUluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0R1MuU2V0dGluZ3MubG9hZFNldHRpbmdzKCk7XHJcblxyXG5cclxuXHJcblx0XHR0aGlzLnN0YXRlID0gR1MuR2FtZVN0YXRlcy5QcmVMb2FkO1xyXG5cdFx0dGhpcy5uZXh0U3RhdGUgPSBudWxsO1xyXG5cdFx0dGhpcy51cGRhdGVkID0gZmFsc2U7XHJcblx0XHR0aGlzLmZpcnN0TG9hZCA9IHRydWU7XHJcblx0XHR0aGlzLmZpcnN0UGxheSA9IHRydWU7XHJcblx0XHR0aGlzLm9ubGluZVBsYXkgPSBmYWxzZTtcclxuXHRcdHRoaXMubWFwV29uID0gZmFsc2U7XHJcblx0XHR0aGlzLnJlc3RhcnRlZExldmVsID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5hbnRpYWxpYXMgPSBmYWxzZTtcclxuXHRcdHRoaXMuY2xlYXJDb2xvciA9IDB4MzM2Njk5O1xyXG5cdFx0dGhpcy5jYW1lcmFGb3YgPSBHUy5TZXR0aW5ncy5mb3Y7XHJcblx0XHR0aGlzLmNhbWVyYUZhciA9IDE1MDA7XHJcblxyXG5cdFx0aWYgKHRoaXMuaXNUZXN0TWFwKCkpIHtcclxuXHRcdFx0dGhpcy5ub01lbnUgPSB0cnVlO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5ub01lbnUgPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmZpcnN0VGltZUluTWVudSA9IHRydWU7XHJcblxyXG5cdFx0dGhpcy5zaG93RlBTID0gR1MuU2V0dGluZ3Muc2hvd0ZQUztcclxuXHRcdHRoaXMuc2hvd1BlcmZvcm1hbmNlRGVidWdNZXRlcnMgPSBmYWxzZTtcclxuXHR9LFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdEdTLkRlYnVnVUkuaW5pdCgpO1xyXG5cdFx0R1MuRGVidWdVSS52aXNpYmxlID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5sb2FkaW5nVUkgPSBuZXcgR1MuTG9hZGluZ1VJKCk7XHJcblx0XHR0aGlzLmxvYWRpbmdVSS5pbml0KCk7XHJcblxyXG5cdFx0dGhpcy51aU1hbmFnZXIgPSBuZXcgR1MuVUlNYW5hZ2VyKCk7XHJcblx0XHR0aGlzLnVpTWFuYWdlci5pbml0KCk7XHJcblxyXG5cdFx0dGhpcy5vbmxpbmVNYW5hZ2VyID0gbmV3IEdTLk9ubGluZU1hbmFnZXIoKTtcclxuXHRcdHRoaXMub25saW5lTWFuYWdlci5pbml0KCk7XHJcblxyXG5cdFx0dGhpcy5zb3VuZE1hbmFnZXIgPSBuZXcgR1MuU291bmRNYW5hZ2VyKCk7XHJcblx0XHR0aGlzLnNvdW5kTWFuYWdlci5pbml0KCk7XHJcblxyXG5cdFx0dGhpcy5tdXNpY01hbmFnZXIgPSBuZXcgR1MuTXVzaWNNYW5hZ2VyKCk7XHJcblx0XHR0aGlzLm11c2ljTWFuYWdlci5pbml0KCk7XHJcblxyXG5cdFx0dGhpcy5pbml0QXNzZXRMb2FkZXIoKTtcclxuXHJcblx0XHR0aGlzLmtleXMgPSB7XHJcblx0XHRcdEVudGVyOiAxMyxcclxuXHRcdFx0RXNjYXBlOiAyNyxcclxuXHRcdFx0VGFiOiA5LFxyXG5cdFx0fTtcclxuXHJcblx0XHRHUy5CYXNlLnByb3RvdHlwZS5pbml0LmNhbGwodGhpcyk7XHJcblxyXG5cdFx0dGhpcy5ncmFwaGljc01hbmFnZXIgPSBuZXcgR1MuR3JhcGhpY3NNYW5hZ2VyKHRoaXMucmVuZGVyZXIsIHRoaXMuY2FtZXJhKTtcclxuXHRcdHRoaXMuZ3JhcGhpY3NNYW5hZ2VyLmluaXQoKTtcclxuXHR9LFxyXG5cclxuXHRwcmVMb2FkOiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMudWlNYW5hZ2VyLnJlc2V0KCk7XHJcblxyXG5cdFx0dGhpcy5sb2FkaW5nVUkucGVyY2VudExvYWRlZCA9IDA7XHJcblx0XHR0aGlzLmxvYWRpbmdVSS5zaG93KCk7XHJcblxyXG5cdFx0dGhpcy5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cdFx0dGhpcy5zY2VuZS5mb2cgPSBuZXcgVEhSRUUuRm9nKG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQigwLCAwLCAwKS5nZXRIZXgoKSwgNTAwLCA5MDApO1xyXG5cclxuXHRcdGlmICghdGhpcy5hc3NldExvYWRlci5sb2FkZWQpIHtcclxuXHRcdFx0dGhpcy5hc3NldExvYWRlci5sb2FkKCk7XHJcblx0XHRcdHRoaXMubmV4dFN0YXRlID0gR1MuR2FtZVN0YXRlcy5Mb2FkaW5nO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5uZXh0U3RhdGUgPSBHUy5HYW1lU3RhdGVzLlBvc3RMb2FkO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdGluaXRBc3NldExvYWRlcjogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0dGhpcy5hc3NldExvYWRlciA9IG5ldyBHUy5aaXBBc3NldExvYWRlcih0aGlzLnNvdW5kTWFuYWdlci5jdHgpO1xyXG5cclxuXHRcdHRoaXMuYXNzZXRMb2FkZXIuaW5pdCgpO1xyXG5cdFx0dGhpcy5hc3NldExvYWRlci5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIiwgZnVuY3Rpb24oZSkge1xyXG5cdFx0XHR0aGF0LmxvYWRpbmdVSS51cGRhdGVQcm9ncmVzcyhlKTtcclxuXHRcdH0pO1xyXG5cdFx0dGhpcy5hc3NldExvYWRlci5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBmdW5jdGlvbihlKSB7XHJcblx0XHRcdHRoYXQubG9hZGluZ1VJLnVwZGF0ZVByb2dyZXNzKGUpO1xyXG5cdFx0XHR0aGF0Lm5leHRTdGF0ZSA9IEdTLkdhbWVTdGF0ZXMuUG9zdExvYWQ7XHJcblx0XHR9KTtcclxuXHR9LFxyXG5cclxuXHRwb3N0TG9hZDogZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy5vbmxpbmVQbGF5KSB7XHJcbiAgICAgIGlmICh0aGlzLmZpcnN0TG9hZCkge1xyXG4gICAgICAgIHRoaXMubG9hZGluZ1VJLnNwaW5uZXJPbmx5ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnVpTWFuYWdlci5pbml0Q29tcG9uZW50cyh0aGlzLmFzc2V0TG9hZGVyLmFzc2V0cyk7XHJcbiAgICAgICAgLy8gdGhpcy5vcGVuTWVudSgpO1xyXG4gICAgICAgIHRoaXMuZmlyc3RMb2FkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHRoaXMub25saW5lTWFuYWdlci5zZXRHcmlkKHRoaXMuZ3JpZCk7XHJcbiAgICAgICAgLy8gaWYgKHRoaXMubm9NZW51KSB7XHJcbiAgICAgICAgLy8gICB0aGlzLm5ld0dhbWUoKTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5pbml0Q29tcG9uZW50cyh0aGlzLmFzc2V0TG9hZGVyLmFzc2V0cyk7XHJcbiAgICAgICAgdGhpcy51aU1hbmFnZXIuaW5pdENvbXBvbmVudHModGhpcy5hc3NldExvYWRlci5hc3NldHMsIHRoaXMuZ3JpZCk7XHJcbiAgICAgICAgdGhpcy51aU1hbmFnZXIudXNlSW5nYW1lTWVudSgpO1xyXG4gICAgICAgIC8vIFRPRE8gYWRkIHVzZU9ubGluZU1lbnVcclxuXHJcbiAgICAgICAgdGhpcy5uZXh0U3RhdGUgPSBHUy5HYW1lU3RhdGVzLlBsYXk7XHJcbiAgICAgICAgdGhpcy5ncmFwaGljc01hbmFnZXIubW9ub2Nocm9tZUVuYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZ3JpZC5haU1hbmFnZXIuc2NyaXB0ICE9PSB1bmRlZmluZWQgJiYgIXRoaXMucmVzdGFydGVkTGV2ZWwpIHtcclxuICAgICAgICAgIHRoaXMubXVzaWNNYW5hZ2VyLnBsYXlUcmFjayh0aGlzLmdyaWQuYWlNYW5hZ2VyLnNjcmlwdC5tdXNpY1RyYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXN0YXJ0ZWRMZXZlbCA9IGZhbHNlO1xyXG5cclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHRoaXMuZmlyc3RMb2FkKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nVUkuc3Bpbm5lck9ubHkgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMudWlNYW5hZ2VyLmluaXRDb21wb25lbnRzKHRoaXMuYXNzZXRMb2FkZXIuYXNzZXRzKTtcclxuICAgICAgICB0aGlzLm9wZW5NZW51KCk7XHJcbiAgICAgICAgdGhpcy5maXJzdExvYWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubm9NZW51KSB7XHJcbiAgICAgICAgICB0aGlzLm5ld0dhbWUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5pbml0Q29tcG9uZW50cyh0aGlzLmFzc2V0TG9hZGVyLmFzc2V0cyk7XHJcbiAgICAgICAgdGhpcy51aU1hbmFnZXIuaW5pdENvbXBvbmVudHModGhpcy5hc3NldExvYWRlci5hc3NldHMsIHRoaXMuZ3JpZCk7XHJcbiAgICAgICAgdGhpcy51aU1hbmFnZXIudXNlSW5nYW1lTWVudSgpO1xyXG4gICAgICAgIC8vIFRPRE8gYWRkIHVzZU9ubGluZU1lbnVcclxuXHJcbiAgICAgICAgdGhpcy5uZXh0U3RhdGUgPSBHUy5HYW1lU3RhdGVzLlBsYXk7XHJcbiAgICAgICAgdGhpcy5ncmFwaGljc01hbmFnZXIubW9ub2Nocm9tZUVuYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZ3JpZC5haU1hbmFnZXIuc2NyaXB0ICE9PSB1bmRlZmluZWQgJiYgIXRoaXMucmVzdGFydGVkTGV2ZWwpIHtcclxuICAgICAgICAgIHRoaXMubXVzaWNNYW5hZ2VyLnBsYXlUcmFjayh0aGlzLmdyaWQuYWlNYW5hZ2VyLnNjcmlwdC5tdXNpY1RyYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXN0YXJ0ZWRMZXZlbCA9IGZhbHNlO1xyXG5cclxuICAgICAgfVxyXG4gICAgfVxyXG5cdH0sXHJcblxyXG5cdHBsYXk6IGZ1bmN0aW9uKCkge1xyXG4gICAgR1MuSW5wdXRIZWxwZXIuY2hlY2tQcmVzc2VkS2V5cygpO1xyXG4gICAgaWYgKHRoaXMub25saW5lUGxheSkge1xyXG4gICAgICAgIHRoaXMuZ3JpZC51cGRhdGUoKTtcclxuICAgICAgICBUV0VFTi51cGRhdGUoKTtcclxuICAgICAgICB0aGlzLm9ubGluZU1hbmFnZXIuc2V0dXBDbGllbnRzKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JpZC5wbGF5ZXIuZGVhZCAmJiAhR1MuSW5wdXRIZWxwZXIua2V5c1ByZXNzZWQgJiYgR1MuSW5wdXRIZWxwZXIuaXNLZXlEb3duKHRoaXMua2V5cy5FbnRlcikpIHtcclxuICAgICAgICAgIHRoaXMuZ3JpZC5yZXNwYXduKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuXHJcbiAgICAgIGlmICghR1MuSW5wdXRIZWxwZXIua2V5c1ByZXNzZWQgJiYgR1MuSW5wdXRIZWxwZXIuaXNLZXlEb3duKHRoaXMua2V5cy5Fc2NhcGUpKSB7XHJcbiAgICAgICAgdGhpcy5vcGVuTWVudSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXRoaXMuZ3JpZC5haU1hbmFnZXIubWFwV29uICYmICFHUy5JbnB1dEhlbHBlci5rZXlzUHJlc3NlZCAmJiBHUy5JbnB1dEhlbHBlci5pc0tleURvd24odGhpcy5rZXlzLlRhYikpIHtcclxuICAgICAgICB0aGlzLnVpTWFuYWdlci5hdXRvbWFwLnZpc2libGUgPSAhdGhpcy51aU1hbmFnZXIuYXV0b21hcC52aXNpYmxlO1xyXG4gICAgICAgIHRoaXMudWlNYW5hZ2VyLm92ZXJyaWRlUmVkcmF3ID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmdyYXBoaWNzTWFuYWdlci5tb25vY2hyb21lRW5hYmxlZCA9IHRoaXMudWlNYW5hZ2VyLmF1dG9tYXAudmlzaWJsZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuZ3JpZC5wbGF5ZXIuZGVhZCAmJiAhR1MuSW5wdXRIZWxwZXIua2V5c1ByZXNzZWQgJiYgR1MuSW5wdXRIZWxwZXIuaXNLZXlEb3duKHRoaXMua2V5cy5FbnRlcikpIHtcclxuICAgICAgICB0aGlzLnJlc3RhcnRMZXZlbCgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5ncmlkLmFpTWFuYWdlci5tYXBXb24gJiYgIUdTLklucHV0SGVscGVyLmtleXNQcmVzc2VkICYmIEdTLklucHV0SGVscGVyLmlzS2V5RG93bih0aGlzLmtleXMuRW50ZXIpKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JpZC5haU1hbmFnZXIuc2NyaXB0Lm5leHRNYXAgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgdGhpcy5wbGF5ZXJQZXJzaXN0ZW5jZVBhY2thZ2UgPSB0aGlzLmdyaWQucGxheWVyLmdldFBlcnNpc3RlbmNlUGFja2FnZSgpO1xyXG4gICAgICAgICAgdGhpcy5sb2FkTGV2ZWwodGhpcy5ncmlkLmFpTWFuYWdlci5zY3JpcHQubmV4dE1hcCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXRoaXMubWFwV29uICYmIHRoaXMuZ3JpZC5haU1hbmFnZXIubWFwV29uKSB7XHJcbiAgICAgICAgdGhpcy5tYXBXb24gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMub25NYXBXb24oKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCF0aGlzLmdyaWQuYWlNYW5hZ2VyLm1hcFdvbikge1xyXG4gICAgICAgIHRoaXMuZ3JpZC51cGRhdGUoKTtcclxuICAgICAgICBUV0VFTi51cGRhdGUoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgR1MuRGVidWdVSS51cGRhdGUoKTtcclxuXHJcbiAgICB0aGlzLnVpTWFuYWdlci51cGRhdGUoKTtcclxuXHR9LFxyXG5cclxuXHRvbk1hcFdvbjogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLmdyYXBoaWNzTWFuYWdlci5tb25vY2hyb21lRW5hYmxlZCA9IGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdG1lbnU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0R1MuSW5wdXRIZWxwZXIuY2hlY2tQcmVzc2VkS2V5cygpO1xyXG5cclxuXHRcdGlmICghR1MuSW5wdXRIZWxwZXIua2V5c1ByZXNzZWQgJiYgR1MuSW5wdXRIZWxwZXIuaXNLZXlEb3duKHRoaXMua2V5cy5Fc2NhcGUpKSB7XHJcblx0XHRcdGlmICh0aGlzLmdyaWQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHRoaXMuY2xvc2VNZW51KCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnVpTWFuYWdlci51cGRhdGUoKTtcclxuXHR9LFxyXG5cclxuXHRvcGVuTWVudTogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLm5leHRTdGF0ZSA9IEdTLkdhbWVTdGF0ZXMuTWVudTtcclxuXHJcblx0XHRpZiAodGhpcy5ncmlkICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0dGhpcy5ncmlkLnBsYXllci5pbk1lbnUgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLmdyaWQucGxheWVyLmNvbnRyb2xzLmRpc2FibGUoKTtcclxuXHRcdFx0dGhpcy5ncmlkLnBsYXllci5jb250cm9scy5kZXRhY2hFdmVudHMoKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmdyYXBoaWNzTWFuYWdlci5tb25vY2hyb21lRW5hYmxlZCA9IHRydWU7XHJcblx0XHR0aGlzLnVpTWFuYWdlci5tZW51QWN0aXZlID0gdHJ1ZTtcclxuXHJcblx0XHRHUy5EZWJ1Z1VJLnZpc2libGUgPSBmYWxzZTtcclxuXHR9LFxyXG5cclxuXHRjbG9zZU1lbnU6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5uZXh0U3RhdGUgPSBHUy5HYW1lU3RhdGVzLlBsYXk7XHJcblxyXG5cdFx0aWYgKHRoaXMuZ3JpZCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZ3JpZC5wbGF5ZXIuaW5NZW51ID0gZmFsc2U7XHJcblx0XHRcdHRoaXMuZ3JpZC5wbGF5ZXIuY29udHJvbHMuYXR0YWNoRXZlbnRzKCk7XHJcblx0XHRcdHRoaXMuZ3JpZC5wbGF5ZXIuY29udHJvbHMuZW5hYmxlKCk7XHJcblx0XHRcdHRoaXMuZ3JpZC5haU1hbmFnZXIucmVzdW1lKCk7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5tYXBXb24gfHwgIXRoaXMudWlNYW5hZ2VyLmF1dG9tYXAudmlzaWJsZSkge1xyXG5cdFx0XHRcdHRoaXMuZ3JhcGhpY3NNYW5hZ2VyLm1vbm9jaHJvbWVFbmFibGVkID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMuZ3JhcGhpY3NNYW5hZ2VyLm1vbm9jaHJvbWVFbmFibGVkID0gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuZmlyc3RUaW1lSW5NZW51KSB7XHJcblx0XHRcdHRoaXMudWlNYW5hZ2VyLnJlbW92ZU5ld3NCb3goKTtcclxuXHRcdFx0dGhpcy5maXJzdFRpbWVJbk1lbnUgPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnVpTWFuYWdlci5tZW51QWN0aXZlID0gZmFsc2U7XHJcblx0XHRHUy5EZWJ1Z1VJLnZpc2libGUgPSBHUy5TZXR0aW5ncy5zaG93SFVEO1xyXG5cdH0sXHJcblxyXG5cdHJlc3RhcnRMZXZlbDogZnVuY3Rpb24oKSB7XHJcblx0XHR0aGlzLm5leHRTdGF0ZSA9IEdTLkdhbWVTdGF0ZXMuRGlzcG9zZTtcclxuXHRcdHRoaXMucmVzdGFydGVkTGV2ZWwgPSB0cnVlO1xyXG5cdH0sXHJcblxyXG5cdGxvYWRMZXZlbDogZnVuY3Rpb24obmFtZSkge1xyXG4gICAgdGhpcy5vbmxpbmVQbGF5ID0gZmFsc2U7XHJcblx0XHRpZiAodGhpcy51aU1hbmFnZXIubWVudUFjdGl2ZSkge1xyXG5cdFx0XHR0aGlzLmNsb3NlTWVudSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMubWFwTmFtZSA9IG5hbWU7XHJcblx0XHR0aGlzLm5leHRTdGF0ZSA9IEdTLkdhbWVTdGF0ZXMuRGlzcG9zZTtcclxuXHR9LFxyXG5cclxuXHRsb2FkT25saW5lTGV2ZWw6IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgIHRoaXMub25saW5lUGxheSA9IHRydWU7XHJcblx0XHRpZiAodGhpcy51aU1hbmFnZXIubWVudUFjdGl2ZSkge1xyXG5cdFx0XHR0aGlzLmNsb3NlTWVudSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMubWFwTmFtZSA9IG5hbWU7XHJcblx0XHR0aGlzLm5leHRTdGF0ZSA9IEdTLkdhbWVTdGF0ZXMuRGlzcG9zZTtcclxuXHR9LFxyXG5cclxuXHRuZXdHYW1lOiBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMub25saW5lUGxheSA9IGZhbHNlO1xyXG5cdFx0aWYgKHRoaXMudWlNYW5hZ2VyLm1lbnVBY3RpdmUpIHtcclxuXHRcdFx0dGhpcy5jbG9zZU1lbnUoKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5pc1Rlc3RNYXAoKSkge1xyXG5cdFx0XHR0aGlzLm1hcE5hbWUgPSBcInRlc3RNYXBcIjtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHRoaXMubWFwTmFtZSA9IFwiYWlyc3RyaXAxXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5uZXh0U3RhdGUgPSBHUy5HYW1lU3RhdGVzLkRpc3Bvc2U7XHJcblx0fSxcclxuXHJcblx0am9pbjogZnVuY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy51aU1hbmFnZXIubWVudUFjdGl2ZSkge1xyXG5cdFx0XHR0aGlzLmNsb3NlTWVudSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLmlzVGVzdE1hcCgpKSB7XHJcblx0XHRcdHRoaXMubWFwTmFtZSA9IFwidGVzdE1hcFwiO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5tYXBOYW1lID0gXCJhaXJzdHJpcDFcIjtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLm5leHRTdGF0ZSA9IEdTLkdhbWVTdGF0ZXMuRGlzcG9zZTtcclxuXHR9LFxyXG5cclxuXHRpc1Rlc3RNYXA6IGZ1bmN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwidGVzdG1hcFwiKSA+IC0xO1xyXG5cdH0sXHJcblxyXG5cdGluaXRDb21wb25lbnRzOiBmdW5jdGlvbihhc3NldHMpIHtcclxuXHRcdHZhciB0aGF0ID0gdGhpcztcclxuXHRcdHZhciBtYXAgPSB0aGlzLmFzc2V0TG9hZGVyLm1hcExvYWRlci5wYXJzZShhc3NldHNbR1MuQXNzZXRUeXBlcy5NYXBdW3RoaXMubWFwTmFtZV0pO1xyXG5cdFx0dGhpcy5tYXBXb24gPSBmYWxzZTtcclxuXHJcblx0XHR2YXIgdmlld0ZhY3RvcnkgPSBuZXcgR1MuVmlld0ZhY3RvcnkodGhpcy5yZW5kZXJlciwgbWFwLCBhc3NldHMpO1xyXG5cdFx0dmlld0ZhY3RvcnkuaW5pdCgpO1xyXG5cdFx0dmFyIGdyaWRGYWN0b3J5ID0gbmV3IEdTLkdyaWRGYWN0b3J5KHZpZXdGYWN0b3J5LCB0aGlzLnNvdW5kTWFuYWdlciwgdGhpcy5yZW5kZXJlciwgdGhpcy5zY2VuZSwgdGhpcy5jYW1lcmEpO1xyXG5cdFx0dGhpcy5ncmlkID0gZ3JpZEZhY3RvcnkuZ2V0R3JpZChtYXApO1xyXG5cclxuXHRcdHRoaXMuc291bmRNYW5hZ2VyLmluaXRTb3VuZHMoYXNzZXRzW0dTLkFzc2V0VHlwZXMuU291bmRdKTtcclxuXHRcdHRoaXMubXVzaWNNYW5hZ2VyLmluaXRUcmFja3MoYXNzZXRzW0dTLkFzc2V0VHlwZXMuTXVzaWNUcmFja10pO1xyXG5cclxuXHRcdGlmICh0aGlzLnBsYXllclBlcnNpc3RlbmNlUGFja2FnZSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZ3JpZC5wbGF5ZXIuYXBwbHlQZXJzaXN0ZW5jZVBhY2thZ2UodGhpcy5wbGF5ZXJQZXJzaXN0ZW5jZVBhY2thZ2UpO1xyXG5cdFx0XHR0aGlzLnBsYXllclBlcnNpc3RlbmNlUGFja2FnZSA9IHVuZGVmaW5lZDtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmdyaWQudXBkYXRlKCk7XHJcblx0XHR0aGlzLmdyYXBoaWNzTWFuYWdlci5zZXRHcmlkKHRoaXMuZ3JpZCk7XHJcblxyXG5cdFx0Ly8gdGhpcy5ncmlkLnBsYXllci5jb250cm9scy5hZGRFdmVudExpc3RlbmVyKFwicG9pbnRlckxvY2tEaXNhYmxlZFwiLCBmdW5jdGlvbigpIHsgdGhhdC5vcGVuTWVudSgpOyB9KTtcclxuXHJcblx0XHQvLyBjb25zb2xlLmxvZyhcImNvbGxpc2lvbiB0cmlhbmdsZXNcIiwgdmlld0ZhY3RvcnkudHJpYW5nbGVDb3VudCk7XHJcblx0fSxcclxuXHJcblx0dXBkYXRlOiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciB0aW1lO1xyXG5cdFx0aWYgKHRoaXMuc2hvd1BlcmZvcm1hbmNlRGVidWdNZXRlcnMpIHtcclxuXHRcdFx0dGltZSA9IHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5zdGF0ZSA9PSBHUy5HYW1lU3RhdGVzLkRpc3Bvc2UpIHtcclxuXHRcdFx0aWYgKCF0aGlzLnVwZGF0ZWQpIHtcclxuXHRcdFx0XHR0aGlzLnVwZGF0ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMuZGlzcG9zZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICh0aGlzLnN0YXRlID09IEdTLkdhbWVTdGF0ZXMuUHJlTG9hZCkge1xyXG5cdFx0XHRpZiAoIXRoaXMudXBkYXRlZCkge1xyXG5cdFx0XHRcdHRoaXMudXBkYXRlZCA9IHRydWU7XHJcblx0XHRcdFx0dGhpcy5wcmVMb2FkKCk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZVxyXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT0gR1MuR2FtZVN0YXRlcy5Mb2FkaW5nKSB7XHJcblx0XHRcdHRoaXMudXBkYXRlZCA9IHRydWU7XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICh0aGlzLnN0YXRlID09IEdTLkdhbWVTdGF0ZXMuUG9zdExvYWQpIHtcclxuXHRcdFx0aWYgKCF0aGlzLnVwZGF0ZWQpIHtcclxuXHRcdFx0XHR0aGlzLnVwZGF0ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMucG9zdExvYWQoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSBlbHNlXHJcblx0XHRpZiAodGhpcy5zdGF0ZSA9PSBHUy5HYW1lU3RhdGVzLlBsYXkpIHtcclxuXHRcdFx0dGhpcy51cGRhdGVkID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5wbGF5KCk7XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICh0aGlzLnN0YXRlID09IEdTLkdhbWVTdGF0ZXMuTWVudSkge1xyXG5cdFx0XHR0aGlzLnVwZGF0ZWQgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLm1lbnUoKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5uZXh0U3RhdGUgIT09IG51bGwpIHtcclxuXHRcdFx0aWYgKHRoaXMudXBkYXRlZCkge1xyXG5cdFx0XHRcdGlmICh0aGlzLm5leHRTdGF0ZSA9PSBHUy5HYW1lU3RhdGVzLlBsYXkgfHwgdGhpcy5uZXh0U3RhdGUgPT0gR1MuR2FtZVN0YXRlcy5NZW51KSB7XHJcblx0XHRcdFx0XHR0aGlzLmxvYWRpbmdVSS5oaWRlKCk7XHJcblx0XHRcdFx0XHR0aGlzLnVpTWFuYWdlci5zaG93KCk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0aGlzLnN0YXRlID0gdGhpcy5uZXh0U3RhdGU7XHJcblx0XHRcdFx0dGhpcy5uZXh0U3RhdGUgPSBudWxsO1xyXG5cdFx0XHRcdHRoaXMudXBkYXRlZCA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuc2hvd1BlcmZvcm1hbmNlRGVidWdNZXRlcnMpIHtcclxuXHRcdFx0dGhpcy51cGRhdGVUaW1lID0gKHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKSAtIHRpbWUpLnRvRml4ZWQoMik7XHJcblx0XHRcdEdTLkRlYnVnVUkudHJhY2tOdW1lcmljVmFsdWUoXCJ1cGRhdGVUaW1lXCIsIHRoaXMudXBkYXRlVGltZSk7XHJcblx0XHR9XHJcblx0fSxcclxuXHJcblx0ZHJhdzogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGltZTtcclxuXHRcdGlmICh0aGlzLnNob3dQZXJmb3JtYW5jZURlYnVnTWV0ZXJzKSB7XHJcblx0XHRcdHRpbWUgPSB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT0gR1MuR2FtZVN0YXRlcy5QcmVMb2FkKSB7XHJcblx0XHRcdHRoaXMubG9hZGluZ1VJLmRyYXcoKTtcclxuXHRcdH0gZWxzZVxyXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT0gR1MuR2FtZVN0YXRlcy5Mb2FkaW5nKSB7XHJcblx0XHRcdHRoaXMubG9hZGluZ1VJLmRyYXcoKTtcclxuXHRcdH0gZWxzZVxyXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT0gR1MuR2FtZVN0YXRlcy5Qb3N0TG9hZCkge1xyXG5cdFx0XHR0aGlzLmxvYWRpbmdVSS5kcmF3KCk7XHJcblx0XHR9IGVsc2VcclxuXHRcdGlmICh0aGlzLnN0YXRlID09IEdTLkdhbWVTdGF0ZXMuUGxheSB8fCB0aGlzLnN0YXRlID09IEdTLkdhbWVTdGF0ZXMuTWVudSkge1xyXG5cdFx0XHRpZiAodGhpcy5ncmlkICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHR0aGlzLmdyYXBoaWNzTWFuYWdlci5kcmF3KCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHRoaXMudWlNYW5hZ2VyLmRyYXcoKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5zaG93UGVyZm9ybWFuY2VEZWJ1Z01ldGVycykge1xyXG5cdFx0XHR0aGlzLmRyYXdUaW1lID0gKHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKSAtIHRpbWUpLnRvRml4ZWQoMik7XHJcblx0XHRcdEdTLkRlYnVnVUkudHJhY2tOdW1lcmljVmFsdWUoXCJkcmF3VGltZVwiLCB0aGlzLmRyYXdUaW1lKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRvblJlc2l6ZTogZnVuY3Rpb24oKSB7XHJcblx0XHRHUy5CYXNlLnByb3RvdHlwZS5vblJlc2l6ZS5jYWxsKHRoaXMpO1xyXG5cclxuXHRcdHRoaXMudWlNYW5hZ2VyLm9uUmVzaXplKCk7XHJcblx0XHR0aGlzLmxvYWRpbmdVSS5vblJlc2l6ZSgpO1xyXG5cclxuXHRcdGlmICh0aGlzLmdyYXBoaWNzTWFuYWdlciAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZ3JhcGhpY3NNYW5hZ2VyLm9uUmVzaXplKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuZ3JpZCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZ3JpZC5vblJlc2l6ZSgpO1xyXG5cdFx0XHR0aGlzLmdyaWQucGxheWVyLnBsYXllclZpZXcub25SZXNpemUoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRjdXN0b21NYXA6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdHZhciBjdXN0b21NYXBJbnB1dCA9ICQoXCIjY3VzdG9tTWFwSW5wdXRcIik7XHJcblx0XHR2YXIgZmlsZXMgPSBjdXN0b21NYXBJbnB1dFswXS5maWxlcztcclxuXHJcblx0XHRpZiAoZmlsZXMgPT09IHVuZGVmaW5lZCB8fCBmaWxlcy5sZW5ndGggPT09IDApIHtcclxuXHRcdFx0Y3VzdG9tTWFwSW5wdXQudHJpZ2dlcihcImNsaWNrXCIpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGZpbGUgPSBmaWxlc1swXTtcclxuXHRcdHZhciBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuXHJcblx0XHRmaWxlUmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0dGhhdC5hc3NldExvYWRlci5hc3NldHNbR1MuQXNzZXRUeXBlcy5NYXBdLmN1c3RvbU1hcCA9IGUudGFyZ2V0LnJlc3VsdDtcclxuXHJcblx0XHRcdHRoYXQubG9hZExldmVsKFwiY3VzdG9tTWFwXCIpO1xyXG5cdFx0fTtcclxuXHJcblx0XHRmaWxlUmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XHJcblx0XHRcdEdBTUUuaGFuZGxlRmF0YWxFcnJvcihcImZpbGUgcmVhZCBlcnJvciAtIFwiICsgZS50YXJnZXQuZXJyb3IuY29kZSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdGZpbGVSZWFkZXIucmVhZEFzVGV4dChmaWxlKTtcclxuXHRcdGN1c3RvbU1hcElucHV0LnZhbChcIlwiKTtcclxuXHR9LFxyXG5cclxuXHJcblx0aGFuZGxlRmF0YWxFcnJvcjogZnVuY3Rpb24obWVzc2FnZSkge1xyXG5cdFx0dmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuXHRcdGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gXCI8c3BhbiBjbGFzcz0nZmF0YWwtZXJyb3InPiBmYXRhbCBlcnJvcjogJ1wiICsgbWVzc2FnZSArIFwiJzwvc3Bhbj48YnIvPlwiO1xyXG5cdFx0ZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nID0gXCIyMHB4XCI7XHJcblxyXG5cdFx0dmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuXHRcdGEuaW5uZXJIVE1MID0gXCJjbGljayBoZXJlIG9yIHJlZnJlc2ggcGFnZSB0byByZXN0YXJ0XCI7XHJcblx0XHRhLmNsYXNzTmFtZSA9IFwiZmF0YWwtZXJyb3ItbGlua1wiO1xyXG5cdFx0YS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuXHRcdH07XHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcclxuXHJcblx0XHR0aGlzLm5leHRTdGF0ZSA9IEdTLkdhbWVTdGF0ZXMuRGlzcG9zZTtcclxuXHR9LFxyXG5cclxuXHR1cGRhdGVGb3Y6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy5jYW1lcmFGb3YgPSBHUy5TZXR0aW5ncy5mb3Y7XHJcblx0XHR0aGlzLmNhbWVyYS5mb3YgPSBHUy5TZXR0aW5ncy5mb3Y7XHJcblx0XHR0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT0gR1MuR2FtZVN0YXRlcy5QbGF5KSB7XHJcblx0XHRcdHRoaXMuZ3JpZC51cGRhdGVGb3YoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRkaXNwb3NlRW5kOiBmdW5jdGlvbigpIHtcclxuXHRcdFRXRUVOLnJlbW92ZUFsbCgpO1xyXG5cdFx0dGhpcy5ncmlkID0gdW5kZWZpbmVkO1xyXG5cdFx0dGhpcy5ncmFwaGljc01hbmFnZXIucmVzZXQoKTtcclxuXHRcdHRoaXMuc2NlbmUgPSB1bmRlZmluZWQ7XHJcblx0XHR0aGlzLnVpTWFuYWdlci5kaXNwb3NlKCk7XHJcblxyXG5cdFx0dGhpcy5uZXh0U3RhdGUgPSBHUy5HYW1lU3RhdGVzLlByZUxvYWQ7XHJcblx0fSxcclxuXHJcblx0ZGlzcG9zZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG5cdFx0aWYgKHRoaXMuZ3JpZCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdHRoaXMuZ3JpZC5wbGF5ZXIuY29udHJvbHMuZGlzcG9zZShmdW5jdGlvbigpIHtcclxuXHRcdFx0XHR0aGF0LmRpc3Bvc2VFbmQoKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHR0aGlzLmRpc3Bvc2VFbmQoKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHJcblxyXG59KTtcclxuXHJcbnZhciBHQU1FO1xyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24oKSB7XHJcblx0R1MuRGV0ZWN0b3IucnVuKGZ1bmN0aW9uKCkge1xyXG5cdFx0R0FNRSA9IG5ldyBHUy5HYW1lKCk7XHJcblxyXG5cdFx0R0FNRS5wcmVJbml0KCk7XHJcblx0XHRHQU1FLmluaXQoKTtcclxuXHJcblx0fSk7XHJcbn0sIGZhbHNlKTtcclxuIiwiR1MuS2V5YmluZFNldHRpbmdzID0ge1xyXG5cdGtleWJpbmRzOiBbXHJcblx0XHR7XHJcblx0XHRcdGFjdGlvbk5hbWU6IFwibW92ZUZvcndhcmRcIixcclxuXHRcdFx0Y29udHJvbE5hbWU6IFwiV1wiLFxyXG5cdFx0XHRjb2RlOiA4N1xyXG5cdFx0fSxcclxuXHRcdHtcclxuXHRcdFx0YWN0aW9uTmFtZTogXCJtb3ZlQmFja3dhcmRcIixcclxuXHRcdFx0Y29udHJvbE5hbWU6IFwiU1wiLFxyXG5cdFx0XHRjb2RlOiA4M1xyXG5cdFx0fSxcclxuXHRcdHtcclxuXHRcdFx0YWN0aW9uTmFtZTogXCJzdHJhZmVMZWZ0XCIsXHJcblx0XHRcdGNvbnRyb2xOYW1lOiBcIkFcIixcclxuXHRcdFx0Y29kZTogNjVcclxuXHRcdH0sXHJcblx0XHR7XHJcblx0XHRcdGFjdGlvbk5hbWU6IFwic3RyYWZlUmlnaHRcIixcclxuXHRcdFx0Y29udHJvbE5hbWU6IFwiRFwiLFxyXG5cdFx0XHRjb2RlOiA2OFxyXG5cdFx0fSxcclxuXHRcdHtcclxuXHRcdFx0YWN0aW9uTmFtZTogXCJ1c2VcIixcclxuXHRcdFx0Y29udHJvbE5hbWU6IFwiRVwiLFxyXG5cdFx0XHRjb2RlOiA2OVxyXG5cdFx0fSxcclxuXHRcdHtcclxuXHRcdFx0YWN0aW9uTmFtZTogXCJzaG9vdFwiLFxyXG5cdFx0XHRjb250cm9sTmFtZTogXCJNT1VTRSBMRUZUXCIsXHJcblx0XHRcdG1vdXNlOiB0cnVlLFxyXG5cdFx0XHRidXR0b246IDFcclxuXHRcdH0sXHJcblx0XHR7XHJcblx0XHRcdGFjdGlvbk5hbWU6IFwicGlzdG9sXCIsXHJcblx0XHRcdGNvbnRyb2xOYW1lOiBcIjJcIixcclxuXHRcdFx0Y29kZTogNTBcclxuXHRcdH0sXHJcblx0XHR7XHJcblx0XHRcdGFjdGlvbk5hbWU6IFwic2hvdGd1blwiLFxyXG5cdFx0XHRjb250cm9sTmFtZTogXCIzXCIsXHJcblx0XHRcdGNvZGU6IDUxXHJcblx0XHR9LFxyXG5cdFx0e1xyXG5cdFx0XHRhY3Rpb25OYW1lOiBcImh5cGVyYmxhc3RlclwiLFxyXG5cdFx0XHRjb250cm9sTmFtZTogXCI0XCIsXHJcblx0XHRcdGNvZGU6IDUyXHJcblx0XHR9LFxyXG5cdF0sXHJcblxyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dGhpcy50ZXh0aW5wdXQgPSBuZXcgR1MuVGV4dElucHV0KCk7XHJcblx0XHR0aGlzLnRleHRpbnB1dC5pbml0KCk7XHJcblxyXG5cdFx0dGhpcy5yZWJvdW5kID0gbmV3IEdTLlJlYm91bmQoR1MuS2V5YmluZFNldHRpbmdzLmtleWJpbmRzKTtcclxuXHRcdHRoaXMucmVib3VuZC5pbml0KCk7XHJcblxyXG5cdFx0R1MuS2V5YmluZHMgPSB7fTtcclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMua2V5YmluZHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0dmFyIGtleWJpbmQgPSB0aGlzLmtleWJpbmRzW2ldO1xyXG5cdFx0XHRHUy5LZXliaW5kc1trZXliaW5kLmFjdGlvbk5hbWVdID0ga2V5YmluZDtcclxuXHRcdH1cclxuXHR9LFxyXG59O1xyXG4iLCJcclxuR1MuU2V0dGluZ3MgPSBmdW5jdGlvbigpIHtcclxuXHR2YXIgc2V0dGluZ3MgPSB7XHJcblx0XHRmb3ZNaW46IDYwLFxyXG5cdFx0Zm92TWF4OiAxMjAsXHJcblx0XHRmb3Y6IDc1LFxyXG5cclxuXHRcdHNzYW86IHRydWUsXHJcblx0XHRibG9vbTogdHJ1ZSxcclxuXHRcdG5vaXNlOiB0cnVlLFxyXG5cdFx0dmlnbmV0dGU6IHRydWUsXHJcblx0XHRmeGFhOiB0cnVlLFxyXG5cclxuXHJcblx0XHRoYWxmU2l6ZTogdHJ1ZSxcclxuXHRcdHNob3dGUFM6IHRydWUsXHJcblxyXG5cdFx0dmlld0JvYjogdHJ1ZSxcclxuXHRcdHdlYXBvbkJvYjogdHJ1ZSxcclxuXHJcblx0XHRzaG93SFVEOiB0cnVlLFxyXG5cdFx0c2hvd1dlYXBvbjogdHJ1ZSxcclxuXHJcblx0XHRzb3VuZE1pbjogMCxcclxuXHRcdHNvdW5kTWF4OiAxMCxcclxuXHRcdHNvdW5kOiA1LFxyXG5cclxuXHRcdG11c2ljTWluOiAwLFxyXG5cdFx0bXVzaWNNYXg6IDEwLFxyXG5cdFx0bXVzaWM6IDUsXHJcblxyXG5cdFx0bW91c2VNaW46IDEsXHJcblx0XHRtb3VzZU1heDogMTAsXHJcblx0XHRtb3VzZTogNSxcclxuXHRcdG1vdXNlSW52ZXJ0WTogZmFsc2UsXHJcblxyXG5cdFx0a2V5YmluZHM6IG51bGwsXHJcblxyXG4gICAgcm9vbU5hbWU6ICcnXHJcblx0fTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGxvYWRTZXR0aW5nczogZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBqc29uU3RyID0gbG9jYWxTdG9yYWdlW1wiZ3Mtc2V0dGluZ3NcIl07XHJcblx0XHRcdGlmIChqc29uU3RyICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHR2YXIgbG9hZGVkU2V0dGluZ3MgPSBKU09OLnBhcnNlKGpzb25TdHIpO1xyXG5cdFx0XHRcdGZvciAodmFyIGkgaW4gbG9hZGVkU2V0dGluZ3MpIHtcclxuXHRcdFx0XHRcdGlmIChpIGluIHNldHRpbmdzKSB7XHJcblx0XHRcdFx0XHRcdHNldHRpbmdzW2ldID0gbG9hZGVkU2V0dGluZ3NbaV07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAobG9hZGVkU2V0dGluZ3Mua2V5YmluZHMpIHtcclxuXHRcdFx0XHRcdEdTLktleWJpbmRTZXR0aW5ncy5rZXliaW5kcyA9IGxvYWRlZFNldHRpbmdzLmtleWJpbmRzO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0R1MuS2V5YmluZFNldHRpbmdzLmluaXQoKTtcclxuXHRcdFx0c2V0dGluZ3Mua2V5YmluZHMgPSBHUy5LZXliaW5kU2V0dGluZ3Mua2V5YmluZHM7XHJcblx0XHR9LFxyXG5cclxuXHJcblx0XHRzYXZlU2V0dGluZ3M6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHR2YXIganNvblN0ciA9IEpTT04uc3RyaW5naWZ5KHNldHRpbmdzKTtcclxuXHRcdFx0bG9jYWxTdG9yYWdlW1wiZ3Mtc2V0dGluZ3NcIl0gPSBqc29uU3RyO1xyXG5cclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IGZvdk1pbigpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLmZvdk1pbjtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IGZvdk1heCgpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLmZvdk1heDtcclxuXHRcdH0sXHJcblxyXG5cdFx0c2V0IGZvdih2YWx1ZSkge1xyXG5cdFx0XHR2YXIgbiA9IHBhcnNlSW50KHZhbHVlKTtcclxuXHRcdFx0aWYgKCFpc05hTihuKSkge1xyXG5cdFx0XHRcdG4gPSBNYXRoLmZsb29yKEdTLk1hdGhIZWxwZXIuY2xhbXAobiwgc2V0dGluZ3MuZm92TWluLCBzZXR0aW5ncy5mb3ZNYXgpKTtcclxuXHRcdFx0XHRzZXR0aW5ncy5mb3YgPSBuO1xyXG5cclxuXHRcdFx0XHRHQU1FLnVwZGF0ZUZvdigpO1xyXG5cdFx0XHRcdHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IGZvdigpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLmZvdjtcclxuXHRcdH0sXHJcblxyXG5cdFx0c2V0IHNzYW8odmFsdWUpIHtcclxuXHRcdFx0c2V0dGluZ3Muc3NhbyA9ICh2YWx1ZSA9PT0gdHJ1ZSk7XHJcblx0XHRcdEdBTUUuZ3JhcGhpY3NNYW5hZ2VyLnNzYW9FbmFibGVkID0gc2V0dGluZ3Muc3NhbztcclxuXHRcdFx0dGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IHNzYW8oKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5zc2FvO1xyXG5cdFx0fSxcclxuXHJcblx0XHRzZXQgYmxvb20odmFsdWUpIHtcclxuXHRcdFx0c2V0dGluZ3MuYmxvb20gPSAodmFsdWUgPT09IHRydWUpO1xyXG5cdFx0XHRHQU1FLmdyYXBoaWNzTWFuYWdlci5ibG9vbUVuYWJsZWQgPSBzZXR0aW5ncy5ibG9vbTtcclxuXHRcdFx0dGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IGJsb29tKCkge1xyXG5cdFx0XHRyZXR1cm4gc2V0dGluZ3MuYmxvb207XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldCBub2lzZSh2YWx1ZSkge1xyXG5cdFx0XHRzZXR0aW5ncy5ub2lzZSA9ICh2YWx1ZSA9PT0gdHJ1ZSk7XHJcblx0XHRcdEdBTUUuZ3JhcGhpY3NNYW5hZ2VyLm5vaXNlRW5hYmxlZCA9IHNldHRpbmdzLm5vaXNlO1xyXG5cdFx0XHR0aGlzLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXQgbm9pc2UoKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5ub2lzZTtcclxuXHRcdH0sXHJcblxyXG5cdFx0c2V0IHZpZ25ldHRlKHZhbHVlKSB7XHJcblx0XHRcdHNldHRpbmdzLnZpZ25ldHRlID0gKHZhbHVlID09PSB0cnVlKTtcclxuXHRcdFx0R0FNRS5ncmFwaGljc01hbmFnZXIudmlnbmV0dGVFbmFibGVkID0gc2V0dGluZ3MudmlnbmV0dGU7XHJcblx0XHRcdHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldCB2aWduZXR0ZSgpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLnZpZ25ldHRlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRzZXQgZnhhYSh2YWx1ZSkge1xyXG5cdFx0XHRzZXR0aW5ncy5meGFhID0gKHZhbHVlID09PSB0cnVlKTtcclxuXHRcdFx0R0FNRS5ncmFwaGljc01hbmFnZXIuZnhhYUVuYWJsZWQgPSBzZXR0aW5ncy5meGFhO1xyXG5cdFx0XHR0aGlzLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXQgZnhhYSgpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLmZ4YWE7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldCB2aWV3Qm9iKHZhbHVlKSB7XHJcblx0XHRcdHNldHRpbmdzLnZpZXdCb2IgPSAodmFsdWUgPT09IHRydWUpO1xyXG5cdFx0XHR0aGlzLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRpZiAoR0FNRS5ncmlkICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRHQU1FLmdyaWQucGxheWVyLnBsYXllclZpZXcudmlld0JvYi5lbmFibGVkID0gc2V0dGluZ3Mudmlld0JvYjtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRnZXQgdmlld0JvYigpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLnZpZXdCb2I7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldCB3ZWFwb25Cb2IodmFsdWUpIHtcclxuXHRcdFx0c2V0dGluZ3Mud2VhcG9uQm9iID0gKHZhbHVlID09PSB0cnVlKTtcclxuXHRcdFx0dGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0aWYgKEdBTUUuZ3JpZCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0R0FNRS5ncmlkLnBsYXllci5wbGF5ZXJWaWV3LndlYXBvbkJvYi5lbmFibGVkID0gc2V0dGluZ3Mud2VhcG9uQm9iO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldCB3ZWFwb25Cb2IoKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy53ZWFwb25Cb2I7XHJcblx0XHR9LFxyXG5cclxuXHJcblxyXG5cdFx0c2V0IGhhbGZTaXplKHZhbHVlKSB7XHJcblx0XHRcdHNldHRpbmdzLmhhbGZTaXplID0gKHZhbHVlID09PSB0cnVlKTtcclxuXHRcdFx0dGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0R0FNRS5ncmFwaGljc01hbmFnZXIuaGFsZlNpemVFbmFibGVkID0gc2V0dGluZ3MuaGFsZlNpemU7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldCBoYWxmU2l6ZSgpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLmhhbGZTaXplO1xyXG5cdFx0fSxcclxuXHJcblx0XHRzZXQgc2hvd0ZQUyh2YWx1ZSkge1xyXG5cdFx0XHRzZXR0aW5ncy5zaG93RlBTID0gKHZhbHVlID09PSB0cnVlKTtcclxuXHRcdFx0dGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0R0FNRS5zaG93RlBTID0gc2V0dGluZ3Muc2hvd0ZQUztcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IHNob3dGUFMoKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5zaG93RlBTO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXQgc291bmRNaW4oKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5zb3VuZE1pbjtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IHNvdW5kTWF4KCkge1xyXG5cdFx0XHRyZXR1cm4gc2V0dGluZ3Muc291bmRNYXg7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldCBzb3VuZCh2YWx1ZSkge1xyXG5cdFx0XHR2YXIgbiA9IHBhcnNlSW50KHZhbHVlKTtcclxuXHRcdFx0aWYgKCFpc05hTihuKSkge1xyXG5cdFx0XHRcdG4gPSBNYXRoLmZsb29yKEdTLk1hdGhIZWxwZXIuY2xhbXAobiwgc2V0dGluZ3Muc291bmRNaW4sIHNldHRpbmdzLnNvdW5kTWF4KSk7XHJcblx0XHRcdFx0c2V0dGluZ3Muc291bmQgPSBuO1xyXG5cclxuXHRcdFx0XHRHQU1FLnNvdW5kTWFuYWdlci52b2x1bWUgPSBzZXR0aW5ncy5zb3VuZCAvIDEwO1xyXG5cdFx0XHRcdHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IHNvdW5kKCkge1xyXG5cdFx0XHRyZXR1cm4gc2V0dGluZ3Muc291bmQ7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldCBtdXNpY01pbigpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLm11c2ljTWluO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXQgbXVzaWNNYXgoKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5tdXNpY01heDtcclxuXHRcdH0sXHJcblxyXG5cdFx0c2V0IG11c2ljKHZhbHVlKSB7XHJcblx0XHRcdHZhciBuID0gcGFyc2VJbnQodmFsdWUpO1xyXG5cdFx0XHRpZiAoIWlzTmFOKG4pKSB7XHJcblx0XHRcdFx0biA9IE1hdGguZmxvb3IoR1MuTWF0aEhlbHBlci5jbGFtcChuLCBzZXR0aW5ncy5tdXNpY01pbiwgc2V0dGluZ3MubXVzaWNNYXgpKTtcclxuXHRcdFx0XHRzZXR0aW5ncy5tdXNpYyA9IG47XHJcblxyXG5cdFx0XHRcdEdBTUUubXVzaWNNYW5hZ2VyLnZvbHVtZSA9IHNldHRpbmdzLm11c2ljIC8gMTA7XHJcblx0XHRcdFx0dGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRnZXQgbXVzaWMoKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5tdXNpYztcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IG1vdXNlTWluKCkge1xyXG5cdFx0XHRyZXR1cm4gc2V0dGluZ3MubW91c2VNaW47XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldCBtb3VzZU1heCgpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLm1vdXNlTWF4O1xyXG5cdFx0fSxcclxuXHJcblx0XHRzZXQgbW91c2UodmFsdWUpIHtcclxuXHRcdFx0dmFyIG4gPSBwYXJzZUludCh2YWx1ZSk7XHJcblx0XHRcdGlmICghaXNOYU4obikpIHtcclxuXHRcdFx0XHRuID0gTWF0aC5mbG9vcihHUy5NYXRoSGVscGVyLmNsYW1wKG4sIHNldHRpbmdzLm1vdXNlTWluLCBzZXR0aW5ncy5tb3VzZU1heCkpO1xyXG5cdFx0XHRcdHNldHRpbmdzLm1vdXNlID0gbjtcclxuXHJcblx0XHRcdFx0aWYgKEdBTUUuZ3JpZCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0XHRHQU1FLmdyaWQucGxheWVyLmNvbnRyb2xzLmxvb2tTcGVlZCA9IDAuMDY2ICogKHNldHRpbmdzLm1vdXNlIC8gNSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IG1vdXNlKCkge1xyXG5cdFx0XHRyZXR1cm4gc2V0dGluZ3MubW91c2U7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldCBzaG93SFVEKHZhbHVlKSB7XHJcblx0XHRcdHNldHRpbmdzLnNob3dIVUQgPSAodmFsdWUgPT09IHRydWUpO1xyXG5cdFx0XHR0aGlzLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRHQU1FLnVpTWFuYWdlci5zaG93SFVEID0gc2V0dGluZ3Muc2hvd0hVRDtcclxuXHRcdFx0R0FNRS51aU1hbmFnZXIub3ZlcnJpZGVSZWRyYXcgPSB0cnVlO1xyXG5cdFx0fSxcclxuXHJcblx0XHRnZXQgc2hvd0hVRCgpIHtcclxuXHRcdFx0cmV0dXJuIHNldHRpbmdzLnNob3dIVUQ7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNldCBzaG93V2VhcG9uKHZhbHVlKSB7XHJcblx0XHRcdHNldHRpbmdzLnNob3dXZWFwb24gPSAodmFsdWUgPT09IHRydWUpO1xyXG5cdFx0XHR0aGlzLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRHQU1FLmdyYXBoaWNzTWFuYWdlci5zaG93V2VhcG9uID0gc2V0dGluZ3Muc2hvd1dlYXBvbjtcclxuXHRcdH0sXHJcblxyXG5cdFx0Z2V0IHNob3dXZWFwb24oKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5zaG93V2VhcG9uO1xyXG5cdFx0fSxcclxuXHJcblx0XHRzZXQgbW91c2VJbnZlcnRZKHZhbHVlKSB7XHJcblx0XHRcdHNldHRpbmdzLm1vdXNlSW52ZXJ0WSA9ICh2YWx1ZSA9PT0gdHJ1ZSk7XHJcblx0XHRcdHRoaXMuc2F2ZVNldHRpbmdzKCk7XHJcblx0XHRcdGlmIChHQU1FLmdyaWQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdEdBTUUuZ3JpZC5wbGF5ZXIuY29udHJvbHMubW91c2VJbnZlcnRZID0gc2V0dGluZ3MubW91c2VJbnZlcnRZO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdGdldCBtb3VzZUludmVydFkoKSB7XHJcblx0XHRcdHJldHVybiBzZXR0aW5ncy5tb3VzZUludmVydFk7XHJcblx0XHR9LFxyXG5cclxuICAgIGdldCByb29tTmFtZSgpIHtcclxuICAgICAgcmV0dXJuIHNldHRpbmdzLnJvb21OYW1lO1xyXG4gICAgfSxcclxuXHJcbiAgICBzZXQgcm9vbU5hbWUodmFsdWUpIHtcclxuICAgICAgc2V0dGluZ3Mucm9vbU5hbWUgPSB2YWx1ZTtcclxuICAgICAgdGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuICAgIH1cclxuXHR9XHJcbn0oKTtcclxuIiwiR1MuU29ja2V0ID0gZnVuY3Rpb24oKSB7XG4gIGxldCB0aGF0ID0gdGhpcztcbiAgcmV0dXJuIHtcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIGxldCB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDMwJztcbiAgICAgIGxldCB1cmwgPSAnaHR0cDovL3NvY2tldC5waXhlbHJvY2tldHN0dWRpby5jb20nO1xuICAgICAgLy8gbGV0IHVybCA9ICdodHRwOi8vMTkyLjE2OC44Ni4yNjozMDMwJztcbiAgICAgIEdTLlNvY2tldC5pbyA9IGlvKHVybCk7XG4gICAgICAvLyBHUy5Tb2NrZXQucDJwID0gbmV3IFAyUChHUy5Tb2NrZXQuaW8pO1xuICAgIH0sXG4gICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKEdTLlNvY2tldC5pbykge1xuICAgICAgICBHUy5Tb2NrZXQuaW8uY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9LFxuICB9O1xufSgpO1xuIl19
